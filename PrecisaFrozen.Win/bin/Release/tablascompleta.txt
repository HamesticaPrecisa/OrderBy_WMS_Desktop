SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO


GO
CREATE TABLE [dbo].[_personas](
	[ID] [int] IDENTITY(1,1) NOT NULL,
	[PRIMERNOMBRE] [varchar](50) NOT NULL,
	[SEGUNDONOMBRE] [varchar](50) NOT NULL
) ON [PRIMARY]

GO
SET ANSI_PADDING OFF
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[AccionCamion](
	[ID] [int] IDENTITY(1,1) NOT NULL,
	[Descripcion] [char](30) NOT NULL,
 CONSTRAINT [PK_AccionCamion] PRIMARY KEY CLUSTERED 
(
	[ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_PADDING OFF
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[Actualizaciones](
	[Act_Codi] [int] IDENTITY(1,1) NOT NULL,
	[Act_version] [nvarchar](8) NULL,
	[Act_Fecha] [date] NULL,
	[Act_Descripcion] [varchar](900) NULL,
 CONSTRAINT [PK_Actualizaciones] PRIMARY KEY CLUSTERED 
(
	[Act_Codi] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_PADDING OFF
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[ACUSETE_LOG](
	[LOG_FECAVISO] [nvarchar](10) NULL,
	[LOG_HORAVISO] [nvarchar](5) NULL,
	[LOG_USUARIO] [nvarchar](5) NULL,
	[LOG_PALLET] [nvarchar](9) NULL,
	[LOG_FECMOV] [nvarchar](10) NULL,
	[LOG_HORMOV] [nvarchar](5) NULL
) ON [PRIMARY]

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[ACUSETE_PARAMETROS](
	[acu_horas] [nvarchar](2) NULL,
	[acu_fecha] [nvarchar](10) NULL
) ON [PRIMARY]

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[AINVENTARIO](
	[PALLET] [varchar](50) NULL,
	[ESTADO] [varchar](50) NULL,
	[USUARIO] [varchar](50) NULL,
	[FECHA] [datetime] NULL,
	[TIPOLECT] [varchar](20) NULL,
	[VALPRODUCTO] [numeric](18, 0) NULL,
	[VALCLIENTE] [numeric](18, 0) NULL,
	[VALCANTIDAD] [numeric](18, 0) NULL,
	[CODPRODUCTO] [varchar](50) NULL
) ON [PRIMARY]

GO
SET ANSI_PADDING OFF
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[AINVENTARIO1](
	[PALLET] [varchar](50) NULL,
	[ESTADO] [varchar](50) NULL,
	[USUARIO] [varchar](50) NULL,
	[FECHA] [datetime] NULL,
	[TIPOLECT] [varchar](20) NULL
) ON [PRIMARY]

GO
SET ANSI_PADDING OFF
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[ajustetarifas](
	[id] [varchar](50) NULL,
	[contrato] [varchar](50) NULL,
	[servicio] [varchar](50) NULL,
	[valor] [float] NULL,
	[cambio] [float] NULL,
	[fecha] [datetime] NULL
) ON [PRIMARY]

GO
SET ANSI_PADDING OFF
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Alumnos](
	[Rut] [nvarchar](10) NOT NULL,
	[Nombre] [nvarchar](100) NULL,
	[Mail] [nvarchar](100) NULL,
	[Clave] [nvarchar](8) NULL,
 CONSTRAINT [PK_Alumnos] PRIMARY KEY CLUSTERED 
(
	[Rut] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[AlumnosNotas](
	[Rut] [nvarchar](10) NOT NULL,
	[Nota1] [numeric](18, 0) NULL,
	[Nota2] [numeric](18, 0) NULL,
	[Nota3] [numeric](18, 0) NULL,
 CONSTRAINT [PK_AlumnosNotas] PRIMARY KEY CLUSTERED 
(
	[Rut] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[AndenesReg](
	[Folio] [nchar](10) NULL,
	[Anden] [nvarchar](50) NULL,
	[cliente] [nvarchar](50) NULL,
	[tip_mov] [nvarchar](50) NULL,
	[fec_reg] [datetime] NULL,
	[usr_reg] [nvarchar](20) NULL,
	[usr_reg2] [nvarchar](20) NULL,
	[Obs] [nvarchar](80) NULL,
	[cod_bod] [nchar](10) NULL
) ON [PRIMARY]

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[anuladoc](
	[anul_unica] [uniqueidentifier] NOT NULL CONSTRAINT [DF_anuladoc_anul_unica]  DEFAULT (newid()),
	[anul_codi] [nvarchar](10) NULL,
	[anul_fecha] [nvarchar](10) NULL,
	[anul_hora] [nvarchar](8) NULL,
	[anul_usuario] [nvarchar](10) NULL,
	[anul_personal] [int] NULL,
	[anul_glosa] [nvarchar](50) NULL,
 CONSTRAINT [PK_anuladoc] PRIMARY KEY NONCLUSTERED 
(
	[anul_unica] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[ApeCieAndenes](
	[Folio] [nchar](10) NULL,
	[Anden] [nvarchar](50) NULL,
	[cliente] [nvarchar](50) NULL,
	[aper] [datetime] NULL,
	[cierrre] [datetime] NULL
) ON [PRIMARY]

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[CAJAS_DANADAS](
	[CDAN_PALLET] [nvarchar](9) NULL,
	[CDAN_FECHA] [nvarchar](10) NULL,
	[CDAN_OBSERVACION] [nvarchar](255) NULL,
	[CDAN_ESTADO] [nvarchar](50) NULL,
	[CDAN_HORA] [nvarchar](5) NULL,
	[CDAN_LINK] [nvarchar](255) NULL,
	[CDAN_CAJAS] [nvarchar](5) NULL
) ON [PRIMARY]

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[CAJAS_DANADAS_LOG](
	[id] [nvarchar](14) NULL,
	[fecha] [nvarchar](10) NULL,
	[pallet] [nvarchar](9) NULL,
	[cajas] [numeric](18, 0) NULL,
	[usuario] [nvarchar](50) NULL,
	[equipo] [nvarchar](50) NULL,
	[tipo] [nvarchar](50) NULL
) ON [PRIMARY]

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[CamaraConf](
	[Camara] [nchar](10) NULL,
	[NCamara] [nvarchar](max) NULL,
	[Columnas] [nchar](10) NULL,
	[Bandas] [nchar](10) NULL,
	[AlturaP] [nchar](10) NULL,
	[PisosP] [nchar](10) NULL,
	[apiso] [nchar](20) NULL,
	[rack_sel] [nchar](20) NULL,
	[push_back] [nchar](20) NULL,
	[drivein] [nchar](20) NULL,
	[libre] [nchar](20) NULL,
	[cod_bod] [nchar](10) NULL
) ON [PRIMARY] TEXTIMAGE_ON [PRIMARY]

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[CamaraMantenedor](
	[NombreCamara] [nvarchar](50) NULL,
	[Camara] [nchar](10) NULL,
	[Banda] [nchar](10) NULL,
	[Columna] [nchar](10) NULL,
	[Piso] [nchar](10) NULL,
	[Nivel] [nchar](10) NULL,
	[Altura] [nchar](10) NULL,
	[Cordenada] [nchar](10) NULL,
	[TipoPos] [nvarchar](50) NULL,
	[Bloqueo] [nchar](10) NULL,
	[TipoBloqueo] [nchar](10) NULL,
	[cod_bod] [nchar](10) NULL
) ON [PRIMARY]

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[camaras](
	[cam_unica] [uniqueidentifier] NOT NULL CONSTRAINT [DF_camaras_cam_unica]  DEFAULT (newid()),
	[cam_codi] [varchar](3) NULL,
	[cam_descr] [varchar](30) NULL,
	[cam_tipo] [tinyint] NULL,
	[cam_tipocon] [tinyint] NULL,
	[cam_temper] [float] NULL,
	[cam_humed] [float] NULL,
	[cam_baninic] [float] NULL,
	[cam_banfin] [float] NULL,
	[cam_numcol] [float] NULL,
	[cam_numpiso] [float] NULL,
	[cam_numnive] [float] NULL,
	[cam_capm3] [float] NULL,
	[cam_captone] [float] NULL,
	[cam_numplan] [nvarchar](2) NULL,
	[cam_unidadini] [int] NULL,
	[cam_unidadfin] [int] NULL,
	[cam_capa] [numeric](18, 0) NULL,
	[cam_tmp] [numeric](18, 0) NULL,
 CONSTRAINT [PK_camaras] PRIMARY KEY NONCLUSTERED 
(
	[cam_unica] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_PADDING OFF
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Camaras_Altura](
	[camara] [nvarchar](5) NULL,
	[columna] [nvarchar](5) NULL,
	[piso] [nvarchar](5) NULL,
	[altura] [nvarchar](5) NULL
) ON [PRIMARY]

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[CambioFechaDocumento](
	[ID] [int] IDENTITY(1,1) NOT NULL,
	[Fecha] [smalldatetime] NULL,
	[NumeroDocumento] [char](10) NULL,
	[TipoDocumento] [char](10) NULL,
	[Reproceso] [bit] NOT NULL,
	[Usuario] [char](10) NULL,
	[FechaAnterior] [smalldatetime] NULL,
	[FechaNueva] [smalldatetime] NULL,
 CONSTRAINT [PK_CambioFechaDocumento] PRIMARY KEY NONCLUSTERED 
(
	[ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_PADDING OFF
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[CARGA_DESCARGA](
	[Codigo] [nvarchar](1) NULL,
	[Desc] [char](10) NULL
) ON [PRIMARY]

GO
SET ANSI_PADDING OFF
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[categorias_cliente](
	[CODIGO_CATEGORIA] [int] IDENTITY(1,1) NOT NULL,
	[NOMBRE_CATEGORIA] [varchar](2) NOT NULL,
	[ESTADO_CATEGORIA] [varchar](15) NOT NULL,
PRIMARY KEY CLUSTERED 
(
	[CODIGO_CATEGORIA] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_PADDING OFF
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[chk_images](
	[id_chk] [int] NULL,
	[nombre] [nchar](1) NULL,
	[id_pallets] [bigint] NULL CONSTRAINT [DF_chk_images_id_pallets]  DEFAULT ((0)),
	[cl_imgtem] [image] NULL,
	[cl_imgsel] [image] NULL,
	[cl_imgpat] [image] NULL,
	[cl_fecha] [datetime] NULL,
	[fechamod] [datetime] NULL,
	[cl_imgtemS] [image] NULL,
	[cl_imgselS] [image] NULL,
	[cl_imgpatS] [image] NULL
) ON [PRIMARY] TEXTIMAGE_ON [PRIMARY]

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[chk_imagesopo](
	[id_pallets] [varchar](9) NULL,
	[cl_imgtem] [image] NULL,
	[cl_imgsel] [image] NULL,
	[cl_imgpat] [image] NULL,
	[cl_fecha] [datetime] NULL CONSTRAINT [DF_chk_imagesopo_fecha]  DEFAULT (getdate())
) ON [PRIMARY] TEXTIMAGE_ON [PRIMARY]

GO
SET ANSI_PADDING OFF
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[chk_imagestmp](
	[id_chk] [int] NULL,
	[nombre] [nchar](1) NULL,
	[codtpmrece] [int] NULL,
	[cl_imgpat] [image] NULL,
	[cl_imgsel] [image] NULL,
	[cl_imgtem] [image] NULL,
	[cl_fecha] [datetime] NULL CONSTRAINT [DF_chk_imagestmp_fecha]  DEFAULT (getdate()),
	[id_pallets] [nvarchar](9) NULL,
	[fechamod] [datetime] NULL
) ON [PRIMARY] TEXTIMAGE_ON [PRIMARY]

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[choferes](
	[cho_unica] [uniqueidentifier] NOT NULL CONSTRAINT [DF_choferes_cho_unica]  DEFAULT (newid()),
	[cho_rut] [nvarchar](9) NULL,
	[cho_rutclie] [nvarchar](9) NULL,
	[cho_nombre] [nvarchar](40) NULL,
	[cho_patente] [nvarchar](10) NULL,
	[cho_empresa] [nvarchar](50) NULL,
	[cho_rutempresa] [nvarchar](13) NULL,
	[cho_patente2] [nvarchar](20) NULL,
	[cho_fecreg] [datetime] NULL CONSTRAINT [DF_choferes_cho_fecreg]  DEFAULT (getdate()),
 CONSTRAINT [PK_choferes] PRIMARY KEY NONCLUSTERED 
(
	[cho_unica] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[cincuenta](
	[folio] [char](10) NULL,
	[despacho] [char](10) NULL,
	[cliente] [char](10) NULL,
	[carga] [char](10) NULL,
	[cincuenta] [bit] NOT NULL,
	[fecha] [datetime] NULL
) ON [PRIMARY]

GO
SET ANSI_PADDING OFF
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[ciudad](
	[ciu_unica] [uniqueidentifier] NOT NULL CONSTRAINT [DF_ciudad_ciu_unica]  DEFAULT (newid()),
	[ciu_codi] [nvarchar](3) NULL,
	[ciu_descr] [nvarchar](30) NULL,
 CONSTRAINT [PK_ciudad] PRIMARY KEY NONCLUSTERED 
(
	[ciu_unica] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[ClasificacionMovimiento](
	[Cmov_codi] [varchar](50) NOT NULL,
	[Cmov_Descrip] [varchar](50) NULL,
 CONSTRAINT [PK_ClasificacionMovimiento] PRIMARY KEY CLUSTERED 
(
	[Cmov_codi] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_PADDING OFF
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[clientes](
	[cli_unica] [uniqueidentifier] ROWGUIDCOL  NULL CONSTRAINT [DF_clientes_cli_unica]  DEFAULT (newid()),
	[cli_rut] [varchar](9) NOT NULL,
	[cli_nomb] [varchar](50) NULL,
	[cli_direcc] [varchar](50) NULL,
	[cli_comuna] [varchar](50) NULL,
	[cli_ciudad] [varchar](50) NULL,
	[cli_fono] [varchar](50) NULL,
	[cli_fax] [varchar](50) NULL,
	[cli_feccre] [varchar](50) NULL,
	[cli_estado] [varchar](50) NULL,
	[cli_rubro] [varchar](50) NULL,
	[cli_mail] [varchar](max) NULL,
	[Mail2] [varchar](max) NULL,
	[CLI_CRYD] [varchar](max) NULL,
	[CLI_VENC] [nvarchar](1) NULL,
	[CLI_PVENC] [nvarchar](300) NULL,
	[cli_envio] [nvarchar](1) NULL,
	[cli_diaenv] [nvarchar](1) NULL,
	[cli_validarfecvenc] [char](1) NULL CONSTRAINT [DF_clientes_cli_validarfecvenc]  DEFAULT ((0)),
	[cli_picking] [numeric](18, 0) NULL CONSTRAINT [DF_clientes_cli_picking]  DEFAULT ((0)),
	[cli_ItemGuia] [numeric](18, 0) NULL CONSTRAINT [DF_clientes_cli_ItemGuia]  DEFAULT ((0)),
	[cli_recepciones] [numeric](18, 0) NULL CONSTRAINT [DF_clientes_cli_recepciones]  DEFAULT ((0)),
	[cli_despachos] [numeric](18, 0) NULL CONSTRAINT [DF_clientes_cli_despachos]  DEFAULT ((0)),
	[cli_facturabloqueo] [numeric](18, 0) NULL CONSTRAINT [DF_clientes_cli_facturabloqueo]  DEFAULT ((0)),
	[cli_dia] [numeric](18, 0) NULL CONSTRAINT [DF_clientes_cli_dia]  DEFAULT ((1)),
	[cli_codvig] [numeric](18, 0) NULL,
	[cli_estadopedcaja] [int] NULL CONSTRAINT [DF_clientes_cli_estadopedcaja]  DEFAULT ((3)),
	[cli_length] [numeric](18, 0) NULL,
	[cli_pwdbloqueo] [nvarchar](15) NULL,
	[cli_tipoclie] [varchar](15) NULL,
	[cli_contactos] [varchar](max) NULL,
	[cli_inftraq] [numeric](18, 0) NULL,
	[cli_tramorece] [int] NULL CONSTRAINT [DF_clientes_cli_tramorece]  DEFAULT ((2)),
	[cli_tramodespa] [int] NULL CONSTRAINT [DF_clientes_cli_tramodespa]  DEFAULT ((2)),
	[cli_procrece] [int] NULL CONSTRAINT [DF_clientes_cli_procrece]  DEFAULT ((1)),
	[cli_procdespa] [int] NULL CONSTRAINT [DF_clientes_cli_procdespa]  DEFAULT ((1)),
	[cli_blockweb] [int] NULL,
	[cli_blockGes] [int] NULL,
	[cli_hrs_homog] [int] NULL,
	[cli_stock0] [int] NULL,
	[cod_bod] [nchar](10) NULL,
 CONSTRAINT [PK_clientes] PRIMARY KEY NONCLUSTERED 
(
	[cli_rut] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY] TEXTIMAGE_ON [PRIMARY]

GO
SET ANSI_PADDING OFF
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[Clientes_CodigoPequeno](
	[cli_rut] [char](10) NULL,
	[cli_cod] [char](10) NULL
) ON [PRIMARY]

GO
SET ANSI_PADDING OFF
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[CLIENTES_LOG_BLOQUEOS](
	[ID] [nvarchar](14) NULL,
	[USUARIO] [nvarchar](50) NULL,
	[PC] [nvarchar](50) NULL,
	[RECEPCION] [nvarchar](50) NULL,
	[DESPACHO] [nvarchar](50) NULL,
	[USUARIOGESTION] [nvarchar](3) NULL,
	[CLIENTE] [nvarchar](10) NULL
) ON [PRIMARY]

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[ConexionDatos](
	[ip_servidor] [nvarchar](50) NULL,
	[nombre_serv] [nvarchar](50) NULL,
	[user_adm] [nvarchar](50) NULL,
	[pass] [nvarchar](50) NULL,
	[Tipo] [nchar](10) NULL
) ON [PRIMARY]

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Conf_Impresora](
	[Imp_Id] [uniqueidentifier] NULL CONSTRAINT [DF_Conf_Impresora_Imp_Id]  DEFAULT (newid()),
	[Imp_Comp] [nvarchar](70) NULL,
	[Imp_Etiq] [nvarchar](70) NULL,
	[Imp_Inf] [nvarchar](70) NULL,
	[Imp_FecConf] [datetime] NULL,
	[Imp_Com1] [nvarchar](4) NULL
) ON [PRIMARY]

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[CONFIGURACION_DATAMAX](
	[PC] [nvarchar](50) NULL,
	[CALOR] [nvarchar](2) NULL,
	[DATAMAX] [bit] NULL
) ON [PRIMARY]

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[confirma](
	[con_unica] [uniqueidentifier] NOT NULL CONSTRAINT [DF_confirma_con_unica]  DEFAULT (newid()),
	[con_tipope] [nvarchar](1) NULL,
	[con_folio] [nvarchar](9) NULL,
	[con_nper] [nvarchar](3) NULL,
	[con_fecha] [nvarchar](10) NULL,
	[con_dhora] [nvarchar](6) NULL,
	[con_hhora] [nvarchar](50) NULL,
 CONSTRAINT [PK_confirma] PRIMARY KEY NONCLUSTERED 
(
	[con_unica] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[contrato](
	[cont_codi] [varchar](7) NOT NULL,
	[cont_rutclie] [varchar](9) NULL,
	[cont_descr] [varchar](50) NULL,
	[cont_feccont] [date] NULL,
	[cont_fecexpi] [date] NULL,
	[cont_TipAlmc] [numeric](18, 0) NULL,
	[cont_manual] [numeric](18, 0) NULL,
	[cont_tempcon] [real] NULL,
	[cont_tempgra] [real] NULL,
	[cont_diagracia] [smallint] NULL,
	[cont_cc] [int] NULL,
	[cont_tunelG] [int] NULL,
	[cont_estado] [numeric](18, 0) NULL,
	[cont_Tunelescala] [nvarchar](1) NULL CONSTRAINT [DF_contrato_cont_Tunelescala]  DEFAULT ((0)),
	[cont_palletpromedio] [int] NULL,
	[cont_mespromedio] [nvarchar](12) NULL,
	[cont_producto] [numeric](18, 0) NULL CONSTRAINT [DF_contrato_cont_producto]  DEFAULT ((0)),
	[CONT_RECEPCIONES] [numeric](18, 0) NULL CONSTRAINT [DF_contrato_CONT_RECEPCIONES]  DEFAULT (N'0'),
	[CONT_DESPACHOS] [numeric](18, 0) NULL CONSTRAINT [DF_contrato_CONT_DESPACHOS]  DEFAULT (N'0'),
	[cont_BloqImp] [numeric](18, 0) NULL CONSTRAINT [DF_contrato_cont_BloqImp]  DEFAULT ((0)),
	[cont_bloqfac] [numeric](18, 0) NULL,
	[cont_rutpro] [varchar](15) NULL,
	[cont_fecproc] [nvarchar](10) NULL,
	[cont_diafact] [int] NULL,
	[cont_contrel] [nvarchar](7) NULL,
	[cont_diacont] [smallint] NULL,
	[cont_tipo] [int] NULL CONSTRAINT [DF_contrato_cont_tipo]  DEFAULT ((0)),
	[cont_pallet] [int] NULL,
	[cont_lectura] [numeric](18, 0) NULL CONSTRAINT [DF_contrato_cont_lectura]  DEFAULT ((0)),
	[cont_tipseg] [numeric](18, 0) NULL,
 CONSTRAINT [PK_contrato] PRIMARY KEY NONCLUSTERED 
(
	[cont_codi] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_PADDING OFF
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[contrato_hist](
	[cont_unica_hist] [char](16) NULL,
	[cont_rutclie_hist] [nvarchar](9) NULL,
	[cont_rutpro_hist] [varchar](15) NULL,
	[cont_codi_hist] [nvarchar](7) NULL,
	[cont_descr_hist] [nvarchar](40) NULL,
	[cont_feccont_hist] [nvarchar](10) NULL,
	[cont_fecexpi_hist] [nvarchar](10) NULL,
	[cont_fecproc_hist] [nvarchar](10) NULL,
	[cont_diafact_hist] [int] NULL,
	[cont_tempcon_hist] [real] NULL,
	[cont_tempgra_hist] [real] NULL,
	[cont_contrel_hist] [nvarchar](7) NULL,
	[cont_diacont_hist] [smallint] NULL,
	[cont_diagracia_hist] [smallint] NULL,
	[cont_tipo_hist] [int] NULL,
	[cont_pallet_hist] [int] NULL,
	[cont_fecha_hist] [datetime] NULL,
	[cont_CodWeb] [decimal](18, 0) NULL,
	[cont_GrupFec] [decimal](18, 0) NULL
) ON [PRIMARY]

GO
SET ANSI_PADDING OFF
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[Contratos_Procesos](
	[cont_unica] [varchar](255) NULL,
	[cont_rutclie] [varchar](255) NULL,
	[cont_rutPro] [varchar](50) NULL,
	[cont_codi] [varchar](255) NULL,
	[cont_descr] [varchar](255) NULL,
	[cont_feccont] [varchar](255) NULL,
	[cont_fecexpi] [varchar](255) NULL,
	[cont_fecproc] [varchar](255) NULL,
	[cont_diafact] [int] NULL,
	[cont_tempcon] [real] NULL,
	[cont_tempgra] [real] NULL,
	[cont_contrel] [varchar](255) NULL,
	[cont_diacont] [smallint] NULL,
	[cont_diagracia] [smallint] NULL
) ON [PRIMARY]

GO
SET ANSI_PADDING OFF
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[contratos_web](
	[con_unica] [uniqueidentifier] NULL,
	[con_rut] [varchar](9) NULL,
	[con_pdf] [varchar](200) NULL,
	[con_excel] [varchar](200) NULL,
	[con_imagen] [varchar](200) NULL,
	[con_estado] [varchar](9) NULL
) ON [PRIMARY]

GO
SET ANSI_PADDING OFF
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[ContratosDetalle](
	[Dcon_Codigo] [varchar](7) NOT NULL,
	[Dcon_ServCod] [varchar](3) NOT NULL,
	[Dcon_activo] [numeric](18, 0) NULL,
	[Dcon_Valor] [float] NULL,
	[Dcon_Moneda] [varchar](2) NULL,
	[Dcon_Medida] [varchar](3) NULL,
	[Dcon_codvig] [numeric](18, 0) NULL,
	[Dcon_cero] [numeric](18, 0) NULL,
 CONSTRAINT [PK_ContratosDetalle] PRIMARY KEY CLUSTERED 
(
	[Dcon_Codigo] ASC,
	[Dcon_ServCod] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_PADDING OFF
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[ContratosHorarios](
	[Hor_ContCod] [varchar](7) NOT NULL,
	[Hor_SRI] [varchar](5) NULL,
	[Hor_SRT] [varchar](5) NULL,
	[Hor_SDI] [varchar](5) NULL,
	[Hor_SDT] [varchar](5) NULL,
	[Hor_FRI] [varchar](5) NULL,
	[Hor_FRT] [varchar](5) NULL,
	[Hor_FDI] [varchar](5) NULL,
	[Hor_FDT] [varchar](5) NULL,
 CONSTRAINT [PK_ContratosHorarios_1] PRIMARY KEY CLUSTERED 
(
	[Hor_ContCod] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_PADDING OFF
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[ControlVersion](
	[numero] [nvarchar](2) NULL,
	[programa] [nvarchar](15) NULL,
	[version] [nvarchar](10) NULL,
	[sitioweb] [nvarchar](255) NULL
) ON [PRIMARY]

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[contrpara](
	[cpar_unica] [uniqueidentifier] NOT NULL CONSTRAINT [DF_contrpara_cpar_unica]  DEFAULT (newid()),
	[cpar_contr] [nvarchar](7) NULL,
	[cpar_servi] [nvarchar](2) NULL,
	[cpar_marca] [nvarchar](1) NULL,
	[cpar_valor] [float] NULL,
	[cpar_moneda] [nvarchar](2) NULL,
	[cpar_medida] [nvarchar](7) NULL,
	[cpar_codvig] [tinyint] NULL CONSTRAINT [DF_contrpara_cpar_codvig]  DEFAULT (0),
	[cpar_meses] [nvarchar](12) NULL CONSTRAINT [DF_contrpara_cpar_meses]  DEFAULT (111111111111),
	[cpar_fechahabilita] [nvarchar](10) NULL,
 CONSTRAINT [PK_contrpara] PRIMARY KEY NONCLUSTERED 
(
	[cpar_unica] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[contrpara_hist](
	[cpar_unica_hist] [uniqueidentifier] NULL,
	[cpar_contr_hist] [nvarchar](7) NULL,
	[cpar_servi_hist] [nvarchar](2) NULL,
	[cpar_marca_hist] [nvarchar](1) NULL,
	[cpar_valor_hist] [real] NULL,
	[cpar_moneda_hist] [nvarchar](2) NULL,
	[cpar_medida_hist] [nvarchar](7) NULL,
	[cpar_codvig_hist] [tinyint] NULL,
	[cpar_fecha_hist] [datetime] NULL,
	[cpar_rutcli_hist] [nvarchar](50) NULL,
	[cpar_CodWeb] [decimal](18, 0) NULL,
	[cpar_GrupFec] [decimal](18, 0) NULL
) ON [PRIMARY]

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[correlat](
	[cor_unica] [uniqueidentifier] NOT NULL CONSTRAINT [DF_correlat_cor_unica]  DEFAULT (newid()),
	[cor_codi] [nvarchar](3) NULL,
	[cor_descr] [nvarchar](50) NULL,
	[cor_correini] [int] NULL,
	[cor_correfin] [int] NULL,
	[cor_correact] [int] NULL,
	[cor_codact] [tinyint] NULL,
 CONSTRAINT [PK_correlat] PRIMARY KEY NONCLUSTERED 
(
	[cor_unica] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Correlat_salto](
	[tmps_unica] [uniqueidentifier] ROWGUIDCOL  NOT NULL CONSTRAINT [DF_Correlat_salto_tmps_unica]  DEFAULT (newid()),
	[tmps_codi] [nvarchar](10) NOT NULL,
	[tmps_correl] [int] NOT NULL,
	[tmps_usuario] [nvarchar](10) NULL,
	[tmps_personal] [smallint] NULL,
	[tmps_fecha] [nvarchar](10) NULL,
	[tmps_gestion] [numeric](18, 0) NULL,
 CONSTRAINT [PK_Correlat_salto] PRIMARY KEY CLUSTERED 
(
	[tmps_codi] ASC,
	[tmps_correl] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[correlat_saltoTMP](
	[tmps_unica] [uniqueidentifier] NOT NULL,
	[tmps_codi] [nvarchar](10) NULL,
	[tmps_correl] [int] NULL,
	[tmps_usuario] [nvarchar](10) NULL,
	[tmps_personal] [smallint] NULL,
	[tmps_fecha] [nvarchar](10) NULL,
 CONSTRAINT [PK_correlat_saltoTMP] PRIMARY KEY CLUSTERED 
(
	[tmps_unica] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[CORRELATIVO](
	[TIPO] [int] NULL,
	[ACTUAL] [varchar](50) NULL,
	[UTILIZADO] [varchar](50) NULL
) ON [PRIMARY]

GO
SET ANSI_PADDING OFF
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[correlatTMP](
	[cor_unica] [uniqueidentifier] NOT NULL CONSTRAINT [DF_correlat_TMP_cor_unica]  DEFAULT (newid()),
	[cor_codi] [nvarchar](3) NULL,
	[cor_descr] [nvarchar](30) NULL,
	[cor_correini] [int] NULL,
	[cor_correfin] [int] NULL,
	[cor_correact] [int] NULL,
	[cor_codact] [tinyint] NULL,
 CONSTRAINT [PK_correlat_TMP] PRIMARY KEY CLUSTERED 
(
	[cor_unica] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[Correos](
	[corr_codi] [numeric](18, 0) NOT NULL,
	[corr_desc] [varchar](50) NULL,
	[corr_TO] [varchar](100) NULL,
	[corr_CCO] [varchar](500) NULL,
	[corr_BCC] [varchar](500) NULL,
 CONSTRAINT [PK_Correos] PRIMARY KEY CLUSTERED 
(
	[corr_codi] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_PADDING OFF
GO
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING OFF
GO
CREATE TABLE [dbo].[CORRTABLAS](
	[TABLA] [varchar](50) NOT NULL,
	[CODIGO] [numeric](18, 0) NOT NULL
) ON [PRIMARY]

GO
SET ANSI_PADDING OFF
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[Cotizaciones](
	[coti_codi] [varchar](7) NOT NULL,
	[coti_rutclie] [varchar](9) NULL,
	[coti_descr] [varchar](50) NULL,
	[coti_descrsopo] [varchar](50) NULL,
	[coti_feccont] [date] NULL,
	[coti_fecexpi] [date] NULL,
	[coti_TipAlmc] [numeric](18, 0) NULL,
	[coti_manual] [numeric](18, 0) NULL,
	[coti_tempcon] [real] NULL,
	[coti_tempgra] [real] NULL,
	[coti_diagracia] [smallint] NULL,
	[coti_cc] [int] NULL,
	[coti_tunelG] [int] NULL,
	[coti_estado] [numeric](18, 0) NULL,
	[coti_Tunelescala] [nvarchar](1) NULL CONSTRAINT [DF_Table_1_cont_Tunelescala]  DEFAULT ((0)),
	[coti_producto] [numeric](18, 0) NULL CONSTRAINT [DF_Table_1_cont_producto]  DEFAULT ((0)),
	[coti_RECEPCIONES] [numeric](18, 0) NULL CONSTRAINT [DF_Table_1_CONT_RECEPCIONES]  DEFAULT (N'0'),
	[coti_DESPACHOS] [numeric](18, 0) NULL CONSTRAINT [DF_Table_1_CONT_DESPACHOS]  DEFAULT (N'0'),
	[coti_BloqImp] [numeric](18, 0) NULL CONSTRAINT [DF_Table_1_cont_BloqImp]  DEFAULT ((0)),
	[coti_bloqfac] [numeric](18, 0) NULL,
	[coti_tipo] [int] NULL CONSTRAINT [DF_Table_1_cont_tipo]  DEFAULT ((0)),
	[coti_pallet] [int] NULL,
	[coti_lectura] [numeric](18, 0) NULL CONSTRAINT [DF_Table_1_cont_lectura]  DEFAULT ((0)),
	[coti_tipseg] [numeric](18, 0) NULL,
 CONSTRAINT [PK_Cotizaciones] PRIMARY KEY CLUSTERED 
(
	[coti_codi] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_PADDING OFF
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[CotizacionesDetalle](
	[Dcot_Codigo] [varchar](7) NOT NULL,
	[Dcot_ServCod] [varchar](3) NOT NULL,
	[Dcot_activo] [numeric](18, 0) NULL,
	[Dcot_Valor] [float] NULL,
	[Dcot_Moneda] [varchar](2) NULL,
	[Dcot_Medida] [varchar](3) NULL,
	[Dcot_codvig] [numeric](18, 0) NULL,
	[Dcot_cero] [numeric](18, 0) NULL,
 CONSTRAINT [PK_CotizacionesDetalle] PRIMARY KEY CLUSTERED 
(
	[Dcot_Codigo] ASC,
	[Dcot_ServCod] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_PADDING OFF
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[CotizacionesDetalleEscalas](
	[esc_coti] [varchar](7) NOT NULL,
	[esc_serser] [varchar](3) NOT NULL,
	[esc_ntramos] [numeric](18, 0) NULL,
	[esc_dtramo1] [float] NULL,
	[esc_htramo1] [float] NULL,
	[esc_valor1] [float] NULL,
	[esc_dtramo2] [float] NULL,
	[esc_htramo2] [float] NULL,
	[esc_valor2] [float] NULL,
	[esc_dtramo3] [float] NULL,
	[esc_htramo3] [float] NULL,
	[esc_valor3] [float] NULL,
	[esc_dtramo4] [float] NULL,
	[esc_htramo4] [float] NULL,
	[esc_valor4] [float] NULL,
	[esc_dtramo5] [float] NULL,
	[esc_htramo5] [float] NULL,
	[esc_valor5] [float] NULL,
	[esc_dtramo6] [float] NULL,
	[esc_htramo6] [float] NULL,
	[esc_valor6] [float] NULL,
	[esc_dtramo7] [float] NULL,
	[esc_htramo7] [float] NULL,
	[esc_valor7] [float] NULL,
	[esc_dtramo8] [float] NULL,
	[esc_htramo8] [float] NULL,
	[esc_valor8] [float] NULL,
	[esc_dtramo9] [float] NULL,
	[esc_htramo9] [float] NULL,
	[esc_valor9] [float] NULL,
	[esc_dtramo10] [float] NULL,
	[esc_htramo10] [float] NULL,
	[esc_valor10] [float] NULL,
 CONSTRAINT [PK_CotizacionesDetalleEscalas] PRIMARY KEY CLUSTERED 
(
	[esc_coti] ASC,
	[esc_serser] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_PADDING OFF
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[CotizacionesHorarios](
	[Hor_CotiCod] [varchar](7) NOT NULL,
	[Hor_SRI] [varchar](5) NULL,
	[Hor_SRT] [varchar](5) NULL,
	[Hor_SDI] [varchar](5) NULL,
	[Hor_SDT] [varchar](5) NULL,
	[Hor_FRI] [varchar](5) NULL,
	[Hor_FRT] [varchar](5) NULL,
	[Hor_FDI] [varchar](5) NULL,
	[Hor_FDT] [varchar](5) NULL,
 CONSTRAINT [PK_CotizacionesHorarios] PRIMARY KEY CLUSTERED 
(
	[Hor_CotiCod] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_PADDING OFF
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[DefaultHorarios](
	[Hor_ContCod] [varchar](7) NOT NULL,
	[Hor_SRI] [varchar](5) NULL,
	[Hor_SRT] [varchar](5) NULL,
	[Hor_SDI] [varchar](5) NULL,
	[Hor_SDT] [varchar](5) NULL,
	[Hor_FRI] [varchar](5) NULL,
	[Hor_FRT] [varchar](5) NULL,
	[Hor_FDI] [varchar](5) NULL,
	[Hor_FDT] [varchar](5) NULL,
 CONSTRAINT [PK_DefaultHorarios] PRIMARY KEY CLUSTERED 
(
	[Hor_ContCod] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_PADDING OFF
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[despaimagen](
	[dimg_imagen] [image] NULL,
	[dimg_num] [int] NULL,
	[dimg_despcodi] [nvarchar](7) NULL,
	[fecha] [datetime] NULL CONSTRAINT [DF_despaimagen_fecha]  DEFAULT (getdate()),
	[dimg_imagen2] [image] NULL
) ON [PRIMARY] TEXTIMAGE_ON [PRIMARY]

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[DestinoPallet](
	[DPal_codi] [int] NULL,
	[DPal_desc] [varchar](50) NULL
) ON [PRIMARY]

GO
SET ANSI_PADDING OFF
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[detacont](
	[dcon_cont] [varchar](20) NOT NULL,
	[dcon_folio] [varchar](9) NOT NULL,
	[dcon_usue] [nvarchar](3) NULL,
	[dcon_este] [int] NULL,
	[dcon_fet] [datetime] NULL,
	[dcon_usur] [nvarchar](3) NULL,
	[dcon_estr] [int] NULL,
	[dcon_fre] [datetime] NULL,
	[dcon_dr] [nvarchar](50) NULL,
 CONSTRAINT [PK_detacont_1] PRIMARY KEY CLUSTERED 
(
	[dcon_cont] ASC,
	[dcon_folio] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_PADDING OFF
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[detadespa](
	[ddes_unica] [uniqueidentifier] NOT NULL CONSTRAINT [DF_detadespa_ddes_unica]  DEFAULT (newid()),
	[ddes_codi] [nvarchar](9) NULL,
	[ddes_codpro] [nvarchar](7) NULL,
	[ddes_codsopo] [nvarchar](2) NULL,
	[ddes_sopocli] [nvarchar](17) NULL,
	[ddes_unidades] [int] NULL,
	[ddes_peso] [float] NULL,
	[ddes_fecprod] [nvarchar](10) NULL,
	[ddes_fecha] [nvarchar](10) NULL,
	[ddes_rutcli] [nvarchar](9) NULL,
	[ddes_contcli] [nvarchar](7) NULL,
	[ddes_camara] [nvarchar](2) NULL,
	[ddes_almacen] [tinyint] NULL,
	[ddes_codpred] [nvarchar](9) NULL,
	[ddes_codrece] [nvarchar](9) NULL,
	[ddes_codvig] [nvarchar](1) NULL,
	[ddes_pallet] [tinyint] NULL,
	[ddes_pedido] [nvarchar](25) NULL,
	[cod_bod] [nchar](10) NULL,
 CONSTRAINT [PK_detadespa] PRIMARY KEY NONCLUSTERED 
(
	[ddes_unica] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Detadespabasura](
	[ddes_unica] [uniqueidentifier] NOT NULL,
	[ddes_codi] [nvarchar](9) NULL,
	[ddes_codpro] [nvarchar](7) NULL,
	[ddes_codsopo] [nvarchar](2) NULL,
	[ddes_sopocli] [nvarchar](11) NULL,
	[ddes_unidades] [int] NULL,
	[ddes_peso] [float] NULL,
	[ddes_fecprod] [nvarchar](10) NULL,
	[ddes_fecha] [nvarchar](10) NULL,
	[ddes_rutcli] [nvarchar](9) NULL,
	[ddes_contcli] [nvarchar](7) NULL,
	[ddes_camara] [nvarchar](2) NULL,
	[ddes_almacen] [tinyint] NULL,
	[ddes_codpred] [nvarchar](9) NULL,
	[ddes_codrece] [nvarchar](9) NULL,
	[ddes_codvig] [nvarchar](1) NULL,
	[ddes_pallet] [tinyint] NULL
) ON [PRIMARY]

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[DETAETIQ](
	[ETIQ_CODI] [varchar](5) NOT NULL,
	[ETIQ_DCOD] [nvarchar](2) NOT NULL,
	[ETIQ_SOPOPRE] [nvarchar](9) NULL,
	[ETIQ_SOPOCLIANT] [nvarchar](11) NULL,
	[ETIQ_SOPOCLI] [nvarchar](11) NULL,
	[ETIQ_CODPRO] [nvarchar](7) NULL,
	[ETIQ_FECPROD] [date] NULL,
	[ETIQ_FECVENC] [date] NULL,
	[ETIQ_CAJAS] [numeric](18, 0) NULL,
	[ETIQ_KILOS] [float] NULL,
	[ETIQ_NFECPROD] [date] NULL,
	[ETIQ_NFECVENC] [date] NULL,
	[ETIQ_NSOPOCLI] [nvarchar](11) NULL,
	[ETIQ_EST] [nvarchar](5) NULL,
 CONSTRAINT [PK_DETAETIQ] PRIMARY KEY CLUSTERED 
(
	[ETIQ_CODI] ASC,
	[ETIQ_DCOD] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_PADDING OFF
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[detafact](
	[dfac_codi] [numeric](18, 0) NOT NULL,
	[dfac_codserv] [numeric](18, 0) NULL,
	[dfac_unid] [float] NULL,
	[dfac_caj] [numeric](18, 0) NULL,
	[dfac_kil] [float] NULL,
	[dfac_usd] [float] NULL,
	[dfac_vuni] [numeric](18, 0) NULL,
	[dfac_tot] [numeric](18, 0) NULL,
 CONSTRAINT [PK_detafact] PRIMARY KEY CLUSTERED 
(
	[dfac_codi] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[DETAGRUPOS](
	[dgru_Codi] [nvarchar](7) NULL,
	[dgru_RutCli] [nvarchar](10) NULL,
	[dgru_MetaPallet] [numeric](18, 0) NULL,
	[dgru_TarifaNormal] [numeric](10, 0) NULL,
	[dgru_TarifaMeta] [numeric](10, 0) NULL,
	[dgru_Fecha] [nvarchar](10) NULL,
	[dgru_Hora] [nvarchar](5) NULL,
	[dgru_Usuario] [nvarchar](3) NULL
) ON [PRIMARY]

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[DETALLE_CARGA](
	[IDPROCESO] [nvarchar](50) NULL,
	[RUT] [nvarchar](9) NULL,
	[CLIENTE] [nvarchar](50) NULL,
	[CODIGO] [nvarchar](15) NULL,
	[PRODUCTO] [nvarchar](50) NULL,
	[TUNEL] [nvarchar](15) NULL,
	[PALLET] [numeric](18, 0) NULL,
	[KILOS] [float] NULL,
	[UNIDADES] [numeric](18, 0) NULL,
	[FECHA_INI] [nvarchar](10) NULL,
	[HORA_INI] [nvarchar](8) NULL,
	[FECHA_TER] [nvarchar](10) NULL,
	[HORA_TER] [nvarchar](8) NULL,
	[OPERADOR] [nvarchar](50) NULL,
	[ESTADO] [nvarchar](1) NULL
) ON [PRIMARY]

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[detapedcaja](
	[pc_codi] [numeric](18, 0) NULL,
	[dpc_numpal] [nvarchar](9) NULL,
	[dpc_estado] [int] NULL,
	[dpc_codcaja] [nvarchar](200) NULL,
	[dpc_codped] [numeric](18, 0) NULL
) ON [PRIMARY]

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[DETAPNC](
	[dpnc_codigo] [nvarchar](12) NULL,
	[dpnc_foto] [nvarchar](50) NULL
) ON [PRIMARY]

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[detapred](
	[dpre_unica] [uniqueidentifier] NOT NULL CONSTRAINT [DF_detapred_dpre_unica]  DEFAULT (newid()),
	[dpre_codi] [nvarchar](9) NULL,
	[dpre_codpro] [nvarchar](7) NULL,
	[dpre_codsopo] [nvarchar](2) NULL,
	[dpre_sopocli] [nvarchar](17) NULL,
	[dpre_unidades] [int] NULL,
	[dpre_peso] [float] NULL,
	[dpre_fecdes] [nvarchar](10) NULL,
	[dpre_rutcli] [nvarchar](9) NULL,
	[dpre_contcli] [nvarchar](7) NULL,
	[dpre_fecprod] [nvarchar](10) NULL,
	[dpre_camara] [nvarchar](2) NULL,
	[dpre_banda] [nvarchar](2) NULL,
	[dpre_colum] [nvarchar](2) NULL,
	[dpre_piso] [nvarchar](2) NULL,
	[dpre_nivel] [nvarchar](1) NULL,
	[dpre_almacen] [tinyint] NULL,
	[dpre_dcaja] [tinyint] NULL,
	[dpre_folio] [nvarchar](9) NULL,
	[dpre_activa] [tinyint] NULL,
	[dpre_radio] [tinyint] NULL,
	[dpre_track] [tinyint] NULL,
	[dpre_codvig] [nvarchar](1) NULL,
	[dpre_pallet] [tinyint] NULL,
	[dpre_slot] [nvarchar](3) NULL,
	[dpre_TS] [real] NULL,
	[dpre_TM] [real] NULL,
	[dpre_TI] [real] NULL,
	[dpre_CodPer] [char](3) NULL,
	[dpre_Hora] [varchar](10) NULL,
	[dpre_fecn] [nvarchar](10) NULL,
	[DPRE_FOLIO_PALLET] [nvarchar](18) NULL,
	[dpre_temperatura] [varchar](1) NULL,
	[cod_bod] [nchar](10) NULL,
 CONSTRAINT [PK_detapred] PRIMARY KEY NONCLUSTERED 
(
	[dpre_unica] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_PADDING OFF
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[DetaPredCajas](
	[dpre_npallet] [nvarchar](9) NULL,
	[dpre_caja] [nvarchar](200) NULL,
	[dpre_nped] [numeric](18, 0) NULL
) ON [PRIMARY]

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[Detapredcajas1](
	[dpre_codi] [nvarchar](21) NULL,
	[dpre_codpro] [nvarchar](7) NULL,
	[dpre_codsopo] [nvarchar](2) NULL,
	[dpre_sopocli] [nvarchar](9) NULL,
	[dpre_unidades] [int] NULL,
	[dpre_peso] [float] NULL,
	[dpre_fecdes] [nvarchar](10) NULL,
	[dpre_rutcli] [nvarchar](9) NULL,
	[dpre_contcli] [nvarchar](7) NULL,
	[dpre_fecprod] [nvarchar](10) NULL,
	[dpre_camara] [nvarchar](2) NULL,
	[dpre_banda] [nvarchar](2) NULL,
	[dpre_colum] [nvarchar](2) NULL,
	[dpre_piso] [nvarchar](2) NULL,
	[dpre_nivel] [nvarchar](1) NULL,
	[dpre_almacen] [tinyint] NULL,
	[dpre_dcaja] [tinyint] NULL,
	[dpre_folio] [nvarchar](9) NULL,
	[dpre_activa] [tinyint] NULL,
	[dpre_radio] [tinyint] NULL,
	[dpre_track] [tinyint] NULL,
	[dpre_codvig] [nvarchar](1) NULL,
	[dpre_pallet] [tinyint] NULL,
	[dpre_slot] [nvarchar](3) NULL,
	[dpre_TS] [real] NULL,
	[dpre_TM] [real] NULL,
	[dpre_TI] [real] NULL,
	[dpre_CodPer] [char](3) NULL,
	[dpre_Hora] [varchar](10) NULL,
	[dpre_fecn] [nvarchar](10) NULL
) ON [PRIMARY]

GO
SET ANSI_PADDING OFF
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[detapreslo](
	[pres_unica] [uniqueidentifier] NOT NULL CONSTRAINT [DF_detapreslo_pres_unica]  DEFAULT (newid()),
	[pres_codi] [nvarchar](11) NULL,
	[pres_caslo] [nvarchar](5) NULL,
	[pres_codpro] [nvarchar](7) NULL,
	[pres_unidades] [int] NULL,
	[pres_peso] [float] NULL,
	[pres_fecprod] [nvarchar](10) NULL,
	[pres_folio] [nvarchar](11) NULL,
	[pres_activa] [tinyint] NULL,
	[pres_radio] [tinyint] NULL,
	[pres_codvig] [tinyint] NULL,
 CONSTRAINT [PK_detapreslo] PRIMARY KEY NONCLUSTERED 
(
	[pres_unica] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[detarecbolsa](
	[codrece] [nvarchar](15) NULL,
	[lote] [nvarchar](15) NULL,
	[pallet] [nvarchar](15) NULL,
	[bandejas] [nvarchar](15) NULL,
	[kilos] [nvarchar](15) NULL,
	[producto] [nvarchar](50) NULL,
	[fecha_ela] [datetime] NULL,
	[fecha_ven] [datetime] NULL,
	[kilosbol] [numeric](18, 0) NULL,
	[codbolsa] [numeric](18, 0) NOT NULL,
	[estado] [nchar](10) NULL,
 CONSTRAINT [PK_detarecbolsa] PRIMARY KEY CLUSTERED 
(
	[codbolsa] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[detarece](
	[drec_unica] [uniqueidentifier] NOT NULL CONSTRAINT [DF_detarece_drec_unica]  DEFAULT (newid()),
	[drec_codi] [nvarchar](9) NULL,
	[drec_codcaja] [nvarchar](50) NULL,
	[drec_codpro] [nvarchar](7) NULL,
	[drec_origen] [nvarchar](2) NULL,
	[drec_codsopo] [nvarchar](2) NULL,
	[drec_sopocli] [nvarchar](17) NULL,
	[drec_unidades] [int] NULL,
	[drec_peso] [float] NULL,
	[drec_fecrec] [nvarchar](10) NULL,
	[drec_rutcli] [nvarchar](9) NULL,
	[drec_rutproductor] [varchar](12) NULL CONSTRAINT [DF_detarece_drec_rutproductor]  DEFAULT (''),
	[drec_contcli] [nvarchar](7) NULL,
	[drec_fecprod] [nvarchar](10) NULL,
	[drec_camara] [nvarchar](2) NULL,
	[drec_banda] [nvarchar](2) NULL,
	[drec_colum] [nvarchar](2) NULL,
	[drec_piso] [nvarchar](2) NULL,
	[drec_nivel] [nvarchar](1) NULL,
	[drec_almacen] [tinyint] NULL,
	[drec_dcaja] [tinyint] NULL,
	[drec_tunel] [tinyint] NULL,
	[drec_codvig] [nvarchar](1) NULL,
	[drec_pallet] [tinyint] NULL,
	[drec_codrel] [nvarchar](7) NULL,
	[drec_nrosopo] [int] NULL,
	[drec_slot] [nvarchar](3) NULL,
	[drec_dtgracia] [nvarchar](3) NULL,
	[drec_codsag] [nvarchar](20) NULL,
	[drec_tipo] [int] NULL CONSTRAINT [DF_detarece_drec_tipo]  DEFAULT ((0)),
	[FechaVencimiento] [char](10) NULL,
	[LoteCliente] [char](20) NULL,
	[drec_temp] [float] NULL,
	[drec_TS] [real] NULL,
	[drec_TM] [real] NULL,
	[drec_TI] [real] NULL,
	[drec_RecepTunel] [int] NULL,
	[drec_ProcTunel] [int] NULL,
	[drec_TS_Tunel] [real] NULL,
	[drec_TM_Tunel] [real] NULL,
	[drec_TI_Tunel] [real] NULL,
	[drec_codper] [char](3) NULL,
	[drec_hora] [varchar](10) NULL,
	[drec_FecHomo] [varchar](10) NULL,
	[drec_HorHomo] [varchar](10) NULL,
	[drec_AutHomo] [nvarchar](4) NULL,
	[drec_estado] [varchar](50) NULL,
	[drec_etiqueta] [varchar](20) NULL,
	[drec_valor] [real] NULL,
	[drec_moncodi] [nvarchar](2) NULL,
	[drec_medcodi] [nvarchar](3) NULL,
	[drec_proceso] [nvarchar](50) NULL,
	[drec_palletCC] [nvarchar](9) NULL,
	[frec_codi] [nvarchar](7) NULL,
	[drec_desc] [nvarchar](50) NULL,
	[frec_codi1] [nvarchar](7) NULL,
	[drec_arriendo] [varchar](1) NULL,
	[drec_rev] [int] NULL CONSTRAINT [DF_detarece_drec_rev]  DEFAULT ((0)),
	[Estpallet] [nchar](5) NULL,
	[cod_bod] [nchar](10) NULL,
 CONSTRAINT [PK_detarece] PRIMARY KEY CLUSTERED 
(
	[drec_unica] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_PADDING OFF
GO
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING OFF
GO
CREATE TABLE [dbo].[Detarecebasura](
	[drec_unica] [uniqueidentifier] NOT NULL,
	[drec_codi] [nvarchar](9) NULL,
	[drec_codcaja] [nvarchar](50) NULL,
	[drec_codpro] [nvarchar](7) NULL,
	[drec_origen] [nvarchar](2) NULL,
	[drec_codsopo] [nvarchar](2) NULL,
	[drec_sopocli] [nvarchar](11) NULL,
	[drec_unidades] [int] NULL,
	[drec_peso] [float] NULL,
	[drec_fecrec] [nvarchar](10) NULL,
	[drec_rutcli] [nvarchar](9) NULL,
	[drec_rutproductor] [varchar](12) NULL,
	[drec_contcli] [nvarchar](7) NULL,
	[drec_fecprod] [nvarchar](10) NULL,
	[drec_camara] [nvarchar](2) NULL,
	[drec_banda] [nvarchar](2) NULL,
	[drec_colum] [nvarchar](2) NULL,
	[drec_piso] [nvarchar](2) NULL,
	[drec_nivel] [nvarchar](1) NULL,
	[drec_almacen] [tinyint] NULL,
	[drec_dcaja] [tinyint] NULL,
	[drec_tunel] [tinyint] NULL,
	[drec_codvig] [nvarchar](1) NULL,
	[drec_pallet] [tinyint] NULL,
	[drec_codrel] [nvarchar](7) NULL,
	[drec_nrosopo] [int] NULL,
	[drec_slot] [nvarchar](3) NULL,
	[drec_dtgracia] [nvarchar](3) NULL,
	[drec_codsag] [nvarchar](10) NULL,
	[drec_tipo] [int] NULL,
	[FechaVencimiento] [char](10) NULL,
	[LoteCliente] [char](10) NULL,
	[drec_TS] [real] NULL,
	[drec_TM] [real] NULL,
	[drec_TI] [real] NULL,
	[drec_RecepTunel] [int] NULL,
	[drec_ProcTunel] [int] NULL,
	[drec_TS_Tunel] [real] NULL,
	[drec_TM_Tunel] [real] NULL,
	[drec_TI_Tunel] [real] NULL,
	[drec_codper] [char](3) NULL,
	[drec_hora] [varchar](10) NULL,
	[drec_FecHomo] [varchar](10) NULL,
	[drec_HorHomo] [varchar](10) NULL,
	[drec_AutHomo] [int] NULL,
	[drec_estado] [varchar](50) NULL
) ON [PRIMARY]

GO
SET ANSI_PADDING OFF
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[DetaReceCajas](
	[caj_Pcod] [varchar](9) NOT NULL,
	[caj_cod] [nvarchar](200) NOT NULL,
	[caj_codenca] [varchar](3) NULL,
	[caj_Est] [numeric](1, 0) NULL,
	[caj_TipError] [nvarchar](1) NULL,
	[caj_ped] [int] NULL CONSTRAINT [DF_DetaReceCajas_caj_ped]  DEFAULT ((0)),
	[caj_fecha] [datetime] NULL CONSTRAINT [DF_DetaReceCajas_Caj_fecha]  DEFAULT (getdate()),
	[caj_Calidad] [varchar](30) NULL,
	[caj_Calibre] [varchar](50) NULL,
	[caj_felab] [date] NULL,
	[caj_fvenc] [date] NULL,
	[caj_unid] [int] NULL,
	[caj_Kg] [float] NULL,
	[caj_libras] [varchar](20) NULL,
	[caj_producto] [varchar](100) NULL,
	[caj_Id] [varchar](20) NULL,
	[caj_lote] [varchar](20) NULL,
	[caj_maquilador] [varchar](20) NULL
) ON [PRIMARY]

GO
SET ANSI_PADDING OFF
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[DetareceCajas11](
	[drec_unica] [uniqueidentifier] NULL,
	[drec_codi] [nvarchar](12) NULL,
	[drec_codcaja] [nvarchar](50) NULL,
	[drec_codpro] [nvarchar](10) NULL,
	[drec_origen] [nvarchar](2) NULL,
	[drec_codsopo] [nvarchar](2) NULL,
	[drec_sopocli] [nvarchar](10) NULL,
	[drec_unidades] [int] NULL,
	[drec_peso] [float] NULL,
	[drec_fecrec] [nvarchar](10) NULL,
	[drec_rutcli] [nvarchar](9) NULL,
	[drec_rutproductor] [varchar](12) NULL,
	[drec_contcli] [nvarchar](7) NULL,
	[drec_fecprod] [nvarchar](10) NULL,
	[drec_camara] [nvarchar](2) NULL,
	[drec_banda] [nvarchar](2) NULL,
	[drec_colum] [nvarchar](2) NULL,
	[drec_piso] [nvarchar](2) NULL,
	[drec_nivel] [nvarchar](1) NULL,
	[drec_almacen] [tinyint] NULL,
	[drec_dcaja] [tinyint] NULL,
	[drec_tunel] [tinyint] NULL,
	[drec_codvig] [nvarchar](1) NULL CONSTRAINT [DF_DetareceCajas_drec_codvig]  DEFAULT ('0'),
	[drec_pallet] [tinyint] NULL,
	[drec_codrel] [nvarchar](7) NULL,
	[drec_nrosopo] [int] NULL,
	[drec_slot] [nvarchar](3) NULL,
	[drec_dtgracia] [nvarchar](3) NULL,
	[drec_codsag] [nvarchar](10) NULL,
	[drec_tipo] [int] NULL,
	[FechaVencimiento] [char](10) NULL,
	[LoteCliente] [char](10) NULL,
	[drec_TS] [real] NULL,
	[drec_TM] [real] NULL,
	[drec_TI] [real] NULL,
	[drec_RecepTunel] [int] NULL,
	[drec_ProcTunel] [int] NULL,
	[drec_TS_Tunel] [real] NULL,
	[drec_TM_Tunel] [real] NULL,
	[drec_TI_Tunel] [real] NULL,
	[drec_codper] [char](3) NULL,
	[drec_hora] [varchar](10) NULL,
	[drec_FecHomo] [varchar](10) NULL,
	[drec_HorHomo] [varchar](10) NULL,
	[drec_AutHomo] [int] NULL,
	[drec_estado] [varchar](50) NULL,
	[Batch] [nvarchar](50) NULL,
	[Caja] [nvarchar](50) NULL,
	[Producto] [nvarchar](50) NULL,
	[FechaDespacho] [nvarchar](10) NULL,
	[HoraDespacho] [nvarchar](5) NULL,
	[drec_CajaCliente] [nvarchar](50) NULL,
	[drec_fechahora] [nvarchar](19) NULL,
	[TRACK_CODI] [nvarchar](12) NULL
) ON [PRIMARY]

GO
SET ANSI_PADDING OFF
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[DetarececajasHistorial](
	[Caj_Pcod] [varchar](9) NOT NULL,
	[Caj_cod] [nvarchar](200) NOT NULL,
	[caj_codenca] [varchar](3) NULL,
	[Caj_Est] [numeric](1, 0) NULL,
	[Caj_TipError] [nvarchar](1) NULL,
	[caj_ped] [int] NULL CONSTRAINT [DF_DetarececajasHistorial_caj_ped]  DEFAULT ((0)),
	[Caj_fecha] [datetime] NULL CONSTRAINT [DF_DetarececajasHistorial_Caj_fecha]  DEFAULT (getdate()),
	[Caj_Calidad] [varchar](30) NULL,
	[Caj_Calibre] [varchar](50) NULL,
	[Caj_felab] [date] NULL,
	[Caj_fvenc] [date] NULL,
	[Caj_unid] [int] NULL,
	[Caj_Kg] [float] NULL,
	[Caj_libras] [varchar](20) NULL,
	[Caj_producto] [varchar](100) NULL,
	[Caj_Id] [varchar](20) NULL,
	[caj_lote] [varchar](20) NULL,
	[caj_maquilador] [varchar](20) NULL
) ON [PRIMARY]

GO
SET ANSI_PADDING OFF
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[detarececajasrespaldo](
	[caj_Pcod] [varchar](9) NOT NULL,
	[caj_cod] [nvarchar](200) NOT NULL,
	[caj_codenca] [varchar](3) NULL,
	[caj_Est] [numeric](1, 0) NULL,
	[caj_TipError] [nvarchar](1) NULL,
	[caj_ped] [int] NULL,
	[caj_fecha] [datetime] NULL,
	[caj_Calidad] [varchar](30) NULL,
	[caj_Calibre] [varchar](50) NULL,
	[caj_felab] [date] NULL,
	[caj_fvenc] [date] NULL,
	[caj_unid] [int] NULL,
	[caj_Kg] [float] NULL,
	[caj_libras] [varchar](20) NULL,
	[caj_producto] [varchar](100) NULL,
	[caj_Id] [varchar](20) NULL,
	[caj_lote] [varchar](20) NULL,
	[caj_maquilador] [varchar](20) NULL
) ON [PRIMARY]

GO
SET ANSI_PADDING OFF
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[detareceestado](
	[rtraq_codi] [varchar](7) NOT NULL,
	[rtraq_est] [numeric](18, 0) NULL,
	[rtraq_largo] [numeric](18, 0) NULL,
	[rtraq_l2] [numeric](18, 0) NULL,
	[rtraq_l3] [numeric](18, 0) NULL,
	[rtraq_l4] [numeric](18, 0) NULL,
	[rtraq_l5] [numeric](18, 0) NULL,
 CONSTRAINT [PK_detareceestado] PRIMARY KEY CLUSTERED 
(
	[rtraq_codi] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_PADDING OFF
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Detaservicios](
	[RECEPCION] [nchar](10) NULL,
	[PALLET] [nchar](10) NULL,
	[FILM] [nchar](2) NULL,
	[REPA] [nchar](2) NULL,
	[RETIRO] [nchar](2) NULL,
	[ETIQUETADO] [nchar](2) NULL,
	[CARGAAPISO] [nchar](2) NULL,
	[DESCARGA] [nchar](2) NULL,
	[OBS] [nvarchar](350) NULL,
	[EST_FIN] [nchar](2) NULL,
	[RESPONSABLE] [nvarchar](20) NULL
) ON [PRIMARY]

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[detatunel](
	[dtun_codiPallet] [nvarchar](9) NULL,
	[dtun_fecTunel] [char](10) NULL,
	[dtun_ProcTunel] [char](10) NULL,
	[dtun_TS] [real] NULL,
	[dtun_TM] [real] NULL,
	[dtun_TI] [real] NULL,
	[dtun_CodPer] [varchar](3) NULL,
	[dtun_Fecha] [datetime] NULL,
	[dtun_hora] [varchar](10) NULL
) ON [PRIMARY]

GO
SET ANSI_PADDING OFF
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[detcaja](
	[detc_unica] [uniqueidentifier] NOT NULL,
	[detc_codi] [nvarchar](12) NULL,
	[detc_peso] [float] NULL,
	[detc_ncaja] [smallint] NULL,
	[detc_pieza] [smallint] NULL,
	[detc_fecprod] [nvarchar](10) NULL,
	[detc_codprod] [nvarchar](7) NULL,
	[detc_estado] [tinyint] NULL,
	[detc_salida] [tinyint] NULL,
	[detc_track] [tinyint] NULL,
	[detc_pfolio] [nvarchar](9) NULL,
	[detc_codvig] [tinyint] NULL,
 CONSTRAINT [PK_detcaja] PRIMARY KEY NONCLUSTERED 
(
	[detc_unica] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[DetCajas](
	[detc_pallet] [nvarchar](12) NULL,
	[detc_fprod] [nvarchar](10) NULL,
	[detc_fvenc] [nvarchar](10) NULL,
	[detc_cantidad] [nvarchar](10) NULL
) ON [PRIMARY]

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[detslot](
	[dets_unica] [uniqueidentifier] NOT NULL CONSTRAINT [DF_detslot_dets_unica]  DEFAULT (newid()),
	[dets_codi] [nvarchar](11) NULL,
	[dets_codpro] [nvarchar](7) NULL,
	[dets_caslot] [nvarchar](5) NULL,
	[dets_niveles] [int] NULL,
	[dets_altura] [int] NULL,
	[dets_envniv] [int] NULL,
	[dets_altenv] [int] NULL,
	[dets_unidades] [int] NULL,
	[dets_peso] [float] NULL,
	[dets_fecprod] [nvarchar](10) NULL,
	[dets_tunel] [tinyint] NULL,
	[dets_codvig] [tinyint] NULL,
 CONSTRAINT [PK_detslot] PRIMARY KEY NONCLUSTERED 
(
	[dets_unica] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[documento](
	[doc_unica] [uniqueidentifier] NOT NULL CONSTRAINT [DF_documento_doc_unica]  DEFAULT (newid()),
	[doc_codi] [nvarchar](2) NULL,
	[doc_descr] [nvarchar](30) NULL,
 CONSTRAINT [PK_documento] PRIMARY KEY NONCLUSTERED 
(
	[doc_unica] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[DocumentosEnviados](
	[Denv_codi] [numeric](18, 0) IDENTITY(1,1) NOT NULL,
	[Denv_seccion] [varchar](50) NULL,
	[Denv_fecha] [date] NULL,
	[Denv_hora] [nchar](10) NULL,
	[Denv_Dcto] [varchar](80) NULL,
 CONSTRAINT [PK_DocumentosEnviados] PRIMARY KEY CLUSTERED 
(
	[Denv_codi] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_PADDING OFF
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[EQUIPOS](
	[host] [nvarchar](50) NULL,
	[puerto] [nvarchar](3) NULL
) ON [PRIMARY]

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[escala](
	[esc_contr] [varchar](7) NOT NULL,
	[esc_servi] [varchar](3) NOT NULL,
	[esc_tramos] [int] NULL,
	[esc_dtramo1] [int] NULL,
	[esc_htramo1] [int] NULL,
	[esc_valor1] [float] NULL,
	[esc_dtramo2] [int] NULL,
	[esc_htramo2] [int] NULL,
	[esc_valor2] [float] NULL,
	[esc_dtramo3] [int] NULL,
	[esc_htramo3] [int] NULL,
	[esc_valor3] [float] NULL,
	[esc_dtramo4] [int] NULL,
	[esc_htramo4] [int] NULL,
	[esc_valor4] [float] NULL,
	[esc_dtramo5] [int] NULL,
	[esc_htramo5] [int] NULL,
	[esc_valor5] [float] NULL,
	[esc_dtramo6] [int] NULL,
	[esc_htramo6] [int] NULL,
	[esc_valor6] [float] NULL,
	[esc_dtramo7] [int] NULL,
	[esc_htramo7] [int] NULL,
	[esc_valor7] [float] NULL,
	[esc_dtramo8] [int] NULL,
	[esc_htramo8] [int] NULL,
	[esc_valor8] [float] NULL,
	[esc_dtramo9] [int] NULL,
	[esc_htramo9] [int] NULL,
	[esc_valor9] [float] NULL,
	[esc_dtramo10] [int] NULL,
	[esc_htramo10] [int] NULL,
	[esc_valor10] [float] NULL,
 CONSTRAINT [PK_escala] PRIMARY KEY NONCLUSTERED 
(
	[esc_contr] ASC,
	[esc_servi] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_PADDING OFF
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[escala_hist](
	[esc_unica] [uniqueidentifier] NULL,
	[esc_contr_hist] [nvarchar](7) NULL,
	[esc_servi_hist] [nvarchar](2) NULL,
	[esc_dtramo1_hist] [int] NULL,
	[esc_htramo1_hist] [int] NULL,
	[esc_valor1_hist] [real] NULL,
	[esc_dtramo2_hist] [int] NULL,
	[esc_htramo2_hist] [int] NULL,
	[esc_valor2_hist] [real] NULL,
	[esc_dtramo3_hist] [int] NULL,
	[esc_htramo3_hist] [int] NULL,
	[esc_valor3_hist] [real] NULL,
	[esc_dtramo4_hist] [int] NULL,
	[esc_htramo4_hist] [int] NULL,
	[esc_valor4_hist] [real] NULL,
	[esc_fecha_hist] [datetime] NULL,
	[esc_rutcli_hist] [nvarchar](9) NULL
) ON [PRIMARY]

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[escalaNueva](
	[escn_servi] [nvarchar](2) NULL,
	[escn_rutcli] [nvarchar](10) NULL,
	[escn_pallet] [int] NULL,
	[escn_tunel] [int] NULL,
	[escn_dtramo1] [int] NULL,
	[escn_htramo1] [int] NULL,
	[escn_valor1] [int] NULL,
	[escn_dtramo2] [int] NULL,
	[escn_htramo2] [int] NULL,
	[escn_valor2] [int] NULL,
	[escn_dtramo3] [int] NULL,
	[escn_htramo3] [int] NULL,
	[escn_valor3] [int] NULL,
	[escn_dtramo4] [int] NULL,
	[escn_htramo4] [int] NULL,
	[escn_valor4] [int] NULL
) ON [PRIMARY]

GO
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING OFF
GO
CREATE TABLE [dbo].[ESCALASERV](
	[ESCCOD] [int] NOT NULL,
	[ESCCONTR] [varchar](7) NOT NULL,
	[ESCSERV] [varchar](2) NOT NULL,
	[TOTTRAMAS] [int] NOT NULL
) ON [PRIMARY]

GO
SET ANSI_PADDING OFF
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[estado_cliente](
	[CODIGO_ESTADO] [int] IDENTITY(1,1) NOT NULL,
	[NOMBRE_ESTADO] [varchar](50) NOT NULL,
	[ESTADO_ESTADO] [varchar](15) NOT NULL,
PRIMARY KEY CLUSTERED 
(
	[CODIGO_ESTADO] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_PADDING OFF
GO
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING OFF
GO
CREATE TABLE [dbo].[ESTADOGUIAS](
	[ESTCODIGO] [int] NOT NULL,
	[ESTNOMBRE] [varchar](20) NOT NULL,
	[ESTDESCRIP] [varchar](60) NOT NULL
) ON [PRIMARY]

GO
SET ANSI_PADDING OFF
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[ETIQUETA](
	[CODIGO] [nvarchar](450) NULL,
	[LARGO] [numeric](18, 0) NULL,
	[RUTCLIE] [nvarchar](9) NULL,
	[id] [uniqueidentifier] ROWGUIDCOL  NULL CONSTRAINT [DF_ETIQUETA_id]  DEFAULT (newid())
) ON [PRIMARY]

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[FacEscalas](
	[esc_contr] [nvarchar](7) NOT NULL,
	[esc_servi] [nvarchar](3) NOT NULL,
	[esc_ntramos] [numeric](18, 0) NULL,
	[esc_dtramo1] [float] NULL,
	[esc_htramo1] [float] NULL,
	[esc_valor1] [float] NULL,
	[esc_dtramo2] [float] NULL,
	[esc_htramo2] [float] NULL,
	[esc_valor2] [float] NULL,
	[esc_dtramo3] [float] NULL,
	[esc_htramo3] [float] NULL,
	[esc_valor3] [float] NULL,
	[esc_dtramo4] [float] NULL,
	[esc_htramo4] [float] NULL,
	[esc_valor4] [float] NULL,
	[esc_dtramo5] [float] NULL,
	[esc_htramo5] [float] NULL,
	[esc_valor5] [float] NULL,
	[esc_dtramo6] [float] NULL,
	[esc_htramo6] [float] NULL,
	[esc_valor6] [float] NULL,
	[esc_dtramo7] [float] NULL,
	[esc_htramo7] [float] NULL,
	[esc_valor7] [float] NULL,
	[esc_dtramo8] [float] NULL,
	[esc_htramo8] [float] NULL,
	[esc_valor8] [float] NULL,
	[esc_dtramo9] [float] NULL,
	[esc_htramo9] [float] NULL,
	[esc_valor9] [float] NULL,
	[esc_dtramo10] [float] NULL,
	[esc_htramo10] [float] NULL,
	[esc_valor10] [float] NULL,
 CONSTRAINT [PK_FacEscalas] PRIMARY KEY CLUSTERED 
(
	[esc_contr] ASC,
	[esc_servi] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[FacEstadoVas](
	[evas_codi] [numeric](18, 0) NOT NULL,
	[evas_desc] [varchar](10) NULL,
 CONSTRAINT [PK_Fac_EstadoVas] PRIMARY KEY CLUSTERED 
(
	[evas_codi] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_PADDING OFF
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[FacLugar](
	[Tdoc_codi] [numeric](18, 0) NOT NULL,
	[Tdoc_desc] [nvarchar](50) NULL,
 CONSTRAINT [PK_FacAdmFrigo] PRIMARY KEY CLUSTERED 
(
	[Tdoc_codi] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[FacSeccion](
	[Sec_codi] [numeric](18, 0) NOT NULL,
	[Sec_Desc] [nvarchar](20) NOT NULL,
 CONSTRAINT [PK_FacSeccion] PRIMARY KEY CLUSTERED 
(
	[Sec_codi] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[FacServicios](
	[Serv_Cod] [varchar](3) NOT NULL,
	[Serv_Nom] [varchar](50) NULL,
	[Serv_MedPred] [varchar](3) NULL,
	[Serv_MonPred] [varchar](2) NULL,
	[Serv_descr] [varchar](max) NULL,
	[Serv_Incluir] [numeric](18, 0) NULL,
	[Serv_OrdR] [numeric](18, 0) NULL,
	[Serv_OrdD] [numeric](18, 0) NULL,
	[Serv_OrdE] [numeric](18, 0) NULL,
	[Serv_Esc] [numeric](18, 0) NULL,
	[Serv_Sec] [numeric](18, 0) NULL,
	[Serv_entsal] [numeric](18, 0) NULL CONSTRAINT [DF_FacServicios_Serv_entsal]  DEFAULT ((0)),
 CONSTRAINT [PK_FacServicios] PRIMARY KEY CLUSTERED 
(
	[Serv_Cod] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY] TEXTIMAGE_ON [PRIMARY]

GO
SET ANSI_PADDING OFF
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[FacTipoDcto](
	[TDOC_CODI] [numeric](18, 0) NOT NULL,
	[TDOC_DESC] [varchar](50) NULL,
 CONSTRAINT [PK_FacTipoDcto] PRIMARY KEY CLUSTERED 
(
	[TDOC_CODI] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_PADDING OFF
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[facturacion](
	[fac_unica] [uniqueidentifier] NOT NULL,
	[fac_fecha] [nvarchar](10) NULL,
	[fac_rutcli] [nvarchar](9) NULL,
	[fac_contr] [nvarchar](7) NULL,
	[fac_servi] [nvarchar](2) NULL,
	[fac_moneda] [nvarchar](2) NULL,
	[fac_unifac] [nvarchar](3) NULL,
	[fac_tarifa] [real] NULL,
	[fac_tarifamnac] [real] NULL,
	[fac_dolar] [real] NULL,
	[fac_uf] [real] NULL,
	[fac_unidad] [real] NULL,
	[fac_valorneto] [float] NULL,
	[fac_dfecha] [nvarchar](10) NULL,
 CONSTRAINT [PK_facturacion] PRIMARY KEY NONCLUSTERED 
(
	[fac_unica] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[FACTURASWEB](
	[FACT_ID] [nvarchar](14) NULL,
	[FACT_NUMERO] [nvarchar](50) NULL,
	[FACT_RUTCLI] [nvarchar](10) NULL,
	[FACT_NOMARCHIVO] [nvarchar](255) NULL,
	[FACT_FECHA] [nvarchar](10) NULL,
	[FACT_GLOSA] [nvarchar](255) NULL,
	[FACT_TIPODOCUMENTO] [nvarchar](1) NULL
) ON [PRIMARY]

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[FacVas](
	[Vas_cod] [varchar](50) NOT NULL,
	[Vas_Clirut] [varchar](50) NULL,
	[Vas_Cont] [varchar](50) NULL,
	[Vas_Dcto] [varchar](50) NOT NULL,
	[Vas_fecha] [date] NOT NULL,
	[Vas_guia] [varchar](50) NOT NULL,
	[Vas_Estado] [numeric](18, 0) NOT NULL,
	[Vas_Seccion] [varchar](50) NOT NULL,
	[Vas_TipDoc] [numeric](18, 0) NOT NULL,
	[Vas_Obs] [nvarchar](150) NULL,
	[Vas_TipAsoc] [numeric](18, 0) NULL,
	[Vas_Emis] [datetime] NULL CONSTRAINT [DF_FacVas_Vas_Emis]  DEFAULT (getdate()),
	[Vas_usucod] [varchar](3) NULL,
 CONSTRAINT [PK_FacVas] PRIMARY KEY CLUSTERED 
(
	[Vas_cod] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_PADDING OFF
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[FacVasDeta](
	[Dvas_VasCod] [varchar](7) NOT NULL,
	[Dvas_ServCod] [varchar](50) NOT NULL,
	[Dvas_Est] [varchar](50) NULL,
	[Dvas_Unid] [float] NULL,
	[Dvas_Cajas] [numeric](18, 0) NULL,
	[Dvas_Kilos] [float] NULL,
	[Dvas_Cobrar] [numeric](18, 0) NULL,
	[Dvas_Obs] [varchar](100) NULL,
	[Dvas_ValUni] [numeric](18, 0) NULL,
	[Dvas_ValTot] [numeric](18, 0) NULL,
	[Dvas_entsal] [numeric](18, 0) NULL CONSTRAINT [DF_FacVasDeta_Dvas_entsal]  DEFAULT ((0)),
 CONSTRAINT [PK_FacVasDeta] PRIMARY KEY CLUSTERED 
(
	[Dvas_VasCod] ASC,
	[Dvas_ServCod] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_PADDING OFF
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[famprod](
	[fam_unica] [uniqueidentifier] NOT NULL CONSTRAINT [DF_famprod_fam_unica]  DEFAULT (newid()),
	[fam_codi] [nvarchar](7) NULL,
	[fam_descr] [nvarchar](40) NULL,
	[fam_correl] [float] NULL,
	[fam_imp] [float] NULL CONSTRAINT [DF_famprod_fam_imp]  DEFAULT (0),
	[fam_exp] [float] NULL CONSTRAINT [DF_famprod_fam_exp]  DEFAULT (0),
	[fam_nac] [float] NULL CONSTRAINT [DF_famprod_fam_nac]  DEFAULT (0),
	[FamiliaTunel1] [float] NULL,
	[FamiliaTunel2] [float] NULL,
	[FamiliaTunel3] [float] NULL,
	[FamiliaTunel4] [float] NULL,
 CONSTRAINT [PK_famprod] PRIMARY KEY NONCLUSTERED 
(
	[fam_unica] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[ficha_clientes](
	[CODIGO] [int] IDENTITY(1,1) NOT NULL,
	[RUBRO] [varchar](50) NULL,
	[PRODUCTOS] [varchar](100) NULL,
	[FUENTE] [varchar](100) NULL,
	[FECHA_CREACION] [varchar](100) NULL,
	[RUT] [varchar](12) NULL,
	[RAZON_SOCIAL] [varchar](100) NULL,
	[NOMBRE_CLIENTE] [varchar](100) NULL,
	[DIRECCION] [varchar](100) NULL,
	[FONO] [varchar](100) NULL,
	[PAGINA] [varchar](100) NULL,
	[MERCANTIL] [varchar](200) NULL,
	[NOMBRECONTACTO1] [varchar](100) NULL,
	[FONOCONTACTO1] [varchar](100) NULL,
	[EMAILCONTACTO1] [varchar](100) NULL,
	[CARGOCONTACTO1] [varchar](100) NULL,
	[MOVILCONTACTO1] [varchar](100) NULL,
	[NOMBRECONTACTO2] [varchar](100) NULL,
	[FONOCONTACTO2] [varchar](100) NULL,
	[EMAILCONTACTO2] [varchar](100) NULL,
	[CARGOCONTACTO2] [varchar](100) NULL,
	[MOVILCONTACTO2] [varchar](100) NULL,
	[NOMBRECONTACTO3] [varchar](100) NULL,
	[FONOCONTACTO3] [varchar](100) NULL,
	[EMAILCONTACTO3] [varchar](100) NULL,
	[CARGOCONTACTO3] [varchar](100) NULL,
	[MOVILCONTACTO3] [varchar](100) NULL,
	[NOMBRECONTACTO4] [varchar](100) NULL,
	[FONOCONTACTO4] [varchar](100) NULL,
	[EMAILCONTACTO4] [varchar](100) NULL,
	[CARGOCONTACTO4] [varchar](100) NULL,
	[MOVILCONTACTO4] [varchar](100) NULL,
	[FECHA_CATE_A] [varchar](10) NULL,
	[FECHA_CATE_B] [varchar](10) NULL,
	[FECHA_CATE_C] [varchar](10) NULL,
	[FECHA_CATE_D] [varchar](10) NULL,
	[FECHA_CATE_E] [varchar](10) NULL,
	[FECHA_CATE_F] [varchar](10) NULL,
	[FECHA_CATE_G] [varchar](10) NULL,
	[FECHA_CATE_H] [varchar](10) NULL,
	[FECHA_CATE_I] [varchar](10) NULL,
	[FECHA_CATE_J] [varchar](10) NULL,
	[CBOESTADO] [varchar](5) NULL,
	[CHKCONGELADO] [varchar](1) NULL,
	[CHKREFRIGERADO] [varchar](1) NULL,
	[CHKSECO] [varchar](1) NULL,
	[CHKPROCESO] [varchar](1) NULL,
	[CHKEXPORTACION] [varchar](1) NULL,
	[CHKIMPORTACION] [varchar](1) NULL,
	[CHKNACIONAL] [varchar](1) NULL,
	[COTIZACION] [varchar](50) NULL,
	[CATEGORIA_CLIENTE] [varchar](2) NULL,
	[COMENTARIOS] [varchar](1000) NULL,
	[NECESIDADES_CLIENTE] [varchar](1000) NULL,
	[USUARIO_INGRESO] [varchar](5) NULL,
	[FECHA_INGRESO] [varchar](12) NULL,
	[USUARIO_MODIFICO] [varchar](5) NULL,
	[FECHA_MODIFICACION] [varchar](12) NULL,
	[ESTADO] [varchar](15) NULL,
	[USUARIO_ELIMINACION] [varchar](5) NULL,
 CONSTRAINT [PK__ficha_cl__CC87E1270D5104F8] PRIMARY KEY CLUSTERED 
(
	[CODIGO] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_PADDING OFF
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[ficha_clientes_categorias](
	[CODIGO_CATEGORIA] [int] IDENTITY(1,1) NOT NULL,
	[LETRA_CATEGORIA] [varchar](2) NULL,
	[DESCRIPCION_CATEGORIA] [varchar](100) NULL,
	[ESTADO_CATEGORIA] [varchar](20) NULL
) ON [PRIMARY]

GO
SET ANSI_PADDING OFF
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[fichcont](
	[fcon_codi] [int] NULL,
	[fcon_cont] [nvarchar](50) NOT NULL,
	[fcon_rutcli] [varchar](9) NULL,
	[fcon_contcli] [varchar](7) NULL,
	[fcon_fec] [datetime] NULL,
	[fcon_enca] [varchar](3) NULL,
	[fcon_est] [int] NULL,
	[fcon_petiq] [numeric](18, 0) NULL,
	[fcon_petiqfec] [datetime] NULL,
	[fcon_prev] [int] NULL,
	[fcon_prevfec] [datetime] NULL,
	[fcon_prevdoc] [varchar](80) NULL,
 CONSTRAINT [PK_fichcont] PRIMARY KEY CLUSTERED 
(
	[fcon_cont] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_PADDING OFF
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[fichdespa](
	[fdes_unica] [uniqueidentifier] NOT NULL CONSTRAINT [DF_fichdespa_fdes_unica]  DEFAULT (newid()),
	[fdes_codi] [nvarchar](7) NULL,
	[fdes_rutcli] [nvarchar](9) NULL,
	[fdes_horalleg] [varchar](15) NULL,
	[fdes_hora] [nvarchar](5) NULL,
	[fdes_fecha] [nvarchar](10) NULL,
	[fdes_codpred] [nvarchar](7) NULL,
	[fdes_totsopo] [int] NULL,
	[fdes_totunidad] [int] NULL,
	[fdes_totpeso] [float] NULL,
	[fdes_rutcond] [nvarchar](9) NULL,
	[fdes_patente] [nvarchar](10) NULL,
	[fdes_transporte] [nvarchar](50) NULL,
	[fdes_contenedor] [nvarchar](30) NULL,
	[fdes_carro] [nvarchar](30) NULL,
	[fdes_sello] [nvarchar](50) NULL,
	[fdes_horometro] [nvarchar](30) NULL,
	[fdes_observ] [nvarchar](200) NULL,
	[fdes_tipcarga] [nvarchar](1) NULL,
	[fdes_codienca] [nvarchar](3) NULL,
	[fdes_codvig] [nvarchar](1) NULL,
	[fdes_origen] [nvarchar](2) NULL,
	[fdes_arte] [nvarchar](7) NULL,
	[fdes_tipo] [int] NULL CONSTRAINT [DF_fichdespa_fdes_tipo]  DEFAULT ((0)),
	[fdes_GuiaCliente] [varchar](25) NULL CONSTRAINT [DF_fichdespa_fdes_GuiaCliente]  DEFAULT ((0)),
	[fdes_tempdespacho] [varchar](60) NULL,
	[fdes_ordenembarque] [nvarchar](15) NULL,
	[fdes_destino] [nvarchar](50) NULL,
	[fdes_clfol] [nvarchar](7) NULL,
	[fdes_enviada] [nvarchar](1) NULL,
	[fdes_emis] [datetime] NULL CONSTRAINT [DF_fichdespa_fdes_emis]  DEFAULT (getdate()),
	[cod_bod] [nchar](10) NULL,
 CONSTRAINT [PK_fichdespa] PRIMARY KEY NONCLUSTERED 
(
	[fdes_unica] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_PADDING OFF
GO
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING OFF
GO
CREATE TABLE [dbo].[Fichdespabasura](
	[fdes_unica] [uniqueidentifier] NOT NULL,
	[fdes_codi] [nvarchar](7) NULL,
	[fdes_rutcli] [nvarchar](9) NULL,
	[fdes_hora] [nvarchar](5) NULL,
	[fdes_fecha] [nvarchar](10) NULL,
	[fdes_codpred] [nvarchar](7) NULL,
	[fdes_totsopo] [int] NULL,
	[fdes_totunidad] [int] NULL,
	[fdes_totpeso] [float] NULL,
	[fdes_rutcond] [nvarchar](9) NULL,
	[fdes_patente] [nvarchar](10) NULL,
	[fdes_transporte] [nvarchar](30) NULL,
	[fdes_contenedor] [nvarchar](30) NULL,
	[fdes_carro] [nvarchar](30) NULL,
	[fdes_sello] [nvarchar](30) NULL,
	[fdes_horometro] [nvarchar](30) NULL,
	[fdes_observ] [nvarchar](50) NULL,
	[fdes_tipcarga] [nvarchar](1) NULL,
	[fdes_codienca] [nvarchar](3) NULL,
	[fdes_codvig] [nvarchar](1) NULL,
	[fdes_origen] [nvarchar](2) NULL,
	[fdes_arte] [nvarchar](7) NULL,
	[fdes_tipo] [int] NULL,
	[fdes_GuiaCliente] [varchar](25) NULL,
	[fdes_tempdespacho] [varchar](60) NULL,
	[fdes_ordenembarque] [nvarchar](15) NULL
) ON [PRIMARY]

GO
SET ANSI_PADDING OFF
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[FICHETIQ](
	[ETIQ_CODI] [nvarchar](5) NOT NULL,
	[ETIQ_CLIRUT] [nvarchar](9) NULL,
	[ETIQ_CODCONT] [nvarchar](7) NULL,
	[ETIQ_FECHA] [date] NULL,
	[ETIQ_HORINI] [time](7) NULL,
	[ETIQ_CODENCA] [nvarchar](3) NULL,
	[ETIQ_EST] [nvarchar](1) NULL,
	[ETIQ_HORTER] [time](7) NULL,
	[ETIQ_TOTSOPO] [numeric](18, 0) NULL,
	[ETIQ_TOTUNIDAD] [numeric](18, 0) NULL,
	[ETIQ_TOTPESO] [float] NULL,
 CONSTRAINT [PK_FICHETIQ] PRIMARY KEY CLUSTERED 
(
	[ETIQ_CODI] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[fichfact](
	[fac_codi] [numeric](18, 0) NOT NULL,
	[fac_clirut] [varchar](9) NULL,
	[fac_contcli] [varchar](9) NULL,
	[fact_feci] [date] NULL,
	[fact_fect] [date] NULL,
	[fac_neto] [numeric](18, 0) NULL,
	[fac_iva] [numeric](18, 0) NULL,
	[fac_total] [numeric](18, 0) NULL,
	[fac_enca] [varchar](3) NULL,
 CONSTRAINT [PK_fichfact] PRIMARY KEY CLUSTERED 
(
	[fac_codi] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_PADDING OFF
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[FICHGRUPOS](
	[fgru_Codi] [nvarchar](5) NULL,
	[fgru_Descr] [nvarchar](50) NULL,
	[fgru_Meta] [numeric](18, 0) NULL,
	[fgru_Tarifa] [numeric](18, 0) NULL
) ON [PRIMARY]

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[FICHPNC](
	[fpnc_codigo] [nvarchar](10) NULL,
	[fpnc_fecha] [nvarchar](10) NULL,
	[fpnc_fechacierre] [nvarchar](10) NULL,
	[fpnc_rutcli] [nvarchar](10) NULL,
	[fpnc_persona] [nvarchar](50) NULL,
	[fpnc_supervisor] [nvarchar](50) NULL,
	[fpnc_producto] [nvarchar](50) NULL,
	[fpnc_cantidad] [nvarchar](10) NULL,
	[fpnc_lugar] [nvarchar](50) NULL,
	[fpnc_pallet] [nvarchar](9) NULL,
	[fpnc_observacion] [nvarchar](1000) NULL,
	[fpnc_accion] [nvarchar](1000) NULL,
	[fpnc_encargado] [nvarchar](1000) NULL,
	[fpnc_responsable] [nvarchar](50) NULL,
	[fpnc_EncAseg] [nvarchar](50) NULL
) ON [PRIMARY]

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[fichpred](
	[fpre_unica] [uniqueidentifier] NOT NULL CONSTRAINT [DF_fichpred_fpre_unica]  DEFAULT (newid()),
	[fpre_codi] [nvarchar](7) NULL,
	[fpre_rutcli] [nvarchar](9) NULL,
	[fpre_horades] [nvarchar](5) NULL,
	[fpre_horater] [nvarchar](5) NULL,
	[fpre_fecdes] [nvarchar](10) NULL,
	[fpre_totsopo] [int] NULL,
	[fpre_totunidad] [int] NULL,
	[fpre_totpeso] [float] NULL,
	[fpre_rutcond] [nvarchar](9) NULL,
	[fpre_codienca] [nvarchar](3) NULL,
	[fpre_activa] [nvarchar](1) NULL,
	[fpre_fechact] [nvarchar](10) NULL,
	[fpre_codvig] [nvarchar](1) NULL,
	[fpre_gdespa] [nvarchar](7) NULL,
	[fpre_radio] [nvarchar](1) NULL,
	[fpre_tipo] [int] NULL CONSTRAINT [DF_fichpred_fpre_tipo]  DEFAULT (0),
	[fpre_proceso] [int] NULL CONSTRAINT [DF_fichpred_fpre_proceso]  DEFAULT (0),
	[fpre_sello] [varchar](50) NULL,
	[fpre_tem] [real] NULL,
	[fpre_anden] [nvarchar](10) NULL,
	[FPRE_USUCRE] [nvarchar](6) NULL,
	[est_codi] [int] NULL,
	[fpre_contenedor] [nvarchar](50) NULL,
	[fpre_rampla] [nvarchar](15) NULL,
	[fpre_destino] [nvarchar](20) NULL,
	[fpre_Observacion] [varchar](255) NULL,
	[fpre_nped] [numeric](18, 0) NULL CONSTRAINT [DF_fichpred_fpre_nped]  DEFAULT ((0)),
	[fpre_etiq] [nvarchar](1) NULL,
	[estc_olor] [nchar](10) NULL,
	[estc_hig] [nchar](10) NULL,
	[estc_cond] [nchar](10) NULL,
	[cod_bod] [nchar](10) NULL,
 CONSTRAINT [PK_fichpred] PRIMARY KEY NONCLUSTERED 
(
	[fpre_unica] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_PADDING OFF
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[FICHPRED_TEMPERATURA](
	[FPRE_CODI] [nvarchar](7) NULL,
	[FPRE_TIPOTEMPERATURA] [nvarchar](1) NULL
) ON [PRIMARY]

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[fichrece](
	[frec_unica] [uniqueidentifier] NOT NULL CONSTRAINT [DF_fichrece_frec_unica]  DEFAULT (newid()),
	[frec_codi] [nvarchar](7) NULL,
	[frec_rutcli] [nvarchar](9) NULL,
	[frec_rutproductor] [varchar](12) NULL,
	[frec_contcli] [nvarchar](7) NULL,
	[frec_horalleg] [nvarchar](5) NULL,
	[frec_horarec] [nvarchar](5) NULL,
	[frec_horater] [nvarchar](5) NULL,
	[frec_turnrec] [nvarchar](1) NULL,
	[frec_fecproc] [nvarchar](10) NULL,
	[frec_fecrec] [nvarchar](10) NULL,
	[frec_fecter] [nvarchar](10) NULL,
	[frec_guiades] [nvarchar](8) NULL,
	[frec_tipentr] [nvarchar](2) NULL,
	[frec_totsopo] [int] NULL,
	[frec_totunidad] [int] NULL,
	[frec_totpeso] [float] NULL,
	[frec_temppro] [real] NULL,
	[frec_rutcond] [nvarchar](9) NULL,
	[frec_observ] [nvarchar](320) NULL,
	[frec_tipdesc] [nvarchar](1) NULL,
	[frec_codienca] [nvarchar](3) NULL,
	[frec_origen] [nvarchar](2) NULL,
	[frec_codvig] [nvarchar](1) NULL,
	[frec_radio] [nvarchar](1) NULL,
	[frec_tipo] [int] NULL CONSTRAINT [DF_fichrece_frec_tipo]  DEFAULT ((0)),
	[frec_RecepTunel] [int] NULL,
	[frec_AspectoSanitario] [nvarchar](15) NULL,
	[frec_CondGeneral] [int] NULL,
	[frec_procedencia] [char](10) NULL,
	[frec_paso] [nvarchar](1) NULL,
	[frec_antecamara] [nvarchar](2) NULL,
	[frec_numSello] [nvarchar](25) NULL,
	[frec_termografo] [nvarchar](1) NULL,
	[frec_tiporecepcion] [nvarchar](1) NULL,
	[frec_observ2] [nvarchar](50) NULL,
	[frec_tipoalmacenamiento] [varchar](50) NULL,
	[frec_contenedor] [nvarchar](20) NULL,
	[frec_patente] [nvarchar](20) NULL,
	[frec_almac] [nvarchar](15) NULL,
	[frec_empresa] [nvarchar](50) NULL,
	[frec_olores] [nvarchar](2) NULL,
	[frec_higiene] [nvarchar](2) NULL,
	[frec_estiba] [nvarchar](2) NULL,
	[frec_daado] [nvarchar](2) NULL,
	[frec_TS] [real] NULL,
	[frec_TM] [real] NULL,
	[frec_TI] [real] NULL,
	[frec_clfol] [nvarchar](7) NULL,
	[frec_Enviada] [nvarchar](1) NULL,
	[frec_tablet] [int] NOT NULL CONSTRAINT [DF_fichrece_frec_tablet]  DEFAULT ((0)),
	[frec_traq] [nvarchar](1) NULL,
	[frec_emis] [datetime] NULL CONSTRAINT [DF_fichrece_frec_emis]  DEFAULT (getdate()),
	[frec_packinglist] [nvarchar](30) NULL,
	[frec_ntunel] [nvarchar](50) NULL,
	[frec_modificado] [nchar](10) NULL,
	[cod_bod] [nchar](10) NULL,
	[val_guia] [nchar](10) NULL,
	[uni_guia] [nchar](10) NULL,
	[kilos_guia] [nchar](10) NULL,
 CONSTRAINT [PK_fichrece] PRIMARY KEY NONCLUSTERED 
(
	[frec_unica] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_PADDING OFF
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[FICHRECE_TEMPERATURA](
	[frec_codi] [nvarchar](7) NULL,
	[frec_tipotemperatura] [nvarchar](1) NULL,
	[frec_t1] [nvarchar](2) NULL,
	[frec_t2] [nvarchar](2) NULL,
	[frec_t3] [nvarchar](2) NULL
) ON [PRIMARY]

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[Fichrecebasura](
	[frec_unica] [uniqueidentifier] NOT NULL,
	[frec_codi] [nvarchar](7) NULL,
	[frec_rutcli] [nvarchar](9) NULL,
	[frec_rutproductor] [varchar](12) NULL,
	[frec_contcli] [nvarchar](7) NULL,
	[frec_horalleg] [nvarchar](5) NULL,
	[frec_horarec] [nvarchar](5) NULL,
	[frec_horater] [nvarchar](5) NULL,
	[frec_turnrec] [nvarchar](1) NULL,
	[frec_fecproc] [nvarchar](10) NULL,
	[frec_fecrec] [nvarchar](10) NULL,
	[frec_fecter] [nvarchar](10) NULL,
	[frec_guiades] [nvarchar](8) NULL,
	[frec_tipentr] [nvarchar](2) NULL,
	[frec_totsopo] [int] NULL,
	[frec_totunidad] [int] NULL,
	[frec_totpeso] [float] NULL,
	[frec_temppro] [real] NULL,
	[frec_rutcond] [nvarchar](9) NULL,
	[frec_observ] [nvarchar](50) NULL,
	[frec_tipdesc] [nvarchar](1) NULL,
	[frec_codienca] [nvarchar](3) NULL,
	[frec_origen] [nvarchar](2) NULL,
	[frec_codvig] [nvarchar](1) NULL,
	[frec_radio] [nvarchar](1) NULL,
	[frec_tipo] [int] NULL,
	[frec_RecepTunel] [int] NULL,
	[frec_AspectoSanitario] [nvarchar](15) NULL,
	[frec_CondGeneral] [int] NULL,
	[frec_procedencia] [char](10) NULL,
	[frec_paso] [nvarchar](1) NULL,
	[frec_antecamara] [nvarchar](1) NULL
) ON [PRIMARY]

GO
SET ANSI_PADDING OFF
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[fichtunel](
	[ftun_unica] [uniqueidentifier] NOT NULL CONSTRAINT [DF_fichtunel_ftun_unica]  DEFAULT (newid()),
	[ftun_codi] [nvarchar](7) NULL,
	[ftun_rutcli] [nvarchar](9) NULL,
	[ftun_contcli] [nvarchar](7) NULL,
	[ftun_horalleg] [nvarchar](5) NULL,
	[ftun_horarec] [nvarchar](5) NULL,
	[ftun_horater] [nvarchar](5) NULL,
	[ftun_turnrec] [nvarchar](1) NULL,
	[ftun_fecproc] [nvarchar](10) NULL,
	[ftun_fecrec] [nvarchar](10) NULL,
	[ftun_guiades] [nvarchar](8) NULL,
	[ftun_tipentr] [nvarchar](2) NULL,
	[ftun_totsopo] [int] NULL,
	[ftun_totunidad] [int] NULL,
	[ftun_totpeso] [float] NULL,
	[ftun_ctotsopo] [int] NULL,
	[ftun_ctotunidad] [int] NULL,
	[ftun_ctotpeso] [float] NULL,
	[ftun_etotsopo] [int] NULL,
	[ftun_etotunidad] [int] NULL,
	[ftun_etotpeso] [float] NULL,
	[ftun_temppro] [real] NULL,
	[ftun_tempsal] [real] NULL,
	[ftun_rutcond] [nvarchar](9) NULL,
	[ftun_observ] [nvarchar](50) NULL,
	[ftun_tipdesc] [nvarchar](1) NULL,
	[ftun_codienca] [nvarchar](3) NULL,
	[ftun_codvig] [nvarchar](1) NULL,
 CONSTRAINT [PK_fichtunel] PRIMARY KEY NONCLUSTERED 
(
	[ftun_unica] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[FICHTUNEL_TEMPERATURA](
	[ftun_codi] [nvarchar](7) NULL,
	[ftun_tipotemperatura] [nvarchar](1) NULL
) ON [PRIMARY]

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[formato](
	[for_unica] [uniqueidentifier] NOT NULL CONSTRAINT [DF_formato_for_unica]  DEFAULT (newid()),
	[for_codi] [nvarchar](5) NULL,
	[for_rutcli] [nvarchar](9) NULL,
	[for_cbarra] [nvarchar](51) NULL,
	[for_desde] [smallint] NULL,
	[for_nrodig] [smallint] NULL,
	[for_sopocli] [smallint] NULL,
	[for_sopnro] [smallint] NULL,
	[for_fecha] [smallint] NULL,
	[for_fecnro] [smallint] NULL,
	[for_unidad] [smallint] NULL,
	[for_uninro] [smallint] NULL,
	[for_peso] [smallint] NULL,
	[for_pesnro] [smallint] NULL,
 CONSTRAINT [PK_formato] PRIMARY KEY NONCLUSTERED 
(
	[for_unica] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Formato128](
	[RUTCLI] [nvarchar](12) NULL,
	[LARGO] [numeric](18, 0) NULL,
	[CodEjemplo] [nvarchar](70) NULL,
	[BatchD] [numeric](18, 0) NULL,
	[BatchC] [numeric](18, 0) NULL,
	[CajaD] [numeric](18, 0) NULL,
	[CajaC] [numeric](18, 0) NULL,
	[ProdD] [numeric](18, 0) NULL,
	[ProdC] [numeric](18, 0) NULL,
	[UnidadD] [numeric](18, 0) NULL,
	[UnidadC] [numeric](18, 0) NULL,
	[KilosD] [numeric](18, 0) NULL,
	[KilosC] [numeric](18, 0) NULL,
	[GramosD] [numeric](18, 0) NULL,
	[GramosC] [numeric](18, 0) NULL,
	[KilosOPD] [numeric](18, 0) NULL,
	[KilosOPC] [numeric](18, 0) NULL,
	[GramosOPD] [numeric](18, 0) NULL,
	[GramosOPC] [numeric](18, 0) NULL,
	[FechaPD] [numeric](18, 0) NULL,
	[FechaPC] [numeric](18, 0) NULL,
	[FechaVD] [numeric](18, 0) NULL,
	[FechaVC] [numeric](18, 0) NULL,
	[Codigo] [nvarchar](10) NULL,
	[Descripcion] [nvarchar](50) NULL,
	[BuscarDatos] [nvarchar](100) NULL,
	[KilosCaja] [float] NULL,
	[KilosDecimales] [numeric](18, 0) NULL CONSTRAINT [DF_Formato128_KilosDecimales]  DEFAULT (0),
	[KilosOPDecimales] [numeric](18, 0) NULL CONSTRAINT [DF_Formato128_KilosOPDecimales]  DEFAULT (0)
) ON [PRIMARY]

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[FORMATOETIQUETA](
	[CODIGO] [nvarchar](4) NULL,
	[CLIENTE] [nvarchar](10) NULL,
	[CONTRATO] [nvarchar](7) NULL,
	[LARGOETIQUETA] [nvarchar](255) NULL,
	[CODIGOEJEMPLO] [nvarchar](255) NULL,
	[BATCHD] [nvarchar](10) NULL,
	[BATCHC] [nvarchar](10) NULL,
	[CAJAD] [nvarchar](10) NULL,
	[CAJAC] [nvarchar](10) NULL,
	[PRODUCTOD] [nvarchar](10) NULL,
	[PRODUCTOC] [nvarchar](10) NULL,
	[UNIDADD] [nvarchar](10) NULL,
	[UNIDADC] [nvarchar](10) NULL,
	[KILOSD] [nvarchar](10) NULL,
	[KILOSC] [nvarchar](10) NULL,
	[KILOSOPD] [nvarchar](10) NULL,
	[KILOSOPC] [nvarchar](10) NULL,
	[FECHAPD] [nvarchar](10) NULL,
	[FECHAPC] [nvarchar](10) NULL,
	[FECHAVD] [nvarchar](10) NULL,
	[FECHAVC] [nvarchar](10) NULL,
	[FECHAED] [nvarchar](10) NULL,
	[FECHAEC] [nvarchar](10) NULL
) ON [PRIMARY]

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[habhora](
	[hor_unica] [uniqueidentifier] NOT NULL CONSTRAINT [DF_habhora_hor_unica]  DEFAULT (newid()),
	[hor_rutcli] [nvarchar](9) NULL,
	[hor_cont] [nvarchar](7) NULL,
	[hor_nrodoc] [nvarchar](7) NULL,
	[hor_fecha] [nvarchar](10) NULL,
	[hor_horas] [int] NULL,
	[hor_autoriza] [nvarchar](40) NULL,
	[hor_patente] [nvarchar](10) NULL,
	[hor_cfecha] [nvarchar](10) NULL,
 CONSTRAINT [PK_habhora] PRIMARY KEY NONCLUSTERED 
(
	[hor_unica] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[HistoricoFactura](
	[ID] [int] IDENTITY(1,1) NOT NULL,
	[Cliente] [char](9) NULL,
	[Contrato] [char](9) NULL,
	[Item] [char](10) NULL,
	[FechaInicio] [smalldatetime] NULL,
	[FechaFin] [smalldatetime] NULL,
	[Moneda] [char](10) NULL,
	[ValorDolar] [float] NOT NULL,
	[ValorUF] [float] NULL,
	[Medida] [char](10) NULL,
	[PrecioUnitario] [float] NULL,
	[Cantidad] [float] NULL,
	[Total] [float] NULL,
	[Vigencia] [bit] NULL,
	[Fecha] [smalldatetime] NULL,
 CONSTRAINT [PK_HistoricoFactura] PRIMARY KEY CLUSTERED 
(
	[ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_PADDING OFF
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[ID_Servicio](
	[ID_codi] [decimal](18, 0) NULL,
	[ID_Contra_Hist] [decimal](18, 0) NULL
) ON [PRIMARY]

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[INF_CALIDAD](
	[calidad_id] [nvarchar](20) NULL,
	[calidad_numero] [nvarchar](10) NULL,
	[calidad_RUTCLI] [nvarchar](10) NULL,
	[calidad_nomarchivo] [nvarchar](255) NULL,
	[calidad_fecha] [nvarchar](10) NULL
) ON [PRIMARY]

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[INF_PNC](
	[pnc_id] [nvarchar](20) NULL,
	[pnc_numero] [nvarchar](10) NULL,
	[pnc_rutcli] [nvarchar](10) NULL,
	[pnc_nomarchivo] [nvarchar](255) NULL,
	[pnc_fecha] [nvarchar](10) NULL
) ON [PRIMARY]

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[infocama](
	[inf_unica] [uniqueidentifier] NOT NULL CONSTRAINT [DF_infocama_inf_unica]  DEFAULT (newid()),
	[inf_codi] [nvarchar](10) NULL,
	[inf_rack] [real] NULL,
	[inf_realf] [real] NULL,
	[inf_slot] [real] NULL,
	[inf_sinpos] [real] NULL,
 CONSTRAINT [PK_infocama] PRIMARY KEY NONCLUSTERED 
(
	[inf_unica] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[informes](
	[inf_cod] [int] IDENTITY(1,1) NOT NULL,
	[inf_nom] [varchar](100) NOT NULL,
	[inf_emp] [varchar](12) NOT NULL,
	[inf_est] [varchar](15) NOT NULL,
	[inf_copia] [varchar](max) NULL,
 CONSTRAINT [PK__informes__D9F1ADBB693B9ABD] PRIMARY KEY CLUSTERED 
(
	[inf_cod] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY] TEXTIMAGE_ON [PRIMARY]

GO
SET ANSI_PADDING OFF
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[informes_programa](
	[inf_pro_cod] [int] IDENTITY(1,1) NOT NULL,
	[prg_rut_cli] [varchar](9) NOT NULL,
	[prg_inf_cod] [int] NOT NULL,
	[prg_emp] [varchar](1) NOT NULL,
	[prg_hora] [varchar](5) NULL,
	[prg_mail] [varchar](max) NULL,
	[prg_lunes] [varchar](12) NOT NULL,
	[prg_martes] [varchar](12) NOT NULL,
	[prg_miercoles] [varchar](12) NOT NULL,
	[prg_jueves] [varchar](12) NOT NULL,
	[prg_viernes] [varchar](12) NOT NULL,
	[prg_sabado] [varchar](12) NOT NULL,
	[prg_domingo] [varchar](12) NOT NULL,
	[prg_estado] [varchar](20) NOT NULL,
	[prg_min] [varchar](2) NULL,
 CONSTRAINT [PK__informes__1E6405AAEFDDC1EF] PRIMARY KEY CLUSTERED 
(
	[inf_pro_cod] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY] TEXTIMAGE_ON [PRIMARY]

GO
SET ANSI_PADDING OFF
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[informes_siniestro](
	[CODIGO_INFORME] [int] IDENTITY(1,1) NOT NULL,
	[FOLIO] [varchar](10) NULL,
	[RUT_CLIENTE] [varchar](20) NULL,
	[CODIGO_USUARIO] [varchar](5) NULL,
	[CLIENTE] [varchar](60) NULL,
	[FECHA_SINIESTRO] [varchar](20) NULL,
	[PERSONA_DETECTA] [varchar](100) NULL,
	[ENCARGADO_INFORME] [varchar](100) NULL,
	[LUGAR_DETECCION] [varchar](50) NULL,
	[PALLET_PRECISA] [varchar](20) NULL,
	[DESCRIPCION] [varchar](1000) NULL,
	[PALLET_CLIENTE] [varchar](20) NULL,
	[NOMBRE_PRODUCTO] [varchar](100) NULL,
	[UNIDADES] [varchar](9) NULL,
	[KILOS_UNIDAD] [varchar](9) NULL,
	[TOTAL_KILOS] [varchar](9) NULL,
	[FECHA_RECEPCION] [varchar](20) NULL,
	[GUIA_RECEPCION] [varchar](20) NULL,
	[UNIDADES_SINIESTRO] [varchar](9) NULL,
	[KILOS_UNIDAD_SINIESTRO] [varchar](9) NULL,
	[TOTAL_KILOS_SINIESTRO] [varchar](9) NULL,
	[UNIDADES_DETERIORO] [varchar](9) NULL,
	[KILOS_UNIDAD_DETERIORO] [varchar](9) NULL,
	[TOTAL_KILOS_DETERIORO] [varchar](9) NULL,
	[UNIDADES_INFECTADO] [varchar](9) NULL,
	[KILOS_UNIDAD_INFECTADO] [varchar](9) NULL,
	[TOTAL_KILOS_INFECTADO] [varchar](9) NULL,
	[IMAGEN1] [varchar](500) NULL,
	[IMAGEN2] [varchar](500) NULL,
	[IMAGEN3] [varchar](500) NULL,
	[IMAGEN4] [varchar](500) NULL,
	[IMAGEN5] [varchar](500) NULL,
	[IMAGEN6] [varchar](500) NULL,
	[ACCION_CORRECTIVA_1] [varchar](100) NULL,
	[ACCION_CORRECTIVA_2] [varchar](100) NULL,
	[ACCION_CORRECTIVA_3] [varchar](100) NULL,
	[ACCION_CORRECTIVA_4] [varchar](100) NULL,
	[ACCION_CORRECTIVA_5] [varchar](100) NULL,
	[ACCION_CORRECTIVA_6] [varchar](100) NULL,
	[USUARIO_MODIFICO] [varchar](5) NULL,
	[FECHA_MODIFICACION] [varchar](12) NULL,
	[FECHA_INGRESO] [varchar](12) NULL,
	[ESTADO] [varchar](15) NULL,
	[USUARIO_CAMBIO_ESTADO] [varchar](5) NULL,
 CONSTRAINT [PK__informes__BB24868BE16C3473] PRIMARY KEY CLUSTERED 
(
	[CODIGO_INFORME] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_PADDING OFF
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[ipc](
	[ipc_unica] [uniqueidentifier] ROWGUIDCOL  NOT NULL CONSTRAINT [DF_ipc_ipc_unica]  DEFAULT (newid()),
	[ipc_fecha] [nvarchar](10) NULL,
	[ipc_valor] [real] NULL,
 CONSTRAINT [PK_ipc] PRIMARY KEY NONCLUSTERED 
(
	[ipc_unica] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[juanjabre](
	[cola] [int] NOT NULL,
PRIMARY KEY CLUSTERED 
(
	[cola] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[llamados_diarios](
	[CODIGO_LLAMADAS] [int] IDENTITY(1,1) NOT NULL,
	[FECHA] [date] NULL,
	[CODIGO_FICHA] [int] NULL,
	[CONTACTO] [varchar](100) NULL,
	[CARGO] [varchar](100) NULL,
	[TELEFONO] [varchar](15) NULL,
	[OBSERVACION] [varchar](300) NULL,
	[USUARIO_INGRESO] [varchar](5) NULL,
	[FECHA_INGRESO] [varchar](12) NULL,
	[USUARIO_MODIFICO] [varchar](5) NULL,
	[FECHA_MODIFICACION] [varchar](12) NULL,
	[ESTADO] [varchar](15) NULL,
 CONSTRAINT [PK_llamados_diarios] PRIMARY KEY CLUSTERED 
(
	[CODIGO_LLAMADAS] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_PADDING OFF
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[LOG_BLOQ_WEB](
	[LT_CLI] [nvarchar](20) NULL,
	[LT_MOV] [nvarchar](15) NULL,
	[LT_FECHA] [date] NULL,
	[LT_HORA] [time](5) NULL,
	[LT_USUARIO] [nvarchar](20) NULL,
	[LT_PC] [nvarchar](50) NULL
) ON [PRIMARY]

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[LOG_BLOQUEOPALLETS](
	[LBP_ID] [uniqueidentifier] NOT NULL CONSTRAINT [DF_LOG_BLOQUEOPALLETS_LFR_ID]  DEFAULT (newid()),
	[LBP_CODI] [varchar](50) NULL,
	[LBP_FECHA] [date] NULL,
	[LBP_HORA] [time](5) NULL,
	[LBP_USUARIO] [varchar](3) NULL,
	[LBP_PC] [varchar](50) NULL,
	[LBP_ESTADO] [numeric](18, 0) NULL,
 CONSTRAINT [PK_LOG_BLOQUEOPALLETS] PRIMARY KEY CLUSTERED 
(
	[LBP_ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_PADDING OFF
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[LOG_CONTENEDORES](
	[LCON_CONT] [varchar](50) NULL,
	[LCON_FECHA] [datetime] NULL,
	[LCON_USUCOD] [varchar](3) NULL,
	[LCON_TIPO] [nvarchar](10) NULL,
	[LCON_PC] [varchar](50) NULL
) ON [PRIMARY]

GO
SET ANSI_PADDING OFF
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[LOG_FICHDESPA](
	[LFR_ID] [uniqueidentifier] NOT NULL CONSTRAINT [DF_LOG_FICHDESPA_LFR_ID]  DEFAULT (newid()),
	[LFR_CODI] [nvarchar](7) NULL,
	[LFR_FECHA] [date] NULL,
	[LFR_HORA] [time](5) NULL,
	[LFR_USUARIO] [nvarchar](20) NULL,
	[LFR_PC] [nvarchar](50) NULL,
 CONSTRAINT [PK_LOG_FICHDESPA] PRIMARY KEY CLUSTERED 
(
	[LFR_ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[LOG_FICHRECE](
	[LFR_ID] [uniqueidentifier] ROWGUIDCOL  NOT NULL CONSTRAINT [DF_LOG_FICHRECE_LFR_ID]  DEFAULT (newid()),
	[LFR_CODI] [nvarchar](7) NULL,
	[LFR_FECHA] [date] NULL,
	[LFR_HORA] [time](5) NULL,
	[LFR_USUARIO] [nvarchar](20) NULL,
	[LFR_PC] [nvarchar](50) NULL,
 CONSTRAINT [PK_LOG_FICHRECE] PRIMARY KEY CLUSTERED 
(
	[LFR_ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Log_Liberacion_Tunel](
	[Pallet] [nvarchar](9) NULL,
	[Cliente] [nvarchar](60) NULL,
	[fechaLib] [nvarchar](10) NULL,
	[HoraLib] [nvarchar](8) NULL,
	[fechaTra] [nvarchar](10) NULL,
	[HoraTra] [nvarchar](8) NULL,
	[COD_VIG] [nvarchar](1) NULL
) ON [PRIMARY]

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[LOG_MAEPROD](
	[LMP_ID] [uniqueidentifier] ROWGUIDCOL  NOT NULL CONSTRAINT [DF_LOG_MAEPROD_LMP_ID]  DEFAULT (newid()),
	[LMP_CODI] [nvarchar](7) NULL,
	[LMP_FECHA] [date] NULL,
	[LMP_HORA] [time](5) NULL,
	[LMP_USUARIO] [nvarchar](20) NULL,
	[LMP_PC] [nvarchar](50) NULL,
	[LMP_OPERACION] [nvarchar](50) NULL,
 CONSTRAINT [PK_LOG_MAEPROD] PRIMARY KEY CLUSTERED 
(
	[LMP_ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[LOG_PALLET_BLOQUEADOS](
	[id] [nvarchar](50) NULL,
	[pallet] [nvarchar](50) NULL,
	[tipo] [nvarchar](50) NULL,
	[equipo] [nvarchar](50) NULL,
	[USUARIOEQUIPO] [nvarchar](50) NULL,
	[usuario] [nvarchar](50) NULL
) ON [PRIMARY]

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[LOG_PALLETVENCIDOS](
	[RUT] [nvarchar](10) NULL,
	[FECHA] [nvarchar](10) NULL,
	[HORA] [nvarchar](8) NULL,
	[TIPO] [nvarchar](1) NULL
) ON [PRIMARY]

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[LOG_PEDIDOSELIMINADOS](
	[LEM_ID] [uniqueidentifier] ROWGUIDCOL  NOT NULL CONSTRAINT [DF_LOG_PEDIDOSELIMINADOS_LEM_ID]  DEFAULT (newid()),
	[LEM_CODI] [nvarchar](7) NULL,
	[LEM_FECHA] [date] NULL,
	[LEM_HORA] [time](7) NULL,
	[LEM_USU] [nvarchar](3) NULL,
	[LEM_PC] [nvarchar](50) NULL,
	[LEM_TIPO] [nvarchar](2) NULL,
 CONSTRAINT [PK_LOG_PEDIDOSELIMINADOS] PRIMARY KEY CLUSTERED 
(
	[LEM_ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[LOG_RCP](
	[LRCP_ID] [uniqueidentifier] NOT NULL CONSTRAINT [DF_Table_1_LFR_ID]  DEFAULT (newid()),
	[LRCP_CODI] [nvarchar](7) NULL,
	[LRCP_FECHA] [date] NULL,
	[LRCP_HORA] [time](5) NULL,
	[LRCP_USUARIO] [nvarchar](20) NULL,
	[LRCP_PC] [nvarchar](50) NULL,
	[LRCP_CODSAG] [nvarchar](50) NULL,
 CONSTRAINT [PK_LOG_RCP] PRIMARY KEY CLUSTERED 
(
	[LRCP_ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[log_recepcion](
	[log_id] [nvarchar](30) NOT NULL,
	[log_Nrecepcion] [nvarchar](7) NULL,
	[log_fecha_hora] [nvarchar](20) NULL,
	[log_usuario] [nvarchar](30) NULL,
	[log_tipo] [nvarchar](1) NULL,
	[log_usergestion] [nvarchar](3) NULL
) ON [PRIMARY]

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[LOG_RevisionPallets](
	[rev_codi] [uniqueidentifier] ROWGUIDCOL  NOT NULL CONSTRAINT [DF_LOG_RevisionPallets_rev_codi]  DEFAULT (newid()),
	[rev_codpallet] [varchar](9) NULL,
	[rev_fecha] [datetime] NULL,
	[rev_codenca] [varchar](3) NULL,
	[rev_est] [int] NULL,
	[rev_tipo] [int] NULL,
 CONSTRAINT [PK_LOG_RevisionPallets] PRIMARY KEY CLUSTERED 
(
	[rev_codi] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_PADDING OFF
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[LOG_SALTOCORR](
	[tmps_unica] [uniqueidentifier] ROWGUIDCOL  NOT NULL CONSTRAINT [DF_LOG_SALTOCORR_tmps_unica]  DEFAULT (newid()),
	[tmps_codi] [nvarchar](10) NULL,
	[tmps_correl] [int] NULL,
	[tmps_usuario] [nvarchar](10) NULL,
	[tmps_personal] [smallint] NULL,
	[tmps_fecha] [datetime] NULL,
	[tmps_gestion] [varchar](50) NULL,
 CONSTRAINT [PK_LOG_SALTOCORR] PRIMARY KEY CLUSTERED 
(
	[tmps_unica] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_PADDING OFF
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[LOG_VAS](
	[LVAS_ID] [uniqueidentifier] ROWGUIDCOL  NOT NULL CONSTRAINT [DF_LOG_VAS_LVAS_ID]  DEFAULT (newid()),
	[LVAS_CODI] [nvarchar](7) NULL,
	[LVAS_FECHA] [date] NULL,
	[LVAS_HORA] [time](5) NULL,
	[LVAS_USUARIO] [nvarchar](20) NULL,
	[LVAS_PC] [nvarchar](50) NULL,
	[LVAS_OP] [varchar](50) NULL,
 CONSTRAINT [PK_LOG_VAS] PRIMARY KEY CLUSTERED 
(
	[LVAS_ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_PADDING OFF
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[LOG_WEBUSUARIOS](
	[LWU_ID] [uniqueidentifier] NOT NULL,
	[LWU_CODI] [varchar](50) NULL,
	[LWU_FECHA] [date] NULL,
	[LWU_HORA] [time](7) NULL,
	[LWU_USUARIO] [varchar](10) NULL,
	[LWU_PC] [varchar](50) NULL,
	[LWU_IP] [varchar](50) NULL,
	[LWU_TABLA] [varchar](100) NULL,
	[LWU_ESTADO] [varchar](10) NULL,
 CONSTRAINT [PK_LOG_WEBUSUARIOS] PRIMARY KEY CLUSTERED 
(
	[LWU_ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_PADDING OFF
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Mae_Bodega](
	[Cod_Bodega] [nvarchar](50) NULL,
	[Des_Bodega] [nvarchar](max) NULL,
	[Tipo] [nvarchar](50) NULL,
	[Dir_Bodega] [nvarchar](max) NULL,
	[Rut_Bodega] [numeric](18, 0) NOT NULL,
	[Razon_Social] [nvarchar](max) NULL,
	[contacto] [nvarchar](50) NULL
) ON [PRIMARY] TEXTIMAGE_ON [PRIMARY]

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[maeprod](
	[mae_unica] [uniqueidentifier] NOT NULL CONSTRAINT [DF_maeprod_mae_unica]  DEFAULT (newid()),
	[mae_codi] [nvarchar](7) NULL,
	[mae_descr] [nvarchar](50) NULL,
	[mae_tipenv] [nvarchar](5) NULL,
	[mae_clirut] [nvarchar](10) NULL,
	[mae_productor] [varchar](15) NULL,
	[mae_feccre] [nvarchar](10) NULL,
	[mae_alto] [float] NULL,
	[mae_ancho] [float] NULL,
	[mae_fondo] [float] NULL,
	[mae_base] [int] NULL,
	[mae_altura] [int] NULL,
	[mae_codcli] [nvarchar](15) NULL,
	[mae_codvig] [tinyint] NULL,
	[mae_codirel] [nvarchar](6) NULL,
	[mae_tipo] [int] NULL CONSTRAINT [DF_maeprod_mae_tipo]  DEFAULT ((0)),
	[mae_pt] [int] NULL CONSTRAINT [DF_maeprod_mae_pt]  DEFAULT ((0)),
	[mae_producto_tipo] [int] NULL CONSTRAINT [DF_maeprod_mae_producto_tipo]  DEFAULT ((0)),
	[mae_diasv] [int] NULL,
	[mae_estado] [nvarchar](1) NULL,
	[mae_valor] [real] NOT NULL CONSTRAINT [DF_maeprod_mae_valor]  DEFAULT ((0)),
	[mae_dun14] [nvarchar](60) NULL,
	[MAE_CODI2] [nvarchar](7) NULL,
	[mae_tipenvdesc] [nvarchar](30) NULL,
	[mae_clirutdesc] [nvarchar](30) NULL,
	[mae_pcaja] [nchar](10) NULL,
	[cod_bod] [nchar](10) NULL,
 CONSTRAINT [PK_maeprod] PRIMARY KEY NONCLUSTERED 
(
	[mae_unica] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_PADDING OFF
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[maeprod_detalle](
	[id] [varchar](10) NULL,
	[codigo] [varchar](10) NULL,
	[numero] [varchar](10) NULL,
	[descripcion] [varchar](50) NULL
) ON [PRIMARY]

GO
SET ANSI_PADDING OFF
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[MAEPROD_SOLICITUD](
	[IDAUTOMATICO] [numeric](18, 0) IDENTITY(1,1) NOT NULL,
	[ID] [nvarchar](50) NULL,
	[FECHA] [nvarchar](10) NULL,
	[HORA] [nvarchar](8) NULL,
	[CLIENTE] [nvarchar](50) NULL,
	[FAMILIA] [nvarchar](3) NULL,
	[CODENVASE] [nvarchar](5) NULL,
	[ENVASE] [nvarchar](40) NULL,
	[CODPROD] [nvarchar](7) NULL,
	[PRODUCTO] [nvarchar](50) NULL,
	[CODCLIENTE] [nvarchar](20) NULL,
	[ALTO] [real] NULL,
	[ANCHO] [real] NULL,
	[FONDO] [real] NULL,
	[BASE] [real] NULL,
	[ALTURA] [real] NULL,
	[DUN14] [nvarchar](14) NULL,
	[ESTADO] [bit] NULL,
	[USUARIO] [nvarchar](3) NULL,
	[MAIL] [nvarchar](50) NULL,
	[MAIL1] [nvarchar](50) NULL,
	[BLOQUEO] [nvarchar](3) NULL,
	[FECHABLOQUEO] [nvarchar](50) NULL
) ON [PRIMARY]

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[maerela](
	[mar_unica] [uniqueidentifier] NOT NULL CONSTRAINT [DF_maerela_mar_unica]  DEFAULT (newid()),
	[mar_rutcli] [nvarchar](9) NULL,
	[mar_codigo] [nvarchar](51) NULL,
	[mar_maecod] [nvarchar](7) NULL,
 CONSTRAINT [PK_maerela] PRIMARY KEY NONCLUSTERED 
(
	[mar_unica] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Mail_Ped_Local](
	[mpl_correos] [nvarchar](254) NULL,
	[mpl_vigencia] [int] NULL
) ON [PRIMARY]

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[medidas](
	[med_codi] [varchar](3) NOT NULL,
	[med_descr] [nvarchar](30) NULL,
 CONSTRAINT [PK_medidas] PRIMARY KEY NONCLUSTERED 
(
	[med_codi] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_PADDING OFF
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Medidas2](
	[med_unica] [uniqueidentifier] NOT NULL CONSTRAINT [DF_Medidas2_med_unica]  DEFAULT (newid()),
	[med_codi] [nvarchar](3) NULL,
	[med_descr] [nvarchar](30) NULL
) ON [PRIMARY]

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Menu_Gestion](
	[NombreNodo] [nvarchar](50) NULL,
	[IdentificadorNodo] [int] NULL,
	[IdentificadorPadre] [int] NULL,
	[Estado] [int] NULL
) ON [PRIMARY]

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[MenuFactura](
	[Menu1] [char](40) NULL,
	[Menu2] [char](40) NULL,
	[Menu3] [char](40) NULL,
	[Acceso1] [bit] NULL,
	[Acceso2] [bit] NULL,
	[Acceso3] [bit] NULL
) ON [PRIMARY]

GO
SET ANSI_PADDING OFF
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[MenuGestion](
	[Menu1] [char](40) NULL,
	[Menu2] [char](40) NULL,
	[Menu3] [char](40) NULL,
	[Menu4] [char](40) NULL,
	[Acceso1] [bit] NULL,
	[Acceso2] [bit] NULL,
	[Acceso3] [bit] NULL,
	[Acceso4] [bit] NULL
) ON [PRIMARY]

GO
SET ANSI_PADDING OFF
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[Menus](
	[id] [int] IDENTITY(1,1) NOT NULL,
	[Aplicacion] [char](10) NULL,
	[Personal] [char](3) NULL,
	[Menu1] [char](40) NULL,
	[Menu2] [char](40) NULL,
	[Menu3] [char](40) NULL,
	[Menu4] [char](40) NULL,
	[Acceso1] [bit] NULL,
	[Acceso2] [bit] NULL,
	[Acceso3] [bit] NULL,
	[Acceso4] [bit] NULL,
 CONSTRAINT [PK_Menus] PRIMARY KEY NONCLUSTERED 
(
	[id] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_PADDING OFF
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[MENUS_gestion](
	[NOMBRE] [varchar](80) NULL,
	[FORMULARIO] [varchar](80) NULL,
	[PADRE] [varchar](80) NULL,
	[NUMERO] [int] NULL,
	[HOJA] [bit] NULL,
	[GRABAR] [bit] NULL,
	[PANTALLA] [bit] NULL,
	[ARCHIVO] [bit] NULL,
	[IMPRIMIR] [bit] NULL
) ON [PRIMARY]

GO
SET ANSI_PADDING OFF
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[MENUS_OPERACIONES](
	[NOMBRE] [varchar](80) NULL,
	[FORMULARIO] [varchar](80) NULL,
	[PADRE] [varchar](80) NULL,
	[NUMERO] [int] NULL,
	[HOJA] [bit] NULL,
	[GRABAR] [bit] NULL,
	[PANTALLA] [bit] NULL,
	[ARCHIVO] [bit] NULL,
	[IMPRIMIR] [bit] NULL
) ON [PRIMARY]

GO
SET ANSI_PADDING OFF
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[MENUS_OPERACIONES1](
	[NOMBRE] [varchar](80) NULL,
	[FORMULARIO] [varchar](80) NULL,
	[PADRE] [varchar](80) NULL,
	[NUMERO] [int] NULL,
	[HOJA] [bit] NULL,
	[GRABAR] [bit] NULL,
	[PANTALLA] [bit] NULL,
	[ARCHIVO] [bit] NULL,
	[IMPRIMIR] [bit] NULL
) ON [PRIMARY]

GO
SET ANSI_PADDING OFF
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[MENUS_PROCESOS](
	[NOMBRE] [varchar](80) NULL,
	[FORMULARIO] [varchar](80) NULL,
	[PADRE] [varchar](80) NULL,
	[NUMERO] [int] NULL,
	[HOJA] [bit] NULL,
	[GRABAR] [bit] NULL,
	[PANTALLA] [bit] NULL,
	[ARCHIVO] [bit] NULL,
	[IMPRIMIR] [bit] NULL
) ON [PRIMARY]

GO
SET ANSI_PADDING OFF
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[metas_tunel](
	[met_cod] [int] NOT NULL,
	[met_mes_num] [varchar](2) NULL,
	[met_mes] [varchar](12) NULL,
	[met_year] [varchar](4) NULL,
	[met_toneladas] [float] NULL,
 CONSTRAINT [PK_metas_tunel] PRIMARY KEY CLUSTERED 
(
	[met_cod] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_PADDING OFF
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[monedas](
	[mon_codi] [varchar](2) NOT NULL,
	[mon_descr] [varchar](50) NULL,
	[mon_valor] [real] NULL,
	[mon_fecval] [varchar](50) NULL,
	[mon_est] [int] NULL,
	[mon_sigla] [varchar](5) NULL,
 CONSTRAINT [PK_monedas_1] PRIMARY KEY CLUSTERED 
(
	[mon_codi] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_PADDING OFF
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[monedas_hist](
	[Vmon_ID] [decimal](18, 0) NULL,
	[Vmon_Fec] [datetime] NULL,
	[Vmon_codUF] [decimal](18, 0) NULL,
	[Vmon_ValorUF] [float] NULL,
	[Vmon_CodDolar] [decimal](18, 0) NULL,
	[Vmon_ValorDolar] [float] NULL,
	[Vnom_CodPesos] [decimal](18, 0) NULL,
	[Vnom_ValorPesos] [float] NULL,
	[Vmon_GrupFec] [decimal](18, 0) NULL
) ON [PRIMARY]

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[MONITOREO_TRAZABILIDAD](
	[LINEA] [nvarchar](3) NULL,
	[PALLET] [nvarchar](9) NULL,
	[POSRACK] [nvarchar](50) NULL,
	[POSTRAZ] [nvarchar](50) NULL
) ON [PRIMARY]

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[movcajas](
	[movc_codi] [uniqueidentifier] ROWGUIDCOL  NOT NULL CONSTRAINT [DF_movcajas_movc_codi]  DEFAULT (newid()),
	[movc_fecha] [datetime] NULL,
	[movc_codcaja] [varchar](200) NULL,
	[movc_codrece] [varchar](9) NULL,
	[movc_tipo] [varchar](3) NULL,
	[movc_ndoc] [numeric](18, 0) NULL,
 CONSTRAINT [PK_movcajas] PRIMARY KEY CLUSTERED 
(
	[movc_codi] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_PADDING OFF
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[MOVIMIENTOCAMARAS](
	[MOVC_ID] [nvarchar](14) NULL,
	[MOVC_TIPO] [nvarchar](2) NULL,
	[MOVC_FOLIO] [nvarchar](9) NULL,
	[MOVC_FECHA] [nvarchar](10) NULL,
	[MOVC_HORA] [nvarchar](10) NULL,
	[MOVC_CA] [nvarchar](2) NULL,
	[MOVC_BA] [nvarchar](2) NULL,
	[MOVC_CO] [nvarchar](2) NULL,
	[MOVC_PI] [nvarchar](2) NULL,
	[MOVC_NI] [nvarchar](2) NULL,
	[MOVC_TS] [real] NULL,
	[MOVC_TM] [real] NULL,
	[MOVC_TI] [real] NULL,
	[MOVC_PESO] [float] NULL CONSTRAINT [DF_MOVIMIENTOCAMARAS_MOVC_PESO]  DEFAULT (0)
) ON [PRIMARY]

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[MovimientoCamion](
	[ID] [int] IDENTITY(1,1) NOT NULL,
	[NumeroIngreso] [numeric](10, 0) NULL,
	[Chofer] [nvarchar](9) NOT NULL,
	[EmpresaTransporte] [nvarchar](50) NULL,
	[Patente] [char](10) NULL,
	[Cliente] [nvarchar](9) NULL,
	[Accion] [int] NULL,
	[Fecha1] [smalldatetime] NULL,
	[Hora1] [char](5) NULL,
	[Fecha2] [smalldatetime] NULL,
	[Hora2] [char](5) NULL,
	[Fecha3] [smalldatetime] NULL,
	[Hora3] [char](5) NULL,
	[Atiende] [nvarchar](9) NULL,
	[TipoMovimiento] [int] NOT NULL,
	[DocumentoEntrada] [char](10) NULL,
	[DocumentoSalida] [char](10) NULL,
	[Observacion] [char](75) NULL,
	[ruttransporte] [nvarchar](13) NULL,
	[RCP] [nvarchar](15) NULL,
	[DocumentoEntrada2] [nvarchar](10) NULL,
	[DocumentoEntrada3] [nvarchar](10) NULL,
	[DocumentoSalida2] [nvarchar](10) NULL,
	[DocumentoSalida3] [nvarchar](10) NULL,
	[Encargado] [nvarchar](5) NULL,
	[Patente2] [nvarchar](20) NULL,
	[Producto] [nvarchar](15) NULL,
	[TIPOCAMION] [nvarchar](15) NULL,
	[ANDEN] [nvarchar](10) NULL,
	[beepers] [nvarchar](2) NULL,
	[beepers_fh] [nvarchar](19) NULL,
 CONSTRAINT [PK_MovimientoCamion] PRIMARY KEY CLUSTERED 
(
	[ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_PADDING OFF
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[movpallet](
	[mov_unica] [uniqueidentifier] NOT NULL CONSTRAINT [DF_movpallet_mov_unica]  DEFAULT (newid()),
	[mov_folio] [nvarchar](9) NULL,
	[mov_codper] [nvarchar](3) NULL,
	[mov_ca] [nvarchar](2) NULL,
	[mov_ba] [nvarchar](3) NULL,
	[mov_co] [nvarchar](2) NULL,
	[mov_pi] [nvarchar](2) NULL,
	[mov_ni] [nvarchar](1) NULL,
	[mov_fecha] [nvarchar](10) NULL,
	[mov_tipo] [nvarchar](2) NULL,
	[mov_hora] [nvarchar](10) NULL,
	[mov_TS] [real] NULL,
	[mov_TM] [real] NULL,
	[mov_TI] [real] NULL,
	[mov_Doc] [nvarchar](10) NULL,
	[mov_RecepTunel] [int] NULL,
	[Mov_Despacho] [int] NULL,
	[Mov_Saldo] [int] NULL,
	[mov_docdespa] [nvarchar](9) NULL,
	[mov_chorut] [nvarchar](10) NULL,
	[mov_chonom] [nvarchar](50) NULL,
	[mov_chopat] [nvarchar](10) NULL,
	[mov_chotra] [nvarchar](50) NULL,
	[mov_anden] [nvarchar](10) NULL,
	[mov_unidped] [int] NULL CONSTRAINT [DF_movpallet_mov_unidped]  DEFAULT ((0)),
 CONSTRAINT [PK_movpallet] PRIMARY KEY NONCLUSTERED 
(
	[mov_unica] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[NewInventario](
	[inv_pcod] [nvarchar](50) NULL,
	[inv_caj] [nvarchar](50) NOT NULL,
	[Cliente] [nvarchar](100) NULL,
	[fecha_reg] [datetime] NULL,
	[usr_reg] [nchar](10) NULL,
	[obs_com] [nvarchar](100) NULL,
 CONSTRAINT [PK_NewInventario] PRIMARY KEY CLUSTERED 
(
	[inv_caj] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[NewRack](
	[rack_ca] [varchar](2) NULL,
	[rack_ba] [varchar](2) NULL,
	[rack_co] [varchar](2) NULL,
	[rack_pi] [varchar](2) NULL
) ON [PRIMARY]

GO
SET ANSI_PADDING OFF
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[nomiper](
	[nper_unica] [uniqueidentifier] NOT NULL CONSTRAINT [DF_nomiper_nper_unica]  DEFAULT (newid()),
	[nper_codi] [nvarchar](3) NULL,
	[nper_rut] [nvarchar](9) NULL,
	[nper_nomb] [nvarchar](40) NULL,
	[nper_cargo] [nvarchar](30) NULL,
	[nper_feccre] [nvarchar](10) NULL,
 CONSTRAINT [PK_nomiper] PRIMARY KEY NONCLUSTERED 
(
	[nper_unica] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[NotificacionCliente](
	[ID] [int] IDENTITY(1,1) NOT NULL,
	[Cliente] [char](10) NOT NULL,
	[Notificacion] [int] NOT NULL,
 CONSTRAINT [PK_NotificacionCliente] PRIMARY KEY NONCLUSTERED 
(
	[ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_PADDING OFF
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[numerdia](
	[num_unica] [uniqueidentifier] NOT NULL CONSTRAINT [DF_numerdia_num_unica]  DEFAULT (newid()),
	[num_fecha] [nvarchar](10) NULL,
	[num_rutclie] [nvarchar](9) NULL,
	[num_contclie] [nvarchar](7) NULL,
	[num_totsopo] [int] NULL,
	[num_totunidad] [int] NULL,
	[num_totpeso] [real] NULL,
 CONSTRAINT [PK_numerdia] PRIMARY KEY NONCLUSTERED 
(
	[num_unica] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[orden_trabajo](
	[idOT] [int] IDENTITY(1,1) NOT NULL,
	[fecha_hora] [datetime] NULL,
	[descripcion] [varchar](200) NULL,
	[solucionado] [bit] NULL
) ON [PRIMARY]

GO
SET ANSI_PADDING OFF
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[origen](
	[ori_unica] [uniqueidentifier] NOT NULL CONSTRAINT [DF_origen_ori_unica]  DEFAULT (newid()),
	[ori_codi] [nvarchar](2) NULL,
	[ori_descr] [nvarchar](40) NULL,
 CONSTRAINT [PK_origen] PRIMARY KEY NONCLUSTERED 
(
	[ori_unica] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[osaka](
	[CODIGO] [varchar](12) NOT NULL,
	[FECHA] [date] NULL,
	[HORA] [time](7) NULL,
	[TUNEL1_TEMPERATURA] [varchar](5) NULL,
	[TUNEL2_TEMPERATURA] [varchar](5) NULL,
	[ODAT_TEMP_CA1] [varchar](5) NULL,
	[ODAT_TEMP_CA2] [varchar](5) NULL,
	[ODAT_TEMP_CA3] [varchar](5) NULL,
	[ODAT_TEMP_CA4] [varchar](5) NULL,
	[ODAT_TEMP_CA5] [varchar](5) NULL,
	[ODAT_TEMP_CA6] [varchar](5) NULL,
	[ODAT_TEMP_PULM1] [varchar](5) NULL,
	[ODAT_TEMP_PULM2] [varchar](5) NULL,
	[TUNEL1_ESTADO] [varchar](5) NULL,
	[TUNEL2_ESTADO] [varchar](5) NULL,
	[SALA_SERVICIOS] [varchar](5) NULL,
 CONSTRAINT [PK__osaka__CC87E127E14E4A17] PRIMARY KEY CLUSTERED 
(
	[CODIGO] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_PADDING OFF
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[P_Ciudades](
	[CiudadCodigo] [nvarchar](3) NOT NULL,
	[CiudadDescripcion] [nvarchar](70) NOT NULL
) ON [PRIMARY]

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[P_Comunas](
	[CodInterno] [int] NULL,
	[Nombre] [varchar](255) NULL,
	[Padre] [int] NULL
) ON [PRIMARY]

GO
SET ANSI_PADDING OFF
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[P_ConChecklist](
	[Con_codi] [numeric](18, 0) NOT NULL,
	[Con_desc] [nvarchar](50) NULL,
 CONSTRAINT [PK_P_ConChecklist] PRIMARY KEY CLUSTERED 
(
	[Con_codi] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[P_DescripcionCamaras](
	[IdCamara] [nchar](10) NULL,
	[Camara] [nvarchar](50) NOT NULL
) ON [PRIMARY]

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[P_EstadoCajasDaadas](
	[Id] [int] NULL,
	[Estado] [nvarchar](50) NULL
) ON [PRIMARY]

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[P_EstadoContrato](
	[econt_codi] [numeric](18, 0) NOT NULL,
	[econt_desc] [varchar](50) NULL,
 CONSTRAINT [PK_P_EstadoContrato] PRIMARY KEY CLUSTERED 
(
	[econt_codi] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_PADDING OFF
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[P_EstadoDocumento](
	[ED_CODI] [numeric](18, 0) NOT NULL,
	[ED_DESC] [nvarchar](50) NULL,
 CONSTRAINT [PK_P_EstadoDocumento] PRIMARY KEY CLUSTERED 
(
	[ED_CODI] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[P_EstadoFacturacion](
	[tfac_codi] [numeric](18, 0) NOT NULL,
	[tfac_desc] [varchar](50) NULL,
 CONSTRAINT [PK_P_EstadoFacturacion] PRIMARY KEY CLUSTERED 
(
	[tfac_codi] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_PADDING OFF
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[P_EstadoIngreso](
	[eing_codi] [numeric](18, 0) NOT NULL,
	[eing_desc] [varchar](50) NULL,
 CONSTRAINT [PK_P_EstadoIngreso] PRIMARY KEY CLUSTERED 
(
	[eing_codi] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_PADDING OFF
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[P_EstadoPallet](
	[IdEstadoPallet] [nvarchar](50) NULL,
	[EstadoPallet] [nvarchar](50) NULL
) ON [PRIMARY]

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[P_EstadoProducto](
	[IdEstado] [int] NULL,
	[TipoEstado] [nvarchar](50) NULL
) ON [PRIMARY]

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[P_Estados](
	[EstadoId] [int] NULL,
	[EstadoNombre] [nvarchar](50) NULL
) ON [PRIMARY]

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[P_EstadoUsuPed](
	[estped_glosa] [nvarchar](50) NULL,
	[estped_codi] [int] NULL
) ON [PRIMARY]

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[P_Filtros](
	[IdFiltro] [nvarchar](2) NULL,
	[FiltroDescripcion] [nvarchar](50) NULL
) ON [PRIMARY]

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[P_Incluir](
	[Inc_codi] [numeric](18, 0) NOT NULL,
	[Inc_Descr] [nvarchar](20) NULL,
 CONSTRAINT [PK_P_Incluir] PRIMARY KEY CLUSTERED 
(
	[Inc_codi] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[P_InfCargaDescarga](
	[Id] [int] NULL,
	[Tipo] [nvarchar](50) NULL
) ON [PRIMARY]

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[P_InfCPendientesMov](
	[id] [varchar](1) NULL,
	[TipoMov] [nvarchar](50) NULL
) ON [PRIMARY]

GO
SET ANSI_PADDING OFF
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[P_InfEstadoPedido](
	[Id] [int] NULL,
	[Estado] [nvarchar](50) NULL
) ON [PRIMARY]

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[P_InfMovPallet](
	[Id] [int] NULL,
	[Datos] [nvarchar](50) NULL
) ON [PRIMARY]

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[P_InfOrdenar](
	[id] [int] NULL,
	[Ordenar] [nvarchar](50) NULL
) ON [PRIMARY]

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[P_InfPalletVencidos](
	[Id] [int] NULL,
	[Mostrar] [nvarchar](50) NULL
) ON [PRIMARY]

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[P_InfPosicionCamaras](
	[Id] [int] NULL,
	[Mostrar] [nvarchar](50) NULL
) ON [PRIMARY]

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[P_InfProductividad](
	[Id] [int] NULL,
	[Datos] [nvarchar](50) NULL
) ON [PRIMARY]

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[P_InfTunel](
	[id] [int] NULL,
	[Tunel] [nvarchar](50) NULL
) ON [PRIMARY]

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[P_MenuADMINISTRADOROPERACIONES](
	[NombreNodo] [nvarchar](50) NULL,
	[IdentificadorNodo] [int] NULL,
	[IdentificadorPadre] [int] NULL,
	[Estado] [int] NULL
) ON [PRIMARY]

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[P_MenuOPERACION](
	[NombreNodo] [nvarchar](50) NULL,
	[IdentificadorNodo] [int] NULL,
	[IdentificadorPadre] [int] NULL,
	[Estado] [int] NULL
) ON [PRIMARY]

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[P_MenuOPERACIONES](
	[NombreNodo] [nvarchar](50) NULL,
	[IdentificadorNodo] [int] NULL,
	[IdentificadorPadre] [int] NULL,
	[Estado] [int] NULL
) ON [PRIMARY]

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[P_MenuSUPERVISOR](
	[NombreNodo] [nvarchar](50) NULL,
	[IdentificadorNodo] [int] NULL,
	[IdentificadorPadre] [int] NULL,
	[Estado] [int] NULL
) ON [PRIMARY]

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[P_MovChecklist](
	[mov_codi] [numeric](18, 0) NOT NULL,
	[Mov_desc] [nvarchar](30) NULL,
 CONSTRAINT [PK_P_MovChecklist] PRIMARY KEY CLUSTERED 
(
	[mov_codi] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[P_NotificacioneCliente](
	[RutCliente] [nvarchar](10) NOT NULL,
	[IdNotificacion1] [int] NOT NULL,
	[IdNotificacion2] [int] NOT NULL,
	[IdNotificacion3] [int] NOT NULL,
	[IdNotificacion4] [int] NOT NULL,
	[IdNotificacion5] [int] NOT NULL
) ON [PRIMARY]

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[P_PalletHACCP](
	[id] [int] NULL,
	[descripcion] [nvarchar](50) NULL
) ON [PRIMARY]

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[P_ProcTunel](
	[id] [nchar](10) NULL,
	[estado] [nchar](10) NULL
) ON [PRIMARY]

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[P_RadioFrecuencia](
	[Id] [int] NOT NULL,
	[RadioNombre] [nvarchar](50) NOT NULL
) ON [PRIMARY]

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING OFF
GO
CREATE TABLE [dbo].[P_ROLES](
	[IdRol] [int] NOT NULL,
	[NombreRol] [varchar](50) NOT NULL
) ON [PRIMARY]

GO
SET ANSI_PADDING OFF
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[P_SeccionVas](
	[sec_codi] [numeric](18, 0) NOT NULL,
	[sec_descr] [nvarchar](50) NULL
) ON [PRIMARY]

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[P_Sensor](
	[IdSensor] [int] NULL,
	[Sensor] [nvarchar](50) NULL
) ON [PRIMARY]

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[P_TipoAlmacenamiento](
	[id] [int] NULL,
	[almacenamiento] [nvarchar](50) NULL
) ON [PRIMARY]

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[P_TipoCamaras](
	[IdTipoCamara] [nchar](10) NULL,
	[TipoCamara] [nvarchar](50) NOT NULL
) ON [PRIMARY]

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[P_TipoCargaDescarga](
	[tcar_codi] [numeric](18, 0) NULL,
	[tcar_descr] [nvarchar](20) NULL
) ON [PRIMARY]

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[P_TipoClientes](
	[tcli_codi] [varchar](15) NOT NULL,
	[tcli_desc] [varchar](20) NULL,
	[tcli_traqueo] [numeric](18, 0) NULL,
 CONSTRAINT [PK_P_TipoClientes] PRIMARY KEY CLUSTERED 
(
	[tcli_codi] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_PADDING OFF
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[P_TipoDao](
	[IdDao] [nvarchar](50) NULL,
	[DescripcionDao] [nvarchar](50) NULL
) ON [PRIMARY]

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[P_TipoDescripcion](
	[IdTipoDescripcion] [nvarchar](50) NULL,
	[TipoDescripcion] [nvarchar](50) NULL
) ON [PRIMARY]

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[P_TipoEstiba](
	[IdEstiba] [nvarchar](50) NULL,
	[DescripcionEstiba] [nvarchar](50) NULL
) ON [PRIMARY]

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[P_TipoHigiene](
	[IdHigiene] [nvarchar](50) NULL,
	[DescripcionHigiene] [nvarchar](50) NULL
) ON [PRIMARY]

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[P_TipoLectura](
	[tlec_codi] [numeric](18, 0) NOT NULL,
	[tlec_desc] [varchar](50) NULL,
 CONSTRAINT [PK_P_TipoLectura] PRIMARY KEY CLUSTERED 
(
	[tlec_codi] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_PADDING OFF
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[P_TipoMenu](
	[Menu] [nvarchar](50) NULL,
	[TipoPerfil] [nvarchar](50) NULL,
	[Rol] [nvarchar](50) NULL
) ON [PRIMARY]

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[P_TipoMovCajas](
	[tmov_sigla] [varchar](2) NOT NULL,
	[tmov_desc] [varchar](50) NULL,
 CONSTRAINT [PK_OP_TipoMovCajas] PRIMARY KEY CLUSTERED 
(
	[tmov_sigla] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_PADDING OFF
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[P_TipoMovTraza](
	[tmov_sigla] [varchar](2) NOT NULL,
	[tmov_desc] [varchar](50) NULL
) ON [PRIMARY]

GO
SET ANSI_PADDING OFF
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[P_TipoMovVas](
	[tmov_codi] [numeric](18, 0) NOT NULL,
	[tmov_desc] [varchar](20) NULL,
 CONSTRAINT [PK_Op_TipoMovVas] PRIMARY KEY CLUSTERED 
(
	[tmov_codi] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_PADDING OFF
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[P_TipoNumerales](
	[tnum_codi] [numeric](18, 0) NOT NULL,
	[tnum_desc] [varchar](20) NULL,
	[tnum_act] [numeric](18, 0) NULL,
 CONSTRAINT [PK_P_TipoNumerales] PRIMARY KEY CLUSTERED 
(
	[tnum_codi] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_PADDING OFF
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[P_TipoOlores](
	[IdOlor] [nvarchar](50) NULL,
	[DescripcionOlor] [nvarchar](50) NULL
) ON [PRIMARY]

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[P_TipoPerfil](
	[Id] [int] NULL,
	[TipoPerfil] [nvarchar](50) NULL
) ON [PRIMARY]

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[P_TipoRecepcion](
	[IdRecepcion] [nvarchar](50) NULL,
	[DescripcionRecepcion] [nvarchar](50) NULL
) ON [PRIMARY]

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[P_TipoSeguros](
	[tseg_codi] [numeric](18, 0) NOT NULL,
	[tseg_desc] [varchar](50) NULL,
 CONSTRAINT [PK_P_TipoSeguros] PRIMARY KEY CLUSTERED 
(
	[tseg_codi] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_PADDING OFF
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[P_TipoTunel](
	[IdTunel] [int] NULL,
	[Tunel] [nvarchar](50) NULL
) ON [PRIMARY]

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[P_Tunel](
	[IdTunel] [int] NULL,
	[Tunel] [nvarchar](3) NULL
) ON [PRIMARY]

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[P_turnos](
	[tur_codi] [numeric](18, 0) NOT NULL,
	[tur_desc] [nvarchar](10) NULL,
 CONSTRAINT [PK_P_turnos] PRIMARY KEY CLUSTERED 
(
	[tur_codi] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[P_Usuario](
	[UsuarioNumero] [nvarchar](50) NOT NULL,
	[UsuarioRut] [nvarchar](50) NOT NULL,
	[UsuarioNombre] [nvarchar](100) NOT NULL,
	[UsuarioModulo] [int] NOT NULL,
	[UsuarioClave] [nvarchar](50) NOT NULL,
	[UsuarioAlias] [nvarchar](50) NOT NULL,
	[IdRol] [int] NOT NULL,
	[UsuarioCargo] [nvarchar](50) NULL,
	[UsuarioRadio] [int] NULL,
	[UsuarioTipoRadio] [int] NULL,
	[UsuarioMenu] [nvarchar](50) NULL,
	[UsuarioTipoMenu] [nvarchar](50) NULL,
	[UsuarioTemperatura] [int] NULL
) ON [PRIMARY]

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[P_Vigencia](
	[IdVigencia] [int] NULL,
	[Nombre] [nvarchar](50) NULL
) ON [PRIMARY]

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Packing_List](
	[Pack_rutcli] [nvarchar](50) NULL,
	[Pack_Numero] [nvarchar](50) NULL,
	[Pack_Fecha] [nvarchar](50) NULL,
	[Pack_CodPer] [nvarchar](50) NULL,
	[PacK_CodBarra] [nvarchar](50) NULL,
	[Pack_Batch] [nvarchar](50) NULL,
	[Pack_Caja] [nvarchar](50) NULL,
	[Pack_Prod] [nvarchar](15) NULL,
	[Pack_unidad] [numeric](18, 0) NULL,
	[Pack_kilos] [real] NULL,
	[Pack_kilosop] [real] NULL,
	[Pack_obs] [nvarchar](255) NULL,
	[Pack_FechaP] [nvarchar](10) NULL,
	[Pack_FechaV] [nvarchar](10) NULL,
	[Pack_Estado] [nvarchar](1) NULL,
	[pack_primar] [nvarchar](1) NULL
) ON [PRIMARY]

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Packing_listCliente](
	[correlativo] [nvarchar](50) NULL,
	[rutcli] [nvarchar](12) NULL,
	[batch] [nvarchar](50) NULL,
	[codpro] [nvarchar](50) NULL,
	[caja] [nvarchar](50) NULL,
	[pieza] [nvarchar](50) NULL,
	[calidad] [nvarchar](50) NULL,
	[kilosop] [numeric](18, 0) NULL,
	[kilos] [numeric](18, 0) NULL,
	[fechadesp] [nvarchar](50) NULL,
	[packing] [nvarchar](50) NULL,
	[contenedor] [nvarchar](50) NULL,
	[cliente] [nvarchar](50) NULL,
	[orden] [nvarchar](50) NULL,
	[fechaelab] [nvarchar](50) NULL,
	[f10] [nvarchar](50) NULL,
	[NumCajaCliente] [nvarchar](15) NULL,
	[Propietario] [nvarchar](50) NULL,
	[LotePrimar] [nvarchar](15) NULL,
	[LoteCliente] [nvarchar](15) NULL,
	[TipoLote] [nvarchar](15) NULL,
	[Productor] [nvarchar](50) NULL,
	[CentroCultivo] [nvarchar](20) NULL,
	[Especie] [nvarchar](30) NULL,
	[ProductoDescr] [nvarchar](50) NULL,
	[Conservacion] [nvarchar](20) NULL,
	[CalibreINF] [nvarchar](10) NULL,
	[CalibreSUP] [nvarchar](10) NULL,
	[UMCal] [nvarchar](15) NULL,
	[EnvasePRIM] [nvarchar](20) NULL,
	[EnvaseSECU] [nvarchar](20) NULL,
	[UMPeso] [nvarchar](15) NULL,
	[FechaProduccion] [nvarchar](10) NULL,
	[Sello] [nvarchar](40) NULL,
	[GuiaDespacho] [nvarchar](15) NULL,
	[Destino] [nvarchar](50) NULL
) ON [PRIMARY]

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Packing_pass](
	[pack_pass] [nvarchar](10) NULL,
	[pack_pass2] [nvarchar](10) NULL
) ON [PRIMARY]

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Passwords](
	[porteria] [nvarchar](15) NULL
) ON [PRIMARY]

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[PasswordsTemperatura](
	[Usuario] [nvarchar](50) NULL,
	[Password] [char](10) NULL,
	[MAIL] [nvarchar](50) NULL,
	[NOMBRE] [nvarchar](50) NULL,
	[CODVIG] [nvarchar](1) NULL
) ON [PRIMARY]

GO
SET ANSI_PADDING OFF
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[PCC2](
	[PCC2_ID] [nvarchar](9) NULL,
	[PCC2_RECEPCION] [nvarchar](7) NULL,
	[PCC2_TUNEL] [nvarchar](2) NULL,
	[PCC2_FECHA] [nvarchar](10) NULL,
	[PCC2_HORA] [nvarchar](30) NULL,
	[PCC2_SUPERVISOR] [nvarchar](50) NULL,
	[PCC2_EXTENCION] [nvarchar](1) NULL CONSTRAINT [DF_PCC2_PCC2_EXTENCION]  DEFAULT (0)
) ON [PRIMARY]

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[pedcaja](
	[pc_fecha] [date] NULL,
	[pc_hora] [time](7) NULL,
	[pc_estado] [int] NULL,
	[pc_codped] [numeric](18, 0) NULL,
	[pc_ncaja] [int] NULL,
	[pc_numpal] [nchar](9) NULL,
	[pc_tpoped] [int] NULL,
	[pc_saldo] [int] NULL,
	[pc_rutclie] [nchar](10) NULL,
	[pc_horaenvio] [time](7) NULL,
	[pc_kilos] [float] NULL CONSTRAINT [DF_pedcaja_pc_kilos]  DEFAULT ((0))
) ON [PRIMARY]

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[Pedido_Est](
	[pallet] [varchar](9) NULL,
	[fecha_reg] [datetime] NULL,
	[pedido] [numeric](18, 0) NULL,
	[encargado] [nvarchar](50) NULL
) ON [PRIMARY]

GO
SET ANSI_PADDING OFF
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[pedidoguias](
	[pguia_nguia] [nchar](8) NULL,
	[pguia_fecha] [date] NULL,
	[pguia_ncajas] [int] NULL CONSTRAINT [DF_pedidoguias_pguia_ncajas]  DEFAULT ((0)),
	[pguia_nsopo] [int] NULL CONSTRAINT [DF_pedidoguias_pguia_nsopo]  DEFAULT ((0)),
	[pguia_hora] [time](7) NULL,
	[pguia_rutclie] [nchar](9) NULL,
	[pguia_estado] [int] NULL CONSTRAINT [DF_pedidoguias_pguia_estado]  DEFAULT ((0)),
	[pguia_codped] [numeric](18, 0) NULL CONSTRAINT [DF_pedidoguias_pguia_codped]  DEFAULT ((0))
) ON [PRIMARY]

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[Pedidos_detalle](
	[pedido] [varchar](25) NULL,
	[linea] [numeric](18, 0) NULL,
	[pallet] [varchar](9) NULL,
	[cajas] [numeric](18, 0) NULL,
	[kilos] [real] NULL,
	[posicion] [varchar](50) NULL,
	[est] [nvarchar](1) NULL,
	[parcial] [int] NULL CONSTRAINT [DF_Pedidos_detalle_parcial]  DEFAULT ((0)),
	[revisado] [int] NULL CONSTRAINT [DF_Pedidos_detalle_revisado]  DEFAULT ((0)),
	[cajas_siniestradas] [int] NULL,
	[cod_bod] [nchar](10) NULL
) ON [PRIMARY]

GO
SET ANSI_PADDING OFF
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[pedidos_enviados](
	[orden] [numeric](18, 0) NULL,
	[pedido] [nvarchar](50) NULL,
	[fecha] [varchar](50) NULL,
	[hora] [varchar](7) NULL
) ON [PRIMARY]

GO
SET ANSI_PADDING OFF
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[Pedidos_ficha](
	[Orden] [numeric](18, 0) IDENTITY(1,1) NOT NULL,
	[pedido] [varchar](25) NULL,
	[cliente] [varchar](10) NULL,
	[transporte] [varchar](100) NULL,
	[fecha] [varchar](10) NULL,
	[hora] [varchar](5) NULL,
	[destino] [varchar](250) NULL,
	[observacion] [varchar](1000) NULL,
	[mail] [varchar](max) NULL,
	[codvig] [varchar](1) NULL,
	[terminado] [nvarchar](1) NULL,
	[Encargado] [nvarchar](50) NULL,
	[fechapedido] [datetime] NULL,
	[fechaTermino] [datetime] NULL,
	[ped_estpred] [numeric](18, 0) NULL CONSTRAINT [DF_Pedidos_ficha_ped_estpred]  DEFAULT ((0)),
	[ped_revision] [numeric](18, 0) NULL CONSTRAINT [DF_Pedidos_ficha_ped_revision]  DEFAULT ((0)),
	[packinglist] [nvarchar](30) NULL,
	[ordenconjunta] [nvarchar](max) NULL,
	[cod_bod] [nchar](10) NULL,
 CONSTRAINT [PK_Pedidos_ficha_1] PRIMARY KEY CLUSTERED 
(
	[Orden] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY] TEXTIMAGE_ON [PRIMARY]

GO
SET ANSI_PADDING OFF
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[pedidos_prg](
	[prg_orden] [numeric](18, 0) NULL,
	[prg_hora] [time](7) NULL,
	[prg_fecha] [date] NULL,
	[prg_rutclie] [nvarchar](20) NULL,
	[prg_modo] [nvarchar](25) NULL,
	[prg_2daHr] [int] NULL CONSTRAINT [DF_pedidos_prg_prg_2daHr]  DEFAULT ((0)),
	[prg_tipo] [int] NULL CONSTRAINT [DF_pedidos_prg_prg_tipo]  DEFAULT ((0))
) ON [PRIMARY]

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[PedidosWebok](
	[Ped_Numero] [nvarchar](50) NULL,
	[ped_fechahora] [nvarchar](16) NULL,
	[Ped_RutCliente] [nvarchar](10) NULL,
	[Ped_Folio_Icestar] [nvarchar](9) NULL,
	[Ped_Folio_Cliente] [nvarchar](15) NULL,
	[Ped_Cantidad] [int] NULL,
	[Ped_Kilos] [float] NULL,
	[Ped_Descripcion] [nvarchar](50) NULL,
	[Ped_RCP] [nvarchar](15) NULL,
	[Ped_FecRec] [nvarchar](10) NULL,
	[Ped_FecProd] [nvarchar](10) NULL,
	[Ped_FecVenc] [nvarchar](10) NULL,
	[Ped_Sopocli] [nvarchar](20) NULL,
	[Ped_Tipo] [numeric](18, 0) NULL,
	[Ped_destino] [nvarchar](100) NULL,
	[Ped_transporte] [nvarchar](100) NULL,
	[Ped_FechaHoraCarga] [nvarchar](50) NULL,
	[Ped_Picking] [nvarchar](15) NULL,
	[Ped_Pallet] [nvarchar](9) NULL,
	[Ped_ok] [nvarchar](1) NULL,
	[Ped_GDespacho] [nvarchar](9) NULL
) ON [PRIMARY]

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[PEDIDOSWEBOK_ANULACION](
	[ped_numero] [nvarchar](30) NULL,
	[ped_fecha] [nvarchar](10) NULL,
	[ped_hora] [nvarchar](8) NULL,
	[ped_estado] [nvarchar](1) NULL,
	[ped_usuario] [nvarchar](3) NULL,
	[ped_pc] [nvarchar](20) NULL
) ON [PRIMARY]

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[PedidosWebOKTMP](
	[pedido] [nvarchar](23) NULL,
	[ped_ok] [nvarchar](1) NULL
) ON [PRIMARY]

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[pedidowebrelacionrut](
	[ID] [int] NOT NULL,
	[Rut] [nvarchar](255) NULL,
	[Rutcorto] [nvarchar](255) NULL
) ON [PRIMARY]

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[PedWebTmp](
	[pwt_codcaja] [nvarchar](200) NULL,
	[pwt_producto] [nvarchar](50) NULL,
	[pwt_calidad] [nvarchar](20) NULL,
	[pwt_calibre] [nvarchar](10) NULL,
	[pwt_piezas] [int] NULL,
	[pwt_kilos] [float] NULL,
	[pwt_misc1] [nvarchar](50) NULL,
	[pwt_misc2] [nvarchar](50) NULL,
	[pwt_pallet] [nvarchar](9) NULL,
	[pwt_estado] [int] NULL,
	[pwt_fecelab] [nchar](10) NULL,
	[pwt_fecvenc] [nchar](10) NULL,
	[pwt_lote] [nvarchar](30) NULL,
	[pwt_coding] [nvarchar](30) NULL,
	[pwt_codped] [numeric](18, 0) NULL
) ON [PRIMARY]

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[PERFIL_USUARIO](
	[ID] [decimal](18, 0) IDENTITY(1,1) NOT NULL,
	[NOMBRE] [varchar](250) NULL,
	[FORMULARIO] [varchar](250) NULL,
	[PADRE] [varchar](250) NULL,
	[NUMERO] [varchar](250) NULL,
	[HOJA] [varchar](250) NULL,
	[GRABAR] [varchar](252) NULL,
	[PANTALLA] [varchar](250) NULL,
	[ARCHIVO] [varchar](250) NULL,
	[IMPRIMIR] [varchar](250) NULL,
	[TIPO_ROL] [varchar](250) NULL,
	[TIPO_PERFIL] [varchar](250) NULL,
	[NOMBRE_PERFIL] [varchar](250) NULL,
	[NOMBRE_TABLA] [varchar](250) NULL,
	[ESTADO] [decimal](18, 0) NULL,
	[ATRIBUTO] [varchar](250) NULL,
	[FECHA] [varchar](50) NULL
) ON [PRIMARY]

GO
SET ANSI_PADDING OFF
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[PERFIL_USUARIO1](
	[ID] [decimal](18, 0) IDENTITY(1,1) NOT NULL,
	[NOMBRE] [varchar](250) NULL,
	[FORMULARIO] [varchar](250) NULL,
	[PADRE] [varchar](250) NULL,
	[NUMERO] [varchar](250) NULL,
	[HOJA] [varchar](250) NULL,
	[GRABAR] [varchar](252) NULL,
	[PANTALLA] [varchar](250) NULL,
	[ARCHIVO] [varchar](250) NULL,
	[IMPRIMIR] [varchar](250) NULL,
	[TIPO_ROL] [varchar](250) NULL,
	[TIPO_PERFIL] [varchar](250) NULL,
	[NOMBRE_PERFIL] [varchar](250) NULL,
	[NOMBRE_TABLA] [varchar](250) NULL,
	[ESTADO] [decimal](18, 0) NULL,
	[ATRIBUTO] [varchar](250) NULL,
	[FECHA] [varchar](50) NULL
) ON [PRIMARY]

GO
SET ANSI_PADDING OFF
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[picking](
	[FOLIO] [char](10) NULL,
	[DESPACHO] [char](10) NULL,
	[CLIENTE] [char](10) NULL,
	[CANTIDAD] [float] NULL,
	[PESO] [float] NULL,
	[PALLET] [float] NULL,
	[FECHA] [datetime] NULL,
	[CONTRATO] [char](10) NULL,
	[CODIGO_RECEP] [varchar](50) NULL
) ON [PRIMARY]

GO
SET ANSI_PADDING OFF
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[pickingCorrupto](
	[FOLIO] [char](10) NULL,
	[DESPACHO] [char](10) NULL,
	[CLIENTE] [char](10) NULL,
	[CANTIDAD] [float] NULL,
	[PESO] [float] NULL,
	[PALLET] [float] NULL,
	[FECHA] [datetime] NULL,
	[CONTRATO] [char](10) NULL,
	[CODIGO_RECEP] [varchar](50) NULL
) ON [PRIMARY]

GO
SET ANSI_PADDING OFF
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[pisoband](
	[pisb_unica] [uniqueidentifier] NOT NULL CONSTRAINT [DF_pisoband_pisb_unica]  DEFAULT (newid()),
	[pisb_codi] [nvarchar](9) NULL,
	[pisb_ca] [nvarchar](2) NULL,
	[pisb_banda] [nvarchar](2) NULL,
 CONSTRAINT [PK_pisoband] PRIMARY KEY NONCLUSTERED 
(
	[pisb_unica] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[pisodeta](
	[pisd_unica] [uniqueidentifier] NOT NULL,
	[pisd_codi] [nvarchar](11) NULL,
	[pisd_ca] [nvarchar](2) NULL,
	[pisd_folio] [nvarchar](9) NULL,
	[pisd_codprod] [nvarchar](7) NULL,
	[pisd_unidades] [int] NULL,
	[pisd_peso] [int] NULL,
	[pisd_fecprod] [nvarchar](10) NULL,
	[pisd_core] [tinyint] NULL,
	[pisd_code] [tinyint] NULL,
 CONSTRAINT [PK_pisodeta] PRIMARY KEY NONCLUSTERED 
(
	[pisd_unica] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[POLITICAS](
	[id] [nvarchar](14) NULL,
	[nombre] [nvarchar](100) NULL,
	[archivo] [nvarchar](500) NULL
) ON [PRIMARY]

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[predimagen](
	[pimg_imagen] [image] NULL,
	[pimg_num] [int] NULL,
	[pimg_precodi] [nvarchar](7) NULL,
	[fecha] [datetime] NULL CONSTRAINT [DF_predimagen_fecha]  DEFAULT (getdate())
) ON [PRIMARY] TEXTIMAGE_ON [PRIMARY]

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[preferen](
	[pref_unica] [uniqueidentifier] NOT NULL,
	[pref_rutclie] [nvarchar](9) NULL,
	[pref_prefer] [tinyint] NULL,
	[pref_camara] [nvarchar](2) NULL,
	[pref_almacen] [tinyint] NULL,
	[pref_estado] [tinyint] NULL,
 CONSTRAINT [PK_preferen] PRIMARY KEY NONCLUSTERED 
(
	[pref_unica] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[PRIVILEGIOS](
	[COD_PRIVILEGIO] [int] NOT NULL,
	[COD_ROL] [int] NOT NULL,
	[PRIVILEGIO] [nvarchar](50) NOT NULL
) ON [PRIMARY]

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[PrivilegiosSeccion](
	[Priv_Id] [nvarchar](3) NOT NULL,
	[Priv_Nombre] [nvarchar](50) NULL,
 CONSTRAINT [PK_PrivilegiosSeccion] PRIMARY KEY CLUSTERED 
(
	[Priv_Id] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[PrivilegiosSubSeccion](
	[Spriv_Id] [nvarchar](3) NOT NULL,
	[Spriv_nombre] [nvarchar](50) NOT NULL,
	[Spriv_PrivId] [nvarchar](3) NOT NULL,
	[spriv_habil] [int] NULL CONSTRAINT [DF_PrivilegiosSubSeccion_spriv_habil]  DEFAULT ((0)),
 CONSTRAINT [PK_PrivilegiosSubSeccion] PRIMARY KEY CLUSTERED 
(
	[Spriv_Id] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Proc_Importaciones](
	[pimp_codi] [nvarchar](4) NOT NULL,
	[pimp_rutcli] [nvarchar](9) NULL,
	[pimp_contcli] [nvarchar](7) NULL,
	[pimp_ncont] [nvarchar](30) NULL,
	[pimp_codrece] [nvarchar](7) NULL,
	[pimp_reso] [nvarchar](40) NULL,
	[pimp_totsopo] [numeric](18, 0) NULL,
	[pimp_totunid] [numeric](18, 0) NULL,
	[pimp_totpeso] [float] NULL,
	[pimp_obs] [nvarchar](150) NULL,
	[pimp_fecha] [date] NULL,
	[pimp_hora] [time](7) NULL,
	[Pimp_usucod] [nvarchar](3) NULL,
 CONSTRAINT [PK_Proc_Importaciones_1] PRIMARY KEY CLUSTERED 
(
	[pimp_codi] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[procedencia](
	[proc_rutcli] [nvarchar](10) NULL,
	[proc_origen] [nvarchar](10) NULL
) ON [PRIMARY]

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[procesos_despa](
	[ID] [varchar](80) NULL,
	[NUMERO] [varchar](20) NULL,
	[RECEPCION] [varchar](20) NULL,
	[CLIENTE] [varchar](15) NULL,
	[PRODUCTOR] [varchar](15) NULL,
	[FECHA] [datetime] NULL
) ON [PRIMARY]

GO
SET ANSI_PADDING OFF
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[procesos_despa_dett](
	[ID] [varchar](20) NULL,
	[NUMERO] [varchar](20) NULL,
	[PRODUCTO] [varchar](20) NULL,
	[PALLET] [varchar](20) NULL,
	[LOTEP] [varchar](10) NULL,
	[TIPO] [varchar](20) NULL,
	[SOPO] [varchar](20) NULL,
	[TIPO_CARGA] [varchar](20) NULL,
	[ORIGEN] [varchar](20) NULL,
	[OBSERVACION] [varchar](80) NULL,
	[UNIDADES] [float] NULL,
	[PESO] [float] NULL,
	[FECHA] [datetime] NULL
) ON [PRIMARY]

GO
SET ANSI_PADDING OFF
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[procesos_despa_dett2](
	[ID] [varchar](20) NULL,
	[NUMERO] [varchar](20) NULL,
	[PRODUCTO] [varchar](20) NULL,
	[PALLET] [varchar](20) NULL,
	[LOTEP] [varchar](10) NULL,
	[TIPO] [varchar](20) NULL,
	[SOPO] [varchar](20) NULL,
	[TIPO_CARGA] [varchar](20) NULL,
	[ORIGEN] [varchar](20) NULL,
	[OBSERVACION] [varchar](80) NULL,
	[UNIDADES] [float] NULL,
	[PESO] [float] NULL,
	[FECHA] [datetime] NULL
) ON [PRIMARY]

GO
SET ANSI_PADDING OFF
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[procesos_despa2](
	[ID] [varchar](80) NULL,
	[NUMERO] [varchar](20) NULL,
	[RECEPCION] [varchar](20) NULL,
	[CLIENTE] [varchar](15) NULL,
	[PRODUCTOR] [varchar](15) NULL,
	[FECHA] [datetime] NULL
) ON [PRIMARY]

GO
SET ANSI_PADDING OFF
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[procesos_estaticos](
	[id] [uniqueidentifier] NULL,
	[codigo] [char](10) NULL,
	[ngp] [char](10) NULL,
	[producto] [char](10) NULL,
	[fecha] [float] NULL,
	[unidades] [float] NULL,
	[peso] [float] NULL,
	[pallet] [char](10) NULL,
	[sopor] [char](10) NULL,
	[estado] [int] NULL,
	[lugar] [char](10) NULL
) ON [PRIMARY]

GO
SET ANSI_PADDING OFF
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[procesos_ingreso_Camaras](
	[Id] [varchar](255) NULL,
	[NGP] [varchar](10) NULL,
	[codigo] [varchar](10) NULL,
	[numero] [varchar](10) NULL,
	[producto] [varchar](10) NULL,
	[pallet] [varchar](8) NULL,
	[fecha] [datetime] NULL,
	[unidades] [float] NULL,
	[peso] [float] NULL,
	[tipo] [varchar](10) NULL,
	[camara] [varchar](10) NULL,
	[sopo] [varchar](10) NULL,
	[estado] [int] NULL,
	[final] [int] NULL CONSTRAINT [DF_procesos_ingreso_Camaras_final]  DEFAULT (0),
	[CLIENTE] [char](15) NULL CONSTRAINT [DF_procesos_ingreso_Camaras_CLIENTE]  DEFAULT (0),
	[PRODUCTOR] [char](15) NULL CONSTRAINT [DF_procesos_ingreso_Camaras_PRODUCTOR]  DEFAULT (0),
	[pucho] [char](10) NULL,
	[reproceso] [int] NULL
) ON [PRIMARY]

GO
SET ANSI_PADDING OFF
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[procesos_ingreso_camaras2](
	[Id] [varchar](255) NULL,
	[NGP] [varchar](10) NULL,
	[codigo] [varchar](10) NULL,
	[numero] [varchar](10) NULL,
	[producto] [varchar](10) NULL,
	[pallet] [varchar](8) NULL,
	[fecha] [datetime] NULL,
	[unidades] [float] NULL,
	[peso] [float] NULL,
	[tipo] [varchar](10) NULL,
	[camara] [varchar](10) NULL,
	[sopo] [varchar](10) NULL,
	[estado] [int] NULL,
	[final] [int] NULL,
	[CLIENTE] [varchar](15) NULL,
	[PRODUCTOR] [varchar](15) NULL,
	[pucho] [varchar](10) NULL,
	[reproceso] [int] NULL
) ON [PRIMARY]

GO
SET ANSI_PADDING OFF
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[procesos_ingreso_temporal](
	[id] [char](10) NULL,
	[pallet] [float] NULL,
	[npallet] [char](10) NULL
) ON [PRIMARY]

GO
SET ANSI_PADDING OFF
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[procesos_ingreso_tunel](
	[id] [varchar](255) NULL,
	[NGP] [varchar](10) NULL,
	[codigo] [varchar](50) NULL,
	[numero] [varchar](10) NULL,
	[producto] [varchar](20) NULL,
	[fecha] [datetime] NULL,
	[unidades] [float] NULL,
	[peso] [float] NULL,
	[tipo] [varchar](10) NULL,
	[tunel] [varchar](10) NULL
) ON [PRIMARY]

GO
SET ANSI_PADDING OFF
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[procesos_medidas](
	[id] [int] NULL,
	[tipo] [varchar](20) NULL
) ON [PRIMARY]

GO
SET ANSI_PADDING OFF
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[procesos_moneda](
	[id] [char](10) NULL,
	[dolar] [float] NULL,
	[UF] [float] NULL,
	[fecha] [datetime] NULL
) ON [PRIMARY]

GO
SET ANSI_PADDING OFF
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[procesos_puchos](
	[id] [char](10) NULL,
	[codigo] [char](10) NULL,
	[ngp] [char](10) NULL,
	[peso] [float] NULL
) ON [PRIMARY]

GO
SET ANSI_PADDING OFF
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[procesos_puchos_temporal](
	[ID] [char](10) NULL,
	[codigo] [char](10) NULL,
	[ngp] [char](10) NULL,
	[peso] [float] NULL
) ON [PRIMARY]

GO
SET ANSI_PADDING OFF
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[procesos_recep](
	[id] [varchar](255) NULL,
	[NGP] [varchar](50) NULL,
	[GUIA_OPER] [varchar](50) NULL,
	[RUTCLIENTE] [varchar](50) NULL,
	[RUTPRODUCTOR] [varchar](50) NULL,
	[CONTRATO] [varchar](50) NULL,
	[FECHA] [datetime] NULL,
	[TURNO] [int] NULL,
	[TEMPERATURA] [int] NULL,
	[TIPO_DESC] [int] NULL,
	[ORIGEN] [int] NULL,
	[OBSERVACION] [varchar](10) NULL,
	[ESTADO] [int] NULL
) ON [PRIMARY]

GO
SET ANSI_PADDING OFF
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[procesos_recep_dett](
	[id] [varchar](50) NULL,
	[NGP] [varchar](50) NULL,
	[CODIGO] [varchar](50) NULL,
	[PRODUCTO] [char](50) NULL,
	[PALLET] [varchar](50) NULL,
	[SOPORTANTE] [varchar](50) NULL,
	[FECHA] [datetime] NULL,
	[UNIDADES] [float] NULL,
	[PESO] [float] NULL
) ON [PRIMARY]

GO
SET ANSI_PADDING OFF
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[procesos_recep_dett2](
	[id] [varchar](50) NULL,
	[NGP] [varchar](50) NULL,
	[CODIGO] [varchar](50) NULL,
	[PRODUCTO] [char](50) NULL,
	[PALLET] [varchar](50) NULL,
	[SOPORTANTE] [varchar](50) NULL,
	[FECHA] [datetime] NULL,
	[UNIDADES] [float] NULL,
	[PESO] [float] NULL
) ON [PRIMARY]

GO
SET ANSI_PADDING OFF
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[procesos_recep2](
	[id] [varchar](255) NULL,
	[NGP] [varchar](50) NULL,
	[GUIA_OPER] [varchar](50) NULL,
	[RUTCLIENTE] [varchar](50) NULL,
	[RUTPRODUCTOR] [varchar](50) NULL,
	[CONTRATO] [varchar](50) NULL,
	[FECHA] [datetime] NULL,
	[TURNO] [int] NULL,
	[TEMPERATURA] [int] NULL,
	[TIPO_DESC] [int] NULL,
	[ORIGEN] [int] NULL,
	[OBSERVACION] [varchar](10) NULL,
	[ESTADO] [int] NULL
) ON [PRIMARY]

GO
SET ANSI_PADDING OFF
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[procesos_RelacionFactura](
	[producto] [varchar](20) NULL,
	[factura] [varchar](20) NULL
) ON [PRIMARY]

GO
SET ANSI_PADDING OFF
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[procesos_reprocesos](
	[codigo] [char](10) NULL,
	[tipo] [char](10) NULL,
	[fecha] [char](10) NULL
) ON [PRIMARY]

GO
SET ANSI_PADDING OFF
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[procesos_tipo_producto](
	[id] [varchar](10) NULL,
	[producto] [varchar](10) NULL,
	[tipo] [varchar](10) NULL,
	[descripcion] [varchar](50) NULL
) ON [PRIMARY]

GO
SET ANSI_PADDING OFF
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[procesos_Tipofactura](
	[cliente] [varchar](20) NULL,
	[codigo] [float] NULL,
	[descripcion] [varchar](80) NULL,
	[precio] [float] NULL CONSTRAINT [DF_procesos_Tipofactura_precio]  DEFAULT (0),
	[medida] [int] NULL CONSTRAINT [DF_procesos_Tipofactura_medida]  DEFAULT (0),
	[valor] [int] NULL CONSTRAINT [DF_procesos_Tipofactura_valor]  DEFAULT (0),
	[fecha] [datetime] NULL
) ON [PRIMARY]

GO
SET ANSI_PADDING OFF
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[procesos_Tunel](
	[id] [varchar](10) NULL,
	[NGP] [varchar](10) NULL,
	[producto] [varchar](50) NULL,
	[total] [float] NULL CONSTRAINT [DF_procesos_Tunel_total]  DEFAULT (0),
	[IQF] [float] NULL CONSTRAINT [DF_procesos_Tunel_IQF]  DEFAULT (0),
	[E1] [float] NULL CONSTRAINT [DF_procesos_Tunel_E1]  DEFAULT (0),
	[E2] [float] NULL CONSTRAINT [DF_procesos_Tunel_E2]  DEFAULT (0),
	[E3] [float] NULL CONSTRAINT [DF_procesos_Tunel_E3]  DEFAULT (0),
	[JUGO] [float] NULL CONSTRAINT [DF_procesos_Tunel_JUGO]  DEFAULT (0),
	[fecha] [datetime] NULL,
	[usuario] [varchar](10) NULL,
	[estado] [int] NULL,
	[final] [char](10) NULL CONSTRAINT [DF_procesos_Tunel_final]  DEFAULT (0),
	[REPROCESO] [int] NULL CONSTRAINT [DF_procesos_Tunel_REPROCESO]  DEFAULT (0)
) ON [PRIMARY]

GO
SET ANSI_PADDING OFF
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[procesos_Tunel_dett](
	[Id] [varchar](50) NULL,
	[numero] [varchar](50) NULL,
	[iqf] [float] NULL CONSTRAINT [DF_procesos_Tunel_dett_iqf]  DEFAULT (0),
	[e1] [float] NULL CONSTRAINT [DF_procesos_Tunel_dett_e1]  DEFAULT (0),
	[e2] [float] NULL CONSTRAINT [DF_procesos_Tunel_dett_e2]  DEFAULT (0),
	[e3] [float] NULL CONSTRAINT [DF_procesos_Tunel_dett_e3]  DEFAULT (0),
	[JUGO] [float] NULL CONSTRAINT [DF_procesos_Tunel_dett_JUGO]  DEFAULT (0),
	[fecha] [datetime] NULL
) ON [PRIMARY]

GO
SET ANSI_PADDING OFF
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[procesos_valores](
	[id] [int] NULL,
	[tipo] [varchar](20) NULL
) ON [PRIMARY]

GO
SET ANSI_PADDING OFF
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[PRODUCCION_PROCESOS](
	[Especie] [char](50) NULL,
	[Fecha] [datetime] NULL,
	[Turno] [char](10) NULL,
	[Hora_ini] [char](10) NULL,
	[Hora_Fin] [char](10) NULL,
	[Calidad] [char](20) NULL,
	[Valor] [float] NULL,
	[Numero] [char](13) NULL,
	[Productor] [char](13) NULL,
	[Produccion] [float] NULL
) ON [PRIMARY]

GO
SET ANSI_PADDING OFF
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[Productores](
	[cli_unica] [varchar](255) NULL,
	[cli_rut] [varchar](255) NULL,
	[cli_nomb] [varchar](255) NULL,
	[cli_direcc] [varchar](255) NULL,
	[cli_comuna] [varchar](255) NULL,
	[cli_ciudad] [varchar](255) NULL,
	[cli_fono] [varchar](255) NULL,
	[cli_fax] [varchar](255) NULL,
	[cli_feccre] [varchar](255) NULL,
	[cli_estado] [varchar](255) NULL,
	[cli_rubro] [varchar](255) NULL,
	[cli_mail] [varchar](255) NULL,
	[cli_envio] [varchar](255) NULL,
	[cli_diaenv] [varchar](255) NULL
) ON [PRIMARY]

GO
SET ANSI_PADDING OFF
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[PRODUCTOS_PROCESOS](
	[mae_unica] [varchar](255) NULL,
	[mae_codi] [varchar](50) NULL,
	[mae_descr] [varchar](50) NULL,
	[mae_tipenv] [varchar](50) NULL,
	[mae_clirut] [varchar](50) NULL,
	[mae_productor] [varchar](50) NULL,
	[mae_feccre] [varchar](50) NULL,
	[mae_alto] [float] NULL,
	[mae_ancho] [float] NULL,
	[mae_fondo] [float] NULL,
	[mae_base] [int] NULL,
	[mae_altura] [int] NULL,
	[mae_codcli] [varchar](255) NULL,
	[mae_codvig] [tinyint] NULL,
	[mae_codirel] [varchar](255) NULL
) ON [PRIMARY]

GO
SET ANSI_PADDING OFF
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[rack](
	[rack_codi] [varchar](8) NOT NULL,
	[rack_ca] [varchar](2) NULL,
	[rack_ba] [varchar](2) NULL,
	[rack_co] [varchar](2) NULL,
	[rack_pi] [varchar](2) NULL,
 CONSTRAINT [PK_rack_1] PRIMARY KEY CLUSTERED 
(
	[rack_codi] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_PADDING OFF
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[rack_](
	[rac_unica] [uniqueidentifier] NOT NULL CONSTRAINT [DF_rack_rac_unica]  DEFAULT (newid()),
	[rac_codi] [nvarchar](8) NULL,
	[rac_camara] [nvarchar](2) NULL,
	[rac_banda] [nvarchar](2) NULL,
	[rac_columna] [nvarchar](2) NULL,
	[rac_piso] [nvarchar](2) NULL,
	[rac_nivel1] [nvarchar](1) NULL CONSTRAINT [DF_rack_rac_nivel1]  DEFAULT ('0'),
	[rac_nivel2] [nvarchar](1) NULL CONSTRAINT [DF_rack_rac_nivel2]  DEFAULT ('0'),
	[rac_dispon] [nvarchar](1) NULL CONSTRAINT [DF_rack_rac_dispon]  DEFAULT ('0'),
	[rac_tiempo] [nvarchar](4) NULL CONSTRAINT [DF_rack_rac_tiempo]  DEFAULT ('0'),
	[rac_ocupado] [nvarchar](1) NULL CONSTRAINT [DF_rack_rac_ocupado]  DEFAULT ('0'),
	[rac_coren1] [tinyint] NULL CONSTRAINT [DF_rack_rac_coren1]  DEFAULT (0),
	[rac_coren2] [tinyint] NULL CONSTRAINT [DF_rack_rac_coren2]  DEFAULT (0),
 CONSTRAINT [PK_rack] PRIMARY KEY NONCLUSTERED 
(
	[rac_unica] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[Rack_Altura](
	[rack_ca] [varchar](2) NULL,
	[rack_ba] [varchar](2) NULL,
	[rack_co] [varchar](2) NULL,
	[rack_pi] [varchar](2) NULL,
	[rack_altura] [nchar](10) NULL,
	[Bloqueo] [nchar](10) NULL,
	[Imp_nac] [nvarchar](50) NULL,
	[Reserva_cliente] [nvarchar](50) NULL,
	[Reserva_Producto] [nvarchar](50) NULL
) ON [PRIMARY]

GO
SET ANSI_PADDING OFF
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[Rack_Descuentos](
	[rack_ca] [varchar](2) NULL,
	[rack_ba] [varchar](2) NULL,
	[rack_co] [varchar](2) NULL,
	[rack_pi] [varchar](2) NULL
) ON [PRIMARY]

GO
SET ANSI_PADDING OFF
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[rackdeta](
	[racd_unica] [uniqueidentifier] NOT NULL CONSTRAINT [DF_rackdeta_racd_unica]  DEFAULT (newid()),
	[racd_codi] [nvarchar](9) NULL,
	[racd_ca] [nvarchar](2) NULL,
	[racd_ba] [nvarchar](2) NULL,
	[racd_co] [nvarchar](2) NULL,
	[racd_pi] [nvarchar](2) NULL,
	[racd_ni] [nvarchar](1) NULL,
	[racd_codpro] [nvarchar](7) NULL,
	[racd_unidades] [int] NULL,
	[racd_peso] [float] NULL,
	[racd_fecpro] [nvarchar](10) NULL,
	[racd_core] [tinyint] NULL,
	[racd_code] [tinyint] NULL,
	[FechaVencimiento] [char](10) NULL,
	[LoteCliente] [char](20) NULL,
	[racd_pedido] [nvarchar](2) NULL CONSTRAINT [DF_rackdeta_racd_pedido]  DEFAULT ((0)),
	[racd_pedido_fec] [nvarchar](10) NULL,
	[racd_pedido_hor] [nvarchar](5) NULL,
	[racd_fechamov] [nvarchar](10) NULL,
	[racd_horamov] [nvarchar](5) NULL,
	[racd_estadopallet] [nvarchar](1) NULL CONSTRAINT [DF_rackdeta_racd_estadopallet]  DEFAULT ('0'),
	[racd_solicitado] [int] NULL CONSTRAINT [DF_rackdeta_racd_solicitado]  DEFAULT ((0)),
	[racd_correo] [nvarchar](1) NULL CONSTRAINT [DF_rackdeta_racd_correo]  DEFAULT ('0'),
	[racd_picking] [nvarchar](1) NULL CONSTRAINT [DF_rackdeta_racd_picking]  DEFAULT ('0'),
	[racd_estado] [nvarchar](1) NULL CONSTRAINT [DF_rackdeta_racd_estado]  DEFAULT ('0'),
	[racd_pred] [varchar](7) NULL,
	[racd_pedi] [varchar](10) NULL,
	[racd_sini] [varchar](10) NULL,
	[cod_bod] [nchar](10) NULL,
	[racd_webusu] [int] NULL,
 CONSTRAINT [PK_rackdeta] PRIMARY KEY NONCLUSTERED 
(
	[racd_unica] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_PADDING OFF
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[rackdeta_20080512](
	[racd_unica] [uniqueidentifier] NOT NULL,
	[racd_codi] [nvarchar](9) NULL,
	[racd_ca] [nvarchar](2) NULL,
	[racd_ba] [nvarchar](2) NULL,
	[racd_co] [nvarchar](2) NULL,
	[racd_pi] [nvarchar](2) NULL,
	[racd_ni] [nvarchar](1) NULL,
	[racd_codpro] [nvarchar](7) NULL,
	[racd_unidades] [int] NULL,
	[racd_peso] [float] NULL,
	[racd_fecpro] [nvarchar](10) NULL,
	[racd_core] [tinyint] NULL,
	[racd_code] [tinyint] NULL,
	[FechaVencimiento] [char](10) NULL,
	[LoteCliente] [char](10) NULL,
	[racd_pedido] [nvarchar](2) NULL,
	[racd_pedido_fec] [nvarchar](10) NULL,
	[racd_pedido_hor] [nvarchar](5) NULL
) ON [PRIMARY]

GO
SET ANSI_PADDING OFF
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[RACKDETA_ESTADO](
	[CODIGO] [varchar](1) NULL,
	[DESCRIPCION] [varchar](30) NULL,
	[BLOQUEAR] [varchar](1) NULL,
	[VISIBLE] [numeric](18, 0) NULL
) ON [PRIMARY]

GO
SET ANSI_PADDING OFF
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[RackdetaBasura](
	[fecbasura] [datetime] NULL CONSTRAINT [DF_RackdetaBasura_fecbasura]  DEFAULT (getdate()),
	[racd_unica] [uniqueidentifier] NOT NULL,
	[racd_codi] [nvarchar](9) NULL,
	[racd_ca] [nvarchar](2) NULL,
	[racd_ba] [nvarchar](2) NULL,
	[racd_co] [nvarchar](2) NULL,
	[racd_pi] [nvarchar](2) NULL,
	[racd_ni] [nvarchar](1) NULL,
	[racd_codpro] [nvarchar](7) NULL,
	[racd_unidades] [int] NULL,
	[racd_peso] [float] NULL,
	[racd_fecpro] [nvarchar](10) NULL,
	[racd_core] [tinyint] NULL,
	[racd_code] [tinyint] NULL,
	[FechaVencimiento] [char](10) NULL,
	[LoteCliente] [char](10) NULL,
	[racd_pedido] [nvarchar](2) NULL,
	[racd_pedido_fec] [nvarchar](10) NULL,
	[racd_pedido_hor] [nvarchar](5) NULL
) ON [PRIMARY]

GO
SET ANSI_PADDING OFF
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[receimagen](
	[rimg_imagen] [image] NULL,
	[rimg_num] [int] NULL,
	[rimg_rececodi] [nvarchar](7) NULL,
	[fecha] [datetime] NULL CONSTRAINT [DF_receimagen_fecha]  DEFAULT (getdate()),
	[rimg_temp] [int] NULL CONSTRAINT [DF_receimagen_riimg_temp]  DEFAULT ((0)),
	[rimg_imagen2] [image] NULL
) ON [PRIMARY] TEXTIMAGE_ON [PRIMARY]

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[recepcion_prg](
	[rprg_codrece] [nvarchar](7) NULL,
	[rprg_hora] [time](7) NULL,
	[rprg_fecha] [date] NULL,
	[rprg_rutclie] [nvarchar](20) NULL,
	[rprg_modo] [nvarchar](25) NULL,
	[rprg_pl] [nvarchar](30) NULL,
	[rprg_observacion] [nvarchar](150) NULL,
	[rprg_guiatrans] [numeric](18, 0) NULL
) ON [PRIMARY]

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Reclamo_Clientes](
	[Numero] [numeric](18, 0) NULL
) ON [PRIMARY]

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Reclamo_Clientes_Detalle](
	[rec_numero] [nvarchar](5) NULL,
	[rec_rutcli] [nvarchar](10) NULL,
	[rec_fecha] [nvarchar](10) NULL,
	[rec_genrec] [nvarchar](50) NULL,
	[rec_reclamo] [nvarchar](2048) NULL,
	[rec_direccion] [nvarchar](80) NULL,
	[rec_ciudad] [nvarchar](50) NULL,
	[rec_telefono] [nvarchar](50) NULL,
	[rec_email] [nvarchar](60) NULL,
	[rec_producto] [nvarchar](80) NULL,
	[rec_elaboracion] [nvarchar](15) NULL,
	[REC_ESTADO] [nvarchar](1) NULL CONSTRAINT [DF_Reclamo_Clientes_Detalle_REC_ESTADO]  DEFAULT (0)
) ON [PRIMARY]

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[reclamos](
	[CODIGO] [int] IDENTITY(1,1) NOT NULL,
	[RUTCLIENTE] [varchar](20) NULL,
	[NOMBRE] [varchar](100) NULL,
	[EMAIL] [varchar](100) NULL,
	[COMENTARIO] [varchar](1000) NULL,
	[FECHA_INGRESO] [datetime] NULL,
	[FECHA_APERTURA] [datetime] NULL,
	[FECHA_CIERRE] [datetime] NULL,
	[ARCHIVO] [varchar](200) NULL,
	[ESTADO_PROCESO] [varchar](20) NULL,
	[ESTADO_ACTUALIZACION] [varchar](20) NULL,
	[ESTADO] [varchar](20) NULL,
	[USUARIO] [varchar](10) NULL,
 CONSTRAINT [PK__reclamos__CC87E1278B70086B] PRIMARY KEY CLUSTERED 
(
	[CODIGO] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_PADDING OFF
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[reclamos_mensajes](
	[CODIGO] [int] IDENTITY(1,1) NOT NULL,
	[CODIGO_RECLAMO] [int] NULL,
	[USUARIO] [varchar](100) NULL,
	[TIPO] [varchar](11) NULL,
	[MENSAJE] [varchar](1000) NULL,
	[FECHA_INGRESO] [datetime] NULL,
	[ESTADO] [varchar](1) NULL,
 CONSTRAINT [PK__reclamos__CC87E127ABF513FB] PRIMARY KEY CLUSTERED 
(
	[CODIGO] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_PADDING OFF
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[recordatorios](
	[CODIGO_RECORDATORIO] [int] IDENTITY(1,1) NOT NULL,
	[TITULO_REC] [varchar](100) NULL,
	[FECHA_REC] [date] NULL,
	[HORA_REC] [time](7) NULL,
	[DESCRIPCION_REC] [varchar](1000) NULL,
	[USUARIO_INGRESO] [varchar](5) NULL,
	[FECHA_INGRESO] [varchar](12) NULL,
	[USUARIO_MODIFICO] [varchar](5) NULL,
	[FECHA_MODIFICACION] [varchar](12) NULL,
	[CODIGO_FICHA] [int] NULL,
	[ESTADO_REC] [varchar](15) NULL,
 CONSTRAINT [PK_recordatorios] PRIMARY KEY CLUSTERED 
(
	[CODIGO_RECORDATORIO] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_PADDING OFF
GO
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[REL_USUARIOS_ROLES](
	[COD_USUARIO] [nvarchar](8) NOT NULL,
	[COD_ROL] [int] NOT NULL
) ON [PRIMARY]

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[relrack](
	[rel_unica] [uniqueidentifier] NOT NULL CONSTRAINT [DF_relrack_rel_unica]  DEFAULT (newid()),
	[rel_ca] [nvarchar](2) NULL,
	[rel_ba] [nvarchar](2) NULL,
	[rel_co] [nvarchar](2) NULL,
	[rel_pi] [nvarchar](2) NULL,
	[rel_pa] [nvarchar](1) NULL,
 CONSTRAINT [PK_relrack] PRIMARY KEY NONCLUSTERED 
(
	[rel_unica] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Rendiciondinero](
	[correlativo] [nvarchar](10) NULL,
	[fecha] [nvarchar](50) NULL,
	[cliente] [nvarchar](50) NULL,
	[cheque] [nvarchar](50) NULL,
	[efectivo] [numeric](18, 0) NULL,
	[pagado] [numeric](18, 0) NULL,
	[vuelto] [numeric](18, 0) NULL
) ON [PRIMARY]

GO
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[ROLES](
	[CODIGO_ROL] [int] NOT NULL,
	[DESCRIPCION_ROL] [nvarchar](50) NOT NULL
) ON [PRIMARY]

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[RPTlote](
	[Pallet] [varchar](50) NULL,
	[fecharece] [varchar](50) NULL,
	[guiacliente] [varchar](50) NULL,
	[posicion] [varchar](50) NULL,
	[guiadesp] [varchar](50) NULL,
	[fechadesp] [varchar](50) NULL
) ON [PRIMARY]

GO
SET ANSI_PADDING OFF
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[rubro](
	[CODIGO_RUBRO] [int] IDENTITY(1,1) NOT NULL,
	[NOMBRE_RUBRO] [varchar](50) NOT NULL,
	[ESTADO_RUBRO] [varchar](15) NOT NULL,
PRIMARY KEY CLUSTERED 
(
	[CODIGO_RUBRO] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_PADDING OFF
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[rutacama](
	[rutca_unica] [uniqueidentifier] NOT NULL CONSTRAINT [DF_rutacama_rutca_unica]  DEFAULT (newid()),
	[rutca_rutclie] [nvarchar](9) NULL,
	[rutca_secuen] [nvarchar](2) NULL,
	[rutca_cama] [nvarchar](2) NULL,
 CONSTRAINT [PK_rutacama] PRIMARY KEY NONCLUSTERED 
(
	[rutca_unica] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[rutaclie](
	[rutc_unica] [uniqueidentifier] NOT NULL CONSTRAINT [DF_rutaclie_rutc_unica]  DEFAULT (newid()),
	[rutc_rutclie] [nvarchar](9) NULL,
	[rutc_secuen] [nvarchar](2) NULL,
	[rutc_almacena] [nvarchar](1) NULL,
 CONSTRAINT [PK_rutaclie] PRIMARY KEY NONCLUSTERED 
(
	[rutc_unica] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[rutaprod](
	[rutp_unica] [uniqueidentifier] NOT NULL,
	[rutp_rutclie] [nvarchar](9) NULL,
	[rutp_codpro] [nvarchar](7) NULL,
	[rutp_secuen] [nvarchar](3) NULL,
	[rutp_camara] [nvarchar](2) NULL,
	[rutp_npos] [nvarchar](6) NULL,
 CONSTRAINT [PK_rutaprod] PRIMARY KEY NONCLUSTERED 
(
	[rutp_unica] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[SADEMA_GRAFICAS](
	[nombre] [nvarchar](50) NULL,
	[base] [nvarchar](50) NULL,
	[sectores] [numeric](18, 0) NULL
) ON [PRIMARY]

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Secciones](
	[Sec_Id] [numeric](18, 0) NOT NULL,
	[Sec_Descr] [nvarchar](20) NULL,
 CONSTRAINT [PK_Secciones] PRIMARY KEY CLUSTERED 
(
	[Sec_Id] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[serimagen](
	[rimg_imagen] [image] NULL,
	[rimg_num] [int] NULL,
	[rimg_rececodi] [nvarchar](7) NULL,
	[fecha] [datetime] NULL CONSTRAINT [DF_serimagen_fecha]  DEFAULT (getdate()),
	[rimg_temp] [int] NULL CONSTRAINT [DF_serimagen_rimg_temp]  DEFAULT ((0)),
	[rimg_imagen2] [image] NULL
) ON [PRIMARY] TEXTIMAGE_ON [PRIMARY]

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Servicio_Nuevos](
	[ServN_servicio] [nvarchar](4) NULL,
	[servn_rutcli] [nvarchar](10) NULL,
	[servn_pallet] [int] NULL,
	[servn_tunel] [int] NULL
) ON [PRIMARY]

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[servicios](
	[ser_unica] [uniqueidentifier] NOT NULL CONSTRAINT [DF_servicios_ser_unica]  DEFAULT (newid()),
	[ser_codi] [nvarchar](3) NULL,
	[ser_descr] [varchar](1000) NULL,
	[ser_tdato] [tinyint] NULL,
	[ser_tmeca] [tinyint] NULL,
	[ser_codvig] [tinyint] NULL,
	[ser_escala] [tinyint] NULL,
 CONSTRAINT [PK_servicios] PRIMARY KEY NONCLUSTERED 
(
	[ser_unica] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_PADDING OFF
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[servicios_asociar](
	[id] [int] IDENTITY(1,1) NOT NULL,
	[pallet] [varchar](50) NULL,
	[servicio] [varchar](50) NULL,
	[estado] [int] NULL,
	[fecha] [datetime] NULL
) ON [PRIMARY]

GO
SET ANSI_PADDING OFF
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[servicios_detalledespacho](
	[codigo] [int] IDENTITY(1,1) NOT NULL,
	[barra] [varchar](50) NULL,
	[numero] [varchar](50) NULL,
	[ficha] [varchar](50) NULL,
	[fecha] [datetime] NULL,
	[producto] [varchar](50) NULL,
	[soportante] [varchar](50) NULL,
	[unidades] [float] NULL,
	[peso] [float] NULL,
	[estado] [int] NULL
) ON [PRIMARY]

GO
SET ANSI_PADDING OFF
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[servicios_detallerecepcion](
	[codigo] [int] IDENTITY(1,1) NOT NULL,
	[barra] [varchar](50) NULL,
	[numero] [varchar](50) NULL,
	[ficha] [varchar](50) NULL,
	[fecha] [datetime] NULL,
	[producto] [varchar](50) NULL,
	[soportante] [varchar](50) NULL,
	[unidades] [float] NULL,
	[peso] [float] NULL,
	[estado] [int] NULL
) ON [PRIMARY]

GO
SET ANSI_PADDING OFF
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[servicios_fichaDespacho](
	[codigo] [int] IDENTITY(1,1) NOT NULL,
	[ficha] [varchar](50) NULL,
	[cliente] [varchar](50) NULL,
	[productor] [varchar](50) NULL,
	[cotrato] [varchar](50) NULL,
	[fecha] [datetime] NULL,
	[carga] [varchar](50) NULL,
	[observacion] [varchar](50) NULL,
	[estado] [int] NULL
) ON [PRIMARY]

GO
SET ANSI_PADDING OFF
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[servicios_ficharecepcion](
	[codigo] [int] IDENTITY(1,1) NOT NULL,
	[ficha] [varchar](50) NULL,
	[cliente] [varchar](50) NULL,
	[productor] [varchar](50) NULL,
	[contrato] [varchar](50) NULL,
	[fecha] [datetime] NULL,
	[carga] [varchar](50) NULL,
	[observacion] [varchar](50) NULL,
	[estado] [int] NULL
) ON [PRIMARY]

GO
SET ANSI_PADDING OFF
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[servicios_monedas](
	[id] [int] IDENTITY(1,1) NOT NULL,
	[codigo] [varchar](50) NULL,
	[nombre] [varchar](50) NULL,
	[sigla] [varchar](50) NULL,
	[valor] [float] NULL
) ON [PRIMARY]

GO
SET ANSI_PADDING OFF
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[servicios_numeros](
	[codigo] [int] IDENTITY(1,1) NOT NULL,
	[tipo] [varchar](50) NULL,
	[actual] [float] NULL,
	[utilizado] [float] NULL
) ON [PRIMARY]

GO
SET ANSI_PADDING OFF
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[servicios_servicios](
	[id] [int] IDENTITY(10,1) NOT NULL,
	[codigo] [int] NULL,
	[nombre] [varchar](50) NULL,
	[descripcion] [varchar](50) NULL,
	[valor] [float] NULL,
	[unidad] [int] NULL,
	[moneda] [int] NULL
) ON [PRIMARY]

GO
SET ANSI_PADDING OFF
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[servicios_unidades](
	[id] [int] IDENTITY(1,1) NOT NULL,
	[codigo] [varchar](50) NULL,
	[nombre] [varchar](50) NULL,
	[tipo] [int] NULL
) ON [PRIMARY]

GO
SET ANSI_PADDING OFF
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[servicios_web](
	[CODIGO] [int] IDENTITY(1,1) NOT NULL,
	[DESCRIPCION] [varchar](100) NULL,
	[ESTADO] [varchar](1) NULL,
PRIMARY KEY CLUSTERED 
(
	[CODIGO] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_PADDING OFF
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[servicios_web_solicitud](
	[CODIGO] [int] IDENTITY(1,1) NOT NULL,
	[RUTCLIENTE] [varchar](20) NULL,
	[NOMBRE] [varchar](100) NULL,
	[EMAIL] [varchar](100) NULL,
	[CODIGO_SERVICIO] [varchar](5) NULL,
	[OTRO] [varchar](100) NULL,
	[COMENTARIO] [varchar](1000) NULL,
	[FECHA_INGRESO] [datetime] NULL,
	[ESTADO] [varchar](1) NULL,
 CONSTRAINT [PK__servicio__CC87E127BC94A5A1] PRIMARY KEY CLUSTERED 
(
	[CODIGO] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_PADDING OFF
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[ServWeb](
	[Sweb_codi] [float] NULL,
	[Sweb_Serv] [int] NULL,
	[Sweb_Cliente] [char](10) NULL,
	[Sweb_Fecha] [datetime] NULL,
	[Sweb_Cam1] [float] NULL,
	[Sweb_Cam2] [float] NULL,
	[Sweb_Cam3] [float] NOT NULL,
	[Sweb_Cam4] [char](15) NULL,
	[Sweb_Cam5] [char](15) NULL,
	[Sweb_Cam6] [char](15) NULL,
	[Sweb_Cam7] [char](15) NULL,
	[Sweb_Cam8] [char](15) NULL,
	[Sweb_GrupFec] [decimal](24, 0) NULL
) ON [PRIMARY]

GO
SET ANSI_PADDING OFF
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[slot](
	[slo_unica] [uniqueidentifier] NOT NULL CONSTRAINT [DF_slot_slo_unica]  DEFAULT (newid()),
	[slo_codi] [nvarchar](5) NULL,
	[slo_camara] [nvarchar](2) NULL,
	[slo_slot] [nvarchar](3) NULL,
	[slo_banda] [nvarchar](2) NULL,
	[slo_piso] [nvarchar](2) NULL,
	[slo_alto] [int] NULL,
	[slo_ancho] [int] NULL,
	[slo_fondo] [int] NULL,
	[slo_saltura] [nvarchar](5) NULL,
	[slo_tslot] [nvarchar](1) NULL,
 CONSTRAINT [PK_slot] PRIMARY KEY NONCLUSTERED 
(
	[slo_unica] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[slot_historial](
	[id] [int] IDENTITY(1,1) NOT NULL,
	[fecha] [datetime] NULL,
	[cliente] [varchar](50) NULL,
	[cod_Rece] [varchar](50) NULL,
	[camara] [varchar](50) NULL,
	[slot] [varchar](50) NULL,
	[contrato] [varchar](50) NULL,
	[producto] [varchar](50) NULL,
	[unidades] [float] NULL CONSTRAINT [DF_slot_historial_unidades]  DEFAULT (0),
	[peso] [float] NULL CONSTRAINT [DF_slot_historial_peso]  DEFAULT (0)
) ON [PRIMARY]

GO
SET ANSI_PADDING OFF
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[slotdeta](
	[slod_unica] [uniqueidentifier] NOT NULL,
	[slod_codi] [nvarchar](16) NULL,
	[slod_caslo] [nvarchar](5) NULL,
	[slod_folio] [nvarchar](11) NULL,
	[slod_codpro] [nvarchar](7) NULL,
	[slod_unidades] [int] NULL,
	[slod_peso] [float] NULL,
	[slod_fecpro] [nvarchar](10) NULL,
	[slod_nivel] [int] NULL,
	[slod_altura] [int] NULL,
	[slod_envniv] [int] NULL,
	[slod_altenv] [int] NULL,
	[slod_core] [tinyint] NULL,
	[slod_code] [tinyint] NULL,
 CONSTRAINT [PK_slotdeta] PRIMARY KEY NONCLUSTERED 
(
	[slod_unica] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Stock_Pallet_Cliente](
	[fecha] [nvarchar](10) NULL,
	[nombre] [nvarchar](50) NULL,
	[pallet] [numeric](18, 0) NULL,
	[bins] [numeric](18, 0) NULL,
	[envases] [numeric](18, 0) NULL,
	[kilos] [float] NULL,
	[grupo] [nvarchar](6) NULL
) ON [PRIMARY]

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Stockini](
	[sto_unica] [uniqueidentifier] NOT NULL,
	[sto_fecha] [nvarchar](4) NULL,
	[sto_codprod] [nvarchar](7) NULL,
	[sto_pallet] [int] NULL,
	[sto_unidad] [int] NULL,
	[sto_peso] [float] NULL,
 CONSTRAINT [PK_Stockini] PRIMARY KEY NONCLUSTERED 
(
	[sto_unica] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[T_ANDREW_TEMP](
	[PALET] [nvarchar](50) NULL,
	[CAJA] [nvarchar](50) NULL,
	[ESTADO] [nvarchar](50) NULL,
	[CALIDAD] [nvarchar](50) NULL,
	[CALIBRE] [nvarchar](50) NULL,
	[FECHAELAB] [nvarchar](50) NULL,
	[FECHAVEN] [nvarchar](50) NULL,
	[UNIDAD] [nvarchar](50) NULL,
	[KILO] [nvarchar](50) NULL,
	[ID] [nvarchar](50) NULL,
	[LOTE] [nvarchar](50) NULL
) ON [PRIMARY]

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[TipoDocumento](
	[ID] [int] IDENTITY(1,1) NOT NULL,
	[Descripcion] [char](30) NOT NULL,
	[Tabla] [char](30) NULL,
 CONSTRAINT [PK_Notificacion] PRIMARY KEY NONCLUSTERED 
(
	[ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_PADDING OFF
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[tipoenv](
	[tenv_unica] [uniqueidentifier] NOT NULL CONSTRAINT [DF_tipoenv_tenv_unica]  DEFAULT (newid()),
	[tenv_codi] [nvarchar](5) NULL,
	[tenv_descr] [nvarchar](40) NULL,
	[tenv_mater] [nvarchar](15) NULL,
	[tenv_alto] [float] NULL,
	[tenv_ancho] [float] NULL,
	[tenv_fondo] [float] NULL,
	[tenv_fecproc] [nvarchar](10) NULL,
 CONSTRAINT [PK_tipoenv] PRIMARY KEY NONCLUSTERED 
(
	[tenv_unica] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[tiposopo](
	[tsop_unica] [uniqueidentifier] NOT NULL CONSTRAINT [DF_tiposopo_tsop_unica]  DEFAULT (newid()),
	[tsop_codi] [nvarchar](3) NULL,
	[tsop_descr] [nvarchar](40) NULL,
	[tsop_materi] [nvarchar](30) NULL,
	[tsop_alto] [float] NULL,
	[tsop_ancho] [float] NULL,
	[tsop_fondo] [float] NULL,
	[tsop_fecproc] [nvarchar](10) NULL,
	[codcorto] [nchar](3) NULL,
	[pesoPallet] [numeric](18, 0) NULL,
 CONSTRAINT [PK_tiposopo] PRIMARY KEY NONCLUSTERED 
(
	[tsop_unica] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[TMP_DETAPREDCAJAS](
	[Folio] [nchar](10) NULL,
	[Pallet] [nvarchar](50) NULL,
	[Caja] [nvarchar](50) NULL
) ON [PRIMARY]

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[TMP_MOVIMIENTOSCAMARA](
	[MOVC_ID] [nvarchar](14) NULL,
	[MOVC_FOLIO] [nvarchar](9) NULL,
	[MOVC_FECHA] [nvarchar](10) NULL,
	[MOVC_HORA] [nvarchar](5) NULL,
	[MOVC_CA] [nvarchar](2) NULL,
	[MOVC_BA] [nvarchar](2) NULL,
	[MOVC_CO] [nvarchar](2) NULL,
	[MOVC_PI] [nvarchar](2) NULL,
	[MOVC_NI] [nvarchar](1) NULL,
	[MOVC_TS] [real] NULL,
	[MOVC_TM] [real] NULL,
	[MOVC_TI] [real] NULL,
	[MOVC_RUTCLI] [nvarchar](10) NULL,
	[MOVC_NOMCLI] [nvarchar](50) NULL,
	[MOVC_MOVIM] [nvarchar](50) NULL,
	[MOVC_CODPRO] [nvarchar](10) NULL,
	[MOVC_PRODESC] [nvarchar](50) NULL,
	[MOVC_FECREC] [nvarchar](10) NULL,
	[MOVC_PESO] [float] NULL,
	[MOVC_UNIDAD] [int] NULL CONSTRAINT [DF_TMP_MOVIMIENTOSCAMARA_MOVC_UNIDAD]  DEFAULT (1)
) ON [PRIMARY]

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[TMP_PackingList](
	[tmpc_codrece] [varchar](9) NULL,
	[tmpc_codcaja] [varchar](200) NULL,
	[tmpc_id] [numeric](18, 0) NULL
) ON [PRIMARY]

GO
SET ANSI_PADDING OFF
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[TMP_POS](
	[pallet] [nvarchar](50) NULL,
	[fechareg] [datetime] NULL,
	[encargado] [nvarchar](50) NULL
) ON [PRIMARY]

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[TMP_PRN_ETQ](
	[etiqueta] [nvarchar](20) NULL,
	[prn] [int] NULL,
	[temp] [int] NULL,
	[numpallet] [nvarchar](9) NULL
) ON [PRIMARY]

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[TMP_SELECCIONCAJAS](
	[scaj_codcaja] [varchar](200) NOT NULL,
	[scaj_codped] [numeric](18, 0) NOT NULL,
	[scaj_fecha] [datetime] NULL,
	[scaj_enca] [varchar](3) NULL
) ON [PRIMARY]

GO
SET ANSI_PADDING OFF
GO
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING OFF
GO
CREATE TABLE [dbo].[TMPCABSERVICIOS](
	[IDENT] [numeric](18, 0) NOT NULL,
	[CONTRATO] [varchar](7) NOT NULL,
	[CONTRVAL] [decimal](12, 2) NOT NULL CONSTRAINT [DF__TMPCABSER__CONTR__0307610B]  DEFAULT (0),
	[MONDESC] [varchar](30) NOT NULL CONSTRAINT [DF__TMPCABSER__MONDE__03FB8544]  DEFAULT (''),
	[MONVAL] [decimal](12, 2) NOT NULL CONSTRAINT [DF__TMPCABSER__MONVA__04EFA97D]  DEFAULT (0),
	[MEDDESC] [varchar](30) NOT NULL CONSTRAINT [DF__TMPCABSER__MEDDE__05E3CDB6]  DEFAULT (''),
	[TOTSOP] [int] NOT NULL CONSTRAINT [DF__TMPCABSER__TOTSO__06D7F1EF]  DEFAULT (0),
	[VALNETO] [decimal](12, 2) NOT NULL CONSTRAINT [DF__TMPCABSER__VALNE__07CC1628]  DEFAULT (0),
	[VALUF] [decimal](12, 2) NOT NULL CONSTRAINT [DF__TMPCABSER__VALUF__08C03A61]  DEFAULT (0),
	[FECUF] [varchar](10) NOT NULL CONSTRAINT [DF__TMPCABSER__FECUF__09B45E9A]  DEFAULT (''),
	[VALDOLAR] [decimal](12, 2) NOT NULL CONSTRAINT [DF__TMPCABSER__VALDO__0AA882D3]  DEFAULT (0),
	[FECDOLAR] [varchar](10) NOT NULL CONSTRAINT [DF__TMPCABSER__FECDO__0B9CA70C]  DEFAULT (''),
	[TOTCT] [int] NOT NULL CONSTRAINT [DF__TMPCABSER__TOTCT__0C90CB45]  DEFAULT (0),
	[TOTST] [int] NOT NULL CONSTRAINT [DF__TMPCABSER__TOTST__0D84EF7E]  DEFAULT (0),
	[TOTDP] [int] NOT NULL CONSTRAINT [DF__TMPCABSER__TOTDP__0E7913B7]  DEFAULT (0),
	[TOTSTOCK] [int] NOT NULL CONSTRAINT [DF__TMPCABSER__TOTST__0F6D37F0]  DEFAULT (0),
	[TOTUNI] [int] NOT NULL CONSTRAINT [DF__TMPCABSER__TOTUN__10615C29]  DEFAULT (0),
	[TOTTONE] [decimal](12, 2) NOT NULL CONSTRAINT [DF__TMPCABSER__TOTTO__11558062]  DEFAULT (0),
	[CONTRDERENTR] [int] NOT NULL CONSTRAINT [DF_TMPCABSERVICIOS_CONTRDERENTR]  DEFAULT (0),
 CONSTRAINT [PK_TMPCABSERV_MINTUNEL] PRIMARY KEY CLUSTERED 
(
	[IDENT] ASC,
	[CONTRATO] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_PADDING OFF
GO
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[TMPCHOFERES](
	[frec_codi] [nvarchar](7) NOT NULL,
	[cho_rut] [nvarchar](9) NOT NULL CONSTRAINT [DF_TMPCHOFERES_cho_rut]  DEFAULT (''),
	[cho_rutclie] [nvarchar](9) NOT NULL CONSTRAINT [DF_TMPCHOFERES_cho_rutclie]  DEFAULT (''),
	[cho_nombre] [nvarchar](40) NOT NULL CONSTRAINT [DF_TMPCHOFERES_cho_nombre]  DEFAULT (''),
	[cho_patente] [nvarchar](10) NOT NULL CONSTRAINT [DF_TMPCHOFERES_cho_patente]  DEFAULT (''),
	[cho_empresa] [nvarchar](35) NOT NULL CONSTRAINT [DF_TMPCHOFERES_cho_empresa]  DEFAULT (''),
 CONSTRAINT [PK_TMPCHOFERES] PRIMARY KEY CLUSTERED 
(
	[frec_codi] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[tmpcorrel](
	[tmpc_unica] [uniqueidentifier] NOT NULL CONSTRAINT [DF_tmpcorrel_tmpc_unica]  DEFAULT (newid()),
	[tmpc_codi] [nvarchar](10) NULL,
	[tmpc_usuario] [nvarchar](10) NULL,
	[tmpc_personal] [smallint] NULL,
	[tmpc_fechaini] [nvarchar](10) NULL,
	[tmpc_horaini] [nvarchar](8) NULL,
	[tmpc_fechater] [nvarchar](10) NULL,
	[tmpc_horater] [nvarchar](8) NULL,
	[tmpc_proceso] [tinyint] NULL,
 CONSTRAINT [PK_tmpcorrel] PRIMARY KEY NONCLUSTERED 
(
	[tmpc_unica] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[TMPDETAETIQ](
	[ETIQ_CODI] [varchar](5) NOT NULL,
	[ETIQ_DCOD] [nvarchar](2) NOT NULL,
	[ETIQ_SOPOPRE] [nvarchar](9) NULL,
	[ETIQ_SOPOCLI] [nvarchar](11) NULL,
	[ETIQ_CODPRO] [nvarchar](7) NULL,
	[ETIQ_FECPROD] [date] NULL,
	[ETIQ_FECVENC] [date] NULL,
	[ETIQ_CAJAS] [numeric](18, 0) NULL,
	[ETIQ_KILOS] [float] NULL,
	[ETIQ_NFECPROD] [date] NULL,
	[ETIQ_NFECVENC] [date] NULL,
	[ETIQ_NSOPOCLI] [nvarchar](11) NULL,
	[ETIQ_EST] [nvarchar](5) NULL,
 CONSTRAINT [PK_TMPDETAETIQ] PRIMARY KEY CLUSTERED 
(
	[ETIQ_CODI] ASC,
	[ETIQ_DCOD] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_PADDING OFF
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[TMPDETAPRED](
	[fpre_codi] [nvarchar](7) NOT NULL,
	[dpre_codi] [nvarchar](2) NOT NULL,
	[dpre_codpro] [nvarchar](7) NULL,
	[dpre_codsopo] [nvarchar](2) NULL,
	[dpre_sopocli] [nvarchar](17) NULL,
	[dpre_unidades] [int] NULL,
	[dpre_peso] [float] NULL,
	[dpre_fecdes] [nvarchar](10) NULL,
	[dpre_rutcli] [nvarchar](9) NULL,
	[dpre_contcli] [nvarchar](7) NULL,
	[dpre_fecprod] [nvarchar](10) NULL,
	[dpre_camara] [nvarchar](2) NULL,
	[dpre_banda] [nvarchar](2) NULL,
	[dpre_colum] [nvarchar](2) NULL,
	[dpre_piso] [nvarchar](2) NULL,
	[dpre_nivel] [nvarchar](1) NULL,
	[dpre_almacen] [tinyint] NULL,
	[dpre_dcaja] [tinyint] NULL,
	[dpre_folio] [nvarchar](9) NULL,
	[dpre_activa] [tinyint] NULL,
	[dpre_radio] [tinyint] NULL,
	[dpre_track] [tinyint] NULL,
	[dpre_codvig] [nvarchar](1) NULL,
	[dpre_pallet] [tinyint] NULL,
	[dpre_slot] [nvarchar](3) NULL,
	[dpre_TS] [real] NULL,
	[dpre_TM] [real] NULL,
	[dpre_TI] [real] NULL,
	[dpre_Ptr] [int] NOT NULL,
	[dpre_Pick] [int] NOT NULL,
	[dpre_CodPer] [char](3) NULL,
	[dpre_Hora] [varchar](10) NULL,
	[dpre_fecn] [nvarchar](10) NULL,
	[dpre_ActUni] [int] NOT NULL,
	[dpre_TotUni] [int] NOT NULL,
	[DPRE_CORRELATIVO] [int] NULL,
	[DPRE_FOLIO_PALLET] [nvarchar](18) NULL,
 CONSTRAINT [PK_TMPDETAPRED] PRIMARY KEY CLUSTERED 
(
	[fpre_codi] ASC,
	[dpre_codi] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_PADDING OFF
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[TMPDETARECE](
	[frec_codi] [nvarchar](7) NOT NULL,
	[drec_codi] [nvarchar](2) NOT NULL,
	[drec_codcaja] [varchar](1) NULL,
	[drec_codpro] [nvarchar](7) NOT NULL,
	[drec_origen] [nvarchar](2) NOT NULL,
	[drec_codsopo] [nvarchar](2) NOT NULL,
	[drec_sopocli] [nvarchar](17) NOT NULL,
	[drec_unidades] [int] NOT NULL,
	[drec_peso] [float] NOT NULL,
	[drec_fecrec] [nvarchar](10) NOT NULL,
	[drec_rutcli] [nvarchar](9) NOT NULL,
	[drec_rutproductor] [varchar](12) NOT NULL,
	[drec_contcli] [nvarchar](7) NOT NULL,
	[drec_fecprod] [nvarchar](10) NOT NULL,
	[drec_camara] [nvarchar](2) NOT NULL,
	[drec_banda] [nvarchar](2) NOT NULL,
	[drec_colum] [nvarchar](2) NOT NULL,
	[drec_piso] [nvarchar](2) NOT NULL,
	[drec_nivel] [nvarchar](1) NOT NULL,
	[drec_almacen] [tinyint] NOT NULL,
	[drec_dcaja] [tinyint] NOT NULL,
	[drec_tunel] [tinyint] NOT NULL,
	[drec_codvig] [nvarchar](1) NOT NULL,
	[drec_pallet] [tinyint] NULL,
	[drec_codrel] [nvarchar](7) NOT NULL,
	[drec_nrosopo] [int] NOT NULL,
	[drec_slot] [nvarchar](3) NOT NULL,
	[drec_dtgracia] [nvarchar](3) NOT NULL,
	[drec_codsag] [nvarchar](15) NOT NULL,
	[drec_tipo] [int] NULL,
	[FechaVencimiento] [char](10) NOT NULL,
	[LoteCliente] [char](15) NOT NULL,
	[drec_TS] [real] NULL,
	[drec_TM] [real] NULL,
	[drec_TI] [real] NULL,
	[drec_RecepTunel] [int] NULL,
	[drec_ProcTunel] [int] NULL,
	[drec_TS_Tunel] [real] NULL,
	[drec_TM_Tunel] [real] NULL,
	[drec_TI_Tunel] [real] NULL,
	[drec_codper] [char](3) NOT NULL,
	[drec_hora] [varchar](10) NOT NULL,
	[drec_FecHomo] [varchar](10) NOT NULL,
	[drec_HorHomo] [varchar](10) NOT NULL,
	[drec_AutHomo] [int] NULL,
	[drec_estado] [varchar](50) NOT NULL,
	[drec_ocup] [int] NOT NULL,
	[drec_valor] [real] NULL,
	[drec_moncodi] [nvarchar](2) NULL,
	[drec_medcodi] [nvarchar](3) NULL,
	[drec_temp] [float] NULL,
	[drec_arriendo] [varchar](1) NULL,
	[bloqueado] [nchar](1) NULL,
	[drec_etiqueta] [nvarchar](20) NULL,
	[codtmprece] [int] NULL,
	[estpallet] [nchar](5) NULL,
 CONSTRAINT [PK_TMPDETARECE] PRIMARY KEY CLUSTERED 
(
	[frec_codi] ASC,
	[drec_codi] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_PADDING OFF
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING OFF
GO
CREATE TABLE [dbo].[TMPDETARECECASO](
	[frec_codi] [nvarchar](7) NOT NULL,
	[drec_codi] [nvarchar](2) NOT NULL,
	[drec_codpro] [nvarchar](7) NOT NULL,
	[drec_origen] [nvarchar](2) NOT NULL,
	[drec_codsopo] [nvarchar](2) NOT NULL,
	[drec_sopocli] [nvarchar](11) NOT NULL,
	[drec_unidades] [int] NOT NULL,
	[drec_peso] [float] NOT NULL,
	[drec_fecrec] [nvarchar](10) NOT NULL,
	[drec_rutcli] [nvarchar](9) NOT NULL,
	[drec_rutproductor] [varchar](12) NOT NULL,
	[drec_contcli] [nvarchar](7) NOT NULL,
	[drec_fecprod] [nvarchar](10) NOT NULL,
	[drec_camara] [nvarchar](2) NOT NULL,
	[drec_banda] [nvarchar](2) NOT NULL,
	[drec_colum] [nvarchar](2) NOT NULL,
	[drec_piso] [nvarchar](2) NOT NULL,
	[drec_nivel] [nvarchar](1) NOT NULL,
	[drec_almacen] [tinyint] NOT NULL,
	[drec_dcaja] [tinyint] NOT NULL,
	[drec_tunel] [tinyint] NOT NULL,
	[drec_codvig] [nvarchar](1) NOT NULL,
	[drec_pallet] [tinyint] NULL,
	[drec_codrel] [nvarchar](7) NOT NULL,
	[drec_nrosopo] [int] NOT NULL,
	[drec_slot] [nvarchar](3) NOT NULL,
	[drec_dtgracia] [nvarchar](3) NOT NULL,
	[drec_codsag] [nvarchar](10) NOT NULL,
	[drec_tipo] [int] NULL,
	[FechaVencimiento] [char](10) NOT NULL,
	[LoteCliente] [char](10) NOT NULL,
	[drec_TS] [real] NULL,
	[drec_TM] [real] NULL,
	[drec_TI] [real] NULL,
	[drec_RecepTunel] [int] NULL,
	[drec_ProcTunel] [int] NULL,
	[drec_TS_Tunel] [real] NULL,
	[drec_TM_Tunel] [real] NULL,
	[drec_TI_Tunel] [real] NULL,
	[drec_codper] [char](3) NOT NULL,
	[drec_hora] [varchar](10) NOT NULL,
	[drec_FecHomo] [varchar](10) NOT NULL,
	[drec_HorHomo] [varchar](10) NOT NULL,
	[drec_AutHomo] [int] NULL,
	[drec_estado] [varchar](50) NOT NULL,
	[drec_ocup] [int] NOT NULL
) ON [PRIMARY]

GO
SET ANSI_PADDING OFF
GO
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[TMPDETCAJAS](
	[frec_codi] [nvarchar](7) NOT NULL,
	[drec_codi] [nvarchar](2) NOT NULL,
	[detc_codi] [nvarchar](12) NOT NULL,
	[detc_fprod] [nvarchar](10) NOT NULL,
	[detc_fvenc] [nvarchar](10) NOT NULL,
	[detc_cantidad] [nvarchar](10) NOT NULL,
 CONSTRAINT [PK_TMPDETCAJAS] PRIMARY KEY CLUSTERED 
(
	[frec_codi] ASC,
	[drec_codi] ASC,
	[detc_codi] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING OFF
GO
CREATE TABLE [dbo].[TMPDETSERVICIOS](
	[IDENT] [numeric](18, 0) NOT NULL,
	[CONTRATO] [varchar](7) NOT NULL,
	[LINEA] [int] NOT NULL,
	[FECHA] [varchar](10) NOT NULL CONSTRAINT [DF_TMPSERV_MINTUNEL_FECHA]  DEFAULT (''),
	[CT] [int] NOT NULL CONSTRAINT [DF_TMPSERV_MINTUNEL_CT]  DEFAULT (0),
	[ST] [int] NOT NULL CONSTRAINT [DF_TMPSERV_MINTUNEL_ST]  DEFAULT (0),
	[DP] [int] NOT NULL CONSTRAINT [DF_TMPSERV_MINTUNEL_DP]  DEFAULT (0),
	[STOCK] [int] NOT NULL CONSTRAINT [DF_TMPSERV_MINTUNEL_STOCK]  DEFAULT (0),
	[FACTURAR] [int] NOT NULL CONSTRAINT [DF_TMPSERV_MINTUNEL_FACTURAR]  DEFAULT (0),
	[UNIDADES] [int] NOT NULL CONSTRAINT [DF_TMPSERV_MINTUNEL_UNIDADES]  DEFAULT (0),
	[TONELADAS] [decimal](12, 2) NOT NULL CONSTRAINT [DF_TMPSERV_MINTUNEL_TONELADAS]  DEFAULT (0),
 CONSTRAINT [PK_TMPSERV_MINTUNEL] PRIMARY KEY CLUSTERED 
(
	[IDENT] ASC,
	[CONTRATO] ASC,
	[LINEA] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_PADDING OFF
GO
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING OFF
GO
CREATE TABLE [dbo].[TMPESTADOS](
	[Est_Codi] [int] NOT NULL,
	[Est_Glosa] [varchar](10) NOT NULL CONSTRAINT [DF_TMPESTADOS_Est_Glosa]  DEFAULT (''),
 CONSTRAINT [PK_TMPESTADOS] PRIMARY KEY CLUSTERED 
(
	[Est_Codi] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_PADDING OFF
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[TMPFICHETIQ](
	[ETIQ_CODI] [nvarchar](5) NOT NULL,
	[ETIQ_CLIRUT] [nvarchar](9) NULL,
	[ETIQ_CODCONT] [nvarchar](7) NULL,
	[ETIQ_FECHA] [date] NULL,
	[ETIQ_HORINI] [time](7) NULL,
	[ETIQ_CODENCA] [nvarchar](3) NULL,
	[ETIQ_EST] [nvarchar](1) NULL,
	[ETIQ_HORTER] [time](7) NULL,
 CONSTRAINT [PK_TMPFICHETIQ] PRIMARY KEY CLUSTERED 
(
	[ETIQ_CODI] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING OFF
GO
CREATE TABLE [dbo].[TMPFICHPRED](
	[fpre_codi] [nvarchar](7) NOT NULL,
	[fpre_rutcli] [nvarchar](9) NULL,
	[fpre_horades] [nvarchar](5) NULL,
	[fpre_horater] [nvarchar](5) NULL,
	[fpre_fecdes] [nvarchar](10) NULL,
	[fpre_totsopo] [int] NULL,
	[fpre_totunidad] [int] NULL,
	[fpre_totpeso] [float] NULL,
	[fpre_rutcond] [nvarchar](9) NULL,
	[fpre_codienca] [nvarchar](3) NULL,
	[fpre_activa] [nvarchar](1) NULL,
	[fpre_fechact] [nvarchar](10) NULL,
	[fpre_codvig] [nvarchar](1) NULL,
	[fpre_gdespa] [nvarchar](7) NULL,
	[fpre_radio] [nvarchar](1) NULL,
	[fpre_tipo] [int] NULL,
	[fpre_proceso] [int] NULL,
	[fpre_sello] [varchar](50) NULL,
	[fpre_tem] [real] NULL,
	[fpre_anden] [nvarchar](10) NULL,
	[FPRE_USUCRE] [nvarchar](6) NULL,
	[EST_CODI] [int] NULL,
	[FPRE_PALLET] [nvarchar](18) NULL,
	[fpre_TS] [real] NULL,
	[fpre_TM] [real] NULL,
	[fpre_TI] [real] NULL,
	[fpre_nped] [numeric](18, 0) NULL,
	[FPRE_ETIQ] [nvarchar](1) NULL,
	[estc_olor] [nchar](10) NULL,
	[estc_hig] [nchar](10) NULL,
	[estc_cond] [nchar](10) NULL
) ON [PRIMARY]

GO
SET ANSI_PADDING OFF
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[TMPFICHRECE](
	[frec_codi] [nvarchar](7) NOT NULL,
	[frec_rutcli] [nvarchar](9) NOT NULL,
	[frec_rutproductor] [varchar](12) NOT NULL,
	[frec_contcli] [nvarchar](7) NOT NULL,
	[frec_horalleg] [nvarchar](5) NOT NULL,
	[frec_horarec] [nvarchar](5) NOT NULL,
	[frec_horater] [nvarchar](5) NOT NULL,
	[frec_turnrec] [nvarchar](1) NOT NULL,
	[frec_fecproc] [nvarchar](10) NOT NULL,
	[frec_fecrec] [nvarchar](10) NOT NULL,
	[frec_guiades] [nvarchar](8) NOT NULL,
	[frec_tipentr] [nvarchar](2) NOT NULL,
	[frec_totsopo] [int] NOT NULL,
	[frec_totunidad] [int] NOT NULL,
	[frec_totpeso] [float] NOT NULL,
	[frec_temppro] [real] NULL,
	[frec_rutcond] [nvarchar](9) NOT NULL,
	[frec_observ] [nvarchar](250) NOT NULL,
	[frec_tipdesc] [nvarchar](1) NOT NULL,
	[frec_codienca] [nvarchar](3) NOT NULL,
	[frec_origen] [nvarchar](2) NOT NULL,
	[frec_codvig] [nvarchar](1) NOT NULL,
	[frec_radio] [nvarchar](1) NOT NULL,
	[frec_tipo] [int] NULL,
	[frec_RecepTunel] [int] NULL,
	[frec_AspectoSanitario] [nvarchar](15) NOT NULL,
	[frec_CondGeneral] [int] NULL,
	[frec_procedencia] [char](10) NULL,
	[frec_TS] [real] NULL,
	[frec_TM] [real] NULL,
	[frec_TI] [real] NULL,
	[Est_Codi] [int] NOT NULL,
	[frec_FecCre] [datetime] NOT NULL,
	[frec_UsuCre] [nvarchar](3) NOT NULL,
	[frec_FecMod] [datetime] NOT NULL,
	[FREC_NUMSELLO] [nvarchar](25) NULL,
	[frec_tipoalmacenamiento] [varchar](50) NULL,
	[frec_clfol] [nvarchar](7) NULL,
	[frec_contenedor] [nvarchar](20) NULL,
	[frec_antecamara] [nvarchar](2) NULL,
	[frec_olores] [nvarchar](2) NULL,
	[frec_higiene] [nvarchar](2) NULL,
	[frec_estiba] [nvarchar](2) NULL,
	[frec_daado] [nvarchar](2) NULL,
	[frec_codigo] [nvarchar](7) NULL,
	[frec_abierto] [int] NULL,
	[frec_tablet] [int] NULL,
 CONSTRAINT [PK_TMPFICHRECE] PRIMARY KEY CLUSTERED 
(
	[frec_codi] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_PADDING OFF
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING OFF
GO
CREATE TABLE [dbo].[TMPFICHRECECASO](
	[frec_codi] [nvarchar](7) NOT NULL,
	[frec_rutcli] [nvarchar](9) NOT NULL,
	[frec_rutproductor] [varchar](12) NOT NULL,
	[frec_contcli] [nvarchar](7) NOT NULL,
	[frec_horalleg] [nvarchar](5) NOT NULL,
	[frec_horarec] [nvarchar](5) NOT NULL,
	[frec_horater] [nvarchar](5) NOT NULL,
	[frec_turnrec] [nvarchar](1) NOT NULL,
	[frec_fecproc] [nvarchar](10) NOT NULL,
	[frec_fecrec] [nvarchar](10) NOT NULL,
	[frec_guiades] [nvarchar](8) NOT NULL,
	[frec_tipentr] [nvarchar](2) NOT NULL,
	[frec_totsopo] [int] NOT NULL,
	[frec_totunidad] [int] NOT NULL,
	[frec_totpeso] [float] NOT NULL,
	[frec_temppro] [real] NULL,
	[frec_rutcond] [nvarchar](9) NOT NULL,
	[frec_observ] [nvarchar](50) NOT NULL,
	[frec_tipdesc] [nvarchar](1) NOT NULL,
	[frec_codienca] [nvarchar](3) NOT NULL,
	[frec_origen] [nvarchar](2) NOT NULL,
	[frec_codvig] [nvarchar](1) NOT NULL,
	[frec_radio] [nvarchar](1) NOT NULL,
	[frec_tipo] [int] NULL,
	[frec_RecepTunel] [int] NULL,
	[frec_AspectoSanitario] [nvarchar](15) NOT NULL,
	[frec_CondGeneral] [int] NOT NULL,
	[frec_procedencia] [char](10) NULL,
	[frec_TS] [real] NULL,
	[frec_TM] [real] NULL,
	[frec_TI] [real] NULL,
	[Est_Codi] [int] NOT NULL,
	[frec_FecCre] [datetime] NOT NULL,
	[frec_UsuCre] [nvarchar](3) NOT NULL,
	[frec_FecMod] [datetime] NOT NULL
) ON [PRIMARY]

GO
SET ANSI_PADDING OFF
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[TMPTARIFASCLIENTES](
	[TAR_RUTCLI] [nvarchar](10) NULL,
	[TAR_NOMCLI] [nvarchar](50) NULL,
	[TAR_CODCONT] [nvarchar](50) NULL,
	[TAR_CONTRATO] [nvarchar](50) NULL,
	[TAR_CODSERV] [nvarchar](50) NULL,
	[TAR_SERVICIO] [nvarchar](50) NULL,
	[TAR_VALOR] [float] NULL,
	[TAR_MONEDA] [nvarchar](15) NULL,
	[TAR_TOTAL] [float] NULL,
	[TAR_TRAMNOMB] [nvarchar](10) NULL,
	[TAR_TRAMDESDE] [int] NULL,
	[TAR_TRAMHASTA] [int] NULL,
	[TAR_TRAMVAL] [real] NULL,
	[TAR_MEDIDA] [nvarchar](50) NULL
) ON [PRIMARY]

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[TRACKEOCAJAS](
	[TRACK_CODI] [nvarchar](12) NULL,
	[TRACK_CODCAJA] [nvarchar](65) NULL,
	[TRACK_FECHAHORA] [nvarchar](19) NULL,
	[TRACK_USUARIO] [nvarchar](3) NULL,
	[TRACK_CODVIG] [nvarchar](1) NULL,
	[TRACK_PREDESPACHO] [nvarchar](24) NULL,
	[TRACK_CAJA] [numeric](18, 0) NULL,
	[TRACK_LECTURA] [nvarchar](200) NULL,
	[TRACK_CAJACLIENTE] [nvarchar](20) NULL,
	[TRACK_DUN14] [nvarchar](14) NULL,
	[track_drec_codi] [nvarchar](12) NULL
) ON [PRIMARY]

GO
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING OFF
GO
CREATE TABLE [dbo].[TRAMO](
	[TRAMCOD] [int] NOT NULL,
	[ESCCOD] [int] NOT NULL,
	[TRAMNOMB] [varchar](30) NOT NULL,
	[TRAMDESDE] [int] NOT NULL,
	[TRAMHASTA] [int] NOT NULL,
	[TRAMVAL] [real] NOT NULL
) ON [PRIMARY]

GO
SET ANSI_PADDING OFF
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[Transportes](
	[tra_codigo] [varchar](9) NULL,
	[tra_rut] [varchar](13) NULL,
	[tra_razon] [varchar](50) NULL,
	[tra_representante] [varchar](50) NULL,
	[tra_direccion] [varchar](50) NULL,
	[tra_fonofax] [varchar](50) NULL,
	[tra_mail] [varchar](50) NULL,
	[tra_rutrepresentante] [varchar](50) NULL,
	[tra_fantasia] [varchar](50) NULL
) ON [PRIMARY]

GO
SET ANSI_PADDING OFF
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[TraspasoContratos](
	[tra_numero] [int] NOT NULL,
	[tra_recepcion] [varchar](7) NULL,
	[tra_despacho] [varchar](7) NULL,
	[tra_fecha] [datetime] NULL,
	[tra_hora] [nvarchar](8) NULL,
	[tra_pc] [varchar](50) NULL,
	[tra_pcusuario] [varchar](50) NULL,
	[tra_usuario] [varchar](3) NULL
) ON [PRIMARY]

GO
SET ANSI_PADDING OFF
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[TUNEL_AVISOS_SADEMA](
	[PROCESO] [nvarchar](10) NULL,
	[TUNEL] [numeric](18, 0) NULL,
	[FECHA] [nvarchar](10) NULL,
	[HORA] [nvarchar](5) NULL,
	[OBSERVACION] [ntext] NULL,
	[FECHAAVISO] [nvarchar](16) NULL,
	[FECHAINICIO] [nvarchar](16) NULL,
	[FECHATERMINO] [nvarchar](16) NULL,
	[MINUTOSANTES] [numeric](18, 0) NULL CONSTRAINT [DF_TUNEL_AVISOS_SADEMA_MINUTOSANTES]  DEFAULT (20),
	[TEMPORIZADOR] [numeric](18, 0) NULL CONSTRAINT [DF_TUNEL_AVISOS_SADEMA_TEMPORIZADOR]  DEFAULT (5),
	[ESTADO] [bit] NULL CONSTRAINT [DF_TUNEL_AVISOS_SADEMA_ESTADO]  DEFAULT (0)
) ON [PRIMARY] TEXTIMAGE_ON [PRIMARY]

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[TUNEL_HORAS_CONGELADO](
	[FAMILIA] [nvarchar](3) NULL,
	[T1] [float] NULL,
	[T2] [float] NULL,
	[T3] [float] NULL,
	[T4] [float] NULL
) ON [PRIMARY]

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[TUNEL_MAIL_PROCESOS](
	[PROCESO] [nvarchar](10) NULL,
	[MAIL] [numeric](18, 0) NULL,
	[TUNEL] [nvarchar](2) NULL,
	[USUARIO] [nvarchar](3) NULL,
	[PC] [nvarchar](20) NULL
) ON [PRIMARY]

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[tuneles](
	[idTunel] [bigint] IDENTITY(1,1) NOT NULL,
	[frec_guia] [nvarchar](7) NOT NULL,
	[frec_codi] [varchar](20) NOT NULL,
	[fechora_ingreso] [datetime] NOT NULL,
	[temp_ingreso] [real] NULL,
	[fechora_salida] [datetime] NULL,
	[temp_salida] [real] NULL
) ON [PRIMARY]

GO
SET ANSI_PADDING OFF
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[usuario](
	[unica] [uniqueidentifier] ROWGUIDCOL  NOT NULL CONSTRAINT [DF_usuario_unica]  DEFAULT (newid()),
	[codigo] [nvarchar](8) NOT NULL,
	[passwd] [nvarchar](20) NULL,
	[descri] [nvarchar](35) NULL,
	[personal] [nvarchar](3) NULL,
	[acceso] [tinyint] NULL,
	[accesof] [tinyint] NULL,
	[radio] [int] NULL CONSTRAINT [DF_usuario_radio]  DEFAULT ((-1)),
	[CodVig] [nvarchar](1) NULL CONSTRAINT [DF_usuario_CodVig]  DEFAULT (0),
	[modificacionPass] [varchar](50) NULL,
 CONSTRAINT [PK_usuario] PRIMARY KEY NONCLUSTERED 
(
	[unica] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_PADDING OFF
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[Usuarios](
	[usu_codigo] [nvarchar](3) NOT NULL,
	[usu_rut] [nvarchar](9) NULL,
	[usu_nombre] [nvarchar](40) NULL,
	[usu_ap] [varchar](25) NULL,
	[usu_am] [nvarchar](25) NULL,
	[usu_email] [nvarchar](150) NULL,
	[usu_anexo] [nvarchar](4) NULL,
	[usu_teleme] [numeric](18, 0) NULL,
	[usu_usuario] [nvarchar](20) NULL,
	[usu_pass] [nvarchar](100) NULL,
	[usu_pass2] [varchar](50) NULL,
	[usu_passweb] [varchar](80) NULL,
	[radio] [nvarchar](1) NULL,
	[personal] [nvarchar](3) NULL,
	[descri] [nvarchar](150) NOT NULL,
	[usu_codvig] [nvarchar](1) NOT NULL,
	[Usu_SecCod] [numeric](18, 0) NULL,
	[cl_imgtemS] [image] NULL,
	[des_bodega] [nvarchar](max) NULL,
 CONSTRAINT [PK_Usuarios] PRIMARY KEY CLUSTERED 
(
	[usu_codigo] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY] TEXTIMAGE_ON [PRIMARY]

GO
SET ANSI_PADDING OFF
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[USUARIOS_GLOBAL](
	[RUT] [varchar](255) NULL,
	[NOMBRE] [varchar](255) NULL,
	[EMAIL] [varchar](255) NULL,
	[CARGO] [varchar](255) NULL,
	[ANEXO] [varchar](255) NULL,
	[TELEFONO] [varchar](255) NULL,
	[LOGIN] [varchar](255) NULL,
	[PASSWORD] [varchar](255) NULL,
	[ACCESO] [varchar](255) NULL,
	[personal] [varchar](10) NULL,
	[radio] [int] NULL CONSTRAINT [DF_USUARIOS_GLOBAL_radio]  DEFAULT ((-1)),
	[CodVig] [nvarchar](1) NULL CONSTRAINT [DF_USUARIOS_GLOBAL_CodVig]  DEFAULT (0),
	[NOMBRE_PERFIL] [varchar](250) NULL
) ON [PRIMARY]

GO
SET ANSI_PADDING OFF
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[USUARIOS_GLOBAL1](
	[RUT] [varchar](255) NULL,
	[NOMBRE] [varchar](255) NULL,
	[EMAIL] [varchar](255) NULL,
	[CARGO] [varchar](255) NULL,
	[ANEXO] [varchar](255) NULL,
	[TELEFONO] [varchar](255) NULL,
	[LOGIN] [varchar](255) NULL,
	[PASSWORD] [varchar](255) NULL,
	[ACCESO] [varchar](255) NULL,
	[personal] [varchar](10) NULL,
	[radio] [int] NULL,
	[CodVig] [nvarchar](1) NULL,
	[NOMBRE_PERFIL] [varchar](250) NULL,
	[ModificacionPass] [varchar](8) NULL
) ON [PRIMARY]

GO
SET ANSI_PADDING OFF
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[USUARIOS_MENU_GLOBAL](
	[IDUSUARIO] [varchar](255) NULL,
	[FORMULARIO] [varchar](255) NULL,
	[ESTADO] [bit] NULL,
	[ATRIBUTOS] [varchar](255) NULL
) ON [PRIMARY]

GO
SET ANSI_PADDING OFF
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[USUARIOS_MENU_GLOBAL1](
	[IDUSUARIO] [varchar](255) NULL,
	[FORMULARIO] [varchar](255) NULL,
	[ESTADO] [bit] NULL,
	[ATRIBUTOS] [varchar](255) NULL
) ON [PRIMARY]

GO
SET ANSI_PADDING OFF
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[UsuariosFunciones](
	[Usu_Rut] [nvarchar](9) NOT NULL,
	[Usu_SprivId] [nvarchar](3) NOT NULL,
	[Usu_Fnc] [nvarchar](100) NULL,
 CONSTRAINT [PK_UsuariosFunciones] PRIMARY KEY CLUSTERED 
(
	[Usu_Rut] ASC,
	[Usu_SprivId] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[usuimg](
	[ID] [nchar](10) NULL,
	[FOTO] [image] NULL
) ON [PRIMARY] TEXTIMAGE_ON [PRIMARY]

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[WEBpruebaserie](
	[serie] [bigint] NOT NULL CONSTRAINT [DF_WEBpruebaserie_serie]  DEFAULT ((0))
) ON [PRIMARY]

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[webtmpdetarece](
	[drec_codi] [nvarchar](9) NULL,
	[drec_codpro] [nvarchar](7) NULL,
	[drec_codsag] [nvarchar](15) NULL,
	[drec_codsopo] [nvarchar](2) NULL,
	[drec_fecprod] [nvarchar](10) NULL,
	[drec_unidades] [int] NULL,
	[drec_peso] [float] NULL,
	[drec_sopocli] [nvarchar](11) NULL,
	[fechavencimiento] [char](10) NULL,
	[lotecliente] [nvarchar](10) NULL,
	[drec_estado] [nvarchar](50) NULL,
	[codpal] [nvarchar](9) NULL,
	[drec_temp] [float] NULL,
	[bloqueado] [nvarchar](1) NULL,
	[codtpmrece] [int] NULL,
	[drec_etiqueta] [nvarchar](20) NULL,
	[drec_arriendo] [nvarchar](1) NULL CONSTRAINT [DF_webtmpdetarece_drec_arriendo]  DEFAULT ((0))
) ON [PRIMARY]

GO
SET ANSI_PADDING OFF
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[webtmpfichrece](
	[frec_tipoalmacenamiento] [varchar](50) NULL,
	[frec_rutcli] [nvarchar](19) NULL,
	[frec_contcli] [nvarchar](7) NULL,
	[frec_horarec] [nvarchar](5) NULL,
	[frec_horater] [nvarchar](5) NULL,
	[frec_fecrec] [nvarchar](10) NULL,
	[frec_tiporecepcion] [nvarchar](1) NULL,
	[frec_guiades] [nvarchar](8) NULL,
	[frec_clfol] [nvarchar](7) NULL,
	[frec_turnrec] [nvarchar](1) NULL,
	[frec_tipdesc] [nvarchar](1) NULL,
	[frec_origen] [nvarchar](2) NULL,
	[frec_numSello] [nvarchar](25) NULL,
	[frec_observ] [nvarchar](50) NULL,
	[frec_antecamara] [nvarchar](2) NULL,
	[frec_olores] [nvarchar](2) NULL,
	[frec_higiene] [nvarchar](2) NULL,
	[frec_estiba] [nvarchar](2) NULL,
	[frec_daado] [nvarchar](2) NULL,
	[frec_RecepTunel] [int] NULL,
	[frec_abierto] [int] NULL DEFAULT ((0)),
	[frec_contenedor] [nvarchar](20) NULL,
	[frec_codigo] [nvarchar](7) NULL
) ON [PRIMARY]

GO
SET ANSI_PADDING OFF
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[webusuarios](
	[estado] [int] NULL CONSTRAINT [DF_webusuarios_estado]  DEFAULT ((0)),
	[rutclie] [varchar](50) NOT NULL,
	[pass] [nchar](10) NULL,
	[horasbloqueo] [int] NULL CONSTRAINT [DF_webusuarios_horasbloqueo]  DEFAULT ((48)),
	[pedidoe] [int] NULL CONSTRAINT [DF_webusuarios_pedidoe]  DEFAULT ((0)),
	[fechahora] [varchar](50) NULL,
	[tipo] [nchar](10) NULL CONSTRAINT [DF_webusuarios_tipo]  DEFAULT ((0)),
	[pedido] [nchar](10) NULL CONSTRAINT [DF_webusuarios_pedido]  DEFAULT ((0)),
	[nivel] [int] NULL CONSTRAINT [DF_webusuarios_nivel]  DEFAULT ((0)),
	[permisos] [nchar](20) NOT NULL CONSTRAINT [DF_webusuarios_permisos]  DEFAULT ('0000000000'),
	[nomusu] [varchar](50) NULL,
	[codfor] [varchar](18) NULL,
	[rutusu] [nchar](9) NULL,
 CONSTRAINT [PK_webusuarios] PRIMARY KEY CLUSTERED 
(
	[rutclie] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_PADDING OFF
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[webusuclie](
	[webclie_horabloqueo] [int] NULL,
	[webclie_permisos] [int] NULL,
	[webclie_nivel] [int] NULL,
	[webclie_rut] [nchar](10) NULL,
	[webclie_pass] [nchar](10) NULL,
	[webclie_usu] [nchar](10) NULL,
	[webclie_id] [int] IDENTITY(1,1) NOT NULL,
PRIMARY KEY CLUSTERED 
(
	[webclie_id] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[xrelacion](
	[unica] [uniqueidentifier] NOT NULL,
	[codigo] [nvarchar](7) NULL,
	[rut] [nvarchar](9) NULL,
 CONSTRAINT [PK_xrelacion] PRIMARY KEY NONCLUSTERED 
(
	[unica] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[ycubica](
	[cunica] [uniqueidentifier] NOT NULL CONSTRAINT [DF_ycubica_cunica]  DEFAULT (newid()),
	[crutcli] [nvarchar](9) NULL,
	[cnclie] [nvarchar](40) NULL,
	[ccodi] [nvarchar](7) NULL,
	[cenva] [nvarchar](5) NULL,
	[cdescri] [nvarchar](50) NULL,
	[calto] [float] NULL,
	[cancho] [float] NULL,
	[cfondo] [float] NULL,
	[cbase] [int] NULL,
	[caltura] [int] NULL,
 CONSTRAINT [PK_ycubica] PRIMARY KEY NONCLUSTERED 
(
	[cunica] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[yrelacion](
	[yunica] [uniqueidentifier] NOT NULL,
	[yrutcli] [nvarchar](9) NULL,
	[ycodi] [nvarchar](7) NULL,
	[yenva] [nvarchar](5) NULL,
	[ydescri] [nvarchar](50) NULL,
	[yalto] [float] NULL,
	[yancho] [float] NULL,
	[yfondo] [float] NULL,
	[ybase] [int] NULL,
	[yaltura] [int] NULL,
 CONSTRAINT [PK_yrelacion] PRIMARY KEY NONCLUSTERED 
(
	[yunica] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[zCheckList](
	[Cl_fol] [nvarchar](7) NOT NULL,
	[Cl_RutCli] [nvarchar](9) NULL,
	[Cl_chorut] [nvarchar](9) NULL,
	[Cl_ChoEmp] [nvarchar](40) NULL,
	[Cl_Tur] [numeric](18, 0) NULL,
	[Cl_Ting] [nvarchar](10) NULL,
	[Cl_Sellocli] [nvarchar](20) NULL,
	[Cl_Cont] [numeric](18, 0) NULL,
	[Cl_Ori] [nvarchar](30) NULL,
	[Cl_Gs] [nvarchar](3) NULL,
	[Cl_Mov] [numeric](18, 0) NULL,
	[Cl_fec] [date] NULL,
	[Cl_ingGuia] [nvarchar](20) NULL,
	[Cl_IngSopo] [nvarchar](50) NULL,
	[Cl_DesSopo] [nvarchar](50) NULL,
	[Cl_DesTemp] [nvarchar](10) NULL,
	[Cl_DesSello] [nvarchar](50) NULL,
	[Cl_pate] [nvarchar](10) NULL,
	[Cl_Ram] [nvarchar](20) NULL,
	[Cl_EstPor] [numeric](18, 0) NULL,
	[Cl_Estfrigo] [numeric](18, 0) NULL,
	[Cl_Lleg] [datetime] NULL,
	[Cl_CargContenedor] [datetime] NULL,
	[Cl_ing] [datetime] NULL,
	[Cl_Des] [datetime] NULL,
	[Cl_Obs] [nvarchar](500) NULL,
	[Cl_salGuia] [nvarchar](20) NULL,
	[Cl_ModUsu] [numeric](18, 0) NULL,
	[Cl_ModFecha] [date] NULL,
	[Cl_Anden] [nvarchar](30) NULL,
	[Cl_Conectado] [numeric](18, 0) NULL,
	[Cl_Tablet] [numeric](18, 0) NULL,
	[Cl_Enviada] [numeric](18, 0) NULL,
	[cod_bod] [nchar](10) NULL,
 CONSTRAINT [PK_zCheckList] PRIMARY KEY CLUSTERED 
(
	[Cl_fol] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[zcontenedores](
	[Con_codi] [numeric](18, 0) NULL,
	[Con_desc] [nvarchar](50) NULL
) ON [PRIMARY]

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[zMovimientos](
	[mov_codi] [numeric](18, 0) NOT NULL,
	[Mov_desc] [nvarchar](30) NULL,
 CONSTRAINT [PK_zMovimientos] PRIMARY KEY CLUSTERED 
(
	[mov_codi] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[zOpcionCb](
	[op_cod] [nchar](10) NOT NULL,
	[op_desc] [nchar](10) NULL,
 CONSTRAINT [PK_zOpcionCb] PRIMARY KEY CLUSTERED 
(
	[op_cod] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[zTurno](
	[Tur_id] [numeric](18, 0) NULL,
	[Tur_desc] [nvarchar](20) NULL
) ON [PRIMARY]

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[zusuario](
	[usu_cod] [numeric](18, 0) NOT NULL,
	[usu_nom] [nvarchar](20) NULL,
	[usu_usu] [nvarchar](15) NOT NULL,
	[usu_pass] [nvarchar](10) NULL,
	[usu_priv] [numeric](18, 0) NULL,
 CONSTRAINT [PK_zusuario] PRIMARY KEY CLUSTERED 
(
	[usu_cod] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

CREATE PROCEDURE [dbo].[APA_LISTARPEDIDOS] 
	(
	@terminado int
	) 
AS
	SELECT pedido, Orden, cliente+ '  '+ cli_nomb AS cliente, fecha, hora, destino, 
	(SELECT COUNT(*) FROM Pedidos_Detalle AS pd WHERE pf.pedido=pd.pedido AND pd.est='1') AS de,
	(SELECT COUNT(*) FROM Pedidos_Detalle AS pd WHERE pf.pedido=pd.pedido) AS to2, destino, encargado 
	FROM pedidos_ficha AS pf, clientes 
	WHERE cli_rut=cliente AND terminado=@terminado ORDER BY orden DESC

 RETURN

GO
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[BORRAR]
  @FECINI AS VARCHAR(10)
, @FECFIN AS VARCHAR(10)
, @RUTCLI AS VARCHAR(9)
, @CONTR AS VARCHAR(7)
, @IDENT AS NUMERIC = 0
AS
 SET NOCOUNT ON
 SET rowcount 0

    DECLARE @TOTTRAMO AS INT
    DECLARE @ESCCOD AS INT
    DECLARE @TOTDIAS AS INT


 IF @IDENT = 0
 BEGIN

    DECLARE @TABLA VARCHAR(30)
    SET @TABLA = 'TMPSERV_MINTUNEL'

    BEGIN TRAN
        DECLARE @CODI AS INT
        SET @CODI = 0

        SELECT @CODI = CODIGO + 1 FROM CORRTABLAS WHERE RTRIM(LTRIM(TABLA)) = RTRIM(LTRIM('TMPSERV_MINTUNEL'))
        IF @CODI > 0
        BEGIN

            UPDATE CORRTABLAS
            SET CODIGO = @CODI
            WHERE RTRIM(LTRIM(TABLA)) = RTRIM(LTRIM('TMPSERV_MINTUNEL'))

        END
        ELSE
            BEGIN
                ROLLBACK TRAN
                SET @CODI = -1
            END
    IF @@ERROR > 0
    BEGIN
        ROLLBACK TRAN
	SET @CODI = 0
    END
    ELSE
    BEGIN
        COMMIT TRAN
	SET @IDENT = @CODI
    END
 END 

    SELECT @TOTTRAMO = ESCALASERV.TOTTRAMAS
        , @ESCCOD = ESCALASERV.ESCCOD
    FROM ESCALASERV
    WHERE ESCALASERV.ESCCONTR = @CONTR
        AND ESCALASERV.ESCSERV = '15'

    DECLARE CURPALLET CURSOR FOR
	    SELECT CONTRATO.CONT_CODI
	    FROM CONTRATO INNER JOIN CONTRPARA
	        ON CONTRATO.CONT_CODI = CONTRPARA.CPAR_CONTR INNER JOIN ESCALASERV
	        ON CONTRPARA.CPAR_CONTR = ESCALASERV.ESCCONTR COLLATE MODERN_SPANISH_CI_AS  INNER JOIN MONEDAS
	         MONEDAS ON CONTRPARA.CPAR_MONEDA = MONEDAS.MON_CODI INNER JOIN
	         MEDIDAS ON CONVERT(INT,CONTRPARA.CPAR_MEDIDA) = CONVERT(INT,MEDIDAS.MED_CODI)
	    WHERE CONTRATO.CONT_RUTCLIE = @RUTCLI
	        AND CONTRPARA.CPAR_SERVI = '15'
	        AND ESCALASERV.TOTTRAMAS = @TOTTRAMO
	        AND ESCALASERV.ESCSERV = '15'
	     --   AND CONTRPARA.CPAR_MARCA = '1'
    OPEN CURPALLET
    FETCH NEXT FROM CURPALLET INTO @CONTR
    WHILE @@FETCH_STATUS = 0
    BEGIN

	EXEC PA_NUMERALES @FECINI, @FECFIN, @RUTCLI, @CONTR, @IDENT

        FETCH NEXT FROM CURPALLET INTO @CONTR
    END
    CLOSE CURPALLET
    DEALLOCATE CURPALLET

    SET @TOTDIAS = (DATEDIFF(DAY, CONVERT(DATETIME, @FECINI, 111), CONVERT(DATETIME, @FECFIN, 111)) + 1)


    --DROP TABLE #CONTRATOS
    SELECT CONTRPARA.CPAR_CONTR, ESCALASERV.ESCCOD, 0 AS CONT  --CONTRATO.CONT_CODI,
        , CONTRATO.CONT_DIAGRACIA
        , (CASE WHEN CONTRATO.CONT_TUNELG=0 THEN 0 ELSE CONTRATO.CONT_TUNELG-1 END) AS CONT_TUNELG
        , CONTRATO.CONT_DESCR
            , CONTRATO.CONT_DIACONT, CONTRATO.CONT_PALLET
            , 0 AS CPAR_VALOR
         , MONEDAS.MON_DESCR, MONEDAS.MON_VALOR
         , MEDIDAS.MED_DESCR
        , 0 AS STOCK
        , 0 AS UNIDADES
        , 0 AS TONELADAS
    INTO #CONTRATOS
    FROM CONTRATO INNER JOIN CONTRPARA
        ON CONTRATO.CONT_CODI = CONTRPARA.CPAR_CONTR INNER JOIN ESCALASERV
        ON CONTRPARA.CPAR_CONTR = ESCALASERV.ESCCONTR COLLATE MODERN_SPANISH_CI_AS  INNER JOIN MONEDAS
         MONEDAS ON CONTRPARA.CPAR_MONEDA = MONEDAS.MON_CODI INNER JOIN
         MEDIDAS ON CONVERT(INT,CONTRPARA.CPAR_MEDIDA) = CONVERT(INT,MEDIDAS.MED_CODI)
    WHERE CONTRATO.CONT_RUTCLIE = @RUTCLI
        AND CONTRPARA.CPAR_SERVI = '15'
        AND ESCALASERV.TOTTRAMAS = @TOTTRAMO
        AND ESCALASERV.ESCSERV = '15'
 --       AND CONTRPARA.CPAR_MARCA = '1'

    DECLARE @COD VARCHAR(7)
    DECLARE @DESDE VARCHAR(7)
    DECLARE @HASTA VARCHAR(10)
    DECLARE @VAL VARCHAR(7)

    DECLARE CURTRAMA CURSOR FOR SELECT TRAMCOD, TRAMDESDE, TRAMHASTA, TRAMVAL FROM TRAMO WHERE ESCCOD = @ESCCOD
    OPEN CURTRAMA
    FETCH NEXT FROM CURTRAMA INTO @COD, @DESDE, @HASTA, @VAL
    WHILE @@FETCH_STATUS = 0
    BEGIN

        UPDATE #CONTRATOS
        SET CONT = CONT+1
--        SELECT *
        FROM #CONTRATOS INNER JOIN TRAMO
            ON #CONTRATOS.ESCCOD = TRAMO.ESCCOD
        --WHERE TRAMO.TRAMCOD = TRAMCOD AND TRAMDESDE = @DESDE AND TRAMHASTA = @HASTA AND TRAMVAL = @VAL
        WHERE TRAMO.TRAMCOD = @COD AND TRAMDESDE = @DESDE AND TRAMHASTA = @HASTA AND TRAMVAL = @VAL

        FETCH NEXT FROM CURTRAMA INTO @COD, @DESDE, @HASTA, @VAL
    END
    CLOSE CURTRAMA
    DEALLOCATE CURTRAMA

    --DROP TABLE #CONTR
    SELECT * INTO #CONTR FROM #CONTRATOS WHERE CONT = @TOTTRAMO

    --DROP TABLE #RESUMEN
    SELECT distinct TMPDETSERVICIOS.CONTRATO AS CONTR
        , (SUM(FACTURAR) * #CONTR.CPAR_VALOR) AS VALNETO
              , SUM(CT) AS TOTCT
        , SUM(ST) AS TOTST
              , SUM(DP) AS TOTDP
        , SUM(TMPDETSERVICIOS.STOCK) AS TOTSTOCK
        , SUM(TMPDETSERVICIOS.FACTURAR) AS TOTSOP
              , SUM(TMPDETSERVICIOS.UNIDADES) AS TOTUNI
        , SUM(TMPDETSERVICIOS.TONELADAS) AS TOTTONE
        , #CONTR.MON_DESCR AS MONDESC
        , #CONTR.MON_VALOR as MONVAL
             , #CONTR.MED_DESCR AS MEDDESC
        , #CONTR.CONT_DESCR AS CONTRDESC
    INTO #RESUMEN
    FROM TMPDETSERVICIOS
        INNER JOIN #CONTR
            ON TMPDETSERVICIOS.CONTRATO = #CONTR.CPAR_CONTR COLLATE SQL_Latin1_General_CP1_CI_AS
        INNER JOIN ESCALASERV
            ON #CONTR.CPAR_CONTR = ESCALASERV.ESCCONTR COLLATE MODERN_SPANISH_CI_AS
            AND '15' = ESCALASERV.ESCSERV
    WHERE IDENT = @IDENT
    GROUP BY TMPDETSERVICIOS.CONTRATO, #CONTR.CPAR_VALOR, #CONTR.MON_DESCR, #CONTR.MON_VALOR, #CONTR.MED_DESCR, #CONTR.CONT_DESCR

    DECLARE @VALUF AS DEC(12,2)
    DECLARE @FECUF AS VARCHAR(10)
    DECLARE @VALDOLAR AS DEC(12,2)
    DECLARE @FECDOLAR AS VARCHAR(10)

    SET @VALUF = 0
    SET @FECUF = ''
    SET @VALDOLAR = 0
    SET @FECDOLAR = ''

    SELECT @VALUF = CASE WHEN MON_CODI = '02' THEN MON_VALOR ELSE @VALUF END
        , @FECUF = CASE WHEN MON_CODI = '02' THEN MON_FECVAL ELSE @FECUF END
        , @VALDOLAR = CASE WHEN MON_CODI = '01' THEN MON_VALOR ELSE @VALDOLAR END
        , @FECDOLAR = CASE WHEN MON_CODI = '01' THEN MON_FECVAL ELSE @FECDOLAR END
    FROM MONEDAS

    SET @FECUF = SUBSTRING(@FECUF, 9, 2)+'/'+SUBSTRING(@FECUF, 6, 2)+'/'+SUBSTRING(@FECUF, 1, 4)
    SET @FECDOLAR = SUBSTRING(@FECDOLAR, 9, 2)+'/'+SUBSTRING(@FECDOLAR, 6, 2)+'/'+SUBSTRING(@FECDOLAR, 1, 4)

    DECLARE @TOTALFAC  AS DEC(12,2)
    DECLARE @PROMEDIO  AS DEC(12,2)
    DECLARE @TARIFUNI AS DEC(12,2)
    SET @TOTALFAC = 0
    SET @PROMEDIO = 0
    SET @TOTDIAS = (DATEDIFF(DAY, CONVERT(DATETIME, @FECINI, 111), CONVERT(DATETIME, @FECFIN, 111)) + 1)

    SELECT @TOTALFAC = SUM(FACTURAR) FROM TMPDETSERVICIOS WHERE IDENT = @IDENT
    SET @PROMEDIO = @TOTALFAC / @TOTDIAS


    SELECT DISTINCT @TARIFUNI = TRAMVAL
    FROM CONTRATO INNER JOIN CONTRPARA
        ON CONTRATO.CONT_CODI = CONTRPARA.CPAR_CONTR INNER JOIN ESCALASERV
        ON CONTRPARA.CPAR_CONTR = ESCALASERV.ESCCONTR COLLATE MODERN_SPANISH_CI_AS  INNER JOIN TRAMO
        ON ESCALASERV.ESCCOD = TRAMO.ESCCOD
    WHERE CONTRATO.CONT_RUTCLIE = @RUTCLI
        AND ESCALASERV.ESCSERV = '15'
        AND @PROMEDIO BETWEEN TRAMDESDE AND TRAMHASTA


    SELECT DISTINCT TMPDETSERVICIOS.CONTRATO AS CONTR
        , CONTRDESC
        , TOTSOP
    FROM TMPDETSERVICIOS INNER JOIN #RESUMEN
        ON TMPDETSERVICIOS.CONTRATO = #RESUMEN.CONTR
    WHERE IDENT = @IDENT
    ORDER BY 1,2

    SELECT ISNULL(@TOTALFAC, 0) AS TOTALFAC, ISNULL(@PROMEDIO, 0) AS PROMEDIO, ISNULL(@TARIFUNI, 0) AS TARIFUNI, ISNULL((@TOTALFAC*@TARIFUNI), 0) AS TOTAL

    SELECT LINEA, TMPDETSERVICIOS.CONTRATO AS CONTR, FECHA, CT, ST, DP, STOCK, FACTURAR, UNIDADES, TONELADAS
        , MONDESC
        , MEDDESC
        , CONTRDESC
         , TOTCT, TOTST, TOTDP
         , TOTSTOCK, TOTSOP, TOTUNI, TOTTONE
         , ISNULL(@VALUF, 0) AS VALUF, ISNULL(@VALDOLAR, 0) AS VALDOLAR
         , @FECUF AS FECUF, @FECDOLAR AS FECDOLAR
         , @TOTDIAS AS DIASFACT
         , ISNULL(@TOTALFAC, 0) AS TOTALFAC
         , ISNULL(@PROMEDIO, 0) AS PROMEDIO
         , ISNULL(@TARIFUNI, 0) AS TARIFUNI
    FROM TMPDETSERVICIOS INNER JOIN #RESUMEN
        ON TMPDETSERVICIOS.CONTRATO = #RESUMEN.CONTR
    WHERE IDENT = @IDENT
    ORDER BY 2,1,3
GO
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO

CREATE PROCEDURE [dbo].[PA_ACT_DETAPRED]
  @DPRE_CODI        NVARCHAR(18),
  @DPRE_CODPRO      NVARCHAR(14),
  @DPRE_CODSOPO     NVARCHAR(04),
  @DPRE_SOPOCLI     NVARCHAR(18),
  @DPRE_UNIDADES    INT,
  @DPRE_PESO        FLOAT,
  @DPRE_FECDES      NVARCHAR(20),
  @DPRE_RUTCLI      NVARCHAR(18),
  @DPRE_CONTCLI     NVARCHAR(14),
  @DPRE_FECPROD     NVARCHAR(20),
  @DPRE_CAMARA      NVARCHAR(04),
  @DPRE_BANDA       NVARCHAR(04),
  @DPRE_COLUM       NVARCHAR(04),
  @DPRE_PISO        NVARCHAR(04),
  @DPRE_NIVEL       NVARCHAR(02),
  @DPRE_ALMACEN     TINYINT,
  @DPRE_DCAJA       TINYINT,
  @DPRE_FOLIO       NVARCHAR(18),
  @DPRE_ACTIVA      TINYINT,
  @DPRE_RADIO       TINYINT,
  @DPRE_TRACK       TINYINT,
  @DPRE_CODVIG      NVARCHAR(02),
  @DPRE_PALLET      TINYINT,
  @DPRE_SLOT        NVARCHAR(06),
  @DPRE_TS          REAL,
  @DPRE_TM          REAL,
  @DPRE_TI          REAL,
  @DPRE_CODPER      CHAR(03),
  @DPRE_HORA        VARCHAR(10),
  @DPRE_FECN        NVARCHAR(20)
--  @FOLIO_PALLET     NVARCHAR(18)
AS
  BEGIN

  IF NOT EXISTS ( SELECT   DPRE_CODI
                    FROM   DETAPRED
            WHERE  DPRE_CODI = @DPRE_CODI)

           INSERT INTO DETAPRED
         (DPRE_UNICA,
          DPRE_CODI,
          DPRE_CODPRO,
          DPRE_CODSOPO,
          DPRE_SOPOCLI,
          DPRE_UNIDADES,
          DPRE_PESO,
          DPRE_FECDES,
          DPRE_RUTCLI,
          DPRE_CONTCLI,
          DPRE_FECPROD,
          DPRE_CAMARA,
          DPRE_BANDA,
          DPRE_COLUM,
          DPRE_PISO,
          DPRE_NIVEL,
          DPRE_ALMACEN,
          DPRE_DCAJA,
          DPRE_FOLIO,
          DPRE_ACTIVA,
          DPRE_RADIO,
          DPRE_TRACK,
          DPRE_CODVIG,
          DPRE_PALLET,
          DPRE_SLOT,
          DPRE_TS,
          DPRE_TM,
          DPRE_TI,
          DPRE_CODPER,
          DPRE_HORA,
          DPRE_FECN)
        --  dpre_FOLIO_PALLET)
         VALUES
        ( NEWID(),
              @DPRE_CODI,
          @DPRE_CODPRO,
          @DPRE_CODSOPO,
          @DPRE_SOPOCLI,
          @DPRE_UNIDADES,
          @DPRE_PESO,
          @DPRE_FECDES,
          @DPRE_RUTCLI,
          @DPRE_CONTCLI,
          @DPRE_FECPROD,
          @DPRE_CAMARA,
          @DPRE_BANDA,
          @DPRE_COLUM,
          @DPRE_PISO,
          @DPRE_NIVEL,
          @DPRE_ALMACEN,
          @DPRE_DCAJA,
          @DPRE_FOLIO,
          @DPRE_ACTIVA,
          @DPRE_RADIO,
          @DPRE_TRACK,
          @DPRE_CODVIG,
          @DPRE_PALLET,
          @DPRE_SLOT,
          @DPRE_TS,
          @DPRE_TM,
          @DPRE_TI,
          @DPRE_CODPER,
          @DPRE_HORA,
          @DPRE_FECN)
        --  @FOLIO_PALLET)
END


GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
-- Autor:    CAROLINA URIBE RUIZ / ACL
-- Objetivo:    ACTUALIZA TABLA DETARECE
-- Fecha de Creacin: 26-09-2007
-- Modificaciones:
-- Pruebas
/*
exec PA_ACT_DETARECE

*/
CREATE PROCEDURE [dbo].[PA_ACT_DETARECE]
  @DREC_CODI NVARCHAR(9)
, @DREC_CODPRO NVARCHAR(7)
, @DREC_ORIGEN NVARCHAR(2)
, @DREC_CODSOPO NVARCHAR(2)
, @DREC_SOPOCLI NVARCHAR(11)
, @DREC_UNIDADES INT
, @DREC_PESO FLOAT
, @DREC_FECREC NVARCHAR(10)
, @DREC_RUTCLI NVARCHAR(9)
, @DREC_RUTPRODUCTOR VARCHAR(12)
, @DREC_CONTCLI NVARCHAR(7)
, @DREC_FECPROD NVARCHAR(10)
, @DREC_CAMARA NVARCHAR(2)
, @DREC_BANDA NVARCHAR(2)
, @DREC_COLUM NVARCHAR(2)
, @DREC_PISO NVARCHAR(2)
, @DREC_NIVEL NVARCHAR(1)
, @DREC_ALMACEN TINYINT
, @DREC_DCAJA TINYINT
, @DREC_TUNEL TINYINT
, @DREC_CODVIG NVARCHAR(1)
, @DREC_PALLET TINYINT
, @DREC_CODREL NVARCHAR(7)
, @DREC_NROSOPO INT
, @DREC_SLOT NVARCHAR(3)
, @DREC_DTGRACIA NVARCHAR(3)
, @DREC_CODSAG NVARCHAR(15)
, @DREC_TIPO INT
, @FECHAVENCIMIENTO CHAR(10)
, @LOTECLIENTE CHAR(10)
, @DREC_TS REAL
, @DREC_TM REAL
, @DREC_TI REAL
, @DREC_RECEPTUNEL INT
, @DREC_PROCTUNEL INT
, @DREC_TS_TUNEL REAL
, @DREC_TM_TUNEL REAL
, @DREC_TI_TUNEL REAL
, @DREC_CODPER CHAR(3)
, @DREC_HORA VARCHAR(10)
, @DREC_FECHOMO VARCHAR(10)
, @DREC_HORHOMO VARCHAR(10)
, @DREC_AUTHOMO INT
, @DREC_ESTADO VARCHAR(50)
, @DREC_VALOR REAL
, @DREC_MONCODI NVARCHAR(2)
, @DREC_MEDCODI NVARCHAR(3)
AS

        UPDATE DETARECE
        SET DREC_CODPRO = @DREC_CODPRO
          , DREC_ORIGEN = @DREC_ORIGEN
          , DREC_CODSOPO = @DREC_CODSOPO
          , DREC_SOPOCLI = @DREC_SOPOCLI
          , DREC_UNIDADES = @DREC_UNIDADES
          , DREC_PESO = @DREC_PESO
  --        , DREC_FECREC = @DREC_FECREC
 --         , DREC_RUTCLI = @DREC_RUTCLI
  --        , DREC_RUTPRODUCTOR = @DREC_RUTPRODUCTOR
          , DREC_CONTCLI = @DREC_CONTCLI
          , DREC_FECPROD = @DREC_FECPROD
          , DREC_CAMARA = @DREC_CAMARA
          , DREC_BANDA = @DREC_BANDA
          , DREC_COLUM = @DREC_COLUM
          , DREC_PISO = @DREC_PISO
          , DREC_NIVEL = @DREC_NIVEL
          , DREC_ALMACEN = @DREC_ALMACEN
          , DREC_DCAJA = @DREC_DCAJA
          , DREC_TUNEL = @DREC_TUNEL
          , DREC_CODVIG = @DREC_CODVIG
          , DREC_PALLET = @DREC_PALLET
          , DREC_CODREL = @DREC_CODREL
          , DREC_NROSOPO = @DREC_NROSOPO
          , DREC_SLOT = @DREC_SLOT
          , DREC_DTGRACIA = @DREC_DTGRACIA
          , DREC_CODSAG = @DREC_CODSAG
          , DREC_TIPO = @DREC_TIPO
          , FECHAVENCIMIENTO = @FECHAVENCIMIENTO
          , LOTECLIENTE = @LOTECLIENTE
          , DREC_TS = @DREC_TS
          , DREC_TM = @DREC_TM
          , DREC_TI = @DREC_TI
          , DREC_RECEPTUNEL = @DREC_RECEPTUNEL
         -- , DREC_PROCTUNEL = @DREC_PROCTUNEL--
          , DREC_TS_TUNEL = @DREC_TS_TUNEL
          , DREC_TM_TUNEL = @DREC_TM_TUNEL
          , DREC_TI_TUNEL = @DREC_TI_TUNEL
        --  , DREC_CODPER = @DREC_CODPER
       --   , DREC_HORA = @DREC_HORA
      --    , DREC_FECHOMO = @DREC_FECHOMO
      --    , DREC_HORHOMO = @DREC_HORHOMO
          , DREC_AUTHOMO = @DREC_AUTHOMO
          , DREC_ESTADO = @DREC_ESTADO
          , DREC_VALOR = @DREC_VALOR
          , DREC_MONCODI = @DREC_MONCODI 
          , DREC_MEDCODI = @DREC_MEDCODI
        WHERE DREC_CODI =  @DREC_CODI

	Update detadespa
	Set ddes_contcli = @DREC_CONTCLI
	 WHERE DDES_CODRECE =  @DREC_CODI


	Update detapred
	Set dpre_contcli = @DREC_CONTCLI
	 WHERE Dpre_folio =  @DREC_CODI
GO
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO





-- Autor:    CAROLINA URIBE RUIZ / ACL
-- Objetivo:    ACTUALIZA TABLA DETCAJAS
-- Fecha de Creacin: 26-09-2007
-- Modificaciones:
-- Pruebas
/*
exec PA_ACT_DETCAJAS
*/
CREATE PROCEDURE [dbo].[PA_ACT_DETCAJAS]
  @DETC_PALLET NVARCHAR(11)
, @DETC_FPROD NVARCHAR(10)
, @DETC_FVENC NVARCHAR(10)
, @DETC_CANTIDAD NVARCHAR(10)
AS

    IF NOT EXISTS (SELECT DETC_PALLET FROM DETCAJAS WHERE DETC_PALLET= DETC_PALLET)

        INSERT INTO DETCAJAS(
          DETC_PALLET, DETC_FPROD, DETC_FVENC, DETC_CANTIDAD)
        VALUES(
          @DETC_PALLET, @DETC_FPROD, @DETC_FVENC, @DETC_CANTIDAD)

    ELSE

        UPDATE DETCAJAS
        SET DETC_FPROD = @DETC_FPROD
              , DETC_FVENC = @DETC_FVENC
              , DETC_CANTIDAD = @DETC_CANTIDAD
        WHERE DETC_PALLET = @DETC_PALLET


GO
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO




-- Autor:    Carolina Uribe Ruiz - ACL
-- Objetivo:    ACTUALIZA TABLA CONTRPARA, AL INGRESAR ESCALAS Y TRAMOS

-- Fecha de Creacin:    20-07-2007
-- Modificaciones:
-- Pruebas
/*
exec PA_UPD_ESCALASERV '0002900', '15', 2

*/


CREATE PROCEDURE [dbo].[PA_ACT_ESCALASERV]
  @ESCCONTR VARCHAR(7)
, @ESCSERV VARCHAR(2)
, @TOTTRAMAS INT
AS

    SET NOCOUNT ON

    IF NOT EXISTS (SELECT * FROM CONTRPARA WHERE CPAR_CONTR = @ESCCONTR AND CPAR_SERVI = @ESCSERV)
        INSERT INTO CONTRPARA
            ( CPAR_CONTR, CPAR_SERVI, CPAR_MARCA, CPAR_VALOR, CPAR_MONEDA, CPAR_MEDIDA, CPAR_CODVIG)
        VALUES
            (@ESCCONTR, @ESCSERV, '1', 0, '00', '',0 )
    ELSE
        UPDATE CONTRPARA
        SET CPAR_MARCA = CASE WHEN @TOTTRAMAS > 0 THEN 1 ELSE 0 END
        WHERE CPAR_CONTR = @ESCCONTR
            AND CPAR_SERVI = @ESCSERV

    RETURN 0


GO
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO



CREATE PROCEDURE [dbo].[PA_ACT_FICHPRED]
@FPRE_CODI    NVARCHAR(14),
@FPRE_CODVIG  NVARCHAR(02)
AS
    UPDATE FICHPRED
    SET    FPRE_CODVIG  = @FPRE_CODVIG
    WHERE  FPRE_CODI    = @FPRE_CODI


GO
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
-- Autor:    CAROLINA URIBE RUIZ / ACL
-- Objetivo:    ACTUALIZA TABLA FICHRECE
-- Fecha de Creacin: 26-09-2007
-- Modificaciones:
-- Pruebas
/*
exec PA_ACT_TMPFICHRECE
*/
CREATE PROCEDURE [dbo].[PA_ACT_FICHRECE]
  @FREC_CODI NVARCHAR(7)
, @FREC_RUTCLI NVARCHAR(9)
, @FREC_RUTPRODUCTOR VARCHAR(12)
, @FREC_CONTCLI NVARCHAR(7)
, @FREC_HORALLEG NVARCHAR(5)
, @FREC_HORAREC NVARCHAR(5)
, @FREC_HORATER NVARCHAR(5)
, @FREC_TURNREC NVARCHAR(1)
, @FREC_FECPROC NVARCHAR(10)
, @FREC_FECREC NVARCHAR(10)
, @FREC_GUIADES NVARCHAR(8)
, @FREC_TIPENTR NVARCHAR(2)
, @FREC_TOTSOPO INT
, @FREC_TOTUNIDAD INT
, @FREC_TOTPESO FLOAT
, @FREC_TEMPPRO REAL
, @FREC_RUTCOND NVARCHAR(9)
, @FREC_OBSERV NVARCHAR(50)
, @FREC_TIPDESC NVARCHAR(1)
, @FREC_CODIENCA NVARCHAR(3)
, @FREC_ORIGEN NVARCHAR(2)
, @FREC_CODVIG NVARCHAR(1)
, @FREC_RADIO NVARCHAR(1)
, @FREC_TIPO INT
, @FREC_RECEPTUNEL INT
, @FREC_ASPECTOSANITARIO NVARCHAR(15)
, @FREC_CONDGENERAL INT
, @FREC_PROCEDENCIA CHAR(10)
AS


        UPDATE FICHRECE
        SET --FREC_RUTCLI = @FREC_RUTCLI
 --         , FREC_RUTPRODUCTOR = @FREC_RUTPRODUCTOR
            FREC_CONTCLI = @FREC_CONTCLI
--          , FREC_HORALLEG = @FREC_HORALLEG
--          , FREC_HORAREC = @FREC_HORAREC
--          , FREC_HORATER = @FREC_HORATER
           , FREC_TURNREC = @FREC_TURNREC
--          , FREC_FECPROC = @FREC_FECPROC
--          , FREC_FECREC = @FREC_FECREC
          , FREC_GUIADES = @FREC_GUIADES
          , FREC_TIPENTR = @FREC_TIPENTR
          , FREC_TOTSOPO = @FREC_TOTSOPO
          , FREC_TOTUNIDAD = @FREC_TOTUNIDAD
          , FREC_TOTPESO = @FREC_TOTPESO
          , FREC_TEMPPRO = @FREC_TEMPPRO
          , FREC_RUTCOND = @FREC_RUTCOND
          , FREC_OBSERV = @FREC_OBSERV
          , FREC_TIPDESC = @FREC_TIPDESC
      --    , FREC_CODIENCA = @FREC_CODIENCA
          , FREC_ORIGEN = @FREC_ORIGEN
          , FREC_CODVIG = @FREC_CODVIG
          , FREC_RADIO = @FREC_RADIO
          , FREC_TIPO = @FREC_TIPO
          , FREC_RECEPTUNEL = @FREC_RECEPTUNEL
          , FREC_ASPECTOSANITARIO = @FREC_ASPECTOSANITARIO
          , FREC_CONDGENERAL = @FREC_CONDGENERAL
          , FREC_PROCEDENCIA = @FREC_PROCEDENCIA
        --  , EST_CODI = @EST_CODI
        WHERE FREC_CODI = @FREC_CODI

             UPDATE detaRECE SET drec_CONTCLI = @FREC_CONTCLI 
	WHERE substring(DREC_CODI,1,7) =   @fREC_CODI

	Update detadespa
	Set ddes_contcli =  @FREC_CONTCLI 
	 WHERE substring(DDES_CODRECE,1,7) =  @fREC_CODI

	Update detapred
	Set dpre_contcli = @FREC_CONTCLI 
	 WHERE substring(Dpre_folio,1,7) =  @fREC_CODI
GO
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO





-- Autor:    CAROLINA URIBE RUIZ / ACL
-- Objetivo:    ACTUALIZA TABLA FICHTUNEL
-- Fecha de Creacin: 13-09-2007
-- Modificaciones:
-- Pruebas
/*
exec PA_ACT_FICHTUNEL

*/
CREATE PROCEDURE [dbo].[PA_ACT_FICHTUNEL]
  @FTUN_CODI NVARCHAR(7)
, @FTUN_RUTCLI NVARCHAR(9)
, @FTUN_CONTCLI NVARCHAR(7)
, @FTUN_HORALLEG NVARCHAR(5)
, @FTUN_HORAREC NVARCHAR(5)
, @FTUN_HORATER NVARCHAR(5)
, @FTUN_TURNREC NVARCHAR(1)
, @FTUN_FECPROC NVARCHAR(10)
, @FTUN_FECREC NVARCHAR(10)
, @FTUN_GUIADES NVARCHAR(8)
, @FTUN_TIPENTR NVARCHAR(2)
, @FTUN_TOTSOPO INT
, @FTUN_TOTUNIDAD INT
, @FTUN_TOTPESO FLOAT
, @FTUN_CTOTSOPO INT
, @FTUN_CTOTUNIDAD INT
, @FTUN_CTOTPESO FLOAT
, @FTUN_ETOTSOPO INT
, @FTUN_ETOTUNIDAD INT
, @FTUN_ETOTPESO FLOAT
, @FTUN_TEMPPRO REAL
, @FTUN_TEMPSAL REAL
, @FTUN_RUTCOND NVARCHAR(9)
, @FTUN_OBSERV NVARCHAR(50)
, @FTUN_TIPDESC NVARCHAR(1)
, @FTUN_CODIENCA NVARCHAR(3)
, @FTUN_CODVIG NVARCHAR(1)
AS

    IF NOT EXISTS (SELECT FTUN_CODI FROM FICHTUNEL WHERE FTUN_CODI = @FTUN_CODI)

        INSERT INTO FICHTUNEL(
            FTUN_CODI, FTUN_RUTCLI, FTUN_CONTCLI, FTUN_HORALLEG, FTUN_HORAREC, FTUN_HORATER, FTUN_TURNREC
           , FTUN_FECPROC, FTUN_FECREC, FTUN_GUIADES, FTUN_TIPENTR, FTUN_TOTSOPO, FTUN_TOTUNIDAD, FTUN_TOTPESO
           , FTUN_CTOTSOPO, FTUN_CTOTUNIDAD, FTUN_CTOTPESO, FTUN_ETOTSOPO, FTUN_ETOTUNIDAD, FTUN_ETOTPESO
           , FTUN_TEMPPRO, FTUN_TEMPSAL, FTUN_RUTCOND, FTUN_OBSERV, FTUN_TIPDESC, FTUN_CODIENCA, FTUN_CODVIG)
        VALUES(
            @FTUN_CODI, @FTUN_RUTCLI, @FTUN_CONTCLI, @FTUN_HORALLEG, @FTUN_HORAREC, @FTUN_HORATER,
@FTUN_TURNREC
           , @FTUN_FECPROC, @FTUN_FECREC, @FTUN_GUIADES, @FTUN_TIPENTR, @FTUN_TOTSOPO, @FTUN_TOTUNIDAD,
@FTUN_TOTPESO
           , @FTUN_CTOTSOPO, @FTUN_CTOTUNIDAD, @FTUN_CTOTPESO, @FTUN_ETOTSOPO, @FTUN_ETOTUNIDAD, @FTUN_ETOTPESO
           , @FTUN_TEMPPRO, @FTUN_TEMPSAL, @FTUN_RUTCOND, @FTUN_OBSERV, @FTUN_TIPDESC, @FTUN_CODIENCA,
@FTUN_CODVIG)

    ELSE

        UPDATE FICHTUNEL
        SET FTUN_RUTCLI = @FTUN_RUTCLI
          , FTUN_CONTCLI = @FTUN_CONTCLI
--          , FTUN_HORALLEG = @FTUN_HORALLEG
--          , FTUN_HORAREC = @FTUN_HORAREC
--          , FTUN_HORATER = @FTUN_HORATER
          , FTUN_TURNREC = @FTUN_TURNREC
--          , FTUN_FECPROC = @FTUN_FECPROC
          , FTUN_FECREC = @FTUN_FECREC
          , FTUN_GUIADES = @FTUN_GUIADES
          , FTUN_TIPENTR = @FTUN_TIPENTR
          , FTUN_TOTSOPO = @FTUN_TOTSOPO
          , FTUN_TOTUNIDAD = @FTUN_TOTUNIDAD
          , FTUN_TOTPESO = @FTUN_TOTPESO
          , FTUN_CTOTSOPO = @FTUN_CTOTSOPO
          , FTUN_CTOTUNIDAD = @FTUN_CTOTUNIDAD
          , FTUN_CTOTPESO = @FTUN_CTOTPESO
          , FTUN_ETOTSOPO = @FTUN_ETOTSOPO
          , FTUN_ETOTUNIDAD = @FTUN_ETOTUNIDAD
          , FTUN_ETOTPESO = @FTUN_ETOTPESO
          , FTUN_TEMPPRO = @FTUN_TEMPPRO
          , FTUN_TEMPSAL = @FTUN_TEMPSAL
          , FTUN_RUTCOND = @FTUN_RUTCOND
          , FTUN_OBSERV = @FTUN_OBSERV
          , FTUN_TIPDESC = @FTUN_TIPDESC
          , FTUN_CODIENCA = @FTUN_CODIENCA
           , FTUN_CODVIG = @FTUN_CODVIG
        WHERE FTUN_CODI = @FTUN_CODI


GO
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO




-- Autor:    CAROLINA URIBE RUIZ / ACL
-- Objetivo:    ACTUALIZA TABLA MOVPALLET
-- Fecha de Creacin: 13-09-2007
-- Modificaciones:
-- Pruebas
/*
exec PA_ACT_MOVPALLET
*/
CREATE PROCEDURE [dbo].[PA_ACT_MOVPALLET]
  @MOV_FOLIO NVARCHAR(9)
, @MOV_CODPER NVARCHAR(3)
, @MOV_CA NVARCHAR(2)
, @MOV_BA NVARCHAR(3)
, @MOV_CO NVARCHAR(2)
, @MOV_PI NVARCHAR(2)
, @MOV_NI NVARCHAR(1)
, @MOV_FECHA NVARCHAR(10)
, @MOV_TIPO NVARCHAR(2)
, @MOV_HORA NVARCHAR(10)
, @MOV_TS REAL
, @MOV_TM REAL
, @MOV_TI REAL
, @MOV_DOC NVARCHAR(10)
, @MOV_RECEPTUNEL INT
, @MOV_DESPACHO INT
, @MOV_SALDO INT
, @MOV_DOCDESPA NVARCHAR(9)
, @MOV_CHORUT NVARCHAR(10)
, @MOV_CHONOM NVARCHAR(50)
, @MOV_CHOPAT NVARCHAR(10)
, @MOV_CHOTRA NVARCHAR(50)
, @MOV_ANDEN NVARCHAR(10)
AS

    IF NOT EXISTS (SELECT MOV_FOLIO FROM MOVPALLET WHERE MOV_FOLIO = @MOV_FOLIO AND  MOV_TIPO='EN'  --MOV_FECHA=@MOV_FECHA AND
)

        INSERT INTO MOVPALLET(
             MOV_FOLIO, MOV_CODPER, MOV_CA, MOV_BA, MOV_CO, MOV_PI, MOV_NI, MOV_FECHA, MOV_TIPO
           , MOV_HORA, MOV_TS, MOV_TM, MOV_TI, MOV_DOC, MOV_RECEPTUNEL, MOV_DESPACHO, MOV_SALDO
           , MOV_DOCDESPA, MOV_CHORUT , MOV_CHONOM, MOV_CHOPAT, MOV_CHOTRA, MOV_ANDEN)
        VALUES(
             @MOV_FOLIO, @MOV_CODPER, @MOV_CA, @MOV_BA, @MOV_CO, @MOV_PI, @MOV_NI, RIGHT(@MOV_FECHA,4)+'/'+SUBSTRING(@MOV_FECHA,4,2) +'/'+LEFT(@MOV_FECHA,2), @MOV_TIPO
           , @MOV_HORA, @MOV_TS, @MOV_TM, @MOV_TI, @MOV_DOC, @MOV_RECEPTUNEL, NULL, NULL
           , NULL, @MOV_CHORUT , @MOV_CHONOM, @MOV_CHOPAT, @MOV_CHOTRA, @MOV_ANDEN)

    ELSE

        UPDATE MOVPALLET
        SET MOV_CODPER = @MOV_CODPER
          --, MOV_CA = @MOV_CA
          --, MOV_BA = @MOV_BA
          --, MOV_CO = @MOV_CO
         -- , MOV_PI = @MOV_PI
         -- , MOV_NI = @MOV_NI
          , MOV_TIPO = @MOV_TIPO
          , MOV_TS = @MOV_TS
          , MOV_TM = @MOV_TM
          , MOV_TI = @MOV_TI
          , MOV_DOC = @MOV_DOC
          , MOV_RECEPTUNEL = @MOV_RECEPTUNEL
          , MOV_DESPACHO = @MOV_DESPACHO
          , MOV_SALDO = @MOV_SALDO
          , MOV_DOCDESPA = @MOV_DOCDESPA
          , MOV_CHORUT = @MOV_CHORUT
          , MOV_CHONOM = @MOV_CHONOM
          , MOV_CHOPAT = @MOV_CHOPAT
          , MOV_CHOTRA = @MOV_CHOTRA
          , MOV_ANDEN = @MOV_ANDEN
        WHERE MOV_FOLIO = @MOV_FOLIO
  --  AND MOV_FECHA=@MOV_FECHA
    AND MOV_TIPO='EN'
GO
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO



CREATE PROCEDURE [dbo].[PA_ACT_RACKDETA]
@RACD_CODI           NVARCHAR(18),
@RACD_CA         NVARCHAR(04),
@RACD_BA          NVARCHAR(04),
@RACD_CO         NVARCHAR(04),
@RACD_PI         NVARCHAR(04),
@RACD_NI         NVARCHAR(02),
@RACD_CODPRO         NVARCHAR(14),
@RACD_UNIDADES         INT,
@RACD_PESO         FLOAT,
@RACD_FECPRO         NVARCHAR(20),
@RACD_CORE         TINYINT,
@RACD_CODE         TINYINT,
@FECHAVENCIMIENTO    CHAR(10),
@LOTECLIENTE         CHAR(10),
@RACD_PEDIDO         NVARCHAR(04),
@RACD_PEDIDO_FEC     NVARCHAR(20),
@RACD_PEDIDO_HOR     NVARCHAR(10)
AS
UPDATE RACKDETA
SET   RACD_CA              =    @RACD_CA,
      RACD_BA               =    @RACD_BA,
      RACD_CO              =    @RACD_CO,
      RACD_PI              =    @RACD_PI,
      RACD_NI              =    @RACD_NI,
      RACD_CODPRO      =    @RACD_CODPRO,
      RACD_UNIDADES       =    @RACD_UNIDADES,
      RACD_PESO              =    @RACD_PESO,
      RACD_FECPRO      =    @RACD_FECPRO,
      RACD_CORE              =    @RACD_CORE,
      RACD_CODE              =    @RACD_CODE,
      FECHAVENCIMIENTO    =    @FECHAVENCIMIENTO,
      LOTECLIENTE      =    @LOTECLIENTE,
      RACD_PEDIDO      =    @RACD_PEDIDO,
      RACD_PEDIDO_FEC     =    @RACD_PEDIDO_FEC,
      RACD_PEDIDO_HOR     =    @RACD_PEDIDO_HOR
WHERE RACD_CODI  = @RACD_CODI


GO
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO



CREATE PROCEDURE [dbo].[PA_ACT_SLOTDETA]
@SLOD_CODI    NVARCHAR(32),
@SLOD_CODE    TINYINT
AS
   UPDATE SLOTDETA
   SET   SLOD_CODE = @SLOD_CODE
   WHERE SLOD_CODI = @SLOD_CODI


GO
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO





-- Autor:    CAROLINA URIBE RUIZ / ACL
-- Objetivo:    ACTUALIZA TABLA TMPCHOFERES
-- Fecha de Creacin: 13-09-2007
-- Modificaciones:
-- Pruebas
/*
exec PA_ACT_TMPCHOFERES

*/
CREATE PROCEDURE [dbo].[PA_ACT_TMPCHOFERES]
  @FREC_CODI NVARCHAR(7)
, @CHO_RUT NVARCHAR(9)
, @CHO_RUTCLIE NVARCHAR(9)
, @CHO_NOMBRE NVARCHAR(40)
, @CHO_PATENTE NVARCHAR(10)
, @CHO_EMPRESA NVARCHAR(35)
AS

    IF NOT EXISTS (SELECT FREC_CODI FROM TMPCHOFERES WHERE FREC_CODI = @FREC_CODI)

        INSERT INTO TMPCHOFERES(
            FREC_CODI, CHO_RUT, CHO_RUTCLIE, CHO_NOMBRE, CHO_PATENTE, CHO_EMPRESA)
        VALUES(
            @FREC_CODI, @CHO_RUT, @CHO_RUTCLIE, @CHO_NOMBRE, @CHO_PATENTE, @CHO_EMPRESA)

    ELSE

        UPDATE TMPCHOFERES
        SET FREC_CODI = @FREC_CODI
          , CHO_RUT = @CHO_RUT
          , CHO_RUTCLIE = @CHO_RUTCLIE
          , CHO_NOMBRE = @CHO_NOMBRE
          , CHO_PATENTE = @CHO_PATENTE
          , CHO_EMPRESA = @CHO_EMPRESA
        WHERE FREC_CODI = @FREC_CODI


GO
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO



CREATE PROCEDURE [dbo].[PA_ACT_TMPCORREL]
@TMPC_CODI        NVARCHAR,
@TMPC_USUARIO   NVARCHAR,
@TMPC_PERSONAL  SMALLINT,
@TMPC_FECHAINI  NVARCHAR,
@TMPC_HORAINI   NVARCHAR,
@TMPC_FECHATER  NVARCHAR,
@TMPC_HORATER   NVARCHAR,
@TMPC_PROCESO   TINYINT
AS
 BEGIN
      IF NOT EXISTS ( SELECT TMPC_CODI
                  FROM      TMPCORREL
          WHERE  TMPC_CODI = @TMPC_CODI)


           INSERT INTO TMPCORREL
           ( TMPC_UNICA,
                     TMPC_CODI,
             TMPC_USUARIO,
             TMPC_PERSONAL,
             TMPC_FECHAINI,
             TMPC_HORAINI,
             TMPC_FECHATER,
             TMPC_HORATER,
             TMPC_PROCESO)
            VALUES
            (newid(),
                     @TMPC_CODI,
             @TMPC_USUARIO,
             @TMPC_PERSONAL,
             @TMPC_FECHAINI,
             @TMPC_HORAINI,
             @TMPC_FECHATER,
             @TMPC_HORATER,
             @TMPC_PROCESO)
    ELSE
             UPDATE TMPCORREL
              SET TMPC_USUARIO  = @TMPC_USUARIO,
                  TMPC_PERSONAL = @TMPC_PERSONAL,
                  TMPC_FECHAINI = @TMPC_FECHAINI,
                  TMPC_HORAINI  = @TMPC_HORAINI,
                  TMPC_FECHATER = @TMPC_FECHATER,
                  TMPC_HORATER  = @TMPC_HORATER,
                  TMPC_PROCESO  = @TMPC_PROCESO
             WHERE TMPC_CODI    = @TMPC_CODI
   END


GO
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO

CREATE PROCEDURE [dbo].[PA_ACT_TMPDETAPRED]
     @FPRE_CODI        NVARCHAR(7),
            @DPRE_CODI        NVARCHAR(2),
    @DPRE_CODPRO      NVARCHAR(7),
    @DPRE_CODSOPO      NVARCHAR(2),
    @DPRE_SOPOCLI      NVARCHAR(11),
    @DPRE_UNIDADES     INT,
    @DPRE_PESO         FLOAT,
    @DPRE_FECDES       NVARCHAR(10),
    @DPRE_RUTCLI       NVARCHAR(9),
    @DPRE_CONTCLI      NVARCHAR(7),
    @DPRE_FECPROD      NVARCHAR(10),
    @DPRE_CAMARA       NVARCHAR(2),
    @DPRE_BANDA        NVARCHAR(2),
    @DPRE_COLUM        NVARCHAR(2),
    @DPRE_PISO         NVARCHAR(2),
    @DPRE_NIVEL        NVARCHAR(1),
    @DPRE_ALMACEN      TINYINT,
    @DPRE_DCAJA        TINYINT,
    @DPRE_FOLIO        NVARCHAR(9),
    @DPRE_ACTIVA       TINYINT,
    @DPRE_RADIO        TINYINT ,
    @DPRE_TRACK        TINYINT ,
    @DPRE_CODVIG       NVARCHAR(1),
    @DPRE_PALLET       TINYINT,
    @DPRE_SLOT         NVARCHAR(3),
    @DPRE_TS           REAL,
    @DPRE_TM           REAL,
    @DPRE_TI           REAL,
    @DPRE_CODPER       CHAR(3),
    @DPRE_HORA         VARCHAR(10),
    @DPRE_FECN         NVARCHAR(10),
    @DPRE_PTR    INT,
    @DPRE_PICK    INT,
    @DPRE_ACTUNI   INT,
    @DPRE_TOTUNI    INT
--        @DPRE_CORRELATIVO  INT,
--        @DPRE_FOLIO_PALLET NVARCHAR(18)
    AS
           BEGIN
          IF NOT EXISTS ( SELECT DPRE_CODI
                                  FROM      TMPDETAPRED
                  WHERE  FPRE_CODI = @FPRE_CODI AND DPRE_PTR = @DPRE_PTR)
--                                    AND  DPRE_CODI = @DPRE_CODI )

             INSERT INTO TMPDETAPRED
                (FPRE_CODI, DPRE_CODI, DPRE_CODPRO,  DPRE_CODSOPO,    DPRE_SOPOCLI,
                 DPRE_UNIDADES,  DPRE_PESO,    DPRE_FECDES,     DPRE_RUTCLI,
                 DPRE_CONTCLI,   DPRE_FECPROD, DPRE_CAMARA,     DPRE_BANDA,
                      DPRE_COLUM,     DPRE_PISO,    DPRE_NIVEL,      DPRE_ALMACEN,
                     DPRE_DCAJA,     DPRE_FOLIO,   DPRE_ACTIVA,     DPRE_RADIO,
                       DPRE_TRACK,     DPRE_CODVIG,  DPRE_PALLET,     DPRE_SLOT,
                     DPRE_TS,        DPRE_TM,      DPRE_TI,         DPRE_CODPER,
                     DPRE_HORA,      DPRE_FECN, DPRE_PTR, DPRE_PICK, DPRE_ACTUNI, DPRE_TOTUNI)--,    DPRE_CORRELATIVO , DPRE_FOLIO_PALLET)
                  VALUES
                                (@FPRE_CODI, @DPRE_CODI, @DPRE_CODPRO,  @DPRE_CODSOPO,     @DPRE_SOPOCLI,
                 @DPRE_UNIDADES,  @DPRE_PESO,    @DPRE_FECDES,      @DPRE_RUTCLI,
                 @DPRE_CONTCLI,   @DPRE_FECPROD, @DPRE_CAMARA,      @DPRE_BANDA,
                      @DPRE_COLUM,     @DPRE_PISO,    @DPRE_NIVEL,       @DPRE_ALMACEN,
                     @DPRE_DCAJA,     @DPRE_FOLIO,   @DPRE_ACTIVA,      @DPRE_RADIO,
                       @DPRE_TRACK,     @DPRE_CODVIG,  @DPRE_PALLET,      @DPRE_SLOT,
                     @DPRE_TS,        @DPRE_TM,      @DPRE_TI,          @DPRE_CODPER,
                     @DPRE_HORA,      @DPRE_FECN, @DPRE_PTR, @DPRE_PICK, @DPRE_ACTUNI, @DPRE_TOTUNI) --,    @DPRE_CORRELATIVO, @DPRE_FOLIO_PALLET )

            ELSE
                     UPDATE TMPDETAPRED
                 SET   DPRE_CODI            = @DPRE_CODI,
                  DPRE_CODPRO     = @DPRE_CODPRO,
                  DPRE_CODSOPO   = @DPRE_CODSOPO,
                  DPRE_SOPOCLI     = @DPRE_SOPOCLI,
                  DPRE_UNIDADES = @DPRE_UNIDADES,
                  DPRE_PESO         = @DPRE_PESO,
                  DPRE_FECDES    = @DPRE_FECDES,
                  DPRE_RUTCLI     = @DPRE_RUTCLI,
                  DPRE_CONTCLI  = @DPRE_CONTCLI,
                  DPRE_FECPROD = DPRE_FECPROD,
                  DPRE_CAMARA = @DPRE_CAMARA,
                  DPRE_BANDA  = @DPRE_BANDA,
                  DPRE_COLUM    = @DPRE_COLUM,
                  DPRE_PISO         = @DPRE_PISO,
                  DPRE_NIVEL        = @DPRE_NIVEL,
                  DPRE_ALMACEN      = @DPRE_ALMACEN,
                  DPRE_DCAJA        = @DPRE_DCAJA,
                  DPRE_FOLIO        = @DPRE_FOLIO,
                  DPRE_ACTIVA       = @DPRE_ACTIVA,
                  DPRE_RADIO        = @DPRE_RADIO,
                  DPRE_TRACK        = @DPRE_TRACK,
                  DPRE_CODVIG       = @DPRE_CODVIG,
                  DPRE_PALLET       = @DPRE_PALLET,
                  DPRE_SLOT         = @DPRE_SLOT,
                  DPRE_TS           = @DPRE_TS,
                  DPRE_TM           = @DPRE_TM,
                  DPRE_TI           = @DPRE_TI,
                  DPRE_CODPER       = @DPRE_CODPER,
                  DPRE_HORA         = @DPRE_HORA,
                  DPRE_FECN         = @DPRE_FECN,
                  DPRE_PTR = @DPRE_PTR,
                  DPRE_PICK= @DPRE_PICK,
                  DPRE_ACTUNI = @DPRE_ACTUNI,
                  DPRE_TOTUNI = @DPRE_TOTUNI
--                                  DPRE_FOLIO_PALLET = @DPRE_FOLIO_PALLET
                WHERE FPRE_CODI = @FPRE_CODI
                AND  DPRE_PTR = @DPRE_PTR
--                                    AND  DPRE_CODI = @DPRE_CODI
                        END


GO
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER ON
GO
-- Autor:    CAROLINA URIBE RUIZ / ACL
-- Objetivo:    ACTUALIZA TABLA TMPDETARECE
-- Fecha de Creacin: 12-09-2007
-- Modificaciones:
-- Pruebas
/*
exec PA_ACT_TMPDETARECE
*/
CREATE PROCEDURE [dbo].[PA_ACT_TMPDETARECE]
  @FREC_CODI NVARCHAR(7)
, @DREC_CODI NVARCHAR(2)
, @DREC_CODPRO NVARCHAR(7)
, @DREC_ORIGEN NVARCHAR(2)
, @DREC_CODSOPO NVARCHAR(2)
, @DREC_SOPOCLI NVARCHAR(11)
, @DREC_UNIDADES INT
, @DREC_PESO FLOAT
, @DREC_FECREC NVARCHAR(10)
, @DREC_RUTCLI NVARCHAR(9)
, @DREC_RUTPRODUCTOR VARCHAR(12)
, @DREC_CONTCLI NVARCHAR(7)
, @DREC_FECPROD NVARCHAR(10)
, @DREC_CAMARA NVARCHAR(2)
, @DREC_BANDA NVARCHAR(2)
, @DREC_COLUM NVARCHAR(2)
, @DREC_PISO NVARCHAR(2)
, @DREC_NIVEL NVARCHAR(1)
, @DREC_ALMACEN TINYINT
, @DREC_DCAJA TINYINT
, @DREC_TUNEL TINYINT
, @DREC_CODVIG NVARCHAR(1)
, @DREC_PALLET TINYINT
, @DREC_CODREL NVARCHAR(7)
, @DREC_NROSOPO INT
, @DREC_SLOT NVARCHAR(3)
, @DREC_DTGRACIA NVARCHAR(3)
, @DREC_CODSAG NVARCHAR(10)
, @DREC_TIPO INT
, @FECHAVENCIMIENTO CHAR(10)
, @LOTECLIENTE CHAR(10)
, @DREC_TS REAL
, @DREC_TM REAL
, @DREC_TI REAL
, @DREC_RECEPTUNEL INT
, @DREC_PROCTUNEL INT
, @DREC_TS_TUNEL REAL
, @DREC_TM_TUNEL REAL
, @DREC_TI_TUNEL REAL
, @DREC_CODPER CHAR(3)
, @DREC_HORA VARCHAR(10)
, @DREC_FECHOMO VARCHAR(10)
, @DREC_HORHOMO VARCHAR(10)
, @DREC_AUTHOMO INT
, @DREC_ESTADO VARCHAR(50)
, @DREC_OCUP INT
, @DREC_VALOR REAL
, @DREC_MONCODI NVARCHAR(2)
, @DREC_MEDCODI NVARCHAR(3)
AS

    IF NOT EXISTS (SELECT FREC_CODI FROM TMPDETARECE WHERE FREC_CODI = @FREC_CODI AND DREC_CODI =  @DREC_CODI)

        INSERT INTO TMPDETARECE(
          FREC_CODI, DREC_CODI, DREC_CODPRO, DREC_ORIGEN, DREC_CODSOPO, DREC_SOPOCLI, DREC_UNIDADES, DREC_PESO,
DREC_FECREC
        , DREC_RUTCLI, DREC_RUTPRODUCTOR, DREC_CONTCLI, DREC_FECPROD, DREC_CAMARA, DREC_BANDA, DREC_COLUM,
DREC_PISO
        , DREC_NIVEL, DREC_ALMACEN, DREC_DCAJA, DREC_TUNEL, DREC_CODVIG, DREC_PALLET, DREC_CODREL, DREC_NROSOPO,
DREC_SLOT
        , DREC_DTGRACIA, DREC_CODSAG, DREC_TIPO, FECHAVENCIMIENTO, LOTECLIENTE, DREC_TS, DREC_TM, DREC_TI,
DREC_RECEPTUNEL
        , DREC_PROCTUNEL, DREC_TS_TUNEL, DREC_TM_TUNEL, DREC_TI_TUNEL, DREC_CODPER, DREC_HORA, DREC_FECHOMO,
DREC_HORHOMO
        , DREC_AUTHOMO, DREC_ESTADO, DREC_OCUP, DREC_VALOR, DREC_MONCODI,DREC_MEDCODI)
        VALUES(
          @FREC_CODI, @DREC_CODI , @DREC_CODPRO, @DREC_ORIGEN, @DREC_CODSOPO, @DREC_SOPOCLI, @DREC_UNIDADES
        , @DREC_PESO, @DREC_FECREC, @DREC_RUTCLI, @DREC_RUTPRODUCTOR, @DREC_CONTCLI, @DREC_FECPROD, @DREC_CAMARA
        , @DREC_BANDA, @DREC_COLUM, @DREC_PISO, @DREC_NIVEL, @DREC_ALMACEN, @DREC_DCAJA, @DREC_TUNEL,
@DREC_CODVIG
        , @DREC_PALLET, @DREC_CODREL, @DREC_NROSOPO, @DREC_SLOT, @DREC_DTGRACIA, @DREC_CODSAG, @DREC_TIPO,
@FECHAVENCIMIENTO
        , @LOTECLIENTE, @DREC_TS, @DREC_TM, @DREC_TI, @DREC_RECEPTUNEL, @DREC_PROCTUNEL, @DREC_TS_TUNEL,
@DREC_TM_TUNEL
        , @DREC_TI_TUNEL, @DREC_CODPER, @DREC_HORA, @DREC_FECHOMO, @DREC_HORHOMO, @DREC_AUTHOMO, @DREC_ESTADO,
@DREC_OCUP, @DREC_VALOR, @DREC_MONCODI,@DREC_MEDCODI)

    ELSE

        UPDATE TMPDETARECE
        SET FREC_CODI = @FREC_CODI
          , DREC_CODI = @DREC_CODI
          , DREC_CODPRO = @DREC_CODPRO
          , DREC_ORIGEN = @DREC_ORIGEN
          , DREC_CODSOPO = @DREC_CODSOPO
          , DREC_SOPOCLI = @DREC_SOPOCLI
          , DREC_UNIDADES = @DREC_UNIDADES
          , DREC_PESO = @DREC_PESO
          , DREC_FECREC = @DREC_FECREC
          , DREC_RUTCLI = @DREC_RUTCLI
          , DREC_RUTPRODUCTOR = @DREC_RUTPRODUCTOR
          , DREC_CONTCLI = @DREC_CONTCLI
          , DREC_FECPROD = @DREC_FECPROD
          , DREC_CAMARA = @DREC_CAMARA
          , DREC_BANDA = @DREC_BANDA
          , DREC_COLUM = @DREC_COLUM
          , DREC_PISO = @DREC_PISO
          , DREC_NIVEL = @DREC_NIVEL
          , DREC_ALMACEN = @DREC_ALMACEN
          , DREC_DCAJA = @DREC_DCAJA
          , DREC_TUNEL = @DREC_TUNEL
          , DREC_CODVIG = @DREC_CODVIG
          , DREC_PALLET = @DREC_PALLET
          , DREC_CODREL = @DREC_CODREL
          , DREC_NROSOPO = @DREC_NROSOPO
          , DREC_SLOT = @DREC_SLOT
          , DREC_DTGRACIA = @DREC_DTGRACIA
          , DREC_CODSAG = @DREC_CODSAG
          , DREC_TIPO = @DREC_TIPO
          , FECHAVENCIMIENTO = @FECHAVENCIMIENTO
          , LOTECLIENTE = @LOTECLIENTE
          , DREC_TS = @DREC_TS
          , DREC_TM = @DREC_TM
          , DREC_TI = @DREC_TI
          , DREC_RECEPTUNEL = @DREC_RECEPTUNEL
          , DREC_PROCTUNEL = @DREC_PROCTUNEL
          , DREC_TS_TUNEL = @DREC_TS_TUNEL
          , DREC_TM_TUNEL = @DREC_TM_TUNEL
          , DREC_TI_TUNEL = @DREC_TI_TUNEL
          , DREC_CODPER = @DREC_CODPER
          , DREC_HORA = @DREC_HORA
          , DREC_FECHOMO = @DREC_FECHOMO
          , DREC_HORHOMO = @DREC_HORHOMO
          , DREC_AUTHOMO = @DREC_AUTHOMO
          , DREC_ESTADO = @DREC_ESTADO
          , DREC_OCUP = @DREC_OCUP
          , DREC_VALOR = @DREC_VALOR
          , DREC_MONCODI = @DREC_MONCODI  
          , DREC_MEDCODI = @DREC_MEDCODI  
        WHERE FREC_CODI = @FREC_CODI AND DREC_CODI =  @DREC_CODI
GO
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO





-- Autor:    CAROLINA URIBE RUIZ / ACL
-- Objetivo:    ACTUALIZA TABLA TMPDETCAJAS
-- Fecha de Creacin: 12-09-2007
-- Modificaciones:
-- Pruebas
/*
exec PA_ACT_TMPDETARECE
*/

CREATE PROCEDURE [dbo].[PA_ACT_TMPDETCAJAS]
  @FREC_CODI NVARCHAR(7)
, @DREC_CODI NVARCHAR(2)
, @DETC_CODI NVARCHAR(2)
, @DETC_FPROD NVARCHAR(10)
, @DETC_FVENC NVARCHAR(10)
, @DETC_CANTIDAD NVARCHAR(10)
AS

    IF NOT EXISTS (SELECT FREC_CODI FROM TMPDETCAJAS WHERE FREC_CODI = @FREC_CODI AND DREC_CODI = @DREC_CODI AND
DETC_CODI = @DETC_CODI)

        INSERT INTO TMPDETCAJAS(
          FREC_CODI, DREC_CODI, DETC_CODI, DETC_FPROD, DETC_FVENC, DETC_CANTIDAD)
        VALUES(
          @FREC_CODI, @DREC_CODI, @DETC_CODI, @DETC_FPROD, @DETC_FVENC, @DETC_CANTIDAD)

    ELSE

        UPDATE TMPDETCAJAS
        SET FREC_CODI = @FREC_CODI
          , DREC_CODI = @DREC_CODI
          , DETC_CODI = @DETC_CODI
          , DETC_FPROD = @DETC_FPROD
          , DETC_FVENC = @DETC_FVENC
          , DETC_CANTIDAD = @DETC_CANTIDAD
        WHERE FREC_CODI = @FREC_CODI AND DREC_CODI = @DREC_CODI AND DETC_CODI = @DETC_CODI


GO
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO

CREATE PROCEDURE [dbo].[PA_ACT_TMPFICHPRED]
@FPRE_CODI      NVARCHAR (7), --  Numero de Folio de Predespacho
@FPRE_RUTCLI    NVARCHAR (9), --  Rut del Cliente
@FPRE_HORADES   NVARCHAR (5), --  Hora despacho
@FPRE_HORATER   NVARCHAR (5),
@FPRE_FECDES    NVARCHAR (10),
@FPRE_TOTSOPO   INT,
@FPRE_TOTUNIDAD INT,           -- TOTAL DE UNIDADES
@FPRE_TOTPESO   FLOAT,         -- TOTAL
@FPRE_RUTCOND   NVARCHAR (9),
@FPRE_CODIENCA  NVARCHAR (3),
@FPRE_ACTIVA    NVARCHAR (1),
@FPRE_FECHACT   NVARCHAR (10),
@FPRE_CODVIG    NVARCHAR (1),
@FPRE_GDESPA    NVARCHAR (7),
@FPRE_RADIO     NVARCHAR(1),
@FPRE_TIPO      INT,
@FPRE_PROCESO   INT,
@FPRE_SELLO     NVARCHAR (50),
@FPRE_TEM       REAL,
@FPRE_ANDEN     NVARCHAR (10),
--@FPRE_USUCRE    NVARCHAR (06),
@EST_CODI       INT
--@FPRE_PALLET    NVARCHAR(7)

AS
   BEGIN
     IF NOT EXISTS ( SELECT FPRE_CODI
                     FROM TMPFICHPRED
                     WHERE  FPRE_CODI = @FPRE_CODI)

          INSERT INTO TMPFICHPRED
         (FPRE_CODI      ,FPRE_RUTCLI,   FPRE_HORADES,  FPRE_HORATER , FPRE_FECDES, FPRE_TOTSOPO ,
              FPRE_TOTUNIDAD ,FPRE_TOTPESO,  FPRE_RUTCOND,  FPRE_CODIENCA, FPRE_ACTIVA,  FPRE_FECHACT ,
              FPRE_CODVIG    ,FPRE_GDESPA,   FPRE_RADIO  ,  FPRE_TIPO     ,FPRE_PROCESO ,FPRE_SELLO ,
              FPRE_TEM       ,FPRE_ANDEN, EST_CODI) --, FPRE_PALLET)--     ,FPRE_USUCRE  )
        VALUES
         (@FPRE_CODI      ,  @FPRE_RUTCLI,    @FPRE_HORADES   , @FPRE_HORATER  , @FPRE_FECDES,    @FPRE_TOTSOPO,
              @FPRE_TOTUNIDAD ,  @FPRE_TOTPESO   , @FPRE_RUTCOND  , @FPRE_CODIENCA , @FPRE_ACTIVA,
              @FPRE_FECHACT       ,  @FPRE_CODVIG    , @FPRE_GDESPA   , @FPRE_RADIO    , @FPRE_TIPO,
              @FPRE_PROCESO   ,  @FPRE_SELLO     , @FPRE_TEM       ,@FPRE_ANDEN, @EST_CODI) --, @FPRE_PALLET)--    , @FPRE_USUCRE)

     ELSE
      UPDATE TMPFICHPRED
     SET FPRE_RUTCLI    = @FPRE_RUTCLI,
             FPRE_HORADES   = @FPRE_HORADES,
             FPRE_HORATER   = @FPRE_HORATER,
             FPRE_FECDES    = @FPRE_FECDES,
             FPRE_TOTSOPO   = @FPRE_TOTSOPO,
             FPRE_TOTUNIDAD = @FPRE_TOTUNIDAD,
             FPRE_TOTPESO   = @FPRE_TOTPESO,
             FPRE_RUTCOND   = @FPRE_RUTCOND,
         FPRE_CODIENCA  = @FPRE_CODIENCA,
             FPRE_ACTIVA    = @FPRE_ACTIVA,
         FPRE_FECHACT   = @FPRE_FECHACT,
             FPRE_CODVIG    = @FPRE_CODVIG,
             FPRE_GDESPA    = @FPRE_GDESPA,
             FPRE_RADIO     = @FPRE_RADIO,
             FPRE_TIPO      = @FPRE_TIPO,
             FPRE_PROCESO   = @FPRE_PROCESO,
             FPRE_SELLO     = @FPRE_SELLO,
             FPRE_TEM       = @FPRE_TEM,
             FPRE_ANDEN     = @FPRE_ANDEN,
--    FPRE_USUCRE    = @FPRE_USUCRE,
             EST_CODI       = @EST_CODI
--             FPRE_PALLET    = @FPRE_PALLET
        WHERE FPRE_CODI     = @FPRE_CODI
    END


GO
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER ON
GO





-- Autor:    CAROLINA URIBE RUIZ / ACL
-- Objetivo:    ACTUALIZA TABLA TMPFICHRECE
-- Fecha de Creacin: 12-09-2007
-- Modificaciones:
-- Pruebas
/*
exec PA_ACT_TMPFICHRECE
*/
CREATE PROCEDURE [dbo].[PA_ACT_TMPFICHRECE]
  @FREC_CODI NVARCHAR(7)
, @FREC_RUTCLI NVARCHAR(9)
, @FREC_RUTPRODUCTOR VARCHAR(12)
, @FREC_CONTCLI NVARCHAR(7)
, @FREC_HORALLEG NVARCHAR(5)
, @FREC_HORAREC NVARCHAR(5)
, @FREC_HORATER NVARCHAR(5)
, @FREC_TURNREC NVARCHAR(1)
, @FREC_FECPROC NVARCHAR(10)
, @FREC_FECREC NVARCHAR(10)
, @FREC_GUIADES NVARCHAR(8)
, @FREC_TIPENTR NVARCHAR(2)
, @FREC_TOTSOPO INT
, @FREC_TOTUNIDAD INT
, @FREC_TOTPESO FLOAT
, @FREC_TEMPPRO REAL
, @FREC_RUTCOND NVARCHAR(9)
, @FREC_OBSERV NVARCHAR(50)
, @FREC_TIPDESC NVARCHAR(1)
, @FREC_CODIENCA NVARCHAR(3)
, @FREC_ORIGEN NVARCHAR(2)
, @FREC_CODVIG NVARCHAR(1)
, @FREC_RADIO NVARCHAR(1)
, @FREC_TIPO INT
, @FREC_RECEPTUNEL INT
, @FREC_ASPECTOSANITARIO NVARCHAR(15)
, @FREC_CONDGENERAL INT
, @FREC_PROCEDENCIA CHAR(10)
, @FREC_TS AS REAL
, @FREC_TM AS REAL
, @FREC_TI AS REAL
, @EST_CODI INT
, @FREC_USUCRE VARCHAR(3)
--, @FREC_FECMOD DATETIME
--, @FREC_FECCRE DATETIME
AS


    IF NOT EXISTS (SELECT FREC_CODI FROM TMPFICHRECE WHERE FREC_CODI = @FREC_CODI)

        INSERT INTO TMPFICHRECE(
          FREC_CODI, FREC_RUTCLI, FREC_RUTPRODUCTOR, FREC_CONTCLI, FREC_HORALLEG, FREC_HORAREC, FREC_HORATER
        , FREC_TURNREC, FREC_FECPROC, FREC_FECREC, FREC_GUIADES, FREC_TIPENTR, FREC_TOTSOPO, FREC_TOTUNIDAD,
FREC_TOTPESO
        , FREC_TEMPPRO, FREC_RUTCOND, FREC_OBSERV, FREC_TIPDESC, FREC_CODIENCA, FREC_ORIGEN, FREC_CODVIG,
FREC_RADIO
        , FREC_TIPO, FREC_RECEPTUNEL, FREC_ASPECTOSANITARIO, FREC_CONDGENERAL, FREC_PROCEDENCIA, EST_CODI
        , FREC_TS, FREC_TM, FREC_TI, FREC_USUCRE, FREC_FECMOD) --, FREC_FECCRE)
        VALUES(
          @FREC_CODI, @FREC_RUTCLI, @FREC_RUTPRODUCTOR, @FREC_CONTCLI, @FREC_HORALLEG, @FREC_HORAREC,
@FREC_HORATER
        , @FREC_TURNREC, @FREC_FECPROC, @FREC_FECREC, @FREC_GUIADES, @FREC_TIPENTR, @FREC_TOTSOPO,
@FREC_TOTUNIDAD, @FREC_TOTPESO
        , @FREC_TEMPPRO, @FREC_RUTCOND, @FREC_OBSERV, @FREC_TIPDESC, @FREC_CODIENCA, @FREC_ORIGEN, @FREC_CODVIG,
@FREC_RADIO
        , @FREC_TIPO, @FREC_RECEPTUNEL, @FREC_ASPECTOSANITARIO, @FREC_CONDGENERAL, @FREC_PROCEDENCIA, @EST_CODI
        , @FREC_TS, @FREC_TM, @FREC_TI,@FREC_USUCRE, GETDATE())--, @FREC_FECCRE)

    ELSE

        UPDATE TMPFICHRECE
        SET FREC_CODI = @FREC_CODI
          , FREC_RUTCLI = @FREC_RUTCLI
          , FREC_RUTPRODUCTOR = @FREC_RUTPRODUCTOR
          , FREC_CONTCLI = @FREC_CONTCLI
          , FREC_HORALLEG = @FREC_HORALLEG
          , FREC_HORAREC = @FREC_HORAREC
          , FREC_HORATER = @FREC_HORATER
          , FREC_TURNREC = @FREC_TURNREC
          , FREC_FECPROC = @FREC_FECPROC
          , FREC_FECREC = @FREC_FECREC
          , FREC_GUIADES = @FREC_GUIADES
          , FREC_TIPENTR = @FREC_TIPENTR
          , FREC_TOTSOPO = @FREC_TOTSOPO
          , FREC_TOTUNIDAD = @FREC_TOTUNIDAD
          , FREC_TOTPESO = @FREC_TOTPESO
          , FREC_TEMPPRO = @FREC_TEMPPRO
          , FREC_RUTCOND = @FREC_RUTCOND
          , FREC_OBSERV = @FREC_OBSERV
          , FREC_TIPDESC = @FREC_TIPDESC
          , FREC_CODIENCA = @FREC_CODIENCA
          , FREC_ORIGEN = @FREC_ORIGEN
          , FREC_CODVIG = @FREC_CODVIG
          , FREC_RADIO = @FREC_RADIO
          , FREC_TIPO = @FREC_TIPO
          , FREC_RECEPTUNEL = @FREC_RECEPTUNEL
          , FREC_ASPECTOSANITARIO = @FREC_ASPECTOSANITARIO
          , FREC_CONDGENERAL = @FREC_CONDGENERAL
          , FREC_PROCEDENCIA = @FREC_PROCEDENCIA
          , FREC_TS = @FREC_TS
          , FREC_TM = @FREC_TM
          , FREC_TI = @FREC_TI
        --  , EST_CODI = @EST_CODI
          , FREC_USUCRE = @FREC_USUCRE
          , FREC_FECMOD = GETDATE()
--          , FREC_FECCRE = @FREC_FECCRE
        WHERE FREC_CODI = @FREC_CODI
GO
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO




-- Autor:    CAROLINA URIBE RUIZ / ACL
-- Objetivo:    BORRA RECEPCIONES CON MAS DE 8 HORAS
-- Fecha de Creacin: 25-09-2007
-- Modificaciones:
-- Pruebas
/*
exec PA_BATCH_TMPRECEPCION

*/

CREATE PROCEDURE [dbo].[PA_BATCH_TMPRECEPCION]
AS

    SELECT FREC_CODI
    INTO #ELIMREG
    FROM TMPFICHRECE
    WHERE  (480-DATEDIFF(MI, TMPFICHRECE.FREC_FECCRE, GETDATE()))<0

    DECLARE @FREC_CODI AS VARCHAR(7)
    SELECT @FREC_CODI = 0

    DECLARE CURRECEP CURSOR FOR SELECT FREC_CODI FROM #ELIMREG
    OPEN CURRECEP
    FETCH NEXT FROM CURRECEP INTO @FREC_CODI
    WHILE @@FETCH_STATUS = 0
    BEGIN

        DELETE FROM TMPCHOFERES
        WHERE FREC_CODI = @FREC_CODI

        DELETE FROM TMPDETCAJAS
        WHERE FREC_CODI = @FREC_CODI

        DELETE FROM TMPDETARECE
        WHERE FREC_CODI = @FREC_CODI

        DELETE FROM TMPFICHRECE
        WHERE FREC_CODI = @FREC_CODI
        FETCH NEXT FROM CURRECEP INTO @FREC_CODI
    END
    CLOSE CURRECEP
    DEALLOCATE CURRECEP


GO
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO





-- Autor:    CAROLINA URIBE RUIZ / ACL
-- Objetivo:    LISTA CLIENTES
-- Fecha de Creacin: 14-09-2007
-- Modificaciones:
-- Pruebas
/*
exec  PA_BUS_CLIENTE
*/
CREATE  PROCEDURE [dbo].[PA_BUS_CLIENTES]
AS

    SET NOCOUNT ON
    SET rowcount 200
    SET rowcount 0

    SELECT DISTINCT LTRIM(RTRIM(CLI_RUT)) AS CLI_RUT, UPPER(LTRIM(RTRIM(CLI_NOMB))) AS CLI_NOMB
    FROM CLIENTES
    where cli_estado='A'
    ORDER BY 2

    RETURN 0


GO
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO




-- Autor:    Carolina Uribe Ruiz - ACL
-- Objetivo:    BUSCA CONTRATOS POR CLIENTE

-- Fecha de Creacin:    29-06-2007
-- Modificaciones:
-- Pruebas
/*
exec PA_BUS_CONTRATOSXCLI '825570004'
*/

CREATE PROCEDURE [dbo].[PA_BUS_CONTRATOSXCLI]
@CONT_RUTCLIE NVARCHAR(9)
AS

    SELECT Cont_Codi, Cont_Descr
    FROM CONTRATO
    WHERE LTRIM(RTRIM(Cont_RutClie)) = @CONT_RUTCLIE
    ORDER BY Cont_Codi


GO
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO




-- Autor:    Carolina Uribe Ruiz - ACL
-- Objetivo:  BUSCA CORRELATIVO PARA TABLA DE TEMPORAL DE FACTURACION DE LOS SERVICIOS 09 - 14 -15 -16

-- Fecha de Creacin:    17-07-2007
-- Modificaciones:
-- Pruebas
/*
exec PA_BUS_CORRELTMPSER 'TMPSERV_MINTUNEL'

*/
CREATE PROCEDURE [dbo].[PA_BUS_CORRELTABLA]
  @TABLA VARCHAR(30)
AS

    SET NOCOUNT ON
    BEGIN TRAN
        DECLARE @COD AS INT
        SET @COD = 0

        SELECT @COD = CODIGO + 1 FROM CORRTABLAS WHERE RTRIM(LTRIM(TABLA)) = RTRIM(LTRIM(@TABLA))
        IF @COD > 0
        BEGIN

            UPDATE CORRTABLAS
            SET CODIGO = @COD
            WHERE RTRIM(LTRIM(TABLA)) = RTRIM(LTRIM(@TABLA))

        END
        ELSE
            BEGIN
                ROLLBACK TRAN
                SELECT -1
                RETURN
            END
    IF @@ERROR > 0
    BEGIN
        ROLLBACK TRAN
        SELECT 0
    END
    ELSE
    BEGIN
        COMMIT TRAN
        SELECT @COD
    END

    RETURN


GO
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO






-- Autor:    CAROLINA URIBE RUIZ / ACL
-- Objetivo:    LISTA ESTADOS DE GUIAS
-- Fecha de Creacin: 14-09-2007
-- Modificaciones:
-- Pruebas
/*
exec  PA_BUS_ESTADOS
*/
CREATE  PROCEDURE [dbo].[PA_BUS_ESTADOS]
AS


    SET NOCOUNT ON
    SET rowcount 200
    SET rowcount 0

    SELECT EST_CODI, UPPER(LTRIM(RTRIM(EST_GLOSA))) AS EST_GLOSA
    FROM TMPESTADOS
    WHERE EST_CODI < 2
    ORDER BY 2

    RETURN 0


GO
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO

-- Autor:    CAROLINA URIBE RUIZ / ACL
-- Objetivo:    LISTA GUIAS DE RECEPCION
-- Fecha de Creacin: 14-09-2007
-- Modificaciones:
-- Pruebas
/*
exec PA_BUS_RECEPCION 0034111
select * from TMPDETARECE
select TOP 1 * from MAEPROD
select TOP 1 * from TIPOENV

*/

CREATE PROCEDURE [dbo].[PA_BUS_RECEPCION]
  @FREC_CODI AS INT
, @ESTADO AS INT
AS


    SET NOCOUNT ON
    SET rowcount 200
    SET rowcount 0

    IF @ESTADO = 1
    BEGIN
        SELECT TMPFICHRECE.FREC_CODI, TMPFICHRECE.FREC_RUTCLI, TMPFICHRECE.FREC_RUTPRODUCTOR             , TMPFICHRECE.FREC_CONTCLI
            , TMPFICHRECE.FREC_HORALLEG, TMPFICHRECE.FREC_HORAREC, TMPFICHRECE.FREC_HORATER             , TMPFICHRECE.FREC_TURNREC
            , TMPFICHRECE.FREC_FECPROC, TMPFICHRECE.FREC_FECREC, TMPFICHRECE.FREC_GUIADES             , TMPFICHRECE.FREC_TIPENTR
            , TMPFICHRECE.FREC_TOTSOPO, TMPFICHRECE.FREC_TOTUNIDAD, TMPFICHRECE.FREC_TOTPESO            , TMPFICHRECE.FREC_TEMPPRO
            , TMPFICHRECE.FREC_RUTCOND, TMPFICHRECE.FREC_OBSERV, TMPFICHRECE.FREC_TIPDESC            , TMPFICHRECE.FREC_CODIENCA
            , TMPFICHRECE.FREC_ORIGEN, TMPFICHRECE.FREC_CODVIG, TMPFICHRECE.FREC_RADIO, TMPFICHRECE.FREC_TIPO
            , TMPFICHRECE.FREC_RECEPTUNEL, TMPFICHRECE.FREC_ASPECTOSANITARIO, TMPFICHRECE.FREC_CONDGENERAL
            , TMPFICHRECE.FREC_PROCEDENCIA, TMPFICHRECE.FREC_TS, TMPFICHRECE.FREC_TM, TMPFICHRECE.FREC_TI
            , TMPFICHRECE.EST_CODI, TMPFICHRECE.FREC_USUCRE, TMPFICHRECE.FREC_FECMOD
            , TMPDETARECE.DREC_TS, TMPDETARECE.DREC_TM, TMPDETARECE.DREC_TI, TMPDETARECE.DREC_CODPRO             , TMPDETARECE.DREC_CODSOPO
            , TMPDETARECE.DREC_SOPOCLI, TMPDETARECE.DREC_FECPROD, TMPDETARECE.FECHAVENCIMIENTO             , TMPDETARECE.LOTECLIENTE
            , TMPDETARECE.DREC_CAMARA, TMPDETARECE.DREC_BANDA, TMPDETARECE.DREC_SLOT            , TMPDETARECE.DREC_UNIDADES, TMPDETARECE.DREC_PESO
            , TMPDETARECE.DREC_ALMACEN, TMPDETARECE.DREC_COLUM, TMPDETARECE.DREC_PISO, TMPDETARECE.DREC_NIVEL
            , TMPDETARECE.DREC_CODSAG, TMPDETARECE.DREC_DCAJA, TMPDETARECE.DREC_TUNEL            , TMPDETARECE.DREC_DTGRACIA
            , TMPDETARECE.DREC_CODI, TMPDETARECE.DREC_TS, TMPDETARECE.DREC_TM, TMPDETARECE.DREC_TI            , TMPDETARECE.DREC_OCUP
            , TMPDETARECE.DREC_CODPER, TMPDETARECE.DREC_ESTADO
            , USUARIO.DESCRI
            , UPPER(CLIENTES.CLI_NOMB) AS CLI_NOMB
            , ISNULL(PRODUCTORES.CLI_RUT,'') AS RUTPROD, ISNULL(PRODUCTORES.CLI_NOMB,'') AS NOMBPROD
            , UPPER(CONTRATO.CONT_DESCR) AS CONT_DESCR
            , UPPER(ORIGEN.ORI_DESCR) AS ORI_DESCR
            , UPPER(TMPCHOFERES.CHO_NOMBRE) AS CHO_NOMBRE, TMPCHOFERES.CHO_PATENTE, TMPCHOFERES.CHO_EMPRESA
            , LTRIM(RTRIM(MAEPROD.MAE_DESCR)) AS MAE_DESCR
            , LTRIM(RTRIM(TIPOENV.TENV_DESCR)) AS TENV_DESCR
            , drec_valor,drec_moncodi,drec_medcodi
            /*UPPER(LTRIM(RTRIM(TMPESTADOS.EST_GLOSA))) AS EST_GLOSA, TMPFICHRECE.FREC_CODI, UPPER(LTRIM
(RTRIM(CLIENTES.CLI_NOMB))) AS CLI_NOMB
            , CONVERT(VARCHAR(10),TMPFICHRECE.FREC_FECCRE,105) AS FREC_FECCRE, CONVERT(VARCHAR
(8),TMPFICHRECE.FREC_FECCRE,108) AS FREC_FECCRE
            , CONVERT(VARCHAR(10),TMPFICHRECE.FREC_FECMOD,105) AS FREC_FECCRE, CONVERT(VARCHAR
(8),TMPFICHRECE.FREC_FECMOD,108) AS FREC_FECCRE
            , UPPER(LTRIM(RTRIM(USUARIO.DESCRI))) AS DESCRI*/
    --    SELECT *
        FROM TMPFICHRECE LEFT OUTER JOIN
            TMPDETARECE ON TMPFICHRECE.FREC_CODI = TMPDETARECE.FREC_CODI LEFT OUTER JOIN
            TMPCHOFERES ON TMPFICHRECE.FREC_CODI = TMPCHOFERES.FREC_CODI AND
            TMPFICHRECE.FREC_RUTCOND = TMPCHOFERES.CHO_RUT INNER JOIN
            USUARIO ON TMPFICHRECE.FREC_USUCRE = USUARIO.PERSONAL INNER JOIN
            CLIENTES ON TMPFICHRECE.FREC_RUTCLI = CLIENTES.CLI_RUT INNER JOIN
            TMPESTADOS ON TMPFICHRECE.EST_CODI = TMPESTADOS.EST_CODI LEFT OUTER JOIN
            PRODUCTORES ON TMPFICHRECE.FREC_RUTCLI = PRODUCTORES.CLI_RUT LEFT OUTER JOIN
            CONTRATO ON TMPFICHRECE.FREC_RUTCLI = CONTRATO.CONT_RUTCLIE AND
            TMPFICHRECE.FREC_CONTCLI = CONTRATO.CONT_CODI INNER JOIN
            ORIGEN ON TMPFICHRECE.FREC_ORIGEN = ORIGEN.ORI_CODI LEFT OUTER JOIN
            MAEPROD ON --TMPFICHRECE.FREC_RUTCLI = MAEPROD.MAE_CLIRUT AND
            TMPDETARECE.DREC_CODPRO = MAEPROD.MAE_CODI LEFT OUTER JOIN
            TIPOENV ON MAEPROD.MAE_TIPENV = TIPOENV.TENV_CODI
        WHERE TMPFICHRECE.FREC_CODI = @FREC_CODI
        ORDER BY TMPDETARECE.DREC_CODI

        SELECT TMPDETCAJAS.FREC_CODI, TMPDETCAJAS.DREC_CODI, TMPDETCAJAS.DETC_CODI
            , TMPDETCAJAS.DETC_FPROD, TMPDETCAJAS.DETC_FVENC, TMPDETCAJAS.DETC_CANTIDAD
        FROM TMPDETCAJAS
        WHERE TMPDETCAJAS.FREC_CODI = @FREC_CODI

    END
    ELSE
    BEGIN
        SELECT FICHRECE.FREC_CODI, FICHRECE.FREC_RUTCLI, FICHRECE.FREC_RUTPRODUCTOR, FICHRECE.FREC_CONTCLI
            , FICHRECE.FREC_HORALLEG, FICHRECE.FREC_HORAREC, FICHRECE.FREC_HORATER, FICHRECE.FREC_TURNREC
            , FICHRECE.FREC_FECPROC, FICHRECE.FREC_FECREC, FICHRECE.FREC_GUIADES, FICHRECE.FREC_TIPENTR
            , FICHRECE.FREC_TOTSOPO, FICHRECE.FREC_TOTUNIDAD, FICHRECE.FREC_TOTPESO, FICHRECE.FREC_TEMPPRO
            , FICHRECE.FREC_RUTCOND, FICHRECE.FREC_OBSERV, FICHRECE.FREC_TIPDESC, FICHRECE.FREC_CODIENCA
            , FICHRECE.FREC_ORIGEN, FICHRECE.FREC_CODVIG, FICHRECE.FREC_RADIO, FICHRECE.FREC_TIPO
            , FICHRECE.FREC_RECEPTUNEL, FICHRECE.FREC_ASPECTOSANITARIO, FICHRECE.FREC_CONDGENERAL
            , FICHRECE.FREC_PROCEDENCIA, NULL AS FREC_TS, NULL AS FREC_TM, NULL AS FREC_TI
            , 0 AS EST_CODI, '' AS FREC_USUCRE, '' AS FREC_FECMOD
            , DETARECE.DREC_TS, DETARECE.DREC_TM, DETARECE.DREC_TI, DETARECE.DREC_CODPRO            , DETARECE.DREC_CODSOPO
            , DETARECE.DREC_SOPOCLI, DETARECE.DREC_FECPROD, DETARECE.FECHAVENCIMIENTO, DETARECE.LoteCliente
            , DETARECE.DREC_CAMARA, DETARECE.DREC_BANDA, DETARECE.DREC_SLOT, DETARECE.DREC_UNIDADES            , DETARECE.DREC_PESO
            , DETARECE.DREC_ALMACEN, DETARECE.DREC_COLUM, DETARECE.DREC_PISO, DETARECE.DREC_NIVEL
            , DETARECE.DREC_CODSAG, DETARECE.DREC_DCAJA, DETARECE.DREC_TUNEL, DETARECE.DREC_DTGRACIA
            , DETARECE.DREC_CODI, DETARECE.DREC_TS, DETARECE.DREC_TM, DETARECE.DREC_TI, 0 AS DREC_OCUP
            , DETARECE.DREC_CODPER, DETARECE.DREC_ESTADO,DETARECE.drec_valor,DETARECE.drec_moncodi,DETARECE.drec_medcodi
            , USUARIO.DESCRI
            , UPPER(CLIENTES.CLI_NOMB) AS CLI_NOMB
            , ISNULL(PRODUCTORES.CLI_RUT,'') AS RUTPROD, ISNULL(PRODUCTORES.CLI_NOMB,'') AS NOMBPROD
            , UPPER(CONTRATO.CONT_DESCR) AS CONT_DESCR
            , UPPER(ORIGEN.ORI_DESCR) AS ORI_DESCR
            , UPPER(CHOFERES.CHO_NOMBRE) AS CHO_NOMBRE, CHOFERES.CHO_PATENTE, CHOFERES.CHO_EMPRESA
            , LTRIM(RTRIM(MAEPROD.MAE_DESCR)) AS MAE_DESCR
            , LTRIM(RTRIM(TIPOENV.TENV_DESCR)) AS TENV_DESCR
            /*UPPER(LTRIM(RTRIM(TMPESTADOS.EST_GLOSA))) AS EST_GLOSA, FICHRECE.FREC_CODI, UPPER(LTRIM(RTRIM
(CLIENTES.CLI_NOMB))) AS CLI_NOMB
            , CONVERT(VARCHAR(10),FICHRECE.FREC_FECCRE,105) AS FREC_FECCRE, CONVERT(VARCHAR
(8),FICHRECE.FREC_FECCRE,108) AS FREC_FECCRE
            , CONVERT(VARCHAR(10),FICHRECE.FREC_FECMOD,105) AS FREC_FECCRE, CONVERT(VARCHAR
(8),FICHRECE.FREC_FECMOD,108) AS FREC_FECCRE
            , UPPER(LTRIM(RTRIM(USUARIO.DESCRI))) AS DESCRI*/
    --    SELECT TOP 1 * FROM FICHRECE
        FROM FICHRECE INNER JOIN
            DETARECE ON FICHRECE.FREC_CODI = LEFT(DETARECE.DREC_CODI,7) LEFT OUTER JOIN
            CHOFERES ON FICHRECE.FREC_RUTCOND = CHOFERES.CHO_RUT INNER JOIN
            USUARIO ON CONVERT(INT,ISNULL(DETARECE.DREC_CODPER,0)) = CONVERT(INT,USUARIO.PERSONAL) INNER JOIN
            CLIENTES ON FICHRECE.FREC_RUTCLI = CLIENTES.CLI_RUT LEFT OUTER JOIN
            PRODUCTORES ON FICHRECE.FREC_RUTCLI = PRODUCTORES.CLI_RUT INNER JOIN
            CONTRATO ON FICHRECE.FREC_RUTCLI = CONTRATO.CONT_RUTCLIE AND
            FICHRECE.FREC_CONTCLI = CONTRATO.CONT_CODI INNER JOIN
            ORIGEN ON FICHRECE.FREC_ORIGEN = ORIGEN.ORI_CODI INNER JOIN
            MAEPROD ON FICHRECE.FREC_RUTCLI = MAEPROD.MAE_CLIRUT AND
            DETARECE.DREC_CODPRO = MAEPROD.MAE_CODI INNER JOIN
            TIPOENV ON MAEPROD.MAE_TIPENV = TIPOENV.TENV_CODI
        WHERE FICHRECE.FREC_CODI = @FREC_CODI
        ORDER BY DETARECE.DREC_CODI

        SELECT LEFT(DETC_PALLET,7) AS FREC_CODI, SUBSTRING(DETC_PALLET,8,2) AS DREC_CODI, RIGHT(DETC_PALLET,2) AS DETC_CODI
            , DETCAJAS.DETC_FPROD, DETCAJAS.DETC_FVENC, DETCAJAS.DETC_CANTIDAD
        FROM DETCAJAS
        WHERE LEFT(DETCAJAS.DETC_PALLET,7) = @FREC_CODI

    END
GO
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO




-- Autor:    Carolina Uribe Ruiz - ACL
-- Objetivo:    BUSCA SERVICIOS POR CONTRATOS (SERVICIOS NUMERAL PROMEDIO MNIMO TNEL Y NUMERAL SUMA CONTRATOS MNIMO Y 
-- TNEL)

-- Fecha de Creacin:    29-06-2007
-- Modificaciones:
-- Pruebas
/*
exec PA_ING_ESCALASERV '0002900', '08', 2

*/

CREATE PROCEDURE [dbo].[PA_BUS_SERVXCONTR]
@ESCCONTR NVARCHAR(9)
AS

    SELECT DISTINCT  ESCSERV, TOTTRAMAS
    FROM ESCALASERV
    WHERE LTRIM(RTRIM(ESCCONTR)) = @ESCCONTR
    ORDER BY ESCSERV


GO
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO




-- Autor:    Carolina Uribe Ruiz - ACL
-- Objetivo:    BUSCA TRAMOS POR CONTRATO Y SERVICIO (SERVICIOS NUMERAL PROMEDIO MNIMO TNEL Y NUMERAL SUMA CONTRATOS MNIMO Y TNEL)

-- Fecha de Creacin:    29-06-2007
-- Modificaciones:
-- Pruebas
/*
exec PA_BUS_TRAMOXCONTRSERV '0002900', '08'

*/

CREATE PROCEDURE [dbo].[PA_BUS_TRAMOXCONTRSERV]
  @ESCCONTR NVARCHAR(9)
, @ESCSERV VARCHAR(2)
AS

    SELECT ESCALASERV.ESCCOD, ESCALASERV.TOTTRAMAS, TRAMO.TRAMNOMB, TRAMO.TRAMDESDE, TRAMO.TRAMHASTA, TRAMO.TRAMVAL
    FROM ESCALASERV INNER JOIN TRAMO
        ON ESCALASERV.ESCCOD = TRAMO.ESCCOD
    WHERE LTRIM(RTRIM(ESCALASERV.ESCCONTR)) = @ESCCONTR
        AND LTRIM(RTRIM(ESCALASERV.ESCSERV)) = @ESCSERV
--    ORDER BY ESCALASERV.ESCSERV


GO
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO





-- Autor:    CAROLINA URIBE RUIZ / ACL
-- Objetivo:    LISTA USUARIOS
-- Fecha de Creacin: 14-09-2007
-- Modificaciones:
-- Pruebas
/*
exec  PA_BUS_USUARIOS
*/
CREATE  PROCEDURE [dbo].[PA_BUS_USUARIOS]
AS


    SET NOCOUNT ON
    SET rowcount 200
    SET rowcount 0

    SELECT DISTINCT LTRIM(RTRIM(PERSONAL)) AS CODIGO, UPPER(LTRIM(RTRIM(DESCRI))) AS DESCRI
    FROM USUARIO
    WHERE PERSONAL<>'' AND DESCRI <> ''
    ORDER BY 2

    RETURN 0


GO
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO



-- PA_CONDICIONESCONTRATO '0002100', '09'
CREATE PROCEDURE [dbo].[PA_CONDICIONESCONTRATO]
  @CONTR AS VARCHAR(7)
, @SERV AS VARCHAR(2)
AS

     SET NOCOUNT ON
    SET rowcount 0

--    DECLARE @CONTR AS VARCHAR(7)
--    DECLARE @SERV AS VARCHAR(7)
    DECLARE @DESCONTR AS VARCHAR(40)
    DECLARE @DIAGR AS SMALLINT
    DECLARE @TUNELG AS INT
    DECLARE @DIACONT AS SMALLINT
    DECLARE @PALL AS INT
    DECLARE @CONTRVAL AS DEC(12,2)
    DECLARE @MONDESC AS VARCHAR(30)
    DECLARE @MONVAL AS DEC(12,2)
    DECLARE @MEDDESC AS VARCHAR(30)

--    SET @CONTR = '0002100'
--    SET @SERV = '09'
    SET @DESCONTR = ''
    SET @DIAGR = 0
    SET @TUNELG = 0
    SET @DIACONT = 0
    SET @PALL = 0
    SET @CONTRVAL = 0
    SET @MONDESC = ''
    SET @MONVAL = 0
    SET @MEDDESC = ''

    SELECT @DIAGR=CONTRATO.CONT_DIAGRACIA, @TUNELG=CONTRATO.CONT_TUNELG, @DESCONTR=CONTRATO.CONT_DESCR
         , @DIACONT=CONTRATO.CONT_DIACONT, @PALL=CONTRATO.CONT_PALLET, @CONTRVAL = CONTRPARA.CPAR_VALOR
        , @MONDESC = MONEDAS.MON_DESCR, @MONVAL = MONEDAS.MON_VALOR
         , @MEDDESC = MEDIDAS.MED_DESCR
    FROM CONTRPARA INNER JOIN
         CONTRATO ON CONTRPARA.CPAR_CONTR = CONTRATO.CONT_CODI INNER JOIN MONEDAS
         MONEDAS ON CONTRPARA.CPAR_MONEDA = MONEDAS.MON_CODI INNER JOIN
         MEDIDAS ON CONVERT(INT,CONTRPARA.CPAR_MEDIDA) = CONVERT(INT,MEDIDAS.MED_CODI)
    WHERE CONTRPARA.CPAR_CONTR = @CONTR AND CONTRPARA.CPAR_SERVI = @SERV

    DECLARE @VALUF AS DEC(12,2)
    DECLARE @FECUF AS VARCHAR(10)
    DECLARE @VALDOLAR AS DEC(12,2)
    DECLARE @FECDOLAR AS VARCHAR(10)

    SET @VALUF = 0
    SET @FECUF = ''
    SET @VALDOLAR = 0
    SET @FECDOLAR = ''

    SELECT @VALUF = CASE WHEN MON_CODI = '02' THEN MON_VALOR ELSE @VALUF END
        , @FECUF = CASE WHEN MON_CODI = '02' THEN MON_FECVAL ELSE @FECUF END
        , @VALDOLAR = CASE WHEN MON_CODI = '01' THEN MON_VALOR ELSE @VALDOLAR END
        , @FECDOLAR = CASE WHEN MON_CODI = '01' THEN MON_FECVAL ELSE @FECDOLAR END
    FROM MONEDAS

    SELECT @DESCONTR AS DESCONTR, @DIAGR AS DIAGR, @TUNELG AS TUNELG, @DIACONT AS DIACONT
        , @PALL AS PALL, @CONTRVAL AS CONTRVAL, @MONDESC AS MONDESC, @MONVAL AS MONVAL
        , @MEDDESC AS MEDDESC, @VALUF AS VALUF, @FECUF AS FECUF, @VALDOLAR AS VALDOLAR
        , @FECDOLAR AS FECDOLAR


GO
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO





-- Autor:    CAROLINA URIBE RUIZ / ACL
-- Objetivo:    ELIMINA REGISTRO TABLA DETCAJAS
-- Fecha de Creacin: 12-09-2007
-- Modificaciones:
-- Pruebas
/*
exec PA_DEL_DETCAJAS

*/

CREATE PROCEDURE [dbo].[PA_DEL_DETCAJAS]
  @DETC_PALLET NVARCHAR(11)
AS

        DELETE FROM DETCAJAS
        WHERE LEFT(DETC_PALLET,7) = @DETC_PALLET


GO
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO

CREATE PROCEDURE [dbo].[PA_DEL_TMPDETAPRED]
@Fpre_codi NVARCHAR(7)
AS
       DELETE FROM TMPDETAPRED
       WHERE Fpre_codi = @Fpre_codi


GO
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO

CREATE PROCEDURE [dbo].[PA_DEL_TMPDETAPREDFILA]
@fpre_codi  NVARCHAR(7),
@dpre_ptr int
AS
       DELETE FROM TMPDETAPRED
       WHERE fpre_codi = @fpre_codi
         AND dpre_ptr = @dpre_ptr


GO
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO





-- Autor:    CAROLINA URIBE RUIZ / ACL
-- Objetivo:    BORRA REGISTRO TABLA TMPDETARECE
-- Fecha de Creacin: 16-09-2007
-- Modificaciones:
-- Pruebas
/*
exec PA_DEL_TMPDETARECE

*/

CREATE PROCEDURE [dbo].[PA_DEL_TMPDETARECE]
  @FREC_CODI NVARCHAR(7)
, @DREC_CODI NVARCHAR(2)
AS


        DELETE FROM TMPDETARECE
        WHERE FREC_CODI = @FREC_CODI AND DREC_CODI =  @DREC_CODI


GO
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO





-- Autor:    CAROLINA URIBE RUIZ / ACL
-- Objetivo:    BORRA REGISTRO TABLA TMPDETCAJAS
-- Fecha de Creacin: 16-09-2007
-- Modificaciones:
-- Pruebas
/*
exec PA_DEL_TMPDETCAJAS
*/
CREATE PROCEDURE [dbo].[PA_DEL_TMPDETCAJAS]
  @FREC_CODI NVARCHAR(7)
, @DREC_CODI NVARCHAR(2)
AS

        DELETE FROM TMPDETCAJAS
        WHERE FREC_CODI = @FREC_CODI AND DREC_CODI = @DREC_CODI


GO
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO

CREATE PROCEDURE [dbo].[PA_DEL_TMPFICHPRED]
  @fpre_codi NVARCHAR(7)
AS
       DELETE FROM TMPFICHPRED
       WHERE fpre_codi = @fpre_codi


GO
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO





-- Autor:    CAROLINA URIBE RUIZ / ACL
-- Objetivo:    BORRA TABLAS TEMPORALES DE RECEPCION SEGUN NUMERO DE GUIA
-- Fecha de Creacin: 25-09-2007
-- Modificaciones:
-- Pruebas
/*
exec PA_DEL_TMPRECEPCION '0034113'
*/
CREATE PROCEDURE [dbo].[PA_DEL_TMPRECEPCION]
  @FREC_CODI NVARCHAR(7)
AS
        DELETE FROM TMPCHOFERES
        WHERE FREC_CODI = @FREC_CODI

        DELETE FROM TMPDETCAJAS
        WHERE FREC_CODI = @FREC_CODI

        DELETE FROM TMPDETARECE
        WHERE FREC_CODI = @FREC_CODI

        DELETE FROM TMPFICHRECE
        WHERE FREC_CODI = @FREC_CODI


GO
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO



-- Autor:    CAROLINA URIBE RUIZ / ACL
-- Objetivo:    ELIMINA DATOS TEMPORALES UTILIZADAS EN EL PROCESO DE FACTURACION DE LOS SERVICIOS NMPNT, NMT, NSCMT Y DE
-- Fecha de Creacin: 17-08/-2007
-- Modificaciones:
-- Pruebas
/*
exec  PA_DELTMPSERVICIOS 1
exec  PA_DELTMPSERVICIOS 20
*/


CREATE PROCEDURE [dbo].[PA_DEL_TMPSERVICIOS]
@IDENT INT
AS

    DELETE FROM TMPDETSERVICIOS WHERE IDENT = @IDENT
    DELETE FROM TMPCABSERVICIOS WHERE IDENT = @IDENT

    RETURN 0


GO
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[PA_DERECHOENTRADA]
  @RUTCLI AS VARCHAR(9)
, @CONTR AS VARCHAR(7)
, @FECINI AS VARCHAR(10)
, @FECFIN AS VARCHAR(10)
, @IDENT AS INTEGER=0
AS

    SET NOCOUNT ON
    SET rowcount 0
/*
    DECLARE @RUTCLI AS VARCHAR(9)
    DECLARE @CONTR AS VARCHAR(7)
    DECLARE @FECINI AS VARCHAR(10)
    DECLARE @FECFIN AS VARCHAR(10)
    DECLARE @IDENT AS INTEGER

    SET @RUTCLI = '796639407'
    SET @CONTR = '0002100'
    SET @FECINI = '2007/04/01'
    SET @FECFIN = '2007/04/30'
    SET @IDENT = 0
*/

    DECLARE @DESCONTR AS VARCHAR(40)
    DECLARE @DIAGR AS SMALLINT
    DECLARE @TUNELG AS INT
    DECLARE @DIACONT AS SMALLINT
    --DECLARE @PALL AS INT
    DECLARE @CONTRVAL AS DEC(12,2)
    DECLARE @MONDESC AS VARCHAR(30)
    DECLARE @MONVAL AS DEC(12,2)
    DECLARE @MEDDESC AS VARCHAR(30)

    SET @DESCONTR = ''
    SET @DIAGR = 0
    SET @TUNELG = 0
    SET @DIACONT = 0
    --SET @PALL = 0
    SET @CONTRVAL = 0
    SET @MONDESC = ''
    SET @MONVAL = 0
    SET @MEDDESC = ''

    SELECT @DIAGR=ISNULL(CONTRATO.CONT_DIAGRACIA,0), @TUNELG=ISNULL(CONTRATO.CONT_TUNELG,0), @DESCONTR=ISNULL(CONTRATO.CONT_DESCR,'')
         , @DIACONT=ISNULL(CONTRATO.CONT_DIACONT,0), @CONTRVAL = ISNULL(CONTRPARA.CPAR_VALOR,0)  --, @PALL=CONTRATO.CONT_PALLET
        , @MONDESC = ISNULL(MONEDAS.MON_DESCR,''), @MONVAL = ISNULL(MONEDAS.MON_VALOR,0)
         , @MEDDESC = MEDIDAS.MED_DESCR
    FROM CONTRPARA INNER JOIN
         CONTRATO ON CONTRPARA.CPAR_CONTR = CONTRATO.CONT_CODI INNER JOIN MONEDAS
         MONEDAS ON CONTRPARA.CPAR_MONEDA = MONEDAS.MON_CODI INNER JOIN
         MEDIDAS ON CONVERT(INT,CONTRPARA.CPAR_MEDIDA) = CONVERT(INT,MEDIDAS.MED_CODI)
    WHERE CONTRPARA.CPAR_CONTR = @CONTR AND CONTRPARA.CPAR_SERVI = '09'

    --DROP TABLE #DESPPER
    SELECT DISTINCT SUBSTRING(FICHRECE.FREC_FECREC,9,2)+'/'+SUBSTRING(FICHRECE.FREC_FECREC,6,2)+'/'+SUBSTRING(FICHRECE.FREC_FECREC,1,4) AS FECREC
                , SUBSTRING(DETADESPA.DDES_FECHA,9,2)+'/'+SUBSTRING(DETADESPA.DDES_FECHA,6,2)+'/'+SUBSTRING(DETADESPA.DDES_FECHA,1,4) AS FECDESPA
--                , FICHRECE.FREC_CODI AS CODRECE
                , DETARECE.DREC_CODI AS CODRECE, DETADESPA.DDES_CODI AS CODDESPA
                , DETADESPA.DDES_UNIDADES AS UNI, CONVERT(DEC(12,2),DETADESPA.DDES_PESO) AS PESO  --1046
--                , ISNULL(DETARECE.DREC_RECEPTUNEL,0) AS TUNEL
                , ISNULL(DETARECE.DREC_PROCTUNEL,0) AS TUNEL
--                    , (CASE WHEN ISNULL(DETARECE.DREC_RECEPTUNEL,0)  > 1 THEN CONVERT(VARCHAR(10),DATEADD(DD, @TUNELG, CONVERT(DATETIME,FICHRECE.FREC_FECREC,120)),111) ELSE FICHRECE.FREC_FECREC END) AS FIN_TUNEL
                    , (CASE WHEN ISNULL(DETARECE.DREC_PROCTUNEL,0)  > 1 THEN CONVERT(VARCHAR(10),DATEADD(DD, @TUNELG, CONVERT(DATETIME,FICHRECE.FREC_FECREC,120)),111) ELSE FICHRECE.FREC_FECREC END) AS FIN_TUNEL
                , ABS(DATEDIFF(DAY,  CONVERT(DATETIME, CONVERT(DATETIME,FICHRECE.FREC_FECREC,120)) , CONVERT(DATETIME, DDES_FECHA, 120)))  AS DT
                , DATEDIFF(DAY,  CONVERT(DATETIME, (CASE WHEN ISNULL(DETARECE.DREC_RECEPTUNEL,0) > 1 THEN CONVERT(VARCHAR(10),DATEADD(DD, @TUNELG, CONVERT(DATETIME,FICHRECE.FREC_FECREC,120)),111) ELSE FICHRECE.FREC_FECREC END), 120), CONVERT(DATETIME, DDES_FECHA, 120))  AS DE
                , 0 AS CT
                , 0 AS ST
                , 0 AS NUMSOP
                , 0 AS NTD
                , 0 AS COBRAR
                , FICHRECE.FREC_FECREC
                , DETADESPA.DDES_FECHA
    INTO #DESPPER
    FROM DETADESPA
        INNER JOIN FICHDESPA
            ON LEFT(DETADESPA.DDES_CODI,7) = FICHDESPA.FDES_CODI
        INNER JOIN DETARECE
            ON DETADESPA.DDES_CODRECE = DETARECE.DREC_CODI
        INNER JOIN FICHRECE
            ON LEFT(DETARECE.DREC_CODI,7) = FICHRECE.FREC_CODI
    WHERE FICHDESPA.FDES_FECHA BETWEEN @FECINI AND @FECFIN AND
         FICHDESPA.FDES_RUTCLI = @RUTCLI AND
         DETADESPA.DDES_PALLET = 1 AND
         FICHRECE.FREC_CONTCLI = @CONTR AND
         FICHDESPA.FDES_CODVIG = 0 AND
         DETADESPA.DDES_CODVIG = 0 AND
         FICHRECE.FREC_CODVIG = 0 AND
         DETARECE.DREC_CODVIG = 0 and
         FICHDESPA.fdes_origen<>'65' and
         FICHDESPA.fdes_origen<>'99' and
         FICHDESPA.fdes_origen<>'97' and
         FICHRECE.FREC_origen<>'65' and 
         FICHRECE.FREC_origen<>'99' and
         FICHRECE.FREC_origen<>'97'

    ORDER BY 13, 14, 3, 4, 5, 6

--/*
    -- PALLET SIN TUNEL, SI NUMERO DE DIAS DE ESTADIA DEL PALLET (TOTAL DE DIAS)
    -- ES MENOR O IGUAL AL CAMPO CONT_DIADRACIA DE LA TABLA CONTRATO, SI ES MAYOR NO HAY COBRO
--    SELECT FECREC, FECDESPA, CODRECE, CODDESPA, 0 AS CT, 1 AS ST, DE, 1 AS NUMSOP, UNI, PESO
    UPDATE #DESPPER
    SET CT = 0
      , ST = 1
      , NUMSOP = 1
      , COBRAR = 1
    FROM #DESPPER
    WHERE TUNEL <> 1 AND DE <= @DIAGR
--*/

    -- PALLET CON TUNEL, CALCULO NTD
/*
    SELECT FECREC, FECDESPA, CODRECE, CODDESPA, 1 AS CT
        , (CASE WHEN DE>0 THEN 1 ELSE 0 END) AS ST, DE, 1 AS NUMSOP, UNI, PESO, ABS(DE - @TUNELG) AS NTD
*/
    UPDATE #DESPPER
    SET NTD = @TUNELG + @DIAGR
      , NUMSOP = 1
      , CT = 1
    FROM #DESPPER
    WHERE TUNEL = 1 AND COBRAR = 0

    -- SI NUMERO DE DIAS DE ESTADIA DEL PALLET (DIAS CAMARA + DIAS TUNEL)
    -- ES MENOR O IGUAL AL NTD, SI ES MAYOR NO HAY COBRO
--    SELECT *
    UPDATE #DESPPER
    SET
   -- ST = (CASE WHEN DE>0 THEN 1 ELSE 0 END)
       COBRAR = 1
    FROM #DESPPER
    WHERE TUNEL = 1 AND DT <= NTD AND COBRAR = 0 AND DE>0

    DECLARE @VALUF AS DEC(12,2)
    DECLARE @FECUF AS VARCHAR(10)
    DECLARE @VALDOLAR AS DEC(12,2)
    DECLARE @FECDOLAR AS VARCHAR(10)
    DECLARE @TOTSOP AS INTEGER
    SET @VALUF = 0
    SET @FECUF = ''
    SET @VALDOLAR = 0
    SET @FECDOLAR = ''
    SET @TOTSOP = 0

    SELECT @VALUF = CASE WHEN MON_CODI = '02' THEN MON_VALOR ELSE @VALUF END
        , @FECUF = CASE WHEN MON_CODI = '02' THEN MON_FECVAL ELSE @FECUF END
        , @VALDOLAR = CASE WHEN MON_CODI = '01' THEN MON_VALOR ELSE @VALDOLAR END
        , @FECDOLAR = CASE WHEN MON_CODI = '01' THEN MON_FECVAL ELSE @FECDOLAR END
    FROM MONEDAS

    SET @FECUF = SUBSTRING(@FECUF, 9, 2)+'/'+SUBSTRING(@FECUF, 6, 2)+'/'+SUBSTRING(@FECUF, 1, 4)
    SET @FECDOLAR = SUBSTRING(@FECDOLAR, 9, 2)+'/'+SUBSTRING(@FECDOLAR, 6, 2)+'/'+SUBSTRING(@FECDOLAR, 1, 4)
    SELECT @TOTSOP = SUM(NUMSOP) FROM #DESPPER WHERE COBRAR = 1

    IF @IDENT <> 0
    BEGIN
        INSERT INTO TMPCABSERVICIOS
        SELECT  ISNULL(@IDENT, 0), ISNULL(@CONTR, 0), ISNULL(@CONTRVAL, 0), ISNULL(@MONDESC, 0), ISNULL(@MONVAL, 0)
            , ISNULL(@MEDDESC, 0), ISNULL(@TOTSOP, 0), 0, ISNULL(@VALUF, 0), ISNULL(@FECUF, 0)
            , ISNULL(@VALDOLAR, 0), ISNULL(@FECDOLAR, 0), 0, 0, 0, 0, 0, 0, ISNULL(@DIAGR, 0)
    END

    SELECT FECREC, FECDESPA, CODRECE, CODDESPA
        , CT, ST, DE, NUMSOP, UNI, PESO, @DIAGR AS DERENTRADA, @TOTSOP AS TOTSOP, TUNEL,DT,FIN_TUNEL, FREC_FECREC
    FROM #DESPPER
    WHERE COBRAR = 1
    ORDER BY CONVERT(DATETIME,FREC_FECREC,120), CONVERT(DATETIME,DDES_FECHA,120), CODRECE, CODDESPA
--    ORDER BY FREC_FECREC ,DDES_FECHA, CODRECE, CODDESPA
GO
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO





-- Autor:    Carolina Uribe Ruiz - ACL
-- Objetivo:    INGRESO DE ESCALA PARA SERVICIOS NUMERAL PROMEDIO MNIMO TNEL Y NUMERAL SUMA CONTRATOS MNIMO Y TNEL

-- Fecha de Creacin:    29-06-2007
-- Modificaciones:
-- Pruebas
/*
exec PA_ING_ESCALASERV '0002900', '08', 2
SELECT CODIGO FROM CORRTABLAS WHERE RTRIM(LTRIM(TABLA)) = 'ESCALA'
*/


CREATE PROCEDURE [dbo].[PA_ING_ESCALASERV]
  @ESCCONTR VARCHAR(7)
, @ESCSERV VARCHAR(2)
, @TOTTRAMAS INT
AS

    SET NOCOUNT ON
    BEGIN TRAN
        DECLARE @ESCCOD AS INT
        SET @ESCCOD = 0

        SELECT @ESCCOD = CODIGO + 1 FROM CORRTABLAS WHERE RTRIM(LTRIM(TABLA)) = 'ESCALA'
        IF @ESCCOD > 0
        BEGIN

            UPDATE CORRTABLAS
            SET CODIGO = @ESCCOD
            WHERE RTRIM(LTRIM(TABLA)) = 'ESCALA'

            INSERT INTO ESCALASERV
                ( ESCCOD, ESCCONTR, ESCSERV, TOTTRAMAS)
            VALUES
                ( @ESCCOD, @ESCCONTR, @ESCSERV, @TOTTRAMAS)

            IF NOT EXISTS (SELECT * FROM CONTRPARA WHERE CPAR_CONTR = @ESCCONTR AND CPAR_SERVI = @ESCSERV)
                INSERT INTO CONTRPARA
                    ( CPAR_CONTR, CPAR_SERVI, CPAR_MARCA, CPAR_VALOR, CPAR_MONEDA, CPAR_MEDIDA,
CPAR_CODVIG)
                VALUES
                    (@ESCCONTR, @ESCSERV, '1', 0, '00', '',0 )
            ELSE
                UPDATE CONTRPARA
                SET CPAR_MARCA = CASE WHEN @TOTTRAMAS > 0 THEN 1 ELSE 0 END
                WHERE CPAR_CONTR = @ESCCONTR
                    AND @ESCSERV = CPAR_SERVI
        END
        ELSE
            BEGIN
                ROLLBACK TRAN
                SELECT -1
                RETURN
            END
    IF @@ERROR > 0
    BEGIN
        ROLLBACK TRAN
        SELECT 0
    END
    ELSE
    BEGIN
        COMMIT TRAN
        SELECT @ESCCOD
    END

    RETURN


GO
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO



-- Autor:    Carolina Uribe Ruiz - ACL
-- Objetivo:    INGRESO DE TRAMOS DE TARIFICACION POR ESCALA PARA LOS SERVICIOS NUMERAL PROMEDIO MNIMO TNEL Y NUMERAL SUMA CONTRATOS MNIMO Y TNEL
-- Fecha de Creacin:    29-06-2007
-- Modificaciones:
-- Pruebas
/*
exec PA_ING_TRAMOS '1', '1', 'TRAMO 1', 1,10,1000

*/


CREATE PROCEDURE [dbo].[PA_ING_TRAMOS]
  @TRAMCOD INT
, @ESCCOD AS INT
, @TRAMNOMB VARCHAR(50)
, @TRAMDESDE INT
, @TRAMHASTA INT
, @TRAMVAL REAL
, @TRAMINI INT
AS

    SET NOCOUNT ON
    BEGIN TRAN

        IF EXISTS(SELECT * FROM TRAMO WHERE TRAMCOD = @TRAMCOD AND ESCCOD = @ESCCOD)
            UPDATE TRAMO
            SET       TRAMNOMB = @TRAMNOMB
                , TRAMDESDE = @TRAMDESDE
                , TRAMHASTA = @TRAMHASTA
                , TRAMVAL = @TRAMVAL
            FROM TRAMO
            WHERE TRAMCOD = @TRAMCOD AND ESCCOD = @ESCCOD
        ELSE
            INSERT INTO TRAMO
                ( TRAMCOD, ESCCOD, TRAMNOMB, TRAMDESDE, TRAMHASTA, TRAMVAL)
            VALUES
                ( @TRAMCOD, @ESCCOD, @TRAMNOMB, @TRAMDESDE, @TRAMHASTA, @TRAMVAL)

        IF @TRAMINI >@TRAMCOD
            DELETE TRAMO
            WHERE ESCCOD = @ESCCOD AND TRAMCOD > @TRAMINI

    IF @@ERROR > 0
    BEGIN
        ROLLBACK TRAN
        DELETE ESCALASERV
        WHERE ESCCOD = @ESCCOD

        SELECT 0
    END
    ELSE
    BEGIN
        COMMIT TRAN
        UPDATE ESCALASERV
        SET TOTTRAMAS = @TRAMCOD
        WHERE ESCCOD = @ESCCOD
        SELECT 1


    END


GO
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO



CREATE PROCEDURE [dbo].[PA_INS_DETAPRESLO]
@PRES_CODI    NVARCHAR(22),
@PRES_CASLO    NVARCHAR(10),
@PRES_CODPRO    NVARCHAR(14),
@PRES_UNIDADES    INT,
@PRES_PESO    FLOAT,
@PRES_FECPROD    NVARCHAR(20),
@PRES_FOLIO    NVARCHAR(22),
@PRES_ACTIVA    TINYINT,
@PRES_RADIO    TINYINT,
@PRES_CODVIG    TINYINT
AS
   INSERT INTO DETAPRESLO
   (PRES_UNICA,
    PRES_CODI,
    PRES_CASLO,
    PRES_CODPRO,
    PRES_UNIDADES,
    PRES_PESO,
    PRES_FECPROD,
    PRES_FOLIO,
    PRES_ACTIVA,
    PRES_RADIO,
    PRES_CODVIG)
   VALUES
   (NEWID(),
    @PRES_CODI,
    @PRES_CASLO,
    @PRES_CODPRO,
    @PRES_UNIDADES,
    @PRES_PESO,
    @PRES_FECPROD,
    @PRES_FOLIO,
    @PRES_ACTIVA,
    @PRES_RADIO,
    @PRES_CODVIG)


GO
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO

CREATE PROCEDURE  [dbo].[PA_INS_FICHPRED]
@FPRE_CODI        NVARCHAR (14),
@FPRE_RUTCLI      NVARCHAR (18),
@FPRE_HORADES     NVARCHAR (10),
@FPRE_HORATER     NVARCHAR (10),
@FPRE_FECDES      NVARCHAR (20),
@FPRE_TOTSOPO     INT,
@FPRE_TOTUNIDAD   INT,
@FPRE_TOTPESO     FLOAT,
@FPRE_RUTCOND     NVARCHAR (18),
@FPRE_CODIENCA    NVARCHAR (06),
@FPRE_ACTIVA      NVARCHAR (02),
@FPRE_FECHACT     NVARCHAR (20),
@FPRE_CODVIG      NVARCHAR (02),
@FPRE_GDESPA      NVARCHAR (14),
@FPRE_RADIO       NVARCHAR (02),
@FPRE_TIPO        INT,
@FPRE_PROCESO     INT,
@FPRE_SELLO       VARCHAR  (50),
@FPRE_TEM         REAL,
@FPRE_ANDEN       NVARCHAR (20)
--@FPRE_USUCRE      NVARCHAR (12),
--@EST_CODI         INT
AS
BEGIN
    IF EXISTS ( SELECT FPRE_CODI
                FROM   FICHPRED
                WHERE  FPRE_CODI = @FPRE_CODI)

   UPDATE FICHPRED
   SET FPRE_RUTCLI      = @FPRE_RUTCLI,
       FPRE_HORADES     = @FPRE_HORADES,
       FPRE_HORATER     = @FPRE_HORATER,
       FPRE_FECDES      = @FPRE_FECDES,
       FPRE_TOTSOPO     = @FPRE_TOTSOPO,
       FPRE_TOTUNIDAD   = @FPRE_TOTUNIDAD,
       FPRE_TOTPESO     = @FPRE_TOTPESO,
       FPRE_RUTCOND     = @FPRE_RUTCOND,
       FPRE_CODIENCA    = @FPRE_CODIENCA,
       FPRE_ACTIVA      = @FPRE_ACTIVA,
       FPRE_FECHACT     = @FPRE_FECHACT,
       FPRE_CODVIG      = @FPRE_CODVIG,
       FPRE_GDESPA      = @FPRE_GDESPA,
       FPRE_RADIO       = @FPRE_RADIO,
       FPRE_TIPO        = @FPRE_TIPO,
       FPRE_PROCESO     = @FPRE_PROCESO,
       FPRE_SELLO       = @FPRE_SELLO,
       FPRE_TEM         = @FPRE_TEM,
       FPRE_ANDEN       = @FPRE_ANDEN
--       FPRE_USUCRE      = @FPRE_USUCRE,
--             EST_CODI         = @EST_CODI
          WHERE FPRE_CODI  = @FPRE_CODI
   ELSE
  INSERT INTO FICHPRED
   (FPRE_UNICA,
    FPRE_CODI,
    FPRE_RUTCLI,
    FPRE_HORADES,
    FPRE_HORATER,
    FPRE_FECDES,
    FPRE_TOTSOPO,
    FPRE_TOTUNIDAD,
    FPRE_TOTPESO,
    FPRE_RUTCOND,
    FPRE_CODIENCA,
    FPRE_ACTIVA,
    FPRE_FECHACT,
    FPRE_CODVIG,
    FPRE_GDESPA,
    FPRE_RADIO,
    FPRE_TIPO,
    FPRE_PROCESO,
    FPRE_SELLO,
    FPRE_TEM,
    FPRE_ANDEN)
--    FPRE_USUCRE,
--    EST_CODI)
   VALUES
   (NEWID(),
    @FPRE_CODI,
    @FPRE_RUTCLI,
    @FPRE_HORADES,
    @FPRE_HORATER,
    @FPRE_FECDES,
    @FPRE_TOTSOPO,
    @FPRE_TOTUNIDAD,
    @FPRE_TOTPESO,
    @FPRE_RUTCOND,
    @FPRE_CODIENCA,
    @FPRE_ACTIVA,
    @FPRE_FECHACT,
    @FPRE_CODVIG,
    @FPRE_GDESPA,
    @FPRE_RADIO,
    @FPRE_TIPO,
    @FPRE_PROCESO,
    @FPRE_SELLO,
    @FPRE_TEM,
    @FPRE_ANDEN )
--    @FPRE_USUCRE,
--    0)
END


GO
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO



CREATE PROCEDURE [dbo].[PA_INS_MOVPALLET]
@MOV_FOLIO              NVARCHAR(18),
@MOV_CODPER             NVARCHAR(06),
@MOV_CA                 NVARCHAR(04),
@MOV_BA                 NVARCHAR(06),
@MOV_CO                 NVARCHAR(04),
@MOV_PI                 NVARCHAR(04),
@MOV_NI                 NVARCHAR(02),
@MOV_FECHA              NVARCHAR(20),
@MOV_TIPO               NVARCHAR(04),
@MOV_HORA               NVARCHAR(20),
@MOV_TS                 REAL,
@MOV_TM                 REAL,
@MOV_TI                 REAL,
@MOV_DOC                NVARCHAR(20),
@MOV_RECEPTUNEL         INT,
@MOV_DESPACHO           INT,
@MOV_SALDO              INT,
@MOV_DOCDESPA           NVARCHAR(18),
@MOV_CHORUT             NVARCHAR(20),
@MOV_CHONOM             NVARCHAR(100),
@MOV_CHOPAT             NVARCHAR(20),
@MOV_CHOTRA             NVARCHAR(100),
@MOV_ANDEN              NVARCHAR(20)
AS
     INSERT INTO MOVPALLET
       (MOV_UNICA,
        MOV_FOLIO,
    MOV_CODPER,
    MOV_CA,
    MOV_BA,
    MOV_CO,
    MOV_PI,
    MOV_NI,
    MOV_FECHA,
    MOV_TIPO,
    MOV_HORA,
    MOV_TS,
    MOV_TM,
    MOV_TI,
    MOV_DOC,
    MOV_RECEPTUNEL,
    MOV_DESPACHO,
    MOV_SALDO,
    MOV_DOCDESPA,
    MOV_CHORUT,
    MOV_CHONOM,
    MOV_CHOPAT,
    MOV_CHOTRA,
    MOV_ANDEN)
     VALUES
       (NEWID(),
        @MOV_FOLIO,
    @MOV_CODPER,
    @MOV_CA,
    @MOV_BA,
    @MOV_CO,
    @MOV_PI,
    @MOV_NI,
    @MOV_FECHA,
    @MOV_TIPO,
    @MOV_HORA,
    @MOV_TS,
    @MOV_TM,
    @MOV_TI,
    @MOV_DOC,
    @MOV_RECEPTUNEL,
    @MOV_DESPACHO,
    @MOV_SALDO,
    @MOV_DOCDESPA,
    @MOV_CHORUT,
    @MOV_CHONOM,
    @MOV_CHOPAT,
    @MOV_CHOTRA,
    @MOV_ANDEN)


GO
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO



CREATE PROCEDURE [dbo].[PA_INS_PICKING]
@FOLIO        CHAR(10),
@DESPACHO    CHAR(10),
@CLIENTE    CHAR(10),
@CANTIDAD    FLOAT,
@PESO        FLOAT,
@PALLET        FLOAT,
@FECHA        DATETIME,
@CONTRATO    CHAR(10),
@CODIGO_RECEP    VARCHAR(50)
AS
   INSERT INTO PICKING
    (FOLIO,
     DESPACHO,
         CLIENTE,
         CANTIDAD,
         PESO,
         PALLET,
         FECHA,
         CONTRATO,
         CODIGO_RECEP)
   VALUES
    (@FOLIO,
     @DESPACHO,
         @CLIENTE,
         @CANTIDAD,
         @PESO,
         @PALLET,
         @FECHA,
         @CONTRATO,
         @CODIGO_RECEP)


GO
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO





-- Autor:    Carolina Uribe Ruiz / ACL
-- Objetivo:    LIBERA POSICIONES DE CAMARAS
-- Fecha de Creacin: 26-09-2007
-- Modificaciones:
-- Pruebas
/*
exec  PA_LST_TMPSERVICIOS
*/




-- Autor:    Carolina Uribe Ruiz
-- Objetivo:
-- Fecha de Creacin:
-- Modificaciones:
-- Pruebas
/*
exec  PA_LST_TMPSERV_MINTUNEL
*/


CREATE PROCEDURE [dbo].[PA_LST_TMPSERV_MINTUNEL]
  @IDENT NUMERIC
, @SERV INT=0

AS

    SET NOCOUNT ON
    SET rowcount 0

    IF @SERV = 9
        SELECT CONTRVAL, MONDESC, MONVAL, MEDDESC, TOTSOP, VALUF, VALDOLAR, FECUF, FECDOLAR, CONTRDERENTR
        FROM TMPCABSERVICIOS
        WHERE TMPCABSERVICIOS.IDENT = @IDENT
    ELSE
        SELECT TMPCABSERVICIOS.IDENT, LINEA, FECHA, CT, ST, DP, STOCK, FACTURAR, UNIDADES, TONELADAS, CONTRVAL,
MONDESC, MONVAL
            , MEDDESC, TOTSOP, VALNETO, VALUF, VALDOLAR, TOTCT, TOTST, TOTDP, TOTSTOCK, TOTUNI, TOTTONE
            , FECUF, FECDOLAR, CONTRDERENTR
        FROM TMPCABSERVICIOS INNER JOIN TMPDETSERVICIOS
            ON TMPCABSERVICIOS.IDENT = TMPDETSERVICIOS.IDENT
        WHERE TMPCABSERVICIOS.IDENT = @IDENT

    RETURN 0


GO
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO



-- Autor:    Carolina Uribe Ruiz
-- Objetivo:
-- Fecha de Creacin:
-- Modificaciones:
-- Pruebas
/*
exec  PA_LST_TMPSERVICIOS 1
*/


CREATE PROCEDURE [dbo].[PA_LST_TMPSERVICIOS]
@IDENT NUMERIC

AS

    SET NOCOUNT ON
    SET rowcount 0

    SELECT TMPCABSERVICIOS.IDENT, TMPCABSERVICIOS.CONTRATO, LINEA, FECHA, CT, ST, DP, STOCK, FACTURAR, UNIDADES,
TONELADAS, CONTRVAL, MONDESC, MONVAL
        , MEDDESC, TOTSOP, VALNETO, VALUF, VALDOLAR, TOTCT, TOTST, TOTDP, TOTSTOCK, TOTUNI, TOTTONE, CONTRDERENTR
        , FECUF, FECDOLAR, CONTRATO.CONT_DESCR
    FROM   TMPCABSERVICIOS INNER JOIN TMPDETSERVICIOS
            ON TMPCABSERVICIOS.IDENT = TMPDETSERVICIOS.IDENT
                AND TMPCABSERVICIOS.CONTRATO = TMPDETSERVICIOS.CONTRATO
        INNER JOIN CONTRATO
            ON TMPCABSERVICIOS.CONTRATO = CONTRATO.CONT_CODI
    WHERE TMPCABSERVICIOS.IDENT = @IDENT

    RETURN 0


GO
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO




CREATE PROCEDURE [dbo].[PA_LST_TRAMOSXCLIE]
  @RUTCLI as  VARCHAR(9)
, @SERV as  VARCHAR(2)
, @CONTR AS VARCHAR(7)
AS


--    SET NOCOUNT ON
--    SET rowcount 0


    SELECT DISTINCT TRAMO.TRAMNOMB, TRAMO.TRAMDESDE, TRAMO.TRAMHASTA, TRAMVAL
    FROM CONTRATO INNER JOIN CONTRPARA
        ON CONTRATO.CONT_CODI = CONTRPARA.CPAR_CONTR INNER JOIN ESCALASERV
        ON CONTRPARA.CPAR_CONTR = ESCALASERV.ESCCONTR COLLATE MODERN_SPANISH_CI_AS INNER JOIN TRAMO
        ON ESCALASERV.ESCCOD = TRAMO.ESCCOD
    WHERE CONTRATO.CONT_RUTCLIE = @RUTCLI
        AND ESCALASERV.ESCSERV = @SERV
        AND ESCALASERV.ESCCONTR = @CONTR


GO
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO

CREATE PROCEDURE [dbo].[PA_NUMERALES]
  @FECINI AS VARCHAR(10)
, @FECFIN AS VARCHAR(10)
, @RUTCLI AS VARCHAR(9)
, @CONTR AS VARCHAR(7)
, @IDENT AS NUMERIC = 0
AS
 SET NOCOUNT ON
 SET rowcount 0
 DECLARE @DESCONTR AS VARCHAR(40)
 DECLARE @DIAGR AS SMALLINT
 DECLARE @TUNELG AS INT
 DECLARE @DIACONT AS SMALLINT
 DECLARE @MINPALL AS INT
 DECLARE @RECEPANT AS INT
 DECLARE @RUNIDANT AS INT
 DECLARE @RTONEANT AS INT
 DECLARE @DESPANT AS INT
 DECLARE @DUNIDANT AS INT
 DECLARE @DTONEANT AS INT
 DECLARE @RECEPPER AS INT
 DECLARE @DESPPER AS INT
 DECLARE @STOCK AS INT
 DECLARE @UNIDADES AS INT
 DECLARE @TONELADAS AS INT
 DECLARE @TOTDIAS AS INT
 DECLARE @CONTRVAL AS DEC(12,2)
 DECLARE @MONDESC AS VARCHAR(30)
 DECLARE @MONVAL AS DEC(12,2)
 DECLARE @MEDDESC AS VARCHAR(30)

 SET @DESCONTR = ''
 SET @DIAGR = 0
 SET @TUNELG = 0
 SET @DIACONT = 0
 SET @MINPALL = 0
 SET @STOCK = 0
 SET @RUNIDANT = 0
 SET @RTONEANT = 0
 SET @DUNIDANT = 0
 SET @DTONEANT = 0
 SET @TOTDIAS = (DATEDIFF(DAY, CONVERT(DATETIME, @FECINI, 111), CONVERT(DATETIME, @FECFIN, 111)) + 1)
 SET @CONTRVAL = 0
 SET @MONDESC = ''
 SET @MONVAL = 0
 SET @MEDDESC = ''

 SELECT @DIAGR=CONTRATO.CONT_DIAGRACIA
      , @TUNELG=CASE WHEN CONTRATO.CONT_TUNELG=0 THEN 0 ELSE CONTRATO.CONT_TUNELG END
      , @DESCONTR=CONTRATO.CONT_DESCR
      , @DIACONT=CONTRATO.CONT_DIACONT, @MINPALL=CONTRATO.CONT_PALLET
      , @CONTRVAL = CONTRPARA.CPAR_VALOR
      , @MONDESC = MONEDAS.MON_DESCR, @MONVAL = MONEDAS.MON_VALOR
      , @MEDDESC = MEDIDAS.MED_DESCR
 FROM CONTRPARA INNER JOIN
      CONTRATO ON CONTRPARA.CPAR_CONTR = CONTRATO.CONT_CODI INNER JOIN MONEDAS
      MONEDAS ON CONTRPARA.CPAR_MONEDA = MONEDAS.MON_CODI INNER JOIN
      MEDIDAS ON CONVERT(INT,CONTRPARA.CPAR_MEDIDA) = CONVERT(INT,MEDIDAS.MED_CODI)
 WHERE CONTRPARA.CPAR_CONTR = @CONTR
  AND CONTRPARA.CPAR_SERVI = 14


CREATE TABLE #NUMMIN (LINEA INT, FECHA VARCHAR(10), FECHA1 VARCHAR(10), CT INT, ST INT, DP INT, STOCK INT, FACTURAR INT, UNIDADES INT, TONELADAS DECIMAL(12,2))

DECLARE @LIN INT
DECLARE @ILIN INT
Declare @Dfechaini datetime
Declare @Dfechafin datetime

set @dfechaini = DATEADD(  DAY, (CASE WHEN @TUNELG=0 THEN 0 ELSE - @tuneLG - 2 END) , convert(datetime , @fecini,101))
set @dfechafin = convert(datetime , @fecfin,101)
set @LIN=1
while @dfechaini <= @dfechafin
begin
    INSERT INTO #NUMMIN(LINEA, FECHA, FECHA1, CT, ST, DP, STOCK, FACTURAR, UNIDADES, TONELADAS)
    VALUES(case when @tunelg=0 then @lin else @LIN - @tunelg - 2 end, convert(char,@dfechaini,103), convert(char,@dfechaini,111), 0, 0, 0, 0, 0, 0, 0)

    set @dfechaini = dateadd(day,1,@dfechaini)
    set @LIN = @LIN +1
end

	DECLARE @TOTCT AS INT
	DECLARE @TOTST AS INT
	DECLARE @TOTDP AS INT
	DECLARE @TOTSTOCK AS INT
	DECLARE @TOTSOP AS INT
	DECLARE @TOTUNI AS INT
	DECLARE @TOTTONE AS DEC(12,2)
	DECLARE @VALNETO AS DEC(12,2)
	DECLARE @VALUF AS DEC(12,2)
	DECLARE @FECUF AS VARCHAR(10)
	DECLARE @VALDOLAR AS DEC(12,2)
	DECLARE @FECDOLAR AS VARCHAR(10)
	SET @TOTCT = 0
	SET @TOTST = 0
	SET @TOTDP = 0
	SET @TOTSTOCK = 0
	SET @TOTSOP = 0
	SET @TOTUNI = 0
	SET @TOTTONE = 0
	SET @VALNETO = 0
	SET @VALUF = 0
	SET @FECUF = ''
	SET @VALDOLAR = 0
	SET @FECDOLAR = ''

DECLARE @FECHALIN AS VARCHAR(10)

SET @LIN = @LIN - 1
SET @ILIN=1
WHILE @ILIN <= @LIN 
BEGIN
       -- CALCULA 

      SELECT  @FECHALIN = FECHA1 FROM #NUMMIN WHERE LINEA = @ILIN

      UPDATE #NUMMIN
           SET CT = (SELECT COUNT(1) FROM DETARECE  WHERE DREC_PALLET=1 and DREC_RUTCLI=@RUTCLI AND DREC_CONTCLI=@CONTR AND DREC_CODVIG= 0 AND DREC_FECREC =  @FECHALIN AND DREC_TUNEL>=1),
	       ST = (SELECT COUNT(1) FROM DETARECE  WHERE DREC_PALLET=1 and DREC_RUTCLI=@RUTCLI AND DREC_CONTCLI=@CONTR AND DREC_CODVIG= 0 AND DREC_FECREC =  @FECHALIN AND DREC_TUNEL=0),
	       DP = (SELECT COUNT(1) FROM DETADESPA WHERE Ddes_PALLET=1 and DDES_RUTCLI=@RUTCLI AND DDES_CONTCLI=@CONTR AND DDES_CODVIG= 0 AND DDES_FECHA  =  @FECHALIN )
      WHERE LINEA = @ILIN

      UPDATE #NUMMIN

       SET STOCK = (SELECT COUNT(1) FROM DETARECE  WHERE DREC_PALLET=1 and  DREC_RUTCLI=@RUTCLI AND DREC_CONTCLI=@CONTR AND DREC_CODVIG= 0 AND DREC_FECREC <=  @FECHALIN)
		    -
		   (SELECT COUNT(1) FROM DETAdespa WHERE Ddes_PALLET=1 and DDES_RUTCLI=@RUTCLI AND DDES_CONTCLI=@CONTR AND DDES_CODVIG= 0 AND DDES_FECHA  <=  @FECHALIN)
	,UNIDADES = isnull((SELECT sum(isnull(drec_unidades,0)) FROM DETARECE  WHERE DREC_RUTCLI=@RUTCLI AND DREC_CONTCLI=@CONTR AND DREC_CODVIG= 0 AND DREC_FECREC <=  @FECHALIN),0)
			-
		    isnull((SELECT sum(isnull(ddes_unidades,0)) FROM DETAdespa WHERE DDES_RUTCLI=@RUTCLI AND DDES_CONTCLI=@CONTR AND DDES_CODVIG= 0 AND DDES_FECHA  <=  @FECHALIN),0)
	,TONELADAS = isnull((SELECT sum(isnull(drec_PESO,0)) FROM DETARECE  WHERE DREC_RUTCLI=@RUTCLI AND DREC_CONTCLI=@CONTR AND DREC_CODVIG= 0 AND DREC_FECREC <=  @FECHALIN),0)
			-
		    isnull((SELECT sum(isnull(ddes_PESO,0)) FROM DETAdespa WHERE DDES_RUTCLI=@RUTCLI AND DDES_CONTCLI=@CONTR AND DDES_CODVIG= 0 AND DDES_FECHA  <=  @FECHALIN),0)
       WHERE LINEA = @ILIN

      IF @ILIN=1
		UPDATE #NUMMIN SET FACTURAR = STOCK WHERE LINEA = @ILIN
	ELSE
	begin
		UPDATE #NUMMIN  SET FACTURAR = ST - DP + ISNULL((SELECT F.FACTURAR FROM #NUMMIN F WHERE F.LINEA = @ILIN - 1),0) WHERE LINEA = @ILIN

		UPDATE #NUMMIN SET FACTURAR = facturar + ISNULL((SELECT F.CT FROM #NUMMIN F WHERE F.LINEA = @ILIN - @TUNELG   ),0)
		WHERE LINEA = @ILIN
	end

       SET @ILIN= @ILIN + 1
END 

	UPDATE #NUMMIN SET FACTURAR = @MINPALL
	WHERE FACTURAR < @MINPALL and stock>0

 SELECT  @TOTSOP = SUM(FACTURAR), @VALNETO = (SUM(FACTURAR) * @CONTRVAL)
        , @TOTCT = SUM(CT), @TOTST = SUM(ST)
        , @TOTDP = SUM(DP), @TOTSTOCK = SUM(STOCK)
        , @TOTUNI = SUM(UNIDADES), @TOTTONE = SUM(TONELADAS)
 FROM #NUMMIN
 WHERE FECHA1 >=@FECINI

 SELECT  @VALUF = CASE WHEN MON_CODI = '02' THEN MON_VALOR ELSE @VALUF END
  , @FECUF = CASE WHEN MON_CODI = '02' THEN MON_FECVAL ELSE @FECUF END
  , @VALDOLAR = CASE WHEN MON_CODI = '01' THEN MON_VALOR ELSE @VALDOLAR END
  , @FECDOLAR = CASE WHEN MON_CODI = '01' THEN MON_FECVAL ELSE @FECDOLAR END
 FROM MONEDAS

 SET @FECUF = SUBSTRING(@FECUF, 9, 2)+'/'+SUBSTRING(@FECUF, 6, 2)+'/'+SUBSTRING(@FECUF, 1, 4)
 SET @FECDOLAR = SUBSTRING(@FECDOLAR, 9, 2)+'/'+SUBSTRING(@FECDOLAR, 6, 2)+'/'+SUBSTRING(@FECDOLAR, 1, 4)

 IF @IDENT <> 0
 BEGIN
 -- select 'ins'
  INSERT INTO TMPCABSERVICIOS
  SELECT @IDENT, @CONTR, @CONTRVAL, @MONDESC, @MONVAL, @MEDDESC, @TOTSOP, ISNULL(@VALNETO,0), @VALUF, @FECUF,
     ISNULL(@VALDOLAR,0), ISNULL(@FECDOLAR,0), ISNULL(@TOTCT,0), ISNULL(@TOTST,0),
     ISNULL(@TOTDP,0), ISNULL(@TOTSTOCK,0), ISNULL(@TOTUNI,0), ISNULL(@TOTTONE,0), 0

  INSERT INTO TMPDETSERVICIOS
  SELECT @IDENT, @CONTR, LINEA, FECHA, CT, ST, DP, STOCK, ISNULL(FACTURAR,0), ISNULL(UNIDADES,0), ISNULL(TONELADAS,0)
  FROM #NUMMIN
  WHERE FECHA1 >=@FECINI
  ORDER BY 1
 END
GO
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO




CREATE PROCEDURE [dbo].[PA_NUMERALMINTUNEL]
  @FECINI AS VARCHAR(10)
, @FECFIN AS VARCHAR(10)
, @RUTCLI AS VARCHAR(9)
, @CONTR AS VARCHAR(7)
, @IDENT AS NUMERIC = 0
AS
 SET NOCOUNT ON
 SET rowcount 0
 DECLARE @DESCONTR AS VARCHAR(40)
 DECLARE @DIAGR AS SMALLINT
 DECLARE @TUNELG AS INT
 DECLARE @DIACONT AS SMALLINT
 DECLARE @MINPALL AS INT
 DECLARE @RECEPANT AS INT
 DECLARE @RUNIDANT AS INT
 DECLARE @RTONEANT AS INT
 DECLARE @DESPANT AS INT
 DECLARE @DUNIDANT AS INT
 DECLARE @DTONEANT AS INT
 DECLARE @RECEPPER AS INT
 DECLARE @DESPPER AS INT
 DECLARE @STOCK AS INT
 DECLARE @UNIDADES AS INT
 DECLARE @TONELADAS AS INT
 DECLARE @TOTDIAS AS INT
 DECLARE @CONTRVAL AS DEC(12,2)
 DECLARE @MONDESC AS VARCHAR(30)
 DECLARE @MONVAL AS DEC(12,2)
 DECLARE @MEDDESC AS VARCHAR(30)

 SET @DESCONTR = ''
 SET @DIAGR = 0
 SET @TUNELG = 0
 SET @DIACONT = 0
 SET @MINPALL = 0
 SET @STOCK = 0
 SET @RUNIDANT = 0
 SET @RTONEANT = 0
 SET @DUNIDANT = 0
 SET @DTONEANT = 0
 SET @TOTDIAS = (DATEDIFF(DAY, CONVERT(DATETIME, @FECINI, 111), CONVERT(DATETIME, @FECFIN, 111)) + 1)
 SET @CONTRVAL = 0
 SET @MONDESC = ''
 SET @MONVAL = 0
 SET @MEDDESC = ''

 SELECT @DIAGR=CONTRATO.CONT_DIAGRACIA
      , @TUNELG=CASE WHEN CONTRATO.CONT_TUNELG=0 THEN 0 ELSE CONTRATO.CONT_TUNELG END
      , @DESCONTR=CONTRATO.CONT_DESCR
      , @DIACONT=CONTRATO.CONT_DIACONT, @MINPALL=CONTRATO.CONT_PALLET
      , @CONTRVAL = CONTRPARA.CPAR_VALOR
      , @MONDESC = MONEDAS.MON_DESCR, @MONVAL = MONEDAS.MON_VALOR
      , @MEDDESC = MEDIDAS.MED_DESCR
 FROM CONTRPARA INNER JOIN
      CONTRATO ON CONTRPARA.CPAR_CONTR = CONTRATO.CONT_CODI INNER JOIN MONEDAS
      MONEDAS ON CONTRPARA.CPAR_MONEDA = MONEDAS.MON_CODI INNER JOIN
      MEDIDAS ON CONVERT(INT,CONTRPARA.CPAR_MEDIDA) = CONVERT(INT,MEDIDAS.MED_CODI)
 WHERE CONTRATO.CONT_estado='0' and CONTRPARA.CPAR_CONTR = @CONTR
  AND CONTRPARA.CPAR_SERVI = 14


CREATE TABLE #NUMMIN (LINEA INT, FECHA VARCHAR(10), FECHA1 VARCHAR(10), CT INT, ST INT, DP INT, STOCK INT, FACTURAR INT, UNIDADES INT, TONELADAS DECIMAL(12,2))

DECLARE @LIN INT
DECLARE @ILIN INT
Declare @Dfechaini datetime
Declare @Dfechafin datetime

set @dfechaini = DATEADD(  DAY, (CASE WHEN @TUNELG=0 THEN 0 ELSE - @tuneLG - 2 END) , convert(datetime , @fecini,101))
set @dfechafin = convert(datetime , @fecfin,101)
set @LIN=1
while @dfechaini <= @dfechafin
begin


    INSERT INTO #NUMMIN(LINEA, FECHA, FECHA1, CT, ST, DP, STOCK, FACTURAR, UNIDADES, TONELADAS)
    VALUES(case when @tunelg=0 then @lin else @LIN - @tunelg - 2 end, convert(char,@dfechaini,103), convert(char,@dfechaini,111), 0, 0, 0, 0, 0, 0, 0)

    set @dfechaini = dateadd(day,1,@dfechaini)
    set @LIN = @LIN +1
end

	DECLARE @TOTCT AS INT
	DECLARE @TOTST AS INT
	DECLARE @TOTDP AS INT
	DECLARE @TOTSTOCK AS INT
	DECLARE @TOTSOP AS INT
	DECLARE @TOTUNI AS INT
	DECLARE @TOTTONE AS DEC(12,2)
	DECLARE @VALNETO AS DEC(12,2)
	DECLARE @VALUF AS DEC(12,2)
	DECLARE @FECUF AS VARCHAR(10)
	DECLARE @VALDOLAR AS DEC(12,2)
	DECLARE @FECDOLAR AS VARCHAR(10)
	SET @TOTCT = 0
	SET @TOTST = 0
	SET @TOTDP = 0
	SET @TOTSTOCK = 0
	SET @TOTSOP = 0
	SET @TOTUNI = 0
	SET @TOTTONE = 0
	SET @VALNETO = 0
	SET @VALUF = 0
	SET @FECUF = ''
	SET @VALDOLAR = 0
	SET @FECDOLAR = ''

DECLARE @FECHALIN AS VARCHAR(10)

SET @LIN = @LIN - 1
SET @ILIN=1
WHILE @ILIN <= @LIN 
BEGIN
       -- CALCULA 

      SELECT  @FECHALIN = FECHA1 FROM #NUMMIN WHERE LINEA = @ILIN

      UPDATE #NUMMIN
           SET CT = (SELECT count(1) FROM DETARECE  WHERE drec_pallet=1 and DREC_RUTCLI=@RUTCLI AND DREC_CONTCLI=@CONTR AND DREC_CODVIG= 0 AND DREC_FECREC =  @FECHALIN AND DREC_TUNEL>=1),
	       ST = (SELECT count(1) FROM DETARECE  WHERE drec_pallet=1 and DREC_RUTCLI=@RUTCLI AND DREC_CONTCLI=@CONTR AND DREC_CODVIG= 0 AND DREC_FECREC =  @FECHALIN AND DREC_TUNEL=0),
	       DP = (SELECT count(1) FROM DETAdespa WHERE DDES_PALLET=1 and DDES_RUTCLI=@RUTCLI AND DDES_CONTCLI=@CONTR AND DDES_CODVIG= 0 AND DDES_FECHA  =  @FECHALIN)
       WHERE LINEA = @ILIN

      UPDATE #NUMMIN

       SET
	STOCK = (SELECT count(1) FROM DETARECE  WHERE DREC_RUTCLI=@RUTCLI AND DREC_CONTCLI=@CONTR AND DREC_CODVIG= 0 AND DREC_FECREC <=  @FECHALIN  and drec_pallet=1)
		    -
	        (SELECT count(1) FROM DETAdespa WHERE DDES_RUTCLI=@RUTCLI AND DDES_CONTCLI=@CONTR AND DDES_CODVIG= 0 AND DDES_FECHA  <=  @FECHALIN  and ddes_pallet=1)

	,UNIDADES = isnull((SELECT sum(isnull(drec_unidades,0)) FROM DETARECE  WHERE DREC_RUTCLI=@RUTCLI AND DREC_CONTCLI=@CONTR AND DREC_CODVIG= 0 AND DREC_FECREC <=  @FECHALIN),0)
			-
		    isnull((SELECT sum(isnull(ddes_unidades,0)) FROM DETAdespa WHERE DDES_RUTCLI=@RUTCLI AND DDES_CONTCLI=@CONTR AND DDES_CODVIG= 0 AND DDES_FECHA  <=  @FECHALIN),0)
	,TONELADAS = isnull((SELECT sum(isnull(drec_PESO,0)) FROM DETARECE  WHERE DREC_RUTCLI=@RUTCLI AND DREC_CONTCLI=@CONTR AND DREC_CODVIG= 0 AND DREC_FECREC <=  @FECHALIN),0)
			-
		    isnull((SELECT sum(isnull(ddes_PESO,0)) FROM DETAdespa WHERE DDES_RUTCLI=@RUTCLI AND DDES_CONTCLI=@CONTR AND DDES_CODVIG= 0 AND DDES_FECHA  <=  @FECHALIN),0)
       WHERE LINEA = @ILIN

      IF @ILIN=1
		UPDATE #NUMMIN SET FACTURAR = STOCK WHERE LINEA = @ILIN
	ELSE
	begin
		UPDATE #NUMMIN  SET FACTURAR = ST - DP + ISNULL((SELECT F.FACTURAR FROM #NUMMIN F WHERE F.LINEA = @ILIN - 1),0) WHERE LINEA = @ILIN

		UPDATE #NUMMIN SET FACTURAR = facturar + ISNULL((SELECT F.CT FROM #NUMMIN F WHERE F.LINEA = @ILIN - @TUNELG   ),0)
		WHERE LINEA = @ILIN
	end

       SET @ILIN= @ILIN + 1
END 

	UPDATE #NUMMIN SET FACTURAR = @MINPALL
	WHERE FACTURAR < @MINPALL and stock>0

 SELECT  @TOTSOP = SUM(FACTURAR), @VALNETO = (SUM(FACTURAR) * @CONTRVAL)
        , @TOTCT = SUM(CT), @TOTST = SUM(ST)
        , @TOTDP = SUM(DP), @TOTSTOCK = SUM(STOCK)
        , @TOTUNI = SUM(UNIDADES), @TOTTONE = SUM(TONELADAS)
 FROM #NUMMIN
 WHERE FECHA1 >=@FECINI

 SELECT  @VALUF = CASE WHEN MON_CODI = '02' THEN MON_VALOR ELSE @VALUF END
  , @FECUF = CASE WHEN MON_CODI = '02' THEN MON_FECVAL ELSE @FECUF END
  , @VALDOLAR = CASE WHEN MON_CODI = '01' THEN MON_VALOR ELSE @VALDOLAR END
  , @FECDOLAR = CASE WHEN MON_CODI = '01' THEN MON_FECVAL ELSE @FECDOLAR END
 FROM MONEDAS

 SET @FECUF = SUBSTRING(@FECUF, 9, 2)+'/'+SUBSTRING(@FECUF, 6, 2)+'/'+SUBSTRING(@FECUF, 1, 4)
 SET @FECDOLAR = SUBSTRING(@FECDOLAR, 9, 2)+'/'+SUBSTRING(@FECDOLAR, 6, 2)+'/'+SUBSTRING(@FECDOLAR, 1, 4)

 IF @IDENT <> 0
 BEGIN
 -- select 'ins'
  INSERT INTO TMPCABSERVICIOS
  SELECT @IDENT, @CONTR, @CONTRVAL, @MONDESC, @MONVAL, @MEDDESC, @TOTSOP, ISNULL(@VALNETO,0), @VALUF, @FECUF,
     ISNULL(@VALDOLAR,0), ISNULL(@FECDOLAR,0), ISNULL(@TOTCT,0), ISNULL(@TOTST,0),
     ISNULL(@TOTDP,0), ISNULL(@TOTSTOCK,0), ISNULL(@TOTUNI,0), ISNULL(@TOTTONE,0), 0

  INSERT INTO TMPDETSERVICIOS
  SELECT @IDENT, @CONTR, LINEA, FECHA, CT, ST, DP, STOCK, ISNULL(FACTURAR,0), ISNULL(UNIDADES,0), ISNULL(TONELADAS,0)
  FROM #NUMMIN
  WHERE FECHA1 >=@FECINI
  ORDER BY 1
 END
	
 SELECT LINEA, FECHA, CT, ST, DP, STOCK, FACTURAR, UNIDADES, TONELADAS
      , @CONTRVAL AS CONTRVAL, @MONDESC AS MONDESC
      , @MONVAL AS MONVAL, @MEDDESC AS MEDDESC
      , @TOTSOP AS TOTSOP, @VALNETO AS VALNETO
      , @VALUF AS VALUF, @VALDOLAR AS VALDOLAR
      , @TOTCT AS TOTCT, @TOTST AS TOTST, @TOTDP AS TOTDP
      , @TOTSTOCK AS TOTSTOCK, @TOTUNI AS TOTUNI, @TOTTONE AS TOTTONE
      , @FECUF AS FECUF, @FECDOLAR AS FECDOLAR
 FROM #NUMMIN
 WHERE FECHA1 >=@FECINI
 ORDER BY 1
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[PA_NUMERALPROMEDIOMINTUNEL]
  @FECINI AS VARCHAR(10)
, @FECFIN AS VARCHAR(10)
, @RUTCLI AS VARCHAR(9)
, @CONTR AS VARCHAR(7)
, @IDENT AS NUMERIC = 0
AS
 SET NOCOUNT ON
 SET rowcount 0

    DECLARE @TOTTRAMO AS INT
    DECLARE @ESCCOD AS INT
    DECLARE @TOTDIAS AS INT


 IF @IDENT = 0
 BEGIN

    DECLARE @TABLA VARCHAR(30)
    SET @TABLA = 'TMPSERV_MINTUNEL'

    BEGIN TRAN
        DECLARE @CODI AS INT
        SET @CODI = 0

        SELECT @CODI = CODIGO + 1 FROM CORRTABLAS WHERE RTRIM(LTRIM(TABLA)) = RTRIM(LTRIM('TMPSERV_MINTUNEL'))
        IF @CODI > 0
        BEGIN

            UPDATE CORRTABLAS
            SET CODIGO = @CODI
            WHERE RTRIM(LTRIM(TABLA)) = RTRIM(LTRIM('TMPSERV_MINTUNEL'))

        END
        ELSE
            BEGIN
                ROLLBACK TRAN
                SET @CODI = -1
            END
    IF @@ERROR > 0
    BEGIN
        ROLLBACK TRAN
	SET @CODI = 0
    END
    ELSE
    BEGIN
        COMMIT TRAN
	SET @IDENT = @CODI
    END
 END 

    SELECT @TOTTRAMO = ESCALASERV.TOTTRAMAS
        , @ESCCOD = ESCALASERV.ESCCOD
    FROM ESCALASERV
    WHERE ESCALASERV.ESCCONTR = @CONTR
        AND ESCALASERV.ESCSERV = '15'

    DECLARE CURPALLET CURSOR FOR
	    SELECT CONTRATO.CONT_CODI
	    FROM CONTRATO INNER JOIN CONTRPARA
	        ON CONTRATO.CONT_CODI = CONTRPARA.CPAR_CONTR INNER JOIN ESCALASERV
	        ON CONTRPARA.CPAR_CONTR = ESCALASERV.ESCCONTR COLLATE MODERN_SPANISH_CI_AS  INNER JOIN MONEDAS
	         MONEDAS ON CONTRPARA.CPAR_MONEDA = MONEDAS.MON_CODI INNER JOIN
	         MEDIDAS ON CONVERT(INT,CONTRPARA.CPAR_MEDIDA) = CONVERT(INT,MEDIDAS.MED_CODI)
	    WHERE CONTRATO.CONT_RUTCLIE = @RUTCLI
	        AND CONTRPARA.CPAR_SERVI = '15'
	        AND ESCALASERV.TOTTRAMAS = @TOTTRAMO
	        AND ESCALASERV.ESCSERV = '15'
	        AND CONTRPARA.CPAR_MARCA = '1'
    OPEN CURPALLET
    FETCH NEXT FROM CURPALLET INTO @CONTR
    WHILE @@FETCH_STATUS = 0
    BEGIN

	EXEC PA_NUMERALES @FECINI, @FECFIN, @RUTCLI, @CONTR, @IDENT

        FETCH NEXT FROM CURPALLET INTO @CONTR
    END
    CLOSE CURPALLET
    DEALLOCATE CURPALLET

    SET @TOTDIAS = (DATEDIFF(DAY, CONVERT(DATETIME, @FECINI, 111), CONVERT(DATETIME, @FECFIN, 111)) + 1)


    --DROP TABLE #CONTRATOS
    SELECT CONTRPARA.CPAR_CONTR, ESCALASERV.ESCCOD, 0 AS CONT  --CONTRATO.CONT_CODI,
        , CONTRATO.CONT_DIAGRACIA
        , (CASE WHEN CONTRATO.CONT_TUNELG=0 THEN 0 ELSE CONTRATO.CONT_TUNELG-1 END) AS CONT_TUNELG
        , CONTRATO.CONT_DESCR
            , CONTRATO.CONT_DIACONT, CONTRATO.CONT_PALLET
            , 0 AS CPAR_VALOR
         , MONEDAS.MON_DESCR, MONEDAS.MON_VALOR
         , MEDIDAS.MED_DESCR
        , 0 AS STOCK
        , 0 AS UNIDADES
        , 0 AS TONELADAS
    INTO #CONTRATOS
    FROM CONTRATO INNER JOIN CONTRPARA
        ON CONTRATO.CONT_CODI = CONTRPARA.CPAR_CONTR INNER JOIN ESCALASERV
        ON CONTRPARA.CPAR_CONTR = ESCALASERV.ESCCONTR COLLATE MODERN_SPANISH_CI_AS  INNER JOIN MONEDAS
         MONEDAS ON CONTRPARA.CPAR_MONEDA = MONEDAS.MON_CODI INNER JOIN
         MEDIDAS ON CONVERT(INT,CONTRPARA.CPAR_MEDIDA) = CONVERT(INT,MEDIDAS.MED_CODI)
    WHERE CONTRATO.CONT_RUTCLIE = @RUTCLI
        AND CONTRPARA.CPAR_SERVI = '15'
        AND ESCALASERV.TOTTRAMAS = @TOTTRAMO
        AND ESCALASERV.ESCSERV = '15'
        AND CONTRPARA.CPAR_MARCA = '1'

    DECLARE @COD VARCHAR(7)
    DECLARE @DESDE VARCHAR(7)
    DECLARE @HASTA VARCHAR(10)
    DECLARE @VAL VARCHAR(7)

    DECLARE CURTRAMA CURSOR FOR SELECT TRAMCOD, TRAMDESDE, TRAMHASTA, TRAMVAL FROM TRAMO WHERE ESCCOD = @ESCCOD
    OPEN CURTRAMA
    FETCH NEXT FROM CURTRAMA INTO @COD, @DESDE, @HASTA, @VAL
    WHILE @@FETCH_STATUS = 0
    BEGIN

        UPDATE #CONTRATOS
        SET CONT = CONT+1
--        SELECT *
        FROM #CONTRATOS INNER JOIN TRAMO
            ON #CONTRATOS.ESCCOD = TRAMO.ESCCOD
        --WHERE TRAMO.TRAMCOD = TRAMCOD AND TRAMDESDE = @DESDE AND TRAMHASTA = @HASTA AND TRAMVAL = @VAL
        WHERE TRAMO.TRAMCOD = @COD AND TRAMDESDE = @DESDE AND TRAMHASTA = @HASTA AND TRAMVAL = @VAL

        FETCH NEXT FROM CURTRAMA INTO @COD, @DESDE, @HASTA, @VAL
    END
    CLOSE CURTRAMA
    DEALLOCATE CURTRAMA

    --DROP TABLE #CONTR
    SELECT * INTO #CONTR FROM #CONTRATOS WHERE CONT = @TOTTRAMO

    --DROP TABLE #RESUMEN
    SELECT distinct TMPDETSERVICIOS.CONTRATO AS CONTR
        , (SUM(FACTURAR) * #CONTR.CPAR_VALOR) AS VALNETO
              , SUM(CT) AS TOTCT
        , SUM(ST) AS TOTST
              , SUM(DP) AS TOTDP
        , SUM(TMPDETSERVICIOS.STOCK) AS TOTSTOCK
        , SUM(TMPDETSERVICIOS.FACTURAR) AS TOTSOP
              , SUM(TMPDETSERVICIOS.UNIDADES) AS TOTUNI
        , SUM(TMPDETSERVICIOS.TONELADAS) AS TOTTONE
        , #CONTR.MON_DESCR AS MONDESC
        , #CONTR.MON_VALOR as MONVAL
             , #CONTR.MED_DESCR AS MEDDESC
        , #CONTR.CONT_DESCR AS CONTRDESC
    INTO #RESUMEN
    FROM TMPDETSERVICIOS
        INNER JOIN #CONTR
            ON TMPDETSERVICIOS.CONTRATO = #CONTR.CPAR_CONTR COLLATE SQL_Latin1_General_CP1_CI_AS
        INNER JOIN ESCALASERV
            ON #CONTR.CPAR_CONTR = ESCALASERV.ESCCONTR COLLATE MODERN_SPANISH_CI_AS
            AND '15' = ESCALASERV.ESCSERV
    WHERE IDENT = @IDENT
    GROUP BY TMPDETSERVICIOS.CONTRATO, #CONTR.CPAR_VALOR, #CONTR.MON_DESCR, #CONTR.MON_VALOR, #CONTR.MED_DESCR, #CONTR.CONT_DESCR

    DECLARE @VALUF AS DEC(12,2)
    DECLARE @FECUF AS VARCHAR(10)
    DECLARE @VALDOLAR AS DEC(12,2)
    DECLARE @FECDOLAR AS VARCHAR(10)

    SET @VALUF = 0
    SET @FECUF = ''
    SET @VALDOLAR = 0
    SET @FECDOLAR = ''

    SELECT @VALUF = CASE WHEN MON_CODI = '02' THEN MON_VALOR ELSE @VALUF END
        , @FECUF = CASE WHEN MON_CODI = '02' THEN MON_FECVAL ELSE @FECUF END
        , @VALDOLAR = CASE WHEN MON_CODI = '01' THEN MON_VALOR ELSE @VALDOLAR END
        , @FECDOLAR = CASE WHEN MON_CODI = '01' THEN MON_FECVAL ELSE @FECDOLAR END
    FROM MONEDAS

    SET @FECUF = SUBSTRING(@FECUF, 9, 2)+'/'+SUBSTRING(@FECUF, 6, 2)+'/'+SUBSTRING(@FECUF, 1, 4)
    SET @FECDOLAR = SUBSTRING(@FECDOLAR, 9, 2)+'/'+SUBSTRING(@FECDOLAR, 6, 2)+'/'+SUBSTRING(@FECDOLAR, 1, 4)

    DECLARE @TOTALFAC  AS DEC(12,2)
    DECLARE @PROMEDIO  AS DEC(12,2)
    DECLARE @TARIFUNI AS DEC(12,2)
    SET @TOTALFAC = 0
    SET @PROMEDIO = 0
    SET @TOTDIAS = (DATEDIFF(DAY, CONVERT(DATETIME, @FECINI, 111), CONVERT(DATETIME, @FECFIN, 111)) + 1)

    SELECT @TOTALFAC = SUM(FACTURAR) FROM TMPDETSERVICIOS WHERE IDENT = @IDENT
    SET @PROMEDIO = @TOTALFAC / @TOTDIAS


    SELECT DISTINCT @TARIFUNI = TRAMVAL
    FROM CONTRATO INNER JOIN CONTRPARA
        ON CONTRATO.CONT_CODI = CONTRPARA.CPAR_CONTR INNER JOIN ESCALASERV
        ON CONTRPARA.CPAR_CONTR = ESCALASERV.ESCCONTR COLLATE MODERN_SPANISH_CI_AS  INNER JOIN TRAMO
        ON ESCALASERV.ESCCOD = TRAMO.ESCCOD
    WHERE CONTRATO.CONT_RUTCLIE = @RUTCLI
        AND ESCALASERV.ESCSERV = '15'
        AND @PROMEDIO BETWEEN TRAMDESDE AND TRAMHASTA


    SELECT DISTINCT TMPDETSERVICIOS.CONTRATO AS CONTR
        , CONTRDESC
        , TOTSOP
    FROM TMPDETSERVICIOS INNER JOIN #RESUMEN
        ON TMPDETSERVICIOS.CONTRATO = #RESUMEN.CONTR
    WHERE IDENT = @IDENT
    ORDER BY 1,2

    SELECT ISNULL(@TOTALFAC, 0) AS TOTALFAC, ISNULL(@PROMEDIO, 0) AS PROMEDIO, ISNULL(@TARIFUNI, 0) AS TARIFUNI, ISNULL((@TOTALFAC*@TARIFUNI), 0) AS TOTAL

    SELECT LINEA, TMPDETSERVICIOS.CONTRATO AS CONTR, FECHA, CT, ST, DP, STOCK, FACTURAR, UNIDADES, TONELADAS
        , MONDESC
        , MEDDESC
        , CONTRDESC
         , TOTCT, TOTST, TOTDP
         , TOTSTOCK, TOTSOP, TOTUNI, TOTTONE
         , ISNULL(@VALUF, 0) AS VALUF, ISNULL(@VALDOLAR, 0) AS VALDOLAR
         , @FECUF AS FECUF, @FECDOLAR AS FECDOLAR
         , @TOTDIAS AS DIASFACT
         , ISNULL(@TOTALFAC, 0) AS TOTALFAC
         , ISNULL(@PROMEDIO, 0) AS PROMEDIO
         , ISNULL(@TARIFUNI, 0) AS TARIFUNI
    FROM TMPDETSERVICIOS INNER JOIN #RESUMEN
        ON TMPDETSERVICIOS.CONTRATO = #RESUMEN.CONTR
    WHERE IDENT = @IDENT
    ORDER BY 2,1,3
GO
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[PA_NUMERALPROMEDIOMINTUNEL22]
  @FECINI AS VARCHAR(10)
, @FECFIN AS VARCHAR(10)
, @RUTCLI AS VARCHAR(9)
, @CONTR AS VARCHAR(7)
, @IDENT AS NUMERIC = 0
AS
 SET NOCOUNT ON
 SET rowcount 0

    DECLARE @TOTTRAMO AS INT
    DECLARE @ESCCOD AS INT
    DECLARE @TOTDIAS AS INT


 IF @IDENT = 0
 BEGIN

    DECLARE @TABLA VARCHAR(30)
    SET @TABLA = 'TMPSERV_MINTUNEL'

    BEGIN TRAN
        DECLARE @CODI AS INT
        SET @CODI = 0

        SELECT @CODI = CODIGO + 1 FROM CORRTABLAS WHERE RTRIM(LTRIM(TABLA)) = RTRIM(LTRIM('TMPSERV_MINTUNEL'))
        IF @CODI > 0
        BEGIN

            UPDATE CORRTABLAS
            SET CODIGO = @CODI
            WHERE RTRIM(LTRIM(TABLA)) = RTRIM(LTRIM('TMPSERV_MINTUNEL'))

        END
        ELSE
            BEGIN
                ROLLBACK TRAN
                SET @CODI = -1
            END
    IF @@ERROR > 0
    BEGIN
        ROLLBACK TRAN
	SET @CODI = 0
    END
    ELSE
    BEGIN
        COMMIT TRAN
	SET @IDENT = @CODI
    END
 END 

    SELECT @TOTTRAMO = ESCALASERV.TOTTRAMAS
        , @ESCCOD = ESCALASERV.ESCCOD
    FROM ESCALASERV
    WHERE ESCALASERV.ESCCONTR = @CONTR
        AND ESCALASERV.ESCSERV = '15'

    DECLARE CURPALLET CURSOR FOR
	    SELECT CONTRATO.CONT_CODI
	    FROM CONTRATO INNER JOIN CONTRPARA
	        ON CONTRATO.CONT_CODI = CONTRPARA.CPAR_CONTR INNER JOIN ESCALASERV
	        ON CONTRPARA.CPAR_CONTR = ESCALASERV.ESCCONTR COLLATE MODERN_SPANISH_CI_AS  INNER JOIN MONEDAS
	         MONEDAS ON CONTRPARA.CPAR_MONEDA = MONEDAS.MON_CODI INNER JOIN
	         MEDIDAS ON CONVERT(INT,CONTRPARA.CPAR_MEDIDA) = CONVERT(INT,MEDIDAS.MED_CODI)
	    WHERE CONTRATO.CONT_RUTCLIE = @RUTCLI
	        AND CONTRPARA.CPAR_SERVI = '15'
	        AND ESCALASERV.TOTTRAMAS = @TOTTRAMO
	        AND ESCALASERV.ESCSERV = '15'
	        AND CONTRPARA.CPAR_MARCA = '1'
    OPEN CURPALLET
    FETCH NEXT FROM CURPALLET INTO @CONTR
    WHILE @@FETCH_STATUS = 0
    BEGIN

	EXEC PA_NUMERALES @FECINI, @FECFIN, @RUTCLI, @CONTR, @IDENT

        FETCH NEXT FROM CURPALLET INTO @CONTR
    END
    CLOSE CURPALLET
    DEALLOCATE CURPALLET

    SET @TOTDIAS = (DATEDIFF(DAY, CONVERT(DATETIME, @FECINI, 111), CONVERT(DATETIME, @FECFIN, 111)) + 1)


    --DROP TABLE #CONTRATOS
    SELECT CONTRPARA.CPAR_CONTR, ESCALASERV.ESCCOD, 0 AS CONT  --CONTRATO.CONT_CODI,
        , CONTRATO.CONT_DIAGRACIA
        , (CASE WHEN CONTRATO.CONT_TUNELG=0 THEN 0 ELSE CONTRATO.CONT_TUNELG-1 END) AS CONT_TUNELG
        , CONTRATO.CONT_DESCR
            , CONTRATO.CONT_DIACONT, CONTRATO.CONT_PALLET
            , 0 AS CPAR_VALOR
         , MONEDAS.MON_DESCR, MONEDAS.MON_VALOR
         , MEDIDAS.MED_DESCR
        , 0 AS STOCK
        , 0 AS UNIDADES
        , 0 AS TONELADAS
    INTO #CONTRATOS
    FROM CONTRATO INNER JOIN CONTRPARA
        ON CONTRATO.CONT_CODI = CONTRPARA.CPAR_CONTR INNER JOIN ESCALASERV
        ON CONTRPARA.CPAR_CONTR = ESCALASERV.ESCCONTR COLLATE MODERN_SPANISH_CI_AS  INNER JOIN MONEDAS
         MONEDAS ON CONTRPARA.CPAR_MONEDA = MONEDAS.MON_CODI INNER JOIN
         MEDIDAS ON CONVERT(INT,CONTRPARA.CPAR_MEDIDA) = CONVERT(INT,MEDIDAS.MED_CODI)
    WHERE CONTRATO.CONT_RUTCLIE = @RUTCLI
        AND CONTRPARA.CPAR_SERVI = '15'
        AND ESCALASERV.TOTTRAMAS = @TOTTRAMO
        AND ESCALASERV.ESCSERV = '15'
        AND CONTRPARA.CPAR_MARCA = '1'

    DECLARE @COD VARCHAR(7)
    DECLARE @DESDE VARCHAR(7)
    DECLARE @HASTA VARCHAR(10)
    DECLARE @VAL VARCHAR(7)

    DECLARE CURTRAMA CURSOR FOR SELECT TRAMCOD, TRAMDESDE, TRAMHASTA, TRAMVAL FROM TRAMO WHERE ESCCOD = @ESCCOD
    OPEN CURTRAMA
    FETCH NEXT FROM CURTRAMA INTO @COD, @DESDE, @HASTA, @VAL
    WHILE @@FETCH_STATUS = 0
    BEGIN

        UPDATE #CONTRATOS
        SET CONT = CONT+1
--        SELECT *
        FROM #CONTRATOS INNER JOIN TRAMO
            ON #CONTRATOS.ESCCOD = TRAMO.ESCCOD
        --WHERE TRAMO.TRAMCOD = TRAMCOD AND TRAMDESDE = @DESDE AND TRAMHASTA = @HASTA AND TRAMVAL = @VAL
        WHERE TRAMO.TRAMCOD = @COD AND TRAMDESDE = @DESDE AND TRAMHASTA = @HASTA AND TRAMVAL = @VAL

        FETCH NEXT FROM CURTRAMA INTO @COD, @DESDE, @HASTA, @VAL
    END
    CLOSE CURTRAMA
    DEALLOCATE CURTRAMA

    --DROP TABLE #CONTR
    SELECT * INTO #CONTR FROM #CONTRATOS WHERE CONT = @TOTTRAMO

    --DROP TABLE #RESUMEN
    SELECT distinct TMPDETSERVICIOS.CONTRATO AS CONTR
        , (SUM(FACTURAR) * #CONTR.CPAR_VALOR) AS VALNETO
              , SUM(CT) AS TOTCT
        , SUM(ST) AS TOTST
              , SUM(DP) AS TOTDP
        , SUM(TMPDETSERVICIOS.STOCK) AS TOTSTOCK
        , SUM(TMPDETSERVICIOS.FACTURAR) AS TOTSOP
              , SUM(TMPDETSERVICIOS.UNIDADES) AS TOTUNI
        , SUM(TMPDETSERVICIOS.TONELADAS) AS TOTTONE
        , #CONTR.MON_DESCR AS MONDESC
        , #CONTR.MON_VALOR as MONVAL
             , #CONTR.MED_DESCR AS MEDDESC
        , #CONTR.CONT_DESCR AS CONTRDESC
    INTO #RESUMEN
    FROM TMPDETSERVICIOS
        INNER JOIN #CONTR
            ON TMPDETSERVICIOS.CONTRATO = #CONTR.CPAR_CONTR COLLATE SQL_Latin1_General_CP1_CI_AS
        INNER JOIN ESCALASERV
            ON #CONTR.CPAR_CONTR = ESCALASERV.ESCCONTR COLLATE MODERN_SPANISH_CI_AS
            AND '15' = ESCALASERV.ESCSERV
    WHERE IDENT = @IDENT
    GROUP BY TMPDETSERVICIOS.CONTRATO, #CONTR.CPAR_VALOR, #CONTR.MON_DESCR, #CONTR.MON_VALOR, #CONTR.MED_DESCR, #CONTR.CONT_DESCR

    DECLARE @VALUF AS DEC(12,2)
    DECLARE @FECUF AS VARCHAR(10)
    DECLARE @VALDOLAR AS DEC(12,2)
    DECLARE @FECDOLAR AS VARCHAR(10)

    SET @VALUF = 0
    SET @FECUF = ''
    SET @VALDOLAR = 0
    SET @FECDOLAR = ''

    SELECT @VALUF = CASE WHEN MON_CODI = '02' THEN MON_VALOR ELSE @VALUF END
        , @FECUF = CASE WHEN MON_CODI = '02' THEN MON_FECVAL ELSE @FECUF END
        , @VALDOLAR = CASE WHEN MON_CODI = '01' THEN MON_VALOR ELSE @VALDOLAR END
        , @FECDOLAR = CASE WHEN MON_CODI = '01' THEN MON_FECVAL ELSE @FECDOLAR END
    FROM MONEDAS

    SET @FECUF = SUBSTRING(@FECUF, 9, 2)+'/'+SUBSTRING(@FECUF, 6, 2)+'/'+SUBSTRING(@FECUF, 1, 4)
    SET @FECDOLAR = SUBSTRING(@FECDOLAR, 9, 2)+'/'+SUBSTRING(@FECDOLAR, 6, 2)+'/'+SUBSTRING(@FECDOLAR, 1, 4)

    DECLARE @TOTALFAC  AS DEC(12,2)
    DECLARE @PROMEDIO  AS DEC(12,2)
    DECLARE @TARIFUNI AS DEC(12,2)
    SET @TOTALFAC = 0
    SET @PROMEDIO = 0
    SET @TOTDIAS = (DATEDIFF(DAY, CONVERT(DATETIME, @FECINI, 111), CONVERT(DATETIME, @FECFIN, 111)) + 1)

    SELECT @TOTALFAC = SUM(FACTURAR) FROM TMPDETSERVICIOS WHERE IDENT = @IDENT
    SET @PROMEDIO = @TOTALFAC / @TOTDIAS


    SELECT DISTINCT @TARIFUNI = TRAMVAL
    FROM CONTRATO INNER JOIN CONTRPARA
        ON CONTRATO.CONT_CODI = CONTRPARA.CPAR_CONTR INNER JOIN ESCALASERV
        ON CONTRPARA.CPAR_CONTR = ESCALASERV.ESCCONTR COLLATE MODERN_SPANISH_CI_AS  INNER JOIN TRAMO
        ON ESCALASERV.ESCCOD = TRAMO.ESCCOD
    WHERE CONTRATO.CONT_RUTCLIE = @RUTCLI
        AND ESCALASERV.ESCSERV = '15'
        AND @PROMEDIO BETWEEN TRAMDESDE AND TRAMHASTA


    SELECT DISTINCT TMPDETSERVICIOS.CONTRATO AS CONTR
        , CONTRDESC
        , TOTSOP
    FROM TMPDETSERVICIOS INNER JOIN #RESUMEN
        ON TMPDETSERVICIOS.CONTRATO = #RESUMEN.CONTR
    WHERE IDENT = @IDENT
    ORDER BY 1,2

    SELECT ISNULL(@TOTALFAC, 0) AS TOTALFAC, ISNULL(@PROMEDIO, 0) AS PROMEDIO, ISNULL(@TARIFUNI, 0) AS TARIFUNI, ISNULL((@TOTALFAC*@TARIFUNI), 0) AS TOTAL

    SELECT LINEA, TMPDETSERVICIOS.CONTRATO AS CONTR, FECHA, CT, ST, DP, STOCK, FACTURAR, UNIDADES, TONELADAS
        , MONDESC
        , MEDDESC
        , CONTRDESC
         , TOTCT, TOTST, TOTDP
         , TOTSTOCK, TOTSOP, TOTUNI, TOTTONE
         , ISNULL(@VALUF, 0) AS VALUF, ISNULL(@VALDOLAR, 0) AS VALDOLAR
         , @FECUF AS FECUF, @FECDOLAR AS FECDOLAR
         , @TOTDIAS AS DIASFACT
         , ISNULL(@TOTALFAC, 0) AS TOTALFAC
         , ISNULL(@PROMEDIO, 0) AS PROMEDIO
         , ISNULL(@TARIFUNI, 0) AS TARIFUNI
    FROM TMPDETSERVICIOS INNER JOIN #RESUMEN
        ON TMPDETSERVICIOS.CONTRATO = #RESUMEN.CONTR
    WHERE IDENT = @IDENT
    ORDER BY 2,1,3
GO
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO




CREATE PROCEDURE [dbo].[PA_PA_NUMERALPROMEDIOMINTUNEL]
  @FECINI AS VARCHAR(10)
, @FECFIN AS VARCHAR(10)
, @RUTCLI AS VARCHAR(9)
, @CONTR AS VARCHAR(7)
, @IDENT AS NUMERIC = 0
AS
 SET NOCOUNT ON
 SET rowcount 0
 DECLARE @DESCONTR AS VARCHAR(40)
 DECLARE @DIAGR AS SMALLINT
 DECLARE @TUNELG AS INT
 DECLARE @DIACONT AS SMALLINT
 DECLARE @MINPALL AS INT
 DECLARE @RECEPANT AS INT
 DECLARE @RUNIDANT AS INT
 DECLARE @RTONEANT AS INT
 DECLARE @DESPANT AS INT
 DECLARE @DUNIDANT AS INT
 DECLARE @DTONEANT AS INT
 DECLARE @RECEPPER AS INT
 DECLARE @DESPPER AS INT
 DECLARE @STOCK AS INT
 DECLARE @UNIDADES AS INT
 DECLARE @TONELADAS AS INT
 DECLARE @TOTDIAS AS INT
 DECLARE @CONTRVAL AS DEC(12,2)
 DECLARE @MONDESC AS VARCHAR(30)
 DECLARE @MONVAL AS DEC(12,2)
 DECLARE @MEDDESC AS VARCHAR(30)

 SET @DESCONTR = ''
 SET @DIAGR = 0
 SET @TUNELG = 0
 SET @DIACONT = 0
 SET @MINPALL = 0
 SET @STOCK = 0
 SET @RUNIDANT = 0
 SET @RTONEANT = 0
 SET @DUNIDANT = 0
 SET @DTONEANT = 0
 SET @TOTDIAS = (DATEDIFF(DAY, CONVERT(DATETIME, @FECINI, 111), CONVERT(DATETIME, @FECFIN, 111)) + 1)
 SET @CONTRVAL = 0
 SET @MONDESC = ''
 SET @MONVAL = 0
 SET @MEDDESC = ''

 SELECT @DIAGR=CONTRATO.CONT_DIAGRACIA
      , @TUNELG=CASE WHEN CONTRATO.CONT_TUNELG=0 THEN 0 ELSE CONTRATO.CONT_TUNELG END
      , @DESCONTR=CONTRATO.CONT_DESCR
      , @DIACONT=CONTRATO.CONT_DIACONT, @MINPALL=CONTRATO.CONT_PALLET
      , @CONTRVAL = CONTRPARA.CPAR_VALOR
      , @MONDESC = MONEDAS.MON_DESCR, @MONVAL = MONEDAS.MON_VALOR
      , @MEDDESC = MEDIDAS.MED_DESCR
 FROM CONTRPARA INNER JOIN
      CONTRATO ON CONTRPARA.CPAR_CONTR = CONTRATO.CONT_CODI INNER JOIN MONEDAS
      MONEDAS ON CONTRPARA.CPAR_MONEDA = MONEDAS.MON_CODI INNER JOIN
      MEDIDAS ON CONVERT(INT,CONTRPARA.CPAR_MEDIDA) = CONVERT(INT,MEDIDAS.MED_CODI)
 WHERE CONTRPARA.CPAR_CONTR = @CONTR
  AND CONTRPARA.CPAR_SERVI = 14


CREATE TABLE #NUMMIN (LINEA INT, FECHA VARCHAR(10), FECHA1 VARCHAR(10), CT INT, ST INT, DP INT, STOCK INT, FACTURAR INT, UNIDADES INT, TONELADAS DECIMAL(12,2))

DECLARE @LIN INT
DECLARE @ILIN INT
Declare @Dfechaini datetime
Declare @Dfechafin datetime

set @dfechaini = DATEADD(  DAY, (CASE WHEN @TUNELG=0 THEN 0 ELSE - @tuneLG - 2 END) , convert(datetime , @fecini,101))
set @dfechafin = convert(datetime , @fecfin,101)
set @LIN=1
while @dfechaini <= @dfechafin
begin
    INSERT INTO #NUMMIN(LINEA, FECHA, FECHA1, CT, ST, DP, STOCK, FACTURAR, UNIDADES, TONELADAS)
    VALUES(@LIN - @tunelg - 2, convert(char,@dfechaini,103), convert(char,@dfechaini,111), 0, 0, 0, 0, 0, 0, 0)

    set @dfechaini = dateadd(day,1,@dfechaini)
    set @LIN = @LIN +1
end

	DECLARE @TOTCT AS INT
	DECLARE @TOTST AS INT
	DECLARE @TOTDP AS INT
	DECLARE @TOTSTOCK AS INT
	DECLARE @TOTSOP AS INT
	DECLARE @TOTUNI AS INT
	DECLARE @TOTTONE AS DEC(12,2)
	DECLARE @VALNETO AS DEC(12,2)
	DECLARE @VALUF AS DEC(12,2)
	DECLARE @FECUF AS VARCHAR(10)
	DECLARE @VALDOLAR AS DEC(12,2)
	DECLARE @FECDOLAR AS VARCHAR(10)
	SET @TOTCT = 0
	SET @TOTST = 0
	SET @TOTDP = 0
	SET @TOTSTOCK = 0
	SET @TOTSOP = 0
	SET @TOTUNI = 0
	SET @TOTTONE = 0
	SET @VALNETO = 0
	SET @VALUF = 0
	SET @FECUF = ''
	SET @VALDOLAR = 0
	SET @FECDOLAR = ''

DECLARE @FECHALIN AS VARCHAR(10)

SET @LIN = @LIN - 1
SET @ILIN=1
WHILE @ILIN <= @LIN 
BEGIN
       -- CALCULA 

      SELECT  @FECHALIN = FECHA1 FROM #NUMMIN WHERE LINEA = @ILIN

      UPDATE #NUMMIN
           SET CT = (SELECT COUNT(1) FROM DETARECE  WHERE DREC_RUTCLI=@RUTCLI AND DREC_CONTCLI=@CONTR AND DREC_CODVIG= 0 AND DREC_FECREC =  @FECHALIN AND DREC_TUNEL>=1),
	       ST = (SELECT COUNT(1) FROM DETARECE  WHERE DREC_RUTCLI=@RUTCLI AND DREC_CONTCLI=@CONTR AND DREC_CODVIG= 0 AND DREC_FECREC =  @FECHALIN AND DREC_TUNEL=0),
	       DP = (SELECT COUNT(1) FROM DETAdespa WHERE DDES_RUTCLI=@RUTCLI AND DDES_CONTCLI=@CONTR AND DDES_CODVIG= 0 AND DDES_FECHA  =  @FECHALIN AND DDES_PALLET=1)
       WHERE LINEA = @ILIN

      UPDATE #NUMMIN

       SET STOCK = (SELECT COUNT(1) FROM DETARECE  WHERE DREC_RUTCLI=@RUTCLI AND DREC_CONTCLI=@CONTR AND DREC_CODVIG= 0 AND DREC_FECREC <=  @FECHALIN)
		    -
		   (SELECT COUNT(1) FROM DETAdespa WHERE DDES_RUTCLI=@RUTCLI AND DDES_CONTCLI=@CONTR AND DDES_CODVIG= 0 AND DDES_FECHA  <=  @FECHALIN AND DDES_PALLET=1)
	,UNIDADES = isnull((SELECT sum(isnull(drec_unidades,0)) FROM DETARECE  WHERE DREC_RUTCLI=@RUTCLI AND DREC_CONTCLI=@CONTR AND DREC_CODVIG= 0 AND DREC_FECREC <=  @FECHALIN),0)
			-
		    isnull((SELECT sum(isnull(ddes_unidades,0)) FROM DETAdespa WHERE DDES_RUTCLI=@RUTCLI AND DDES_CONTCLI=@CONTR AND DDES_CODVIG= 0 AND DDES_FECHA  <=  @FECHALIN),0)
	,TONELADAS = isnull((SELECT sum(isnull(drec_PESO,0)) FROM DETARECE  WHERE DREC_RUTCLI=@RUTCLI AND DREC_CONTCLI=@CONTR AND DREC_CODVIG= 0 AND DREC_FECREC <=  @FECHALIN),0)
			-
		    isnull((SELECT sum(isnull(ddes_PESO,0)) FROM DETAdespa WHERE DDES_RUTCLI=@RUTCLI AND DDES_CONTCLI=@CONTR AND DDES_CODVIG= 0 AND DDES_FECHA  <=  @FECHALIN),0)
       WHERE LINEA = @ILIN

      IF @ILIN=1
		UPDATE #NUMMIN SET FACTURAR = STOCK WHERE LINEA = @ILIN
	ELSE
	begin
		UPDATE #NUMMIN  SET FACTURAR = ST - DP + ISNULL((SELECT F.FACTURAR FROM #NUMMIN F WHERE F.LINEA = @ILIN - 1),0) WHERE LINEA = @ILIN

		UPDATE #NUMMIN SET FACTURAR = facturar + ISNULL((SELECT F.CT FROM #NUMMIN F WHERE F.LINEA = @ILIN - @TUNELG   ),0)
		WHERE LINEA = @ILIN
	end

       SET @ILIN= @ILIN + 1
END 

	UPDATE #NUMMIN SET FACTURAR = @MINPALL
	WHERE FACTURAR < @MINPALL and stock>0

 SELECT  @TOTSOP = SUM(FACTURAR), @VALNETO = (SUM(FACTURAR) * @CONTRVAL)
        , @TOTCT = SUM(CT), @TOTST = SUM(ST)
        , @TOTDP = SUM(DP), @TOTSTOCK = SUM(STOCK)
        , @TOTUNI = SUM(UNIDADES), @TOTTONE = SUM(TONELADAS)
 FROM #NUMMIN
 WHERE FECHA1 >=@FECINI

 SELECT  @VALUF = CASE WHEN MON_CODI = '02' THEN MON_VALOR ELSE @VALUF END
  , @FECUF = CASE WHEN MON_CODI = '02' THEN MON_FECVAL ELSE @FECUF END
  , @VALDOLAR = CASE WHEN MON_CODI = '01' THEN MON_VALOR ELSE @VALDOLAR END
  , @FECDOLAR = CASE WHEN MON_CODI = '01' THEN MON_FECVAL ELSE @FECDOLAR END
 FROM MONEDAS

 SET @FECUF = SUBSTRING(@FECUF, 9, 2)+'/'+SUBSTRING(@FECUF, 6, 2)+'/'+SUBSTRING(@FECUF, 1, 4)
 SET @FECDOLAR = SUBSTRING(@FECDOLAR, 9, 2)+'/'+SUBSTRING(@FECDOLAR, 6, 2)+'/'+SUBSTRING(@FECDOLAR, 1, 4)

 IF @IDENT <> 0
 BEGIN
  select 'ins'
  INSERT INTO TMPCABSERVICIOS
  SELECT @IDENT, @CONTR, @CONTRVAL, @MONDESC, @MONVAL, @MEDDESC, @TOTSOP, ISNULL(@VALNETO,0), @VALUF, @FECUF,
     ISNULL(@VALDOLAR,0), ISNULL(@FECDOLAR,0), ISNULL(@TOTCT,0), ISNULL(@TOTST,0),
     ISNULL(@TOTDP,0), ISNULL(@TOTSTOCK,0), ISNULL(@TOTUNI,0), ISNULL(@TOTTONE,0), 0

  INSERT INTO TMPDETSERVICIOS
  SELECT @IDENT, @CONTR, LINEA, FECHA, CT, ST, DP, STOCK, ISNULL(FACTURAR,0), ISNULL(UNIDADES,0), ISNULL(TONELADAS,0)
  FROM #NUMMIN
  WHERE FECHA1 >=@FECINI
  ORDER BY 1
 END
	
 SELECT LINEA, FECHA, CT, ST, DP, STOCK, FACTURAR, UNIDADES, TONELADAS
      , @CONTRVAL AS CONTRVAL, @MONDESC AS MONDESC
      , @MONVAL AS MONVAL, @MEDDESC AS MEDDESC
      , @TOTSOP AS TOTSOP, @VALNETO AS VALNETO
      , @VALUF AS VALUF, @VALDOLAR AS VALDOLAR
      , @TOTCT AS TOTCT, @TOTST AS TOTST, @TOTDP AS TOTDP
      , @TOTSTOCK AS TOTSTOCK, @TOTUNI AS TOTUNI, @TOTTONE AS TOTTONE
      , @FECUF AS FECUF, @FECDOLAR AS FECDOLAR
 FROM #NUMMIN
 WHERE FECHA1 >=@FECINI
 ORDER BY 1





GO
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO




CREATE PROCEDURE [dbo].[PA_PROMEDIO]
  @FECINI AS VARCHAR(10)
, @FECFIN AS VARCHAR(10)
, @RUTCLI AS VARCHAR(9)
, @CONTR AS VARCHAR(7)
, @IDENT AS NUMERIC = 0
AS
 SET NOCOUNT ON
 SET rowcount 0

    DECLARE @TOTTRAMO AS INT
    DECLARE @ESCCOD AS INT
    DECLARE @TOTDIAS AS INT

    SELECT @TOTTRAMO = ESCALASERV.TOTTRAMAS
        , @ESCCOD = ESCALASERV.ESCCOD
    FROM ESCALASERV
    WHERE ESCALASERV.ESCCONTR = @CONTR
        AND ESCALASERV.ESCSERV = '15'

    DECLARE CURPALLET CURSOR FOR
	    SELECT CONTRATO.CONT_CODI
	    FROM CONTRATO INNER JOIN CONTRPARA
	        ON CONTRATO.CONT_CODI = CONTRPARA.CPAR_CONTR INNER JOIN ESCALASERV
	        ON CONTRPARA.CPAR_CONTR = ESCALASERV.ESCCONTR COLLATE MODERN_SPANISH_CI_AS  INNER JOIN MONEDAS
	         MONEDAS ON CONTRPARA.CPAR_MONEDA = MONEDAS.MON_CODI INNER JOIN
	         MEDIDAS ON CONVERT(INT,CONTRPARA.CPAR_MEDIDA) = CONVERT(INT,MEDIDAS.MED_CODI)
	    WHERE CONTRATO.CONT_RUTCLIE = @RUTCLI
	        AND CONTRPARA.CPAR_SERVI = '15'
	        AND ESCALASERV.TOTTRAMAS = @TOTTRAMO
	        AND ESCALASERV.ESCSERV = '15'
	        AND CONTRPARA.CPAR_MARCA = '1'
    OPEN CURPALLET
    FETCH NEXT FROM CURPALLET INTO @CONTR
    WHILE @@FETCH_STATUS = 0
    BEGIN

	EXEC PA_NUMERALES @FECINI, @FECFIN, @RUTCLI, @CONTR, @IDENT

        FETCH NEXT FROM CURPALLET INTO @CONTR
    END
    CLOSE CURPALLET
    DEALLOCATE CURPALLET

    SET @TOTDIAS = (DATEDIFF(DAY, CONVERT(DATETIME, @FECINI, 111), CONVERT(DATETIME, @FECFIN, 111)) + 1)

    SELECT @TOTTRAMO = ESCALASERV.TOTTRAMAS
        , @ESCCOD = ESCALASERV.ESCCOD
    FROM ESCALASERV
    WHERE ESCALASERV.ESCCONTR = @CONTR
        AND ESCALASERV.ESCSERV = '15'

    --DROP TABLE #CONTRATOS
    SELECT CONTRPARA.CPAR_CONTR, ESCALASERV.ESCCOD, 0 AS CONT  --CONTRATO.CONT_CODI,
        , CONTRATO.CONT_DIAGRACIA
        , (CASE WHEN CONTRATO.CONT_TUNELG=0 THEN 0 ELSE CONTRATO.CONT_TUNELG-1 END) AS CONT_TUNELG
        , CONTRATO.CONT_DESCR
            , CONTRATO.CONT_DIACONT, CONTRATO.CONT_PALLET
            , 0 AS CPAR_VALOR
         , MONEDAS.MON_DESCR, MONEDAS.MON_VALOR
         , MEDIDAS.MED_DESCR
        , 0 AS STOCK
        , 0 AS UNIDADES
        , 0 AS TONELADAS
    INTO #CONTRATOS
    FROM CONTRATO INNER JOIN CONTRPARA
        ON CONTRATO.CONT_CODI = CONTRPARA.CPAR_CONTR INNER JOIN ESCALASERV
        ON CONTRPARA.CPAR_CONTR = ESCALASERV.ESCCONTR COLLATE MODERN_SPANISH_CI_AS  INNER JOIN MONEDAS
         MONEDAS ON CONTRPARA.CPAR_MONEDA = MONEDAS.MON_CODI INNER JOIN
         MEDIDAS ON CONVERT(INT,CONTRPARA.CPAR_MEDIDA) = CONVERT(INT,MEDIDAS.MED_CODI)
    WHERE CONTRATO.CONT_RUTCLIE = @RUTCLI
        AND CONTRPARA.CPAR_SERVI = '15'
        AND ESCALASERV.TOTTRAMAS = @TOTTRAMO
        AND ESCALASERV.ESCSERV = '15'
        AND CONTRPARA.CPAR_MARCA = '1'

    DECLARE @COD VARCHAR(7)
    DECLARE @DESDE VARCHAR(7)
    DECLARE @HASTA VARCHAR(10)
    DECLARE @VAL VARCHAR(7)

    DECLARE CURTRAMA CURSOR FOR SELECT TRAMCOD, TRAMDESDE, TRAMHASTA, TRAMVAL FROM TRAMO WHERE ESCCOD = @ESCCOD
    OPEN CURTRAMA
    FETCH NEXT FROM CURTRAMA INTO @COD, @DESDE, @HASTA, @VAL
    WHILE @@FETCH_STATUS = 0
    BEGIN

        UPDATE #CONTRATOS
        SET CONT = CONT+1
--        SELECT *
        FROM #CONTRATOS INNER JOIN TRAMO
            ON #CONTRATOS.ESCCOD = TRAMO.ESCCOD
        --WHERE TRAMO.TRAMCOD = TRAMCOD AND TRAMDESDE = @DESDE AND TRAMHASTA = @HASTA AND TRAMVAL = @VAL
        WHERE TRAMO.TRAMCOD = @COD AND TRAMDESDE = @DESDE AND TRAMHASTA = @HASTA AND TRAMVAL = @VAL

        FETCH NEXT FROM CURTRAMA INTO @COD, @DESDE, @HASTA, @VAL
    END
    CLOSE CURTRAMA
    DEALLOCATE CURTRAMA

    --DROP TABLE #CONTR
    SELECT * INTO #CONTR FROM #CONTRATOS WHERE CONT = @TOTTRAMO

    --DROP TABLE #RESUMEN
    SELECT distinct TMPDETSERVICIOS.CONTRATO AS CONTR
        , (SUM(FACTURAR) * #CONTR.CPAR_VALOR) AS VALNETO
              , SUM(CT) AS TOTCT
        , SUM(ST) AS TOTST
              , SUM(DP) AS TOTDP
        , SUM(TMPDETSERVICIOS.STOCK) AS TOTSTOCK
        , SUM(TMPDETSERVICIOS.FACTURAR) AS TOTSOP
              , SUM(TMPDETSERVICIOS.UNIDADES) AS TOTUNI
        , SUM(TMPDETSERVICIOS.TONELADAS) AS TOTTONE
        , #CONTR.MON_DESCR AS MONDESC
        , #CONTR.MON_VALOR as MONVAL
             , #CONTR.MED_DESCR AS MEDDESC
        , #CONTR.CONT_DESCR AS CONTRDESC
    INTO #RESUMEN
    FROM TMPDETSERVICIOS
        INNER JOIN #CONTR
            ON TMPDETSERVICIOS.CONTRATO = #CONTR.CPAR_CONTR COLLATE SQL_Latin1_General_CP1_CI_AS
        INNER JOIN ESCALASERV
            ON #CONTR.CPAR_CONTR = ESCALASERV.ESCCONTR COLLATE MODERN_SPANISH_CI_AS
            AND '15' = ESCALASERV.ESCSERV
    WHERE IDENT = @IDENT
    GROUP BY TMPDETSERVICIOS.CONTRATO, #CONTR.CPAR_VALOR, #CONTR.MON_DESCR, #CONTR.MON_VALOR, #CONTR.MED_DESCR, #CONTR.CONT_DESCR

    DECLARE @VALUF AS DEC(12,2)
    DECLARE @FECUF AS VARCHAR(10)
    DECLARE @VALDOLAR AS DEC(12,2)
    DECLARE @FECDOLAR AS VARCHAR(10)

    SET @VALUF = 0
    SET @FECUF = ''
    SET @VALDOLAR = 0
    SET @FECDOLAR = ''

    SELECT @VALUF = CASE WHEN MON_CODI = '02' THEN MON_VALOR ELSE @VALUF END
        , @FECUF = CASE WHEN MON_CODI = '02' THEN MON_FECVAL ELSE @FECUF END
        , @VALDOLAR = CASE WHEN MON_CODI = '01' THEN MON_VALOR ELSE @VALDOLAR END
        , @FECDOLAR = CASE WHEN MON_CODI = '01' THEN MON_FECVAL ELSE @FECDOLAR END
    FROM MONEDAS

    SET @FECUF = SUBSTRING(@FECUF, 9, 2)+'/'+SUBSTRING(@FECUF, 6, 2)+'/'+SUBSTRING(@FECUF, 1, 4)
    SET @FECDOLAR = SUBSTRING(@FECDOLAR, 9, 2)+'/'+SUBSTRING(@FECDOLAR, 6, 2)+'/'+SUBSTRING(@FECDOLAR, 1, 4)

    DECLARE @TOTALFAC  AS DEC(12,2)
    DECLARE @PROMEDIO  AS DEC(12,2)
    DECLARE @TARIFUNI AS DEC(12,2)
    SET @TOTALFAC = 0
    SET @PROMEDIO = 0
    SET @TOTDIAS = (DATEDIFF(DAY, CONVERT(DATETIME, @FECINI, 111), CONVERT(DATETIME, @FECFIN, 111)) + 1)

    SELECT @TOTALFAC = SUM(FACTURAR) FROM TMPDETSERVICIOS WHERE IDENT = @IDENT
    SET @PROMEDIO = @TOTALFAC / @TOTDIAS


    SELECT DISTINCT @TARIFUNI = TRAMVAL
    FROM CONTRATO INNER JOIN CONTRPARA
        ON CONTRATO.CONT_CODI = CONTRPARA.CPAR_CONTR INNER JOIN ESCALASERV
        ON CONTRPARA.CPAR_CONTR = ESCALASERV.ESCCONTR COLLATE MODERN_SPANISH_CI_AS  INNER JOIN TRAMO
        ON ESCALASERV.ESCCOD = TRAMO.ESCCOD
    WHERE CONTRATO.CONT_RUTCLIE = @RUTCLI
        AND ESCALASERV.ESCSERV = '15'
        AND @PROMEDIO BETWEEN TRAMDESDE AND TRAMHASTA


    SELECT DISTINCT TMPDETSERVICIOS.CONTRATO
        , CONTRDESC
        , TOTSOP
    FROM TMPDETSERVICIOS INNER JOIN #RESUMEN
        ON TMPDETSERVICIOS.CONTRATO = #RESUMEN.CONTR
    WHERE IDENT = @IDENT
    ORDER BY 1,2

    SELECT ISNULL(@TOTALFAC, 0) AS TOTALFAC, ISNULL(@PROMEDIO, 0) AS PROMEDIO, ISNULL(@TARIFUNI, 0) AS TARIFUNI, ISNULL((@TOTALFAC*@TARIFUNI), 0) AS TOTAL

    SELECT LINEA, TMPDETSERVICIOS.CONTRATO, FECHA, CT, ST, DP, STOCK, FACTURAR, UNIDADES, TONELADAS
        , MONDESC
        , MEDDESC
        , CONTRDESC
         , TOTCT, TOTST, TOTDP
         , TOTSTOCK, TOTSOP, TOTUNI, TOTTONE
         , ISNULL(@VALUF, 0) AS VALUF, ISNULL(@VALDOLAR, 0) AS VALDOLAR
         , @FECUF AS FECUF, @FECDOLAR AS FECDOLAR
         , @TOTDIAS AS DIASFACT
         , ISNULL(@TOTALFAC, 0) AS TOTALFAC
         , ISNULL(@PROMEDIO, 0) AS PROMEDIO
         , ISNULL(@TARIFUNI, 0) AS TARIFUNI
    FROM TMPDETSERVICIOS INNER JOIN #RESUMEN
        ON TMPDETSERVICIOS.CONTRATO = #RESUMEN.CONTR
    WHERE IDENT = @IDENT
    ORDER BY 2,1,3



GO
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO





-- Autor:    Carolina Uribe Ruiz / ACL
-- Objetivo: RETORNA FECHA Y HORA DESDE LA BASE DE DATOS
-- Fecha de Creacin: 13/09/2007
-- Modificaciones:
-- Pruebas
/*
exec  PA_RET_FECHAHORA
*/
CREATE PROCEDURE [dbo].[PA_RET_FECHAHORA]
AS

    SET NOCOUNT ON
    SET rowcount 200
    SET rowcount 0

    SELECT CONVERT(VARCHAR(10),GETDATE(),103) AS FECHA, CONVERT(VARCHAR(5),GETDATE(),108) AS HORA
    RETURN 0


GO
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO



CREATE PROCEDURE [dbo].[PA_RET_GUIASDESPC]
  @FPRE_CODI NVARCHAR(7)
AS

  UPDATE TMPFICHPRED
  SET EST_CODI = 2
  WHERE FPRE_CODI = @FPRE_CODI


GO
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO





-- Autor:    CAROLINA URIBE RUIZ / ACL
-- Objetivo:    RETORNA GUIAS DE RECEPCION
-- Fecha de Creacin:25-09-2007
-- Modificaciones:
-- Pruebas
/*
exec PA_RET_GUIASRECEP

*/
CREATE PROCEDURE [dbo].[PA_RET_GUIASRECEP]
  @FREC_CODI NVARCHAR(7)
AS

        UPDATE TMPFICHRECE
        SET EST_CODI = 2
        WHERE FREC_CODI = @FREC_CODI


GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO

CREATE PROCEDURE [dbo].[PA_SUMACONTRATOS]
  @FECINI AS VARCHAR(10)
, @FECFIN AS VARCHAR(10)
, @RUTCLI AS VARCHAR(9)
, @CONTR AS VARCHAR(7)
, @IDENT AS NUMERIC = 0
AS

    SET NOCOUNT ON
    SET rowcount 0

/*
    DECLARE @FECINI AS VARCHAR(10)
    DECLARE @FECFIN AS VARCHAR(10)
    DECLARE @RUTCLI AS VARCHAR(9)
    DECLARE @CONTR AS VARCHAR(7)
    DECLARE @IDENT AS NUMERIC

    SET @FECINI = '2008/04/01'
    SET @FECFIN = '2008/04/15'
    SET @RUTCLI = '965579109'  --'0021101'  '0021100'
    SET @CONTR = '0021100'
    SET @IDENT = 0 --32
*/

 IF @IDENT = 0
 BEGIN

    DECLARE @TABLA VARCHAR(30)
    SET @TABLA = 'TMPSERV_MINTUNEL'

    BEGIN TRAN
        DECLARE @CODI AS INT
        SET @CODI = 0

        SELECT @CODI = CODIGO + 1 FROM CORRTABLAS WHERE RTRIM(LTRIM(TABLA)) = RTRIM(LTRIM('TMPSERV_MINTUNEL'))
        IF @CODI > 0
        BEGIN

            UPDATE CORRTABLAS
            SET CODIGO = @CODI
            WHERE RTRIM(LTRIM(TABLA)) = RTRIM(LTRIM('TMPSERV_MINTUNEL'))

        END
        ELSE
            BEGIN
                ROLLBACK TRAN
                SET @CODI = -1
            END
    IF @@ERROR > 0
    BEGIN
        ROLLBACK TRAN
	SET @CODI = 0
    END
    ELSE
    BEGIN
        COMMIT TRAN
	SET @IDENT = @CODI
    END
 END 


    DECLARE @TOTTRAMO AS INT
    DECLARE @ESCCOD AS INT
    DECLARE @TOTDIAS AS INT

    SELECT @TOTTRAMO = ESCALASERV.TOTTRAMAS
        , @ESCCOD = ESCALASERV.ESCCOD
    FROM ESCALASERV
    WHERE ESCALASERV.ESCCONTR = @CONTR
        AND ESCALASERV.ESCSERV = '16'

    DECLARE CURPALLET CURSOR FOR
	    SELECT CONTRATO.CONT_CODI 
	    FROM CONTRATO INNER JOIN CONTRPARA
	        ON CONTRATO.CONT_CODI = CONTRPARA.CPAR_CONTR INNER JOIN ESCALASERV
	        ON CONTRPARA.CPAR_CONTR = ESCALASERV.ESCCONTR COLLATE MODERN_SPANISH_CI_AS  INNER JOIN MONEDAS
	         MONEDAS ON CONTRPARA.CPAR_MONEDA = MONEDAS.MON_CODI INNER JOIN
	         MEDIDAS ON CONVERT(INT,CONTRPARA.CPAR_MEDIDA) = CONVERT(INT,MEDIDAS.MED_CODI)
	    WHERE CONTRATO.CONT_RUTCLIE = @RUTCLI
	        AND CONTRPARA.CPAR_SERVI = '16'
	        AND ESCALASERV.TOTTRAMAS = @TOTTRAMO
	        AND ESCALASERV.ESCSERV = '16'
	        AND CONTRPARA.CPAR_MARCA = '1'
    OPEN CURPALLET
    FETCH NEXT FROM CURPALLET INTO @CONTR
    WHILE @@FETCH_STATUS = 0
    BEGIN

	EXEC PA_NUMERALES @FECINI, @FECFIN, @RUTCLI, @CONTR, @IDENT

        FETCH NEXT FROM CURPALLET INTO @CONTR
    END
    CLOSE CURPALLET
    DEALLOCATE CURPALLET
--**********************************************************************************************************************************

    SET @TOTDIAS = (DATEDIFF(DAY, CONVERT(DATETIME, @FECINI, 111), CONVERT(DATETIME, @FECFIN, 111)) + 1)

  --  DROP TABLE #CONTRATOS
    SELECT CONTRPARA.CPAR_CONTR, ESCALASERV.ESCCOD, 0 AS CONT  --CONTRATO.CONT_CODI,
        , CONTRATO.CONT_DIAGRACIA
        , (CASE WHEN CONTRATO.CONT_TUNELG=0 THEN 0 ELSE CONTRATO.CONT_TUNELG-1 END) AS CONT_TUNELG
        , CONTRATO.CONT_DESCR
            , CONTRATO.CONT_DIACONT, CONTRATO.CONT_PALLET
            , 0 AS CPAR_VALOR
        , MONEDAS.MON_DESCR, MONEDAS.MON_VALOR
        , MEDIDAS.MED_DESCR
        , 0 AS STOCK
        , 0 AS UNIDADES
        , 0 AS TONELADAS
    INTO #CONTRATOS
    FROM CONTRATO INNER JOIN CONTRPARA
        ON CONTRATO.CONT_CODI = CONTRPARA.CPAR_CONTR INNER JOIN ESCALASERV
        ON CONTRPARA.CPAR_CONTR = ESCALASERV.ESCCONTR COLLATE MODERN_SPANISH_CI_AS  INNER JOIN MONEDAS
         MONEDAS ON CONTRPARA.CPAR_MONEDA = MONEDAS.MON_CODI INNER JOIN
         MEDIDAS ON CONVERT(INT,CONTRPARA.CPAR_MEDIDA) = CONVERT(INT,MEDIDAS.MED_CODI)
    WHERE CONTRATO.CONT_RUTCLIE = @RUTCLI
        AND CONTRPARA.CPAR_SERVI = '16'
        AND ESCALASERV.TOTTRAMAS = @TOTTRAMO
        AND ESCALASERV.ESCSERV = '16'
        AND CONTRPARA.CPAR_MARCA = '1'


    DECLARE @COD VARCHAR(7)
    DECLARE @DESDE VARCHAR(7)
    DECLARE @HASTA VARCHAR(10)
    DECLARE @VAL VARCHAR(7)

    DECLARE CURTRAMA CURSOR FOR SELECT TRAMCOD, TRAMDESDE, TRAMHASTA, TRAMVAL FROM TRAMO WHERE ESCCOD = @ESCCOD
    OPEN CURTRAMA
    FETCH NEXT FROM CURTRAMA INTO @COD, @DESDE, @HASTA, @VAL
    WHILE @@FETCH_STATUS = 0
    BEGIN

        UPDATE #CONTRATOS
        SET CONT = CONT+1
--        SELECT *
        FROM #CONTRATOS INNER JOIN TRAMO
            ON #CONTRATOS.ESCCOD = TRAMO.ESCCOD
        WHERE TRAMO.TRAMCOD = @COD AND TRAMDESDE = @DESDE AND TRAMHASTA = @HASTA AND TRAMVAL = @VAL

        FETCH NEXT FROM CURTRAMA INTO @COD, @DESDE, @HASTA, @VAL
    END
    CLOSE CURTRAMA
    DEALLOCATE CURTRAMA

--    DROP TABLE #CONTR
    SELECT * INTO #CONTR FROM #CONTRATOS WHERE CONT = @TOTTRAMO 

    SELECT @TOTDIAS = COUNT(*) FROM TMPDETSERVICIOS WHERE IDENT = @IDENT

--    DROP TABLE #RESUMEN
    SELECT TMPDETSERVICIOS.CONTRATO AS CONTR
        , (SUM(FACTURAR) * #CONTR.CPAR_VALOR) AS VALNETO
              , SUM(CT) AS TOTCT
        , SUM(ST) AS TOTST
              , SUM(DP) AS TOTDP
        , SUM(TMPDETSERVICIOS.STOCK) AS TOTSTOCK
        , SUM(TMPDETSERVICIOS.FACTURAR) AS TOTSOP
              , SUM(TMPDETSERVICIOS.UNIDADES) AS TOTUNI
        , SUM(TMPDETSERVICIOS.TONELADAS) AS TOTTONE
        , #CONTR.MON_DESCR AS MONDESC
        , #CONTR.MON_VALOR as MONVAL
        , #CONTR.MED_DESCR AS MEDDESC
        , #CONTR.CONT_DESCR AS CONTRDESC
        , #CONTR.CONT_PALLET AS CONT_PALLET
    INTO #RESUMEN
    FROM TMPDETSERVICIOS
        INNER JOIN #CONTR
            ON TMPDETSERVICIOS.CONTRATO = #CONTR.CPAR_CONTR COLLATE SQL_Latin1_General_CP1_CI_AS
        INNER JOIN ESCALASERV
            ON #CONTR.CPAR_CONTR = ESCALASERV.ESCCONTR COLLATE MODERN_SPANISH_CI_AS
            AND '16' = ESCALASERV.ESCSERV
    WHERE IDENT = @IDENT
    GROUP BY TMPDETSERVICIOS.CONTRATO, #CONTR.CPAR_VALOR, #CONTR.MON_DESCR, #CONTR.MON_VALOR, #CONTR.MED_DESCR, #CONTR.CONT_DESCR, #CONTR.CONT_PALLET

    DECLARE @VALUF AS DEC(12,2)
    DECLARE @FECUF AS VARCHAR(10)
    DECLARE @VALDOLAR AS DEC(12,2)
    DECLARE @FECDOLAR AS VARCHAR(10)

    SET @VALUF = 0
    SET @FECUF = ''
    SET @VALDOLAR = 0
    SET @FECDOLAR = ''

    SELECT @VALUF = CASE WHEN MON_CODI = '02' THEN MON_VALOR ELSE @VALUF END
        , @FECUF = CASE WHEN MON_CODI = '02' THEN MON_FECVAL ELSE @FECUF END
        , @VALDOLAR = CASE WHEN MON_CODI = '01' THEN MON_VALOR ELSE @VALDOLAR END
        , @FECDOLAR = CASE WHEN MON_CODI = '01' THEN MON_FECVAL ELSE @FECDOLAR END
    FROM MONEDAS

    SET @FECUF = SUBSTRING(@FECUF, 9, 2)+'/'+SUBSTRING(@FECUF, 6, 2)+'/'+SUBSTRING(@FECUF, 1, 4)
    SET @FECDOLAR = SUBSTRING(@FECDOLAR, 9, 2)+'/'+SUBSTRING(@FECDOLAR, 6, 2)+'/'+SUBSTRING(@FECDOLAR, 1, 4)

    DECLARE @TOTALFAC  AS DEC(12,2)
    DECLARE @PROMEDIO  AS DEC(12,2)
    DECLARE @TARIFUNI AS DEC(12,2)
    SET @TOTALFAC = 0
    SET @PROMEDIO = 0
    SET @TOTDIAS = (DATEDIFF(DAY, CONVERT(DATETIME, @FECINI, 111), CONVERT(DATETIME, @FECFIN, 111)) + 1)

    SELECT @TOTALFAC = SUM(FACTURAR) FROM TMPDETSERVICIOS WHERE IDENT = @IDENT

    SET @PROMEDIO = @TOTALFAC / @TOTDIAS

    SELECT DISTINCT @TARIFUNI = TRAMVAL
    FROM CONTRATO INNER JOIN CONTRPARA
        ON CONTRATO.CONT_CODI = CONTRPARA.CPAR_CONTR INNER JOIN ESCALASERV
        ON CONTRPARA.CPAR_CONTR = ESCALASERV.ESCCONTR COLLATE MODERN_SPANISH_CI_AS INNER JOIN TRAMO
        ON ESCALASERV.ESCCOD = TRAMO.ESCCOD
    WHERE CONTRATO.CONT_RUTCLIE = @RUTCLI
        AND ESCALASERV.ESCSERV = '16'
        AND @PROMEDIO BETWEEN TRAMDESDE AND TRAMHASTA


    SELECT DISTINCT TMPDETSERVICIOS.CONTRATO AS CONTR
        , CONTRDESC
        , TOTSOP
        , TOTSTOCK
        , CONT_PALLET
    FROM TMPDETSERVICIOS INNER JOIN #RESUMEN
        ON TMPDETSERVICIOS.CONTRATO = #RESUMEN.CONTR
    WHERE IDENT = @IDENT
    ORDER BY 1,2


    DECLARE @CONTRA VARCHAR(7) 
    DECLARE @PALL AS INT
    DECLARE @SQL AS VARCHAR(5000)
    DECLARE @I AS INT

    SET @CONTRA = ''
    SET @PALL = 0
    SET @SQL = ''
    SET @I = 0
    DECLARE CURCONTR CURSOR FOR SELECT CPAR_CONTR, CONT_PALLET FROM #CONTR ORDER BY CPAR_CONTR
    OPEN CURCONTR
    FETCH NEXT FROM CURCONTR INTO @CONTRA, @PALL
    WHILE @@FETCH_STATUS = 0
    BEGIN
        SET @I = @I + 1
        SET @SQL = @SQL + ', (SELECT STOCK FROM TMPDETSERVICIOS WHERE CONTRATO = ' + CHAR(39) + @CONTRA +  CHAR(39) + ' AND LINEA = #SOPDIARIOS.LINEA) AS ' + CHAR(39) + @CONTRA + CHAR(39)

        FETCH NEXT FROM CURCONTR INTO @CONTRA, @PALL
    END
    CLOSE CURCONTR
    DEALLOCATE CURCONTR

--    DROP TABLE #SOPDIARIOS
    SELECT DISTINCT LINEA, FECHA
    INTO #SOPDIARIOS
    FROM TMPDETSERVICIOS
    WHERE IDENT = @IDENT

    DECLARE @SQL2 AS VARCHAR(5000)

    SET @SQL2 = ''
    SET @SQL2 = 'SELECT LINEA, FECHA' + @SQL
    SET @SQL2 = @SQL2 + ' FROM #SOPDIARIOS '
    EXEC (@SQL2)


    SELECT ISNULL(@TOTALFAC,0) AS TOTALFAC, ISNULL(@PROMEDIO,0) AS PROMEDIO, ISNULL(@TARIFUNI,0) AS TARIFUNI, (ISNULL(@TOTALFAC,0)*ISNULL(@TARIFUNI,0)) AS TOTAL

    SELECT LINEA, TMPDETSERVICIOS.CONTRATO AS CONTR, FECHA, CT, ST, DP, STOCK, FACTURAR, UNIDADES, TONELADAS
        , MONDESC
        , MEDDESC
        , CONTRDESC
         , TOTCT, TOTST, TOTDP
         , TOTSTOCK, TOTSOP, TOTUNI, TOTTONE
         , @VALUF AS VALUF, @VALDOLAR AS VALDOLAR
         , @FECUF AS FECUF, @FECDOLAR AS FECDOLAR
         , @TOTDIAS AS DIASFACT
         , @TOTALFAC AS TOTALFAC
         , @PROMEDIO AS PROMEDIO
         , @TARIFUNI AS TARIFUNI
    FROM TMPDETSERVICIOS INNER JOIN #RESUMEN
        ON TMPDETSERVICIOS.CONTRATO = #RESUMEN.CONTR
    WHERE IDENT = @IDENT
    ORDER BY 2,1,3

    SELECT CONT_PALLET FROM #CONTR ORDER BY CPAR_CONTR


    EXEC PA_LST_TRAMOSXCLIE @RUTCLI, '16', @CONTR

GO
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO

CREATE PROCEDURE [dbo].[PA_VER_CLIENTES]
@CLI_RUT NVARCHAR(10)
AS
   SELECT CLI_NOMB FROM CLIENTES
   WHERE  CLI_RUT = @CLI_RUT


GO
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO

CREATE PROCEDURE [dbo].[PA_VER_DETAPRED]
@DPRE_CODI NVARCHAR(18)
AS
 SELECT  DPRE_CODI,
      DPRE_CODPRO,
         DPRE_CODSOPO,
       DPRE_SOPOCLI,
         DPRE_UNIDADES,
      DPRE_PESO,
      DPRE_FECDES,
      DPRE_RUTCLI,
      DPRE_CONTCLI,
      DPRE_FECPROD,
      DPRE_CAMARA,
      DPRE_BANDA,
      DPRE_COLUM,
      DPRE_PISO,
      DPRE_NIVEL,
      DPRE_ALMACEN,
      DPRE_DCAJA,
      DPRE_FOLIO,
      DPRE_ACTIVA,
      DPRE_RADIO,
      DPRE_TRACK,
      DPRE_CODVIG,
      DPRE_PALLET,
      DPRE_SLOT,
      DPRE_TS,
      DPRE_TM,
      DPRE_TI,
      DPRE_CODPER,
      DPRE_HORA,
      DPRE_FECN
--      DPRE_FOLIO_PALLET
   FROM  DETAPRED
   WHERE SUBSTRING(DPRE_CODI,1,7) = @DPRE_CODI


GO
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO

CREATE PROCEDURE [dbo].[PA_VER_FICHPRED]
@FPRE_CODI       NVARCHAR(14)
AS
   SELECT FPRE_CODI,
    FPRE_RUTCLI,
    FPRE_HORADES,
    FPRE_HORATER,
    FPRE_FECDES,
    FPRE_TOTSOPO,
    FPRE_TOTUNIDAD,
    FPRE_TOTPESO,
          FPRE_RUTCOND,
          FPRE_CODIENCA,
          FPRE_ACTIVA,
          FPRE_FECHACT,
          FPRE_CODVIG,
          FPRE_GDESPA,
          FPRE_RADIO,
          FPRE_TIPO,
          FPRE_PROCESO,
          FPRE_SELLO,
          FPRE_TEM,
          FPRE_ANDEN
--          FPRE_USUCRE
FROM      FICHPRED
WHERE    FPRE_CODI = @FPRE_CODI


GO
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO

CREATE PROCEDURE [dbo].[PA_VER_GUIASDESPEND]
  @EST_CODI     INT,  -- CODIGO DE ESTADO
  @FPRE_USUCRE  NVARCHAR(3),    -- USUARIO CREADOR
  @FPRE_RUTCLI  VARCHAR(9),     -- RUT DEL CLIENTE
  @FECCREINI    VARCHAR(10),    -- FECHA CREACION INICIO
  @FECCREFIN    VARCHAR(10)     -- FECHA CREACION FINAL
AS

   SET NOCOUNT ON
   SET ROWCOUNT 200
   SET ROWCOUNT 0
   SET DATEFORMAT mdy

      --- ESTADOS DE PENDIENTES Y POR UN CREADOR

               IF  @FPRE_USUCRE <> '000'
                  BEGIN
                     SELECT DISTINCT 'PENDIENTES' AS EST_GLOSA,                                -- ESTADO GUIA PREDESPACHO
                          TMPFICHPRED.FPRE_CODI,                                   -- GUIA   PREDESPACHO
                          UPPER(LTRIM(RTRIM(CLIENTES.CLI_NOMB))) AS CLI_NOMB,      -- NOMBRE CLIENTE
                          TMPFICHPRED.FPRE_FECDES,                                 -- FECHA  CREACION
                          TMPFICHPRED.FPRE_FECDES AS FPRE_FECMOD,                               -- FECHA  ACTUAL
                          UPPER(LTRIM(RTRIM(USUARIO.DESCRI))) AS USUDESCRI,        -- USUARIO
                          TMPFICHPRED.EST_CODI,
                          TMPFICHPRED.FPRE_PALLET,
                        TMPFICHPRED.FPRE_RUTCLI
                     FROM TMPFICHPRED INNER JOIN
                          USUARIO  ON TMPFICHPRED.FPRE_CODIENCA   = USUARIO.PERSONAL INNER JOIN
                          CLIENTES ON TMPFICHPRED.FPRE_RUTCLI     = CLIENTES.CLI_RUT
                     WHERE CONVERT(INT,TMPFICHPRED.FPRE_CODIENCA) = CONVERT(INT,@FPRE_USUCRE)
                        AND EST_CODI = @EST_CODI
                          AND (480-DATEDIFF(MI, TMPFICHPRED.FPRE_FECDES,CONVERT(VARCHAR(10),GETDATE(),111)))>=0
                  END


                IF  @FPRE_USUCRE = '000'
                    BEGIN
                        SELECT DISTINCT 'PENDIENTES' AS EST_GLOSA,                      -- ESTADO GUIA PREDESPACHO                     T   MPFICHPRED.FPRE_CODI,
                        TMPFICHPRED.FPRE_CODI,      -- GUIA   PREDESPACHO
                        UPPER(LTRIM(RTRIM(CLIENTES.CLI_NOMB))) AS CLI_NOMB,      -- NOMBRE CLIENTE
                    TMPFICHPRED.FPRE_FECDES,                                 -- FECHA  CREACION
            TMPFICHPRED.FPRE_FECDES AS FPRE_FECMOD,                  -- FECHA  ACTUAL
                        UPPER(LTRIM(RTRIM(USUARIO.DESCRI))) AS USUDESCRI,        -- USUARIO
                        TMPFICHPRED.EST_CODI,
                        TMPFICHPRED.FPRE_PALLET,
            TMPFICHPRED.FPRE_RUTCLI
                FROM    TMPFICHPRED INNER JOIN
             USUARIO    ON TMPFICHPRED.FPRE_CODIENCA     = USUARIO.PERSONAL INNER JOIN
             CLIENTES   ON TMPFICHPRED.FPRE_RUTCLI     = CLIENTES.CLI_RUT
        WHERE EST_CODI = @EST_CODI
                AND (480-DATEDIFF(MI, TMPFICHPRED.FPRE_FECDES,CONVERT(VARCHAR(10),GETDATE(),111)))>=0
                END


GO
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO



      --- ESTADOS DE PENDIENTES Y POR UN CREADOR
CREATE PROCEDURE [dbo].[PA_VER_GUIASDESPENDCREADAS]
  @EST_CODI     INT,  -- CODIGO DE ESTADO
  @FPRE_USUCRE AS VARCHAR(3),    -- USUARIO CREADOR
  @FPRE_RUTCLI AS VARCHAR(9),   -- RUT DEL CLIENTE
  @FECCREINI    VARCHAR(10),    -- FECHA CREACION INICIO
  @FECCREFIN    VARCHAR(10)     -- FECHA CREACION FINAL
AS
--SP_HELPTEXT PA_VER_GUIASDESPENDCREADAS     0 , '000' , '969849402' , '000000000' , '000000000'
--PA_VER_GUIASDESPENDCREADAS     0 , '909' , '96999710K' , '000000000' , '000000000'
   SET NOCOUNT ON
   SET ROWCOUNT 200
   SET ROWCOUNT 0
-- SELECT * FROM CLIENTES ORDER BY 3
      --- ESTADOS DE PENDIENTES Y POR UN CREADOR

---     IF  @FPRE_USUCRE <> '000'
--     BEGIN
          SELECT 'CREADAS' AS EST_GLOSA,    FPRE_CODIENCA,
               FICHPRED.FPRE_CODI ,
               UPPER(LTRIM(RTRIM(CLIENTES.CLI_NOMB))) AS CLI_NOMB,
               FICHPRED.FPRE_FECDES,
               FICHPRED.FPRE_FECDES AS FPRE_FECMOD,
               UPPER(LTRIM(RTRIM(USUARIO.DESCRI))) AS USUDESCRI,
--               ISNULL(FICHPRED.EST_CODI,0) AS EST_CODI,
               ISNULL(0,0) AS EST_CODI,
               '0' AS FPRE_PALLET,
               FICHPRED.FPRE_RUTCLI
          FROM  FICHPRED INNER JOIN USUARIO
               ON FICHPRED.FPRE_CODIENCA = USUARIO.PERSONAL INNER JOIN CLIENTES
               ON FICHPRED.FPRE_RUTCLI = CLIENTES.CLI_RUT
          WHERE FICHPRED.FPRE_ACTIVA = 0
                AND CONVERT(INT,FICHPRED.FPRE_CODIENCA) = CASE WHEN (@FPRE_USUCRE='000') THEN CONVERT(INT,FICHPRED.FPRE_CODIENCA) ELSE @FPRE_USUCRE END
                AND FICHPRED.FPRE_RUTCLI = CASE WHEN (@FPRE_RUTCLI='0') THEN FICHPRED.FPRE_RUTCLI ELSE @FPRE_RUTCLI END
                AND CONVERT(INT, ISNULL(REPLACE(REPLACE(FICHPRED.FPRE_FECDES,'/',''),'-',''),0)) >= CONVERT(INT,SUBSTRING(CONVERT(VARCHAR(10),DATEADD(MM,-3,GETDATE()),112),1,6)+'01')
                AND CONVERT(INT, ISNULL(REPLACE(REPLACE(FICHPRED.FPRE_FECDES,'/',''),'-',''),0)) <= CONVERT(INT,CONVERT(VARCHAR(10),GETDATE(),112)) --CONVERT(INT,SUBSTRING(CONVERT(VARCHAR(10),GETDATE(),112),1,6)+'01')
          ORDER BY FICHPRED.FPRE_CODI ASC
/*
     IF  @FPRE_USUCRE = '000'
     BEGIN
          SELECT 'CREADAS' AS EST_GLOSA,
               FICHPRED.FPRE_CODI,
               UPPER(LTRIM(RTRIM(CLIENTES.CLI_NOMB))) AS CLI_NOMB,
               FICHPRED.FPRE_FECDES,
               GETDATE() AS FPRE_FECMOD,
               UPPER(LTRIM(RTRIM(USUARIO.DESCRI))) AS USUDESCRI,
               ISNULL(FICHPRED.EST_CODI,0) AS EST_CODI,
               '0' AS FPRE_PALLET,
               FICHPRED.FPRE_RUTCLI
          FROM FICHPRED INNER JOIN USUARIO
                    ON FICHPRED.FPRE_CODIENCA = USUARIO.PERSONAL INNER JOIN CLIENTES
                    ON FICHPRED.FPRE_RUTCLI = CLIENTES.CLI_RUT
          WHERE FICHPRED.FPRE_ACTIVA <> 0
               AND FICHPRED.FREC_RUTCLI = CASE WHEN (@FREC_RUTCLI='') THEN FICHPRED.FPRE_RUTCLI ELSE @FPRE_RUTCLI END
               AND CONVERT(INT, ISNULL(REPLACE(REPLACE(FICHPRED.FPRE_FECDES,'/',''),'-',''),0)) >= CONVERT(INT,SUBSTRING(CONVERT(VARCHAR(10),DATEADD(MM,-3,GETDATE()),112),1,6)+'01')
               AND CONVERT(INT, ISNULL(REPLACE(REPLACE(FICHPRED.FPRE_FECDES,'/',''),'-',''),0)) <= CONVERT(INT,CONVERT(VARCHAR(10),GETDATE(),112)) --CONVERT(INT,SUBSTRING(CONVERT(VARCHAR(10),GETDATE(),112),1,6)+'01')

          ORDER   BY  FICHPRED.FPRE_CODI ASC
     END

*/


GO
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO



CREATE PROCEDURE [dbo].[PA_VER_GUIASDESPENDIENTES_PREDESPACHO]
  @EST_CODI     INT,  -- CODIGO DE ESTADO
  @FPRE_USUCRE  NVARCHAR(3),    -- USUARIO CREADOR
  @FPRE_RUTCLI  VARCHAR(9),     -- RUT DEL CLIENTE
  @FECCREINI    VARCHAR(10),    -- FECHA CREACION INICIO
  @FECCREFIN    VARCHAR(10)     -- FECHA CREACION FINAL
AS

   SET NOCOUNT ON
   SET ROWCOUNT 200
   SET ROWCOUNT 0

      --- ESTADOS DE PENDIENTES Y POR UN CREADOR

               IF  @FPRE_USUCRE <> '000'
                  BEGIN
                     SELECT 'CREADAS' AS EST_GLOSA,
                            FICHPRED.FPRE_CODI ,
                            UPPER(LTRIM(RTRIM(CLIENTES.CLI_NOMB))) AS CLI_NOMB,
                            FICHPRED.FPRE_FECDES,
                            FICHPRED.FPRE_FECDES AS FPRE_FECMOD,
                            UPPER(LTRIM(RTRIM(USUARIO.DESCRI))) AS USUDESCRI,
                            ISNULL(FICHPRED.EST_CODI,0) AS EST_CODI,
                            '0' AS FPRE_PALLET,
                            FICHPRED.FPRE_RUTCLI
                            FROM  FICHPRED,
                                  USUARIO ,
                                  CLIENTES
                          WHERE   FICHPRED.FPRE_USUCRE = USUARIO.PERSONAL
                            AND   FICHPRED.FPRE_RUTCLI = CLIENTES.CLI_RUT
                            AND   CONVERT(INT,FICHPRED.FPRE_USUCRE) = @FPRE_USUCRE
                            AND   FICHPRED.EST_CODI = 1
                           ORDER  BY FICHPRED.FPRE_CODI ASC
                    END

                IF  @FPRE_USUCRE = '000'
                    BEGIN
                    SELECT 'PENDIENTES' AS EST_GLOSA,
                            FICHPRED.FPRE_CODI,
                            UPPER(LTRIM(RTRIM(CLIENTES.CLI_NOMB))) AS CLI_NOMB,
                            FICHPRED.FPRE_FECDES,
                            FICHPRED.FPRE_FECDES AS FPRE_FECMOD,
                            UPPER(LTRIM(RTRIM(USUARIO.DESCRI))) AS USUDESCRI,
                            ISNULL(FICHPRED.EST_CODI,0) AS EST_CODI,
                            '0' AS FPRE_PALLET,
                            FICHPRED.FPRE_RUTCLI
                            FROM    FICHPRED, USUARIO, CLIENTES
                            WHERE   FICHPRED.FPRE_USUCRE     = USUARIO.PERSONAL
                              AND   FICHPRED.FPRE_RUTCLI     = CLIENTES.CLI_RUT
                              AND   FICHPRED.EST_CODI = 1
                           ORDER    BY FICHPRED.FPRE_CODI ASC
                   END


GO
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO

CREATE PROCEDURE [dbo].[PA_VER_GUIASPREDP]
@FPRE_USUCRE AS NVARCHAR(3)
AS

 SET NOCOUNT ON
 SET rowcount 200
 SET rowcount 0

 SET NOCOUNT ON
 SET rowcount 200
 SET rowcount 0

          SELECT DISTINCT UPPER(LTRIM(RTRIM(TMPESTADOS.EST_GLOSA))) AS EST_GLOSA,
          TMPFICHPRED.FPRE_CODI,
          UPPER(LTRIM(RTRIM(CLIENTES.CLI_NOMB))) AS CLI_NOMB ,
          TMPFICHPRED.FPRE_FECDES,
          TMPFICHPRED.FPRE_FECDES AS FPRE_FECMOD,
          UPPER(LTRIM(RTRIM(USUARIO.DESCRI))) AS USUDESCRI,
          TMPFICHPRED.EST_CODI
          FROM TMPFICHPRED INNER JOIN
          USUARIO    ON TMPFICHPRED.FPRE_CODIENCA       = USUARIO.PERSONAL INNER JOIN
          CLIENTES   ON TMPFICHPRED.FPRE_RUTCLI      = CLIENTES.CLI_RUT INNER JOIN
          TMPESTADOS ON TMPFICHPRED.EST_CODI         = TMPESTADOS.EST_CODI
          WHERE CONVERT(INT, TMPFICHPRED.FPRE_CODIENCA) = CONVERT(INT,@FPRE_USUCRE)
             AND TMPFICHPRED.EST_CODI = 2


GO
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO





-- Autor:    CAROLINA URIBE RUIZ / ACL
-- Objetivo:    LISTA GUIAS DE RECEPCION
-- Fecha de Creacin: 14-09-2007
-- Modificaciones:
-- Pruebas
/*
exec PA_VER_GUIASRECEP 1 , '050', '', '', ''
*/
CREATE PROCEDURE [dbo].[PA_VER_GUIASRECEP]
  @EST_CODI AS INT
, @FREC_USUCRE AS NVARCHAR(3)
, @FREC_RUTCLI AS VARCHAR(9)
, @FECCREINI VARCHAR(10)
, @FECCREFIN VARCHAR(10)
AS


    SET NOCOUNT ON
    SET rowcount 200
    SET rowcount 0

    SET NOCOUNT ON
    SET rowcount 200
    SET rowcount 0

    --DROP TABLE #PENDIENTES
    SELECT DISTINCT UPPER(LTRIM(RTRIM(TMPESTADOS.EST_GLOSA))) AS EST_GLOSA, TMPFICHRECE.FREC_CODI, UPPER(LTRIM(RTRIM(CLIENTES.CLI_NOMB))) AS CLI_NOMB
        , TMPFICHRECE.FREC_FECCRE
        , TMPFICHRECE.FREC_FECMOD
        , UPPER(LTRIM(RTRIM(USUARIO.DESCRI))) AS USUDESCRI
        , TMPFICHRECE.EST_CODI
    INTO #PENDIENTES
    FROM TMPFICHRECE INNER JOIN
        USUARIO ON TMPFICHRECE.FREC_USUCRE = USUARIO.PERSONAL INNER JOIN
        CLIENTES ON TMPFICHRECE.FREC_RUTCLI = CLIENTES.CLI_RUT INNER JOIN
        TMPESTADOS ON TMPFICHRECE.EST_CODI = TMPESTADOS.EST_CODI
    WHERE TMPFICHRECE.EST_CODI IN (1,2) AND --= CASE WHEN @EST_CODI=2 THEN TMPFICHRECE.EST_CODI ELSE @EST_CODI END AND
         CONVERT(INT,TMPFICHRECE.FREC_USUCRE) = CASE WHEN (@FREC_USUCRE ='') THEN CONVERT(INT,TMPFICHRECE.FREC_USUCRE) ELSE CONVERT(INT,@FREC_USUCRE) END AND
         TMPFICHRECE.FREC_RUTCLI = CASE WHEN (@FREC_RUTCLI='') THEN TMPFICHRECE.FREC_RUTCLI ELSE @FREC_RUTCLI END AND
         (CONVERT(VARCHAR(10),TMPFICHRECE.FREC_FECCRE,105) >= CASE WHEN (@FECCREINI ='') THEN CONVERT(VARCHAR(10),TMPFICHRECE.FREC_FECCRE,105) ELSE @FECCREINI END AND
         CONVERT(VARCHAR(10),TMPFICHRECE.FREC_FECCRE,105) <= CASE WHEN (@FECCREFIN ='') THEN CONVERT(VARCHAR(10),TMPFICHRECE.FREC_FECCRE,105) ELSE @FECCREFIN END) AND
         (480-DATEDIFF(MI, TMPFICHRECE.FREC_FECCRE, GETDATE()))>=0
--    UNION
    --DROP TABLE #CREADAS
    SELECT DISTINCT 'CREADA' AS EST_GLOSA, FICHRECE.FREC_CODI, UPPER(LTRIM(RTRIM(CLIENTES.CLI_NOMB))) AS CLI_NOMB
        , FICHRECE.FREC_FECREC AS FREC_FECCRE
        , FICHRECE.FREC_FECREC AS FREC_FECMOD
        , UPPER(LTRIM(RTRIM(USUARIO.DESCRI))) AS USUDESCRI
        , 0 AS EST_CODI
    INTO #CREADAS
    FROM FICHRECE INNER JOIN
        DETARECE ON FICHRECE.FREC_CODI = LEFT(DETARECE.DREC_CODI,7) INNER JOIN
        USUARIO ON CONVERT(INT,ISNULL(DETARECE.DREC_CODPER,0)) = CONVERT(INT,USUARIO.PERSONAL) INNER JOIN
        CLIENTES ON FICHRECE.FREC_RUTCLI = CLIENTES.CLI_RUT
    WHERE FICHRECE.FREC_FECREC <> ''
        AND FICHRECE.FREC_RUTCLI = CASE WHEN (@FREC_RUTCLI='') THEN FICHRECE.FREC_RUTCLI ELSE @FREC_RUTCLI END
        AND CONVERT(INT, ISNULL(REPLACE(REPLACE(FICHRECE.FREC_FECREC,'/',''),'-',''),0)) >= CONVERT(INT,SUBSTRING(CONVERT(VARCHAR(10),DATEADD(MM,-3,GETDATE()),112),1,6)+'01')--Modificar meses para ver recepciones antiguas
        AND CONVERT(INT, ISNULL(REPLACE(REPLACE(FICHRECE.FREC_FECREC,'/',''),'-',''),0)) <= CONVERT(INT,CONVERT(VARCHAR(10),GETDATE(),112)) --CONVERT(INT,SUBSTRING(CONVERT(VARCHAR(10),GETDATE(),112),1,6)+'01')
        AND CONVERT(INT,DETARECE.DREC_CODPER) = CONVERT(INT,CASE WHEN (@FREC_USUCRE ='') THEN DETARECE.DREC_CODPER ELSE @FREC_USUCRE END )
        AND CONVERT(INT,DETARECE.DREC_CODPER) = CONVERT(INT,CASE WHEN (@FREC_USUCRE ='') THEN CONVERT(INT,DETARECE.DREC_CODPER) ELSE CONVERT(INT, @FREC_USUCRE) END )
--    ORDER BY 4

    IF @EST_CODI = 0
    BEGIN
        SELECT *
        FROM #CREADAS
        ORDER BY 3, CONVERT(VARCHAR(10), FREC_FECCRE ,105) DESC -- FREC_FECCRE
    END
    ELSE
        IF @EST_CODI = 1
        BEGIN
            SELECT *
            FROM #PENDIENTES
            WHERE EST_CODI = 1
            ORDER BY 3
        END
        ELSE
            IF @EST_CODI = 2
            BEGIN
                SELECT *
                FROM #PENDIENTES
                WHERE EST_CODI = 2
                ORDER BY 3
            END
            ELSE
            BEGIN
                SELECT *
                FROM #PENDIENTES
                ORDER BY 3

                SELECT *
                FROM #CREADAS
                ORDER BY 3, CONVERT(VARCHAR(10), FREC_FECCRE ,105) DESC
            END
GO
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO







CREATE PROCEDURE [dbo].[PA_VER_PRODUCTO]
@MAE_CODI NVARCHAR(14)
AS
SELECT  A.MAE_CODI,
        A.MAE_DESCR,
        B.TENV_DESCR
FROM MAEPROD A,
     TIPOENV B
WHERE   A.MAE_CODI  = @MAE_CODI
 AND    A.MAE_TIPENV=B.TENV_CODI


GO
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO



CREATE PROCEDURE [dbo].[PA_VER_REPORGUIASCREADAS]
@FPRE_CODI NVARCHAR(14)
AS
SELECT   B.DPRE_CODPRO,
  C.MAE_DESCR,
         ISNULL(C.MAE_FECCRE,0)    AS MAE_FECCRE,
         ISNULL(D.MOV_CA,0)        AS MOV_CA,
  ISNULL(D.MOV_BA,0)        AS MOV_BA ,
         ISNULL(D.MOV_CO,0)        AS MOV_CO,
  ISNULL(D.MOV_PI,0)        AS MOV_PI,
         ISNULL(D.MOV_NI,0)        AS MOV_NI,
         ISNULL(B.DPRE_UNIDADES,0) AS DPRE_UNIDADES,
         ISNULL(B.DPRE_PESO,0)     AS DPRE_PESO,
         ISNULL(B.DPRE_SOPOCLI,0)  AS DPRE_SOPOCLI,
         ISNULL(B.DPRE_FOLIO,0)    AS DPRE_FOLIO,
         ISNULL(B.DPRE_PALLET,0)   AS DPRE_PALLET,
         ISNULL(B.DPRE_TS,0)       AS DPRE_TS,
         ISNULL(B.DPRE_TM,0)       AS DPRE_TM,
         ISNULL(B.DPRE_TI,0)       AS DPRE_TI
FROM     FICHPRED   A,
         DETAPRED   B,
         MAEPROD    C,
         MOVPALLET  D
WHERE A.FPRE_CODI   = @FPRE_CODI
  AND A.FPRE_CODI   = SUBSTRING(B.DPRE_CODI,1,7)
  AND B.DPRE_CODPRO = C.MAE_CODI
  AND B.DPRE_FOLIO  = D.MOV_FOLIO


GO
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO



CREATE PROCEDURE [dbo].[PA_VER_ROLES]
@COD_USUARIO NVARCHAR(06),
@PRIVILEGIO  NVARCHAR(100)
AS
SELECT DISTINCT (select distinct A.DESCRI from usuario a where cast(A.PERSONAL as int)   = cast(@COD_USUARIO as int)),
       C.DESCRIPCION_ROL,
       C.CODIGO_ROL,
       D.PRIVILEGIO
FROM   USUARIO A,
       REL_USUARIOS_ROLES B ,
       ROLES C,
       PRIVILEGIOS D
WHERE 1=1
--  and cast(A.PERSONAL as int)   = cast(@COD_USUARIO as int)
  AND cast(@COD_USUARIO as int)   = cast(B.COD_USUARIO as int)
  AND B.COD_ROL    = C.CODIGO_ROL
  AND C.CODIGO_ROL = D.COD_ROL
  AND RTRIM(LTRIM(D.PRIVILEGIO )) = rtrim(ltrim(@PRIVILEGIO))



GO
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO






CREATE PROCEDURE [dbo].[PA_VER_TMPFICHPRED]
@FPRE_CODI       NVARCHAR(14)
AS
   SELECT FPRE_CODI,
      FPRE_RUTCLI,
      FPRE_HORADES,
      FPRE_HORATER,
      FPRE_FECDES,
      FPRE_TOTSOPO,
      FPRE_TOTUNIDAD,
      FPRE_TOTPESO,
          FPRE_RUTCOND,
          FPRE_CODIENCA,
          FPRE_ACTIVA,
          FPRE_FECHACT,
          FPRE_CODVIG,
          FPRE_GDESPA,
          FPRE_RADIO,
          FPRE_TIPO,
          FPRE_PROCESO,
          FPRE_SELLO,
          FPRE_TEM,
          FPRE_ANDEN,
          FPRE_USUCRE,
          EST_CODI,
          FPRE_PALLET,
          FPRE_TS,
      FPRE_TM,
      FPRE_TI
FROM     TMPFICHPRED
WHERE FPRE_CODI = @FPRE_CODI


GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
--drop VIEW GVW_SERVRECE AS
--SELECT Dvas_VasCod VAS, Serv_Cod SERV, Serv_Nom NOM,  Dvas_Unid UNID, Dvas_Cajas CAJAS, REPLACE(Dvas_Kilos,',','.')  AS KILOS 
--FROM FacServicios  LEFT JOIN FacVasDeta ON Serv_Cod=Dvas_ServCod 
--WHERE Serv_OrdR>0 AND Dvas_VasCod=(SELECT Vas_cod FROM FacVas WHERE Vas_Dcto='0002999' AND Vas_TipDoc='0') 


--SELECT * FROM FacServicios LEFT JOIN FacVasDeta ON Serv_Cod=Dvas_ServCod  
--WHERE Serv_OrdR>0 AND Dvas_VasCod='0005961'
----AND Dvas_VasCod IN((SELECT Vas_cod FROM FacVas WHERE Vas_Dcto='0002999' AND Vas_TipDoc='0'),NULL)
--ORDER BY Serv_OrdR
 

--SELECT CASE  WHEN isnull(UNID,0)= 0  AND isnull(UNID,0)=0  AND isnull(UNID,0)=0 THEN 'False'  ELSE 'True' END AS dvas_est, 
--Serv_Cod , Serv_Nom, isnull(UNID,0) dvas_unid, isnull(CAJAS,0) Dvas_Cajas, REPLACE(isnull(KILOS,0),',','.') Dvas_kilos 
--FROM GVW_SERVRECE vw RIGHT JOIN FacServicios se ON se.Serv_Cod=serv 
--WHERE VAS=(SELECT Vas_cod FROM FacVas WHERE Vas_Dcto='0002999' AND Vas_TipDoc='0')
--and  Serv_Incluir<>'0' AND  Serv_Incluir<>'2' ORDER BY Serv_OrdR


 


--		ALTER VIEW AAAAAA AS
--		SELECT Dvas_VasCod VAS, Serv_Cod SERV, Serv_Nom NOM, Dvas_Unid UNID, Dvas_Cajas CAJAS, REPLACE(Dvas_Kilos,',','.') AS KILOS 
--		FROM FacServicios LEFT JOIN FacVasDeta ON Serv_Cod=Dvas_ServCod 
--		WHERE Serv_OrdR>0 
--		AND Dvas_VasCod=(SELECT Vas_cod FROM FacVas WHERE Vas_Dcto='0002999' AND Vas_TipDoc='0') 
 
 
--		SELECT CASE  WHEN isnull(UNID,0)= 0  AND isnull(UNID,0)=0  AND isnull(UNID,0)=0 THEN 'False'  ELSE 'True' END AS dvas_est, 
--		Serv_Cod , Serv_Nom, isnull(UNID,0) dvas_unid, isnull(CAJAS,0) Dvas_Cajas, REPLACE(isnull(KILOS,0),',','.') Dvas_kilos  
--		FROM AAAAAA vw RIGHT JOIN FacServicios se ON se.Serv_Cod=serv 
--		WHERE  Serv_OrdR>'0' ORDER BY Serv_OrdR
		
                                       
--       	SELECT * FROM FacServicios LEFT JOIN FacVasDeta ON Serv_Cod=Dvas_ServCod 
--		WHERE Serv_OrdR>0 
--		AND Dvas_VasCod=(SELECT Vas_cod FROM FacVas WHERE Vas_Dcto='0002999' AND Vas_TipDoc='0')                                 
		
		
		
		CREATE PROCEDURE [dbo].[PAG_ADICIONALESRECE]
		(
			@codrece as varchar(7)
		)
		AS
		BEGIN
		
			declare @sql nvarchar(1000)
			set @sql = 'CREATE VIEW GVW_ADICRECE 
			AS
			SELECT Dvas_VasCod VAS, Serv_Cod SERV, Serv_Nom NOM, Dvas_Unid UNID, Dvas_Cajas CAJAS, REPLACE(Dvas_Kilos,'','',''.'') AS KILOS 
			FROM FacServicios LEFT JOIN FacVasDeta ON Serv_Cod=Dvas_ServCod 
			WHERE Serv_OrdR>0 
			AND Dvas_VasCod=(SELECT Vas_cod FROM FacVas WHERE Vas_Dcto=''@codrece'' AND Vas_TipDoc=0)'
			exec sp_executesql @sql
		
			--CREATE VIEW GVW_ADICRECE 
			--AS
			--SELECT Dvas_VasCod VAS, Serv_Cod SERV, Serv_Nom NOM, Dvas_Unid UNID, Dvas_Cajas CAJAS, REPLACE(Dvas_Kilos,',','.') AS KILOS 
			--FROM FacServicios LEFT JOIN FacVasDeta ON Serv_Cod=Dvas_ServCod 
			--WHERE Serv_OrdR>0 
			--AND Dvas_VasCod=(SELECT Vas_cod FROM FacVas WHERE Vas_Dcto=@codrece AND Vas_TipDoc='0') 
 
			SELECT CASE  WHEN isnull(UNID,0)= 0  AND isnull(UNID,0)=0  AND isnull(UNID,0)=0 THEN 'False'  ELSE 'True' END AS dvas_est, 
			Serv_Cod , Serv_Nom, isnull(UNID,0) dvas_unid, isnull(CAJAS,0) Dvas_Cajas, REPLACE(isnull(KILOS,0),',','.') Dvas_kilos  
			FROM GVW_ADICRECE vw RIGHT JOIN FacServicios se ON se.Serv_Cod=serv 
			WHERE  Serv_OrdR>'0' ORDER BY Serv_OrdR
			
			DROP VIEW GVW_ADICRECE
		END
		
		EXEC PAG_ADICIONALESRECE '0002999'
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[PAG_AgregaCaja]
(
@codped AS numeric(18,0),
@caja AS VARCHAR(200),
@pallet AS VARCHAR(9),
@ultimo as int
)
AS

DECLARE @error AS  int
DECLARE @trans AS VARCHAR(50)

DECLARE @pedido as varchar(30)
DECLARE @kilos as float
DECLARE @cajas as int

SET @error=0

BEGIN TRANSACTION @trans
	BEGIN TRY 
	
		-- Cambiar estado de caja
	 	UPDATE DetaReceCajas SET caj_ped='1'  WHERE Caj_cod=@caja AND Caj_Pcod=@pallet
	 	
	 	-- Agrego movimiento
	 	--INSERT INTO movcajas(movc_fecha, movc_codcaja, movc_codrece, movc_tipo, movc_ndoc)
	 	--VALUES(GETDATE(), @caja, @pallet, 'PW', @codped)
	 	
	 	--Capturo numero de pedido
		SELECT @pedido=pedido FROM Pedidos_ficha WHERE Orden=@codped

		SELECT @cajas=cajas, @kilos=kilos FROM Pedidos_detalle WHERE pedido=@pedido AND pallet=@pallet

		SET @kilos=ROUND((@kilos/@cajas)*(@cajas+1),2);
		SET @cajas=@cajas+1;
		
		UPDATE Pedidos_detalle SET cajas=@cajas, kilos=@kilos, parcial=@ultimo WHERE pedido=@pedido AND pallet=@pallet
 
 		UPDATE pedcaja SET pc_ncaja=@cajas, pc_kilos=@kilos WHERE pc_codped=@codped AND pc_numpal=@pallet
		-- Agrega caja
		INSERT INTO detapedcaja(dpc_codcaja, dpc_codped, dpc_numpal)VALUES(@caja, @codped, @pallet)
 	 	
 	 	
	END TRY
	BEGIN CATCH
		ROLLBACK TRANSACTION @trans;
		SELECT 1;
		RETURN;
	END CATCH

SELECT @error
	IF(@error=0)
	BEGIN
		COMMIT TRANSACTION @trans
		SELECT 0;
	END

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

CREATE PROCEDURE [dbo].[PAG_CambioCaja]
(
@codped AS numeric(18,0),
@caj_inici AS VARCHAR(200),
@caj_final AS VARCHAR(200),
@pal_inici AS VARCHAR(9),
@pal_final AS VARCHAR(9)
)
AS

DECLARE @error AS  int
DECLARE @trans AS VARCHAR(50)
 

SET @error=0

BEGIN TRANSACTION @trans
	BEGIN TRY 
	-- Cambiar caja 1 de pallet
	 	UPDATE DetaReceCajas SET caj_ped='1', Caj_cod=@caj_final WHERE Caj_cod=@caj_inici AND Caj_Pcod=@pal_inici
	 	
	 	INSERT INTO movcajas(movc_fecha, movc_codcaja, movc_codrece, movc_tipo, movc_ndoc)
	 	VALUES(GETDATE(), @caj_final, @pal_inici, 'CP', 0)
	 	
	-- Cambiar caja 2 de pallet
	 	UPDATE DetaReceCajas SET caj_ped='0', Caj_cod=@caj_inici WHERE Caj_cod=@caj_final AND Caj_Pcod=@pal_final
	 	 	
	 	INSERT INTO movcajas(movc_fecha, movc_codcaja, movc_codrece, movc_tipo, movc_ndoc)
	 	VALUES(GETDATE(), @caj_inici, @pal_final, 'CP', 0)
	 	
	-- Cambiar estado de caja a despachar
	 	UPDATE detapedcaja SET dpc_codcaja=@caj_final WHERE dpc_codped=@codped AND dpc_codcaja=@caj_inici
	 	
	 	
	END TRY
	BEGIN CATCH
		ROLLBACK TRANSACTION @trans;
		SELECT 1;
		RETURN;
	END CATCH

SELECT @error
	IF(@error=0)
	BEGIN
		COMMIT TRANSACTION @trans
		SELECT 0;
	END



GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[PAG_CARGASELECCION]
(
@codpred AS varchar(7),
@codped as numeric(18,0),
@codusu as varchar(3)
)
AS

DECLARE @error AS  int
DECLARE @trans AS VARCHAR(50)

SET @error=0

BEGIN TRANSACTION @trans
	BEGIN TRY 
	 	INSERT INTO TMPDETAPRED(fpre_codi, dpre_codi, dpre_codpro, dpre_codsopo, dpre_unidades, dpre_peso, dpre_fecdes, dpre_rutcli, dpre_contcli, dpre_fecprod, 
	 							dpre_camara, dpre_banda, dpre_colum, dpre_piso, dpre_nivel, dpre_almacen, dpre_folio, dpre_activa, dpre_radio, dpre_track, 
	 							dpre_codvig, dpre_pallet, dpre_slot, dpre_TS, dpre_TM, dpre_TI, dpre_Ptr, dpre_Pick, dpre_CodPer, dpre_Hora, 
	 							dpre_fecn, dpre_ActUni, dpre_TotUni) 
						SELECT  @codpred, RIGHT('00' + Ltrim(Rtrim(ROW_NUMBER() OVER( ORDER BY racd_codi ))),2) AS 'codigo', mae_codi, drec_codsopo, pc_ncaja, ROUND(pc_kilos,2) as pc_kilos, Convert(Varchar(10),GETDATE(),111) as fec, drec_rutcli, drec_contcli, drec_fecprod, 
							    drec_camara, drec_banda, drec_colum, drec_piso, drec_nivel,'2', racd_codi, '0', '0', '0', 
								'0', CASE WHEN drec_codi=pc_ncaja THEN 1 ELSE 0 END, '0','0','0','0','0',ROW_NUMBER() OVER( ORDER BY racd_codi ),@codusu, Convert(varchar(5),GETDATE(),108), Convert(Varchar(10),GETDATE(),111), pc_ncaja, racd_unidades-pc_ncaja
								FROM pedcaja 
								INNER JOIN rackdeta ON racd_codi=pc_numpal 
								INNER JOIN detarece ON drec_codi=racd_codi 
								INNER JOIN maeprod ON mae_codi=drec_codpro WHERE pc_codped=@codped
		
			INSERT INTO DetaPredCajas(dpre_caja, dpre_npallet, dpre_nped)
			SELECT DISTINCT dpc_codcaja, dpc_numpal, @codped FROM detapedcaja WHERE dpc_codped=@codped
			 
		
	END TRY
	BEGIN CATCH
		ROLLBACK TRANSACTION @trans;
		SELECT 1;
		RETURN;
	END CATCH

SELECT @error
	IF(@error=0)
	BEGIN
		COMMIT TRANSACTION @trans
		SELECT 0;
	END

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[PAG_EliminaCaja]
(
@codped AS numeric(18,0),
@pallet AS VARCHAR(200),
@codcaja AS VARCHAR(200)
)
AS

DECLARE @error AS  int
DECLARE @trans AS VARCHAR(50)

DECLARE @pedido as varchar(30)
DECLARE @kilos as float
DECLARE @cajas as int


SET @error=0

BEGIN TRANSACTION @trans
	BEGIN TRY 
	
	--rescato numero pedido
	SELECT @pedido=pedido FROM Pedidos_ficha WHERE Orden=@codped

	SELECT @cajas=cajas, @kilos=kilos FROM Pedidos_detalle WHERE pedido=@pedido AND pallet=@pallet

	
	SET @kilos=ROUND((@kilos/@cajas)*(@cajas-1),2);
	SET @cajas=@cajas-1;
	
	UPDATE Pedidos_detalle SET cajas=@cajas, kilos=@kilos, parcial='1'  WHERE pedido=@pedido AND pallet=@pallet
 
	UPDATE pedcaja SET pc_ncaja=@cajas, pc_kilos=@kilos WHERE pc_codped=@codped AND pc_numpal=@pallet
	
	-- Elimina caja
	DELETE detapedcaja WHERE dpc_codcaja=@codcaja AND dpc_numpal=@pallet AND dpc_codped=@codped
	
	UPDATE DetaReceCajas SET caj_ped='0' WHERE Caj_cod=@codcaja
	 
	END TRY
	BEGIN CATCH
		ROLLBACK TRANSACTION @trans;
		SELECT 1;
		RETURN;
	END CATCH

SELECT @error
	IF(@error=0)
	BEGIN
		COMMIT TRANSACTION @trans
		SELECT 0;
	END

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
 
CREATE PROCEDURE [dbo].[PAG_EliminaPedido]
(
@codped AS numeric(18,0) -- Numero de Orden
)
AS

DECLARE @error AS  int
DECLARE @trans AS VARCHAR(50)
DECLARE @pedido as varchar(30)

SET @error=0

BEGIN TRANSACTION @trans
	BEGIN TRY 
		
		SELECT @pedido=pedido FROM Pedidos_ficha WHERE Orden=@codped
	
		DELETE FROM pedcaja  WHERE pc_codped=@codped
		
	 	UPDATE Pedidos_ficha SET codvig='1' WHERE Orden=@codped
	 	
	 	UPDATE rackdeta SET racd_estado='0' WHERE racd_codi in (SELECT pallet FROM Pedidos_detalle WHERE pedido=@pedido)
	 	
	 	UPDATE DetaReceCajas SET caj_ped ='0' FROM DetaReceCajas INNER JOIN detapedcaja ON dpc_codcaja = Caj_cod WHERE dpc_codped=@codped
	 	
	 	INSERT INTO movcajas(movc_fecha, movc_codcaja, movc_codrece, movc_tipo, movc_ndoc)
	 	SELECT GETDATE(), dpc_codcaja, dpc_numpal, 'PA', @codped FROM detapedcaja WHERE dpc_codped=@codped
	 	
	 	
	 	DELETE FROM detapedcaja  WHERE dpc_codped=@codped
	 	
	 	DELETE FROM Pedidos_detalle WHERE pedido=@pedido
	 	
	 	DELETE FROM pedidoguias WHERE pguia_codped=@codped
	 	
	 	DELETE FROM pedidos_prg WHERE prg_orden=@codped
	 	
	 	----Actualiza movcajas
	 	--INSERT INTO movcajas(movc_fecha, movc_codcaja, movc_codrece, movc_tipo, movc_ndoc)
	 	--SELECT GETDATE(), dpc_codcaja, dpc_numpal, 'PA', @codped FROM detapedcaja WHERE dpc_codped=@codped
	 	
	END TRY
	BEGIN CATCH
		ROLLBACK TRANSACTION @trans;
		SELECT 1;
		RETURN;
	END CATCH

SELECT @error
	IF(@error=0)
	BEGIN
		COMMIT TRANSACTION @trans
		SELECT 0;
	END



GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

CREATE PROCEDURE [dbo].[PAG_ElimPreDespacho]
(
@cod_pred AS VARCHAR(9),
@cod_ped AS numeric(18,0)
)
AS

DECLARE @error AS  int
DECLARE @trans AS VARCHAR(50)
 
SET @error=0

BEGIN TRANSACTION @trans
	BEGIN TRY 
	
	 	 DELETE FROM fichpred WHERE fpre_codi=@cod_pred
	 	 DELETE FROM detapred WHERE left(dpre_codi,7)= @cod_pred
	 	 DELETE FROM movpallet WHERE (mov_tipo = 'PD' OR mov_tipo='PR') AND mov_Doc =@cod_pred
	 	 UPDATE pedidos_ficha SET Ped_EstPred='0' WHERE orden=@cod_ped
	 	 UPDATE rackdeta SET racd_estado='0', racd_pred=''   WHERE racd_pred=@cod_pred
	 	 
	 	 if @cod_ped>0
	 	 BEGIN
	 		UPDATE pedcaja SET pc_estado='1' WHERE pc_codped=@cod_ped
	 		INSERT INTO movcajas(movc_fecha, movc_codcaja, movc_codrece, movc_tipo, movc_ndoc)
			SELECT GETDATE(),dpc_codcaja, dpc_numpal, 'AP', @cod_ped FROM detapedcaja  WHERE dpc_codped=@cod_ped
	 	 END
	 	
	END TRY
	BEGIN CATCH
		ROLLBACK TRANSACTION @trans;
		SELECT 1;
		RETURN;
	END CATCH

SELECT @error
	IF(@error=0)
	BEGIN
		COMMIT TRANSACTION @trans
		SELECT 0;
	END



GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[PAG_ING_SEGUROS]
(
@Serv_Cod VARCHAR(3),
@Serv_Nom Varchar(50),
@Serv_MedPred as varchar(3),
@Serv_MonPred as varchar(2),
@Serv_Desc as varchar(1000),
@rece as numeric(18, 0),
@desp as numeric(18, 0),
@etiq as numeric(18, 0),
@serv_esc as numeric(18, 0),
@serv_sec as numeric(18, 0)
)
AS

DECLARE @error AS  int
DECLARE @trans AS VARCHAR(50)
 
DECLARE @recepcion as varchar(2)
DECLARE @despacho as varchar(2)
DECLARE @etiquetado as varchar(2)

SET @error=0

BEGIN TRANSACTION @trans
	if(SELECT COUNT(*) FROM FacServicios WHERE Serv_Cod=@Serv_Cod)=0
	BEGIN
		BEGIN TRY 

			--Si se agrega a la recepcin
			IF(@rece>0)
			BEGIN
				SET @recepcion=(SELECT MAX(Serv_OrdR) FROM FacServicios)+1
			END
			ELSE
			BEGIN
				SET @recepcion=null
			END
			
			--Si se agrega a despacho
			IF(@desp>0)
			BEGIN
				SET @despacho=(SELECT MAX(Serv_OrdD) FROM FacServicios)+1
			END
			ELSE
			BEGIN
				SET @despacho=null
			END
			
			--Si se agrega a etiquetado
			IF(@etiq>0)
			BEGIN
				SET @etiquetado=(SELECT MAX(Serv_OrdE) FROM FacServicios)+1
			END
			ELSE
			BEGIN
				SET @etiquetado=null
			END
			
			INSERT INTO FacServicios(Serv_Cod, Serv_Nom, Serv_MedPred, Serv_MonPred, Serv_descr, Serv_OrdR, Serv_OrdD, Serv_OrdE, Serv_Esc, Serv_Sec)
			VALUES					(@Serv_Cod, @Serv_Nom, @Serv_MedPred, @Serv_MonPred, @Serv_Desc, @recepcion, @despacho, @etiquetado, @serv_esc, @serv_sec)
		 	
		END TRY
		BEGIN CATCH
			ROLLBACK TRANSACTION @trans;
			SELECT 1;
			RETURN;
		END CATCH
	END
	ELSE
	BEGIN
		UPDATE FacServicios SET Serv_Nom=@Serv_Nom, Serv_MedPred=@Serv_MedPred, Serv_MonPred=@Serv_MonPred, Serv_descr=@Serv_Desc,
		Serv_Esc=@serv_esc, Serv_Sec=@serv_sec WHERE Serv_Cod=@Serv_Cod
	END
		

SELECT @error
	IF(@error=0)
	BEGIN
		COMMIT TRANSACTION @trans
		SELECT 0;
	END

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

CREATE PROCEDURE [dbo].[PAG_INGPREDESPACHO]
(
@fpre_codi AS VARCHAR(7),			-- CODIGO PRE-DESPACHO
@fpre_rutcli as varchar(9),			-- RUT CLIENTE
@fpre_totsopo as int,				-- TOTAL DE SOPORTANTES
@fpre_totunidad as int,				-- TOTAL DE ENVASES
@fpre_totpeso as float,				-- TOTAL DE KILOS
@fpre_codienca as varchar(3),		-- ENCARGADO DE MOVIMIENTO
@fpre_sello as varchar(50),			-- SELLO
@fpre_contenedor as varchar(50),	-- CONTENEDOR
@fpre_rampla as varchar(15),		-- RAMPLA
@fpre_destino as varchar(20),		-- DESTINO
@fpre_observacion as varchar(255),	-- OBSERVACIONES DEL MOVIMIENTO
@fpre_nped as numeric(18,0),		-- NUMERO DE PEDIDO, SI NO TIENE OMISION 0
@fpre_etiq as varchar(1),			-- SI VA A ETIQUETADO   1 A ETIQ    0 NORMAL
@tipo as varchar(2),				-- TIPO DE MOVIMIENTO MOV_PALLET  PD|GESTION   PR|RADIO   PT|TABLET
@TS as float,						-- TEMP 1
@TM as float,						-- TEMP 2
@TI as float,						-- TEMP 3
@olor as varchar(10),               -- OLOR	
@hig as varchar(10),                -- HIGIENE
@cond as varchar(10),				-- CONDENSACION							
@codbod as varchar(10)              -- BODEGA
)
AS

DECLARE @error as  int
DECLARE @trans as VARCHAR(50)
DECLARE @PROMEDIO AS float
DECLARE @HoraInicio as varchar(5)

SET @error=0

SELECT @PROMEDIO=ROUND((@TS+@TM+@TI)/3,1) -- PROMEDIO AUTOMATICO, EVITAR PROBLEMAS DE CONFIG DE DISPOSITIVOS.
SELECT @HoraInicio=fpre_horades FROM TMPFICHPRED WHERE fpre_codi=@fpre_codi

IF(SELECT COUNT(*) FROM fichpred WHERE fpre_codi=@fpre_codi)=0

BEGIN 

BEGIN TRANSACTION @trans
	BEGIN TRY
			INSERT INTO fichpred(fpre_codi, fpre_rutcli, fpre_horades, fpre_horater, fpre_fecdes, fpre_totsopo, fpre_totunidad, fpre_totpeso, fpre_codienca, fpre_activa, fpre_fechact, fpre_codvig, fpre_gdespa, fpre_sello, fpre_tem, FPRE_USUCRE, fpre_contenedor, fpre_rampla, fpre_destino, fpre_Observacion, fpre_nped, fpre_etiq,estc_olor,estc_hig,estc_cond,cod_bod)
			VALUES(@fpre_codi, @fpre_rutcli, @HoraInicio, convert(varchar(5), getdate(), 8), convert(varchar(10), getdate(), 111), @fpre_totsopo, @fpre_totunidad, @fpre_totpeso, @fpre_codienca, 0, convert(varchar(10), getdate(), 111), 0, 0, @fpre_sello, @PROMEDIO, @fpre_codienca, @fpre_contenedor, @fpre_rampla, @fpre_destino, @fpre_observacion, @fpre_nped, @fpre_etiq,@olor,@hig,@cond,@codbod)
	END TRY
	BEGIN CATCH
		ROLLBACK TRANSACTION @trans;
		SELECT 1;
		RETURN;
	END CATCH
	
	BEGIN TRY
			INSERT INTO detapred(dpre_codi, dpre_codpro, dpre_codsopo, dpre_sopocli, dpre_unidades, dpre_peso, dpre_camara, dpre_banda, dpre_colum, dpre_piso, dpre_nivel, dpre_fecdes, dpre_rutcli, dpre_contcli, dpre_fecprod, dpre_folio, dpre_activa, dpre_pallet, dpre_TS, dpre_TM, dpre_TI, dpre_CodPer, dpre_Hora, dpre_fecn)
			SELECT fpre_codi+dpre_codi, dpre_codpro, dpre_codsopo, dpre_sopocli, dpre_unidades, dpre_peso, dpre_camara, dpre_banda, dpre_colum, dpre_piso, dpre_nivel, dpre_fecdes, dpre_rutcli, dpre_contcli, dpre_fecprod, dpre_folio, dpre_activa, dpre_pallet, dpre_TS, dpre_TM, dpre_TI, dpre_CodPer, dpre_Hora, dpre_fecn FROM TMPDETAPRED WHERE fpre_codi=@fpre_codi
	END TRY
	BEGIN CATCH
		ROLLBACK TRANSACTION @trans;
		SELECT 2;
		RETURN;
	END CATCH
	
	BEGIN TRY
			INSERT INTO movpallet(mov_folio, mov_codper, mov_ca, mov_ba, mov_co, mov_pi, mov_ni, mov_fecha, mov_tipo, mov_Doc, mov_hora, mov_TS, mov_TM, mov_TI, mov_docdespa, Mov_Despacho, Mov_Saldo)
			SELECT dpre_folio, @fpre_codienca, dpre_camara, dpre_banda, dpre_colum, dpre_piso, dpre_nivel, convert(varchar(10), getdate(), 111), @tipo, @fpre_codi, convert(varchar(5), getdate(), 8), @TS, @TM, @TI, 0, dpre_ActUni, dpre_TotUni FROM TMPDETAPRED WHERE fpre_codi=@fpre_codi
	END TRY
	BEGIN CATCH
		ROLLBACK TRANSACTION @trans;
		SELECT 3;
		RETURN;
	END CATCH
		
	BEGIN TRY
			UPDATE pedcaja SET pc_estado='2' WHERE pc_codped=@fpre_nped
			DELETE FROM TMPDETAPRED WHERE fpre_codi=@fpre_codi
			DELETE FROM TMPFICHPRED WHERE fpre_codi=@fpre_codi
			UPDATE DetaReceCajas SET caj_ped='2' WHERE LEFT(caj_pcod,7)=@fpre_codi
		    UPDATE Pedidos_ficha SET Ped_EstPred=3 WHERE Orden=@fpre_nped
	END TRY
	BEGIN CATCH
			ROLLBACK TRANSACTION @trans;
			SELECT 5;
			RETURN;
	END CATCH


SELECT @error
	IF(@error=0)
	BEGIN
		COMMIT TRANSACTION @trans
		SELECT 0;
	END
END

ELSE
BEGIN
	SELECT 4
	RETURN;
END
-- RETORNA:
--1 ERROR DE FICHA
--2 ERROR DE DETALLE 
--3 ERROR DE MOVPALLET
--4 YA INGRESADO
--------------------------------
--0 EJECUTA CORRECTAMENTE
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[PAG_INVENTARIO]
(
@pallet as varchar(9),
@usuario as varchar(3),
@tipolect as varchar(30),
@valpro as numeric(18,0),
@valcli as numeric(18,0),
@valcan as numeric(18,0),
@camara as varchar(2),
@codpro as varchar(50)
)
AS
DECLARE @estado varchar(15)
DECLARE @trans varchar(MAX)
DECLARE @error int

SET @error=0

      IF (LEFT(@camara,1)='7' OR LEFT(@camara,1)='6')
            BEGIN
                  SELECT @estado='SIN POSICION'
            END
      ELSE
            BEGIN
                  SELECT @ESTADO='POSICIONADO'
            END
                        
BEGIN TRANSACTION @trans
      BEGIN TRY 
       
            IF (SELECT COUNT(*) FROM AINVENTARIO WHERE PALLET=@pallet)= 0
            BEGIN

                  INSERT INTO AINVENTARIO(PALLET, ESTADO, USUARIO, FECHA, TIPOLECT, VALPRODUCTO, VALCLIENTE, VALCANTIDAD, CODPRODUCTO)
                  VALUES(@pallet, @estado, @usuario, GETDATE(), @tipolect, @valcli, @valpro, @valcan, @codpro)
            END
                  ELSE
            BEGIN
                        UPDATE AINVENTARIO SET  ESTADO=@estado, USUARIO=@usuario, FECHA=GETDATE(), TIPOLECT=@tipolect, VALPRODUCTO=@valcli, VALCLIENTE=@valpro, VALCANTIDAD=@valcan, CODPRODUCTO=@codpro
                        WHERE PALLET=@pallet
            END
                  
            IF(@valcan=1)
            BEGIN
                  UPDATE detarece SET drec_rev='1' WHERE drec_codi=@pallet
            END
            
      END TRY
      BEGIN CATCH
            ROLLBACK TRANSACTION @trans;
            SELECT 1;
            RETURN;
      END CATCH

      IF(@error=0)
      BEGIN
            COMMIT TRANSACTION @trans
            SELECT 0;
      END
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[PAG_LARGOETIQ]
(
@recepcion as varchar(7),
@estado as numeric(18,0),
@largo1 as numeric(18,0),
@largo2 as numeric(18,0),
@largo3 as numeric(18,0),
@largo4 as numeric(18,0),
@largo5 as numeric(18,0)
)
AS
IF (SELECT COUNT(*) FROM detareceestado WHERE rtraq_codi=@recepcion)=0
BEGIN

	INSERT INTO detareceestado(rtraq_codi, rtraq_est, rtraq_largo, rtraq_l2, rtraq_l3, rtraq_l4, rtraq_l5)
    VALUES(@recepcion, @estado, @largo1, @largo2, @largo3, @largo4, @largo5)
END
ELSE
BEGIN
	UPDATE detareceestado SET rtraq_largo=@largo1, rtraq_l2=@largo2, rtraq_l3=@largo3, rtraq_l4=@largo4, rtraq_l5=@largo5 WHERE rtraq_codi=@recepcion
END

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
 CREATE PROCEDURE [dbo].[PAG_PALLETCHEQUEADO]
(
@estado AS int,					-- ESTADO 0= SIN REVISAR    1=REVISADO OK	2= MAL INGRESADO RECEPCION
@pallet as varchar(9),			-- NUMERO DE PALLETS
@usuario as varchar(3),			-- USUARIO
@tipo as int,					-- 1 REDE A FRIGO  2 FRIGO A REDE
@pedido as int					-- Codigo Pedido , cuando es 0 corresponde a @tipo=1
)
AS

DECLARE @error as  int
DECLARE @trans as VARCHAR(50)
DECLARE @leidos as int
DECLARE @total as int
DECLARE @terminado as int
SET @error=0

if @tipo=1
BEGIN 
IF(SELECT drec_rev FROM detarece WHERE drec_codi=@pallet)<>@estado
BEGIN
BEGIN TRANSACTION @trans
	BEGIN TRY
			UPDATE detarece SET drec_rev=@estado WHERE drec_codi=@pallet 
	END TRY
	BEGIN CATCH
		ROLLBACK TRANSACTION @trans;
		SELECT 1;
		RETURN;
	END CATCH
	
	BEGIN TRY
			INSERT INTO LOG_RevisionPallets(rev_codpallet, rev_fecha, rev_codenca, rev_est, rev_tipo)VALUES(@pallet,GETDATE(),@usuario, @estado, @tipo)
	END TRY
	BEGIN CATCH
		ROLLBACK TRANSACTION @trans;
		SELECT 2;
		RETURN;
	END CATCH
	
	 
SELECT @error
	IF(@error=0)
	BEGIN
		COMMIT TRANSACTION @trans
		SELECT 0;
	END
END

ELSE
	BEGIN 
		SELECT 3;
		RETURN;
	END
END
ELSE
BEGIN 

IF(SELECT revisado FROM Pedidos_detalle WHERE pallet=@pallet)<>@estado
BEGIN
	BEGIN TRANSACTION @trans
	BEGIN TRY
			UPDATE Pedidos_detalle SET revisado=@estado WHERE pallet=@pallet AND pedido=(SELECT pedido FROM Pedidos_ficha WHERE Orden=@pedido)
	END TRY
	BEGIN CATCH
		ROLLBACK TRANSACTION @trans;
		SELECT 1;
		RETURN;
	END CATCH
	
	BEGIN TRY 
			INSERT INTO LOG_RevisionPallets(rev_codpallet, rev_fecha, rev_codenca, rev_est, rev_tipo)VALUES(@pallet, GETDATE(), @usuario, @estado, @tipo)
			
			SELECT @leidos=SUM(revisado) FROM pedidos_ficha pf INNER JOIN Pedidos_detalle pd ON pf.pedido=pd.pedido WHERE pd.revisado='1' AND terminado<>'3' AND Orden=@pedido GROUP BY pf.pedido 
			SELECT @total=COUNT(*) FROM pedidos_ficha pf INNER JOIN Pedidos_detalle pd ON pf.pedido=pd.pedido WHERE terminado<>'3' AND Orden=@pedido GROUP BY pf.pedido 
			 
			if (@leidos=@total)
			BEGIN
				UPDATE Pedidos_ficha SET ped_revision='1' WHERE Orden=@pedido
			END
			
	END TRY
	BEGIN CATCH
		ROLLBACK TRANSACTION @trans;
		SELECT 2;
		RETURN;
	END CATCH
	
	IF(@error=0)
	BEGIN
		COMMIT TRANSACTION @trans
		if (SELECT ped_revision FROM Pedidos_ficha WHERE Orden=@pedido)=1
			BEGIN
				SELECT 5;
			END
		ELSE
			BEGIN
				SELECT 0;
			END
	END
ELSE
	BEGIN 
		SELECT 3;
		RETURN;
	END
END
ELSE
BEGIN
	SELECT 4;
	RETURN;
END
END

-- RETORNA:
--1 ERROR DE REGISTRO
--2 ERROR DE LOG 
--------------------------------
--0 EJECUTA CORRECTAMENTE
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
 CREATE PROCEDURE [dbo].[PAG_PALLETREVISADO]
(
@estado AS int,					-- ESTADO 0= SIN REVISAR    1=REVISADO OK	2= MAL INGRESADO RECEPCION
@pallet as varchar(9),			-- NUMERO DE PALLETS
@usuario as varchar(3)			-- USUARIO
)
AS

DECLARE @error as  int
DECLARE @trans as VARCHAR(50)

SET @error=0

BEGIN 
IF(SELECT drec_rev FROM detarece WHERE drec_codi=@pallet)<>@estado
BEGIN
BEGIN TRANSACTION @trans
	BEGIN TRY
			UPDATE detarece SET drec_rev=@estado WHERE drec_codi=@pallet
	END TRY
	BEGIN CATCH
		ROLLBACK TRANSACTION @trans;
		SELECT 1;
		RETURN;
	END CATCH
	
	BEGIN TRY
			INSERT INTO LOG_RevisionPallets(rev_codpallet, rev_fecha, rev_codenca, rev_est)VALUES(@pallet,GETDATE(),@usuario, @estado)
	END TRY
	BEGIN CATCH
		ROLLBACK TRANSACTION @trans;
		SELECT 2;
		RETURN;
	END CATCH
	
	 
SELECT @error
	IF(@error=0)
	BEGIN
		COMMIT TRANSACTION @trans
		SELECT 0;
	END
END

ELSE
	BEGIN 
		SELECT 3;
		RETURN;
	END
END
-- RETORNA:
--1 ERROR DE REGISTRO
--2 ERROR DE LOG 
--------------------------------
--0 EJECUTA CORRECTAMENTE
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[PAG_POSICIONAR]
(
@pallet AS varchar(9),			 
@camara as varchar(2),			 
@banda as varchar(2),			 
@columna as varchar(2),
@piso as varchar(2),
@nivel as varchar(2),
@tipo as varchar(2),
@encargado as varchar(3)
)
AS

DECLARE @error AS  int
DECLARE @trans AS VARCHAR(50)

DECLARE @fecha AS VARCHAR(10)
DECLARE @hora AS VARCHAR(5)

SELECT @fecha=CONVERT(VARCHAR(10),GETDATE(),111)
SELECT @hora=Convert(varchar(5), GetDate(), 108)

SET @error=0

BEGIN 
IF(SELECT COUNT(*) FROM rackdeta WHERE racd_codi=@pallet)=1
BEGIN
BEGIN TRANSACTION @trans
	BEGIN TRY
			INSERT INTO movpallet (mov_folio, mov_codper, mov_ca, mov_ba, mov_co, mov_pi, mov_ni, mov_fecha, mov_tipo, mov_hora)
			VALUES(@pallet, @encargado, @camara, @banda, @columna, @piso, @nivel, @fecha, @tipo, @hora)
	END TRY
	BEGIN CATCH
		ROLLBACK TRANSACTION @trans;
		SELECT 1;
		RETURN;
	END CATCH
	
	BEGIN TRY
			UPDATE rackdeta SET racd_ca=@camara, racd_ba=@banda, racd_co=@columna, racd_pi=@piso, racd_ni=@nivel WHERE racd_codi=@pallet
	END TRY
	BEGIN CATCH
		ROLLBACK TRANSACTION @trans;
		SELECT 2;
		RETURN;
	END CATCH
	
	 
	BEGIN TRY
			UPDATE detarece SET drec_camara=@camara, drec_banda=@banda, drec_colum=@columna, drec_piso=@piso, drec_nivel=@nivel WHERE drec_codi=@pallet
	END TRY
	BEGIN CATCH
		ROLLBACK TRANSACTION @trans;
		SELECT 3;
		RETURN;
	END CATCH
	
	
SELECT @error
	IF(@error=0)
	BEGIN
		COMMIT TRANSACTION @trans
		SELECT 0;
	END
END
ELSE
	BEGIN 
		SELECT 4;
		RETURN;
	END
END

-- RETORNA:
--1 ERROR DE MOVPALLET
--2 ERROR DE RACKDETA 
--3 ERROR DE DETARECE 
--4 PALLET NO EXISTE
--------------------------------
--0 EJECUTA CORRECTAMENTE
GO
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[sp_servicio_24]
	 @Contrato as varchar(10),
	 @Rut_Clien  varchar(10), 
	 @Fec_Desde datetime,
	 @Fec_Hasta  datetime,
	@Servicio as float,
	@ID_Fact as float
as
declare
	@fecha datetime,
	@Fecha2 varchar(10),
	@unidades float,
	@peso float,
	@pallet float,
	@totunidades float,
	@totpeso float,
	@totpallet float,
	@Saltotunidades float,
	@Saltotpeso float,
	@Saltotpallet float,
	@totunidadesGer float,
	@totpesoGer float,
	@totpalletGer float,
	@Fec_String varchar(10),
	@Fec_String2 varchar(10),
	@num float,
	@Servicio_Serv varchar(3),  
	@Fecha_Serv varchar(6),
	@Fecha_Grupo float,
	@Fecha_servicio_24 datetime
		


begin
	
	select @unidades = 0
	select @peso = 0
	select @totpallet = 0

	select @saltotunidades = 0
	select @saltotpeso = 0
	select @saltotpallet = 0

	select @totunidades = 0
	select @totpeso = 0
	select @totpallet = 0

	select @totunidadesGer =0
	select @totpesoGer = 0
	select @totpalletGer = 0
	select @num = 1


	select @fec_string2 =  CONVERT(VARCHAR, @fec_desde, 120)
	select @Fecha_servicio_24 =  CONVERT(datetime, @fec_desde, 120)
	select @fec_string2 =  SUBSTRING(@fec_string2, 1, 4)   +  '/'  +  SUBSTRING(@fec_string2, 6, 2)  + '/' + SUBSTRING(@fec_string2, 9, 2) 
	
	select @unidades  =  isnull(sum(unidades),0) ,
		@peso = isnull(sum( peso) ,0),
		@pallet = isnull(sum(pallet), 0) 

	From Qry_detareceServicioWeb24  where
	rut = @Rut_Clien and
	Contrato =  @Contrato and
	FechaDiasGracia   <  @Fecha_servicio_24 and
	TipoRecepcion <> 1 and
--	fecha  < @fec_string2  and
	Vigente = 0


	select @Saltotunidades = @Saltotunidades + @unidades 
	select @Saltotpeso = @Saltotpeso + @peso 
	select @Saltotpallet = @Saltotpallet + @pallet 
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------
	select @unidades  =  isnull(sum(drec_unidades),0) ,
		@peso = isnull(sum( drec_peso) ,0),
		@pallet = isnull(sum(drec_pallet), 0) 

	From detarece where
	drec_rutcli = @Rut_Clien and
	drec_contcli =  @Contrato and
	drec_fecrec  <  @fec_string2  and
	drec_RecepTunel = 1 and
	drec_codvig = 0


	select @Saltotunidades = @Saltotunidades + @unidades 
	select @Saltotpeso = @Saltotpeso + @peso 
	select @Saltotpallet = @Saltotpallet + @pallet 


--------------------------------------------------------------------------------------------------------------------------------------------------------------------

	select  	@unidades  = isnull(sum(ddes_unidades),0),
		@peso = isnull(sum(ddes_peso),0),
		@pallet = isnull(sum(ddes_pallet),0)
	from detadespa where
		ddes_rutcli = @Rut_Clien and
		ddes_contcli =  @Contrato and

		ddes_fecha  <  @fec_string2  and
		ddes_codvig = 0

	select @Saltotunidades = @Saltotunidades - @unidades 
	select @Saltotpeso = @Saltotpeso - @peso 
	select @Saltotpallet = @Saltotpallet - @pallet 

----------------------------------------------------------------------------------







	select @num = 1
	select @fecha  =  @fec_Desde
	
	
	
	select @num = 1
	select @fecha  =  @fec_Desde
	
	
		



		 while @fec_Hasta >= @fecha
		 begin

			select @unidades = 0
			select @peso = 0
			select @pallet = 0
			select @totunidades = 0
			select @totpeso = 0
			select @totpallet = 0

			select @Fecha_servicio_24 =  CONVERT(datetime, @fecha, 120)
			select @fec_string =  CONVERT(VARCHAR, @fecha, 120)
			select @fec_string =  SUBSTRING(@fec_string, 1, 4)   +  '/'  +  SUBSTRING(@fec_string, 6, 2)  + '/' + SUBSTRING(@fec_string, 9, 2) 
			
			select @fecha_serv =  SUBSTRING(@fec_string, 1, 4)  +   SUBSTRING(@fec_string, 6, 2)  
			select @fecha_Grupo = cast(@fecha_Serv as float)
			
			select @unidades  =  isnull(sum(unidades),0) ,
				@peso = isnull(sum( peso) ,0),
				@pallet = isnull(sum(pallet), 0) 
			 from Qry_detareceServicioWeb24 where
				rut = @Rut_Clien and
				contrato  =  @Contrato and
				
				FechaDiasGracia   =  @Fecha_servicio_24 and
				TipoRecepcion <> 1 and
--				fecha   =  @Fecha_servicio_24 and
				vigente = 0

		
			select @totunidades = @totunidades + @unidades
			select @totpeso = @totpeso + @peso
			select @totpallet = @totpallet + @pallet
			If  @totunidades >  0
			begin
				select @Saltotunidades = @Saltotunidades + @totunidades
				select @Saltotpeso = @Saltotpeso + @totpeso
				select @Saltotpallet = @Saltotpallet + @totpallet
			end

			select @unidades = 0
			select @peso = 0
			select @pallet = 0
			select @totunidades = 0
			select @totpeso = 0
			select @totpallet = 0


			select @unidades  =  isnull(sum(drec_unidades),0) ,
				@peso = isnull(sum( drec_peso) ,0),
				@pallet = isnull(sum(drec_pallet), 0) 
			 from detarece where
				drec_rutcli = @Rut_Clien and
				drec_contcli =  @Contrato and
				drec_fecrec = @fec_string  and
				drec_RecepTunel = 1 and
				drec_codvig = 0

		
			select @totunidades = @totunidades + @unidades
			select @totpeso = @totpeso + @peso
			select @totpallet = @totpallet + @pallet
			If  @totunidades >  0
			begin
				select @Saltotunidades = @Saltotunidades + @totunidades
				select @Saltotpeso = @Saltotpeso + @totpeso
				select @Saltotpallet = @Saltotpallet + @totpallet
			end


			select @unidades = 0
			select @peso = 0
			select @pallet = 0
			select @totunidades = 0
			select @totpeso = 0
			select @totpallet = 0

			select  	@unidades  = isnull(sum(unidades),0),
				@peso = isnull(sum(peso),0),
				@pallet = isnull(sum(pallet),0)
			from Qry_DetaDespaServicio24 where
				rut = @Rut_Clien and
				contrato =  @Contrato and
				
				fecha = @fec_string  and
				vigente = 0
			 select @totunidades = @totunidades + @unidades
			select @totpeso = @totpeso + @peso
			select @totpallet = @totpallet + @pallet

			If  @totunidades  > 0
			begin
				select @Saltotunidades =  @Saltotunidades - @totunidades
				select @Saltotpeso = @Saltotpeso - @totpeso
				select @Saltotpallet = @Saltotpallet - @totpallet
			
			--select @totunidadesGer = @totunidadesGer + @totunidades
			end

			if @Saltotunidades > 0
			begin
				select @totunidadesGer = @totunidadesGer + @Saltotunidades
				select @totpesoGer = @totpesoGer + @Saltotpeso
				select @totpalletGer = @totpalletGer + @Saltotpallet
			
				
				insert into ServWeb (
					Sweb_codi,
					Sweb_Serv,
					Sweb_Cliente,
					Sweb_Fecha,
					Sweb_Cam1,
	
					Sweb_Cam2,
					Sweb_Cam3,
					Sweb_GrupFec,
					Sweb_Cam4
			--	Sweb_Cam5,
			--	Sweb_Cam6,
			---	Sweb_Cam7,
			--	Sweb_Cam8
	
					) 
				values (	
					@ID_Fact,
					@Servicio,
					@Rut_Clien,
					@Fecha,			
					 @saltotunidades,
			 		 @saltotpeso,
				 	@saltotpallet,
					@Fecha_Grupo,
					@Fecha_servicio_24
--					CONVERT(VARCHAR,  @fec_Hasta, 120)
					
				--@fec_desde,
				--@Fec_String2,
				--@totpalletGer,
				--@totunidadesGer
				)
			end 
			
			select   @fecha = DateAdd(day, 1, @fecha)  
			--select @Saltotunidades =  0
			--select @Saltotpeso = 0
			--select @Saltotpallet = 0
			
		 end  
	

end
GO
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[sp_servicio_25] 
	 @Contrato as varchar(10),
	 @Rut_Clien  varchar(10),
 
	 @Fec_Desde datetime,
	 @Fec_Hasta  datetime,
	@Servicio as float,
	@ID_Fact as float
as
declare
	@fecha datetime,
	@Fecha2 varchar(10),
	@unidades float,
	@peso float,
	@pallet float,
	@totunidades float,
	@totpeso float,
	@totpallet float,
	@Saltotunidades float,
	@Saltotpeso float,
	@Saltotpallet float,
	@totunidadesGer float,
	@totpesoGer float,
	@totpalletGer float,
	@Fec_String varchar(10),
	@Fec_String2 varchar(10),
	@num float,
	@Servicio_Serv varchar(3),  
	@Fecha_Serv varchar(6),
	@Fecha_Grupo float
		


begin
	
	select @unidades = 0
	select @peso = 0
	select @totpallet = 0

	select @saltotunidades = 0
	select @saltotpeso = 0
	select @saltotpallet = 0

	select @totunidades = 0
	select @totpeso = 0
	select @totpallet = 0

	select @totunidadesGer =0
	select @totpesoGer = 0
	select @totpalletGer = 0
	select @num = 1


	select @fec_string2 =  CONVERT(VARCHAR, @fec_desde, 120)
	select @fec_string2 =  SUBSTRING(@fec_string2, 1, 4)   +  '/'  +  SUBSTRING(@fec_string2, 6, 2)  + '/' + SUBSTRING(@fec_string2, 9, 2) 
	
	select @unidades  =  isnull(sum(drec_unidades),0) ,
		@peso = isnull(sum( drec_peso) ,0),
		@pallet = isnull(sum(drec_pallet), 0) 

	From detarece where
	drec_rutcli = @Rut_Clien and
	drec_contcli =  @Contrato and
	drec_fecrec  <  @fec_string2  and
	drec_codvig = 0


	select @Saltotunidades = @Saltotunidades + @unidades 
	select @Saltotpeso = @Saltotpeso + @peso 
	select @Saltotpallet = @Saltotpallet + @pallet 


	select  	@unidades  = isnull(sum(ddes_unidades),0),
		@peso = isnull(sum(ddes_peso),0),
		@pallet = isnull(sum(ddes_pallet),0)
	from detadespa where
		ddes_rutcli = @Rut_Clien and
		ddes_contcli =  @Contrato and

		ddes_fecha  <  @fec_string2  and
		ddes_codvig = 0

	select @Saltotunidades = @Saltotunidades - @unidades 
	select @Saltotpeso = @Saltotpeso - @peso 
	select @Saltotpallet = @Saltotpallet - @pallet 


	select @num = 1
	select @fecha  =  @fec_Desde
	
	
	
	select @num = 1
	select @fecha  =  @fec_Desde
	
	
		



		 while @fec_Hasta >= @fecha
		 begin

			select @unidades = 0
			select @peso = 0
			select @pallet = 0
			select @totunidades = 0
			select @totpeso = 0
			select @totpallet = 0

			select @fec_string =  CONVERT(VARCHAR, @fecha, 120)
			select @fec_string =  SUBSTRING(@fec_string, 1, 4)   +  '/'  +  SUBSTRING(@fec_string, 6, 2)  + '/' + SUBSTRING(@fec_string, 9, 2) 
			
			select @fecha_serv =  SUBSTRING(@fec_string, 1, 4)  +   SUBSTRING(@fec_string, 6, 2)  
			select @fecha_Grupo = cast(@fecha_Serv as float)
			select @unidades  =  isnull(sum(drec_unidades),0) ,
				@peso = isnull(sum( drec_peso) ,0),
				@pallet = isnull(sum(drec_pallet), 0) 
			 from detarece where
				drec_rutcli = @Rut_Clien and
				drec_contcli =  @Contrato and
				drec_fecrec = @fec_string  and
				drec_codvig = 0

		
			select @totunidades = @totunidades + @unidades
			select @totpeso = @totpeso + @peso
			select @totpallet = @totpallet + @pallet
			If  @totunidades >  0
			begin
				select @Saltotunidades = @Saltotunidades + @totunidades
				select @Saltotpeso = @Saltotpeso + @totpeso
				select @Saltotpallet = @Saltotpallet + @totpallet
			end

			select @unidades = 0
			select @peso = 0
			select @pallet = 0
			select @totunidades = 0
			select @totpeso = 0
			select @totpallet = 0

			select  	@unidades  = isnull(sum(ddes_unidades),0),
				@peso = isnull(sum(ddes_peso),0),
				@pallet = isnull(sum(ddes_pallet),0)
			from detadespa where
				ddes_rutcli = @Rut_Clien and
				ddes_contcli =  @Contrato and

				ddes_fecha = @fec_string  and
				ddes_codvig = 0
			 select @totunidades = @totunidades + @unidades
			select @totpeso = @totpeso + @peso
			select @totpallet = @totpallet + @pallet

			If  @totunidades  > 0
			begin
				select @Saltotunidades =  @Saltotunidades - @totunidades
				select @Saltotpeso = @Saltotpeso - @totpeso
				select @Saltotpallet = @Saltotpallet - @totpallet
			
			--select @totunidadesGer = @totunidadesGer + @totunidades
			end

			if @Saltotunidades > 0
			begin
				select @totunidadesGer = @totunidadesGer + @Saltotunidades
				select @totpesoGer = @totpesoGer + @Saltotpeso
				select @totpalletGer = @totpalletGer + @Saltotpallet
			
				
				insert into ServWeb (
					Sweb_codi,
					Sweb_Serv,
					Sweb_Cliente,
					Sweb_Fecha,
					Sweb_Cam1,
	
					Sweb_Cam2,
					Sweb_Cam3,
					Sweb_GrupFec,
					Sweb_Cam4
			--	Sweb_Cam5,
			--	Sweb_Cam6,
			---	Sweb_Cam7,
			--	Sweb_Cam8
	
					) 
				values (	
					@ID_Fact,
					@Servicio,
					@Rut_Clien,
					@Fecha,			
					 @saltotunidades,
			 		 @saltotpeso,
				 	@saltotpallet,
					@Fecha_Grupo,
					@fec_Hasta
--					CONVERT(VARCHAR,  @fec_Hasta, 120)
					
				--@fec_desde,
				--@Fec_String2,
				--@totpalletGer,
				--@totunidadesGer
				)
			end 
			
			select   @fecha = DateAdd(day, 1, @fecha)  
			--select @Saltotunidades =  0
			--select @Saltotpeso = 0
			--select @Saltotpallet = 0
			
		 end  
	

end
GO
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[sp_servicio_46] 
	 @Contrato as varchar(10),
	 @Rut_Clien  varchar(10),
 
	 @Fec_Desde datetime,
	 @Fec_Hasta  datetime,
	@Servicio as float,
	@ID_Fact as float
as
declare
	@fecha datetime,
	@Fecha2 varchar(10),
	@unidades float,
	@peso float,
	@pallet float,
	@totunidades float,
	@totpeso float,
	@totpallet float,
	@Saltotunidades float,
	@Saltotpeso float,
	@Saltotpallet float,
	@totunidadesGer float,
	@totpesoGer float,
	@totpalletGer float,
	@Fec_String varchar(10),
	@Fec_String2 varchar(10),
	@num float,
	@Servicio_Serv varchar(3),  
	@Fecha_Serv varchar(6),
	@Fecha_Grupo float
		


begin
	
	select @unidades = 0
	select @peso = 0
	select @totpallet = 0

	select @saltotunidades = 0
	select @saltotpeso = 0
	select @saltotpallet = 0

	select @totunidades = 0
	select @totpeso = 0
	select @totpallet = 0

	select @totunidadesGer =0
	select @totpesoGer = 0
	select @totpalletGer = 0
	select @num = 1


	select @fec_string2 =  CONVERT(VARCHAR, @fec_desde, 120)
	select @fec_string2 =  SUBSTRING(@fec_string2, 1, 4)   +  '/'  +  SUBSTRING(@fec_string2, 6, 2)  + '/' + SUBSTRING(@fec_string2, 9, 2) 
	
	select @unidades  =  isnull(sum(drec_unidades),0) ,
		@peso = isnull(sum( drec_peso) ,0),
		@pallet = isnull(sum(drec_pallet), 0) 

	From detarece where
	drec_rutcli = @Rut_Clien and
	drec_contcli =  @Contrato and
	drec_fecrec  <  @fec_string2  and
	drec_codvig = 0


	select @Saltotunidades = @Saltotunidades + @unidades 
	select @Saltotpeso = @Saltotpeso + @peso 
	select @Saltotpallet = @Saltotpallet + @pallet 


	select  	@unidades  = isnull(sum(ddes_unidades),0),
		@peso = isnull(sum(ddes_peso),0),
		@pallet = isnull(sum(ddes_pallet),0)
	from detadespa where
		ddes_rutcli = @Rut_Clien and
		ddes_contcli =  @Contrato and

		ddes_fecha  <  @fec_string2  and
		ddes_codvig = 0

	select @Saltotunidades = @Saltotunidades - @unidades 
	select @Saltotpeso = @Saltotpeso - @peso 
	select @Saltotpallet = @Saltotpallet - @pallet 


	select @num = 1
	select @fecha  =  @fec_Desde
	
	
	
	select @num = 1
	select @fecha  =  @fec_Desde
	
	
		



		 while @fec_Hasta >= @fecha
		 begin

			select @unidades = 0
			select @peso = 0
			select @pallet = 0
			select @totunidades = 0
			select @totpeso = 0
			select @totpallet = 0

			select @fec_string =  CONVERT(VARCHAR, @fecha, 120)
			select @fec_string =  SUBSTRING(@fec_string, 1, 4)   +  '/'  +  SUBSTRING(@fec_string, 6, 2)  + '/' + SUBSTRING(@fec_string, 9, 2) 
			
			select @fecha_serv =  SUBSTRING(@fec_string, 1, 4)  +   SUBSTRING(@fec_string, 6, 2)  
			select @fecha_Grupo = cast(@fecha_Serv as float)
			select @unidades  =  isnull(sum(drec_unidades),0) ,
				@peso = isnull(sum( drec_peso) ,0),
				@pallet = isnull(sum(drec_pallet), 0) 
			 from detarece where
				drec_rutcli = @Rut_Clien and
				drec_contcli =  @Contrato and
				drec_fecrec = @fec_string  and
				drec_codvig = 0

		
			select @totunidades = @totunidades + @unidades
			select @totpeso = @totpeso + @peso
			select @totpallet = @totpallet + @pallet
			If  @totunidades >  0
			begin
				select @Saltotunidades = @Saltotunidades + @totunidades
				select @Saltotpeso = @Saltotpeso + @totpeso
				select @Saltotpallet = @Saltotpallet + @totpallet
			end

			select @unidades = 0
			select @peso = 0
			select @pallet = 0
			select @totunidades = 0
			select @totpeso = 0
			select @totpallet = 0

			select  	@unidades  = isnull(sum(ddes_unidades),0),
				@peso = isnull(sum(ddes_peso),0),
				@pallet = isnull(sum(ddes_pallet),0)
			from detadespa where
				ddes_rutcli = @Rut_Clien and
				ddes_contcli =  @Contrato and

				ddes_fecha = @fec_string  and
				ddes_codvig = 0
			 select @totunidades = @totunidades + @unidades
			select @totpeso = @totpeso + @peso
			select @totpallet = @totpallet + @pallet

			If  @totunidades  > 0
			begin
				select @Saltotunidades =  @Saltotunidades - @totunidades
				select @Saltotpeso = @Saltotpeso - @totpeso
				select @Saltotpallet = @Saltotpallet - @totpallet
			
			--select @totunidadesGer = @totunidadesGer + @totunidades
			end

			if @Saltotunidades > 0
			begin
				select @totunidadesGer = @totunidadesGer + @Saltotunidades
				select @totpesoGer = @totpesoGer + @Saltotpeso
				select @totpalletGer = @totpalletGer + @Saltotpallet
			
				
				insert into ServWeb (
					Sweb_codi,
					Sweb_Serv,
					Sweb_Cliente,
					Sweb_Fecha,
					Sweb_Cam1,
	
					Sweb_Cam2,
					Sweb_Cam3,
					Sweb_GrupFec,
					Sweb_Cam4
			--	Sweb_Cam5,
			--	Sweb_Cam6,
			---	Sweb_Cam7,
			--	Sweb_Cam8
	
					) 
				values (	
					@ID_Fact,
					@Servicio,
					@Rut_Clien,
					@Fecha,			
					 @saltotunidades,
			 		 @saltotpeso,
				 	@saltotpallet,
					@Fecha_Grupo,
					@fec_Hasta
--					CONVERT(VARCHAR,  @fec_Hasta, 120)
					
				--@fec_desde,
				--@Fec_String2,
				--@totpalletGer,
				--@totunidadesGer
				)
			end 
			
			select   @fecha = DateAdd(day, 1, @fecha)  
			--select @Saltotunidades =  0
			--select @Saltotpeso = 0
			--select @Saltotpallet = 0
			
		 end  
	

end
GO
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[sp_servicio_73]
	 @Contrato as varchar(10),
	 @Rut_Clien  varchar(10),
 
	 @Fec_Desde datetime,
	 @Fec_Hasta  datetime,
	@Servicio as float,
	@ID_Fact as float
as
declare
	@fecha datetime,
	@Fecha2 varchar(10),
	@unidades float,
	@peso float,
	@pallet float,
	@totunidades float,
	@totpeso float,
	@totpallet float,
	@Saltotunidades float,
	@Saltotpeso float,
	@Saltotpallet float,
	@totunidadesGer float,
	@totpesoGer float,
	@totpalletGer float,
	@Fec_String varchar(10),
	@Fec_String2 varchar(10),
	@num float,
	@Servicio_Serv varchar(3),  
	@Fecha_Serv varchar(6),
	@Fecha_Grupo float
		


begin
	
	select @unidades = 0
	select @peso = 0
	select @totpallet = 0

	select @saltotunidades = 0
	select @saltotpeso = 0
	select @saltotpallet = 0

	select @totunidades = 0
	select @totpeso = 0
	select @totpallet = 0

	select @totunidadesGer =0
	select @totpesoGer = 0
	select @totpalletGer = 0
	select @num = 1


	select @fec_string2 =  CONVERT(VARCHAR, @fec_desde, 120)
	select @fec_string2 =  SUBSTRING(@fec_string2, 1, 4)   +  '/'  +  SUBSTRING(@fec_string2, 6, 2)  + '/' + SUBSTRING(@fec_string2, 9, 2) 
	
	select @unidades  =  isnull(sum(drec_unidades),0) ,
		@peso = isnull(sum( drec_peso) ,0),
		@pallet = isnull(sum(drec_pallet), 0) 

	From detarece where
	drec_rutcli = @Rut_Clien and
	drec_contcli =  @Contrato and
	drec_fecrec  <  @fec_string2  and
	drec_codvig = 0


	select @Saltotunidades = @Saltotunidades + @unidades 
	select @Saltotpeso = @Saltotpeso + @peso 
	select @Saltotpallet = @Saltotpallet + @pallet 


	select  	@unidades  = isnull(sum(ddes_unidades),0),
		@peso = isnull(sum(ddes_peso),0),
		@pallet = isnull(sum(ddes_pallet),0)
	from detadespa where
		ddes_rutcli = @Rut_Clien and
		ddes_contcli =  @Contrato and

		ddes_fecha  <  @fec_string2  and
		ddes_codvig = 0

	select @Saltotunidades = @Saltotunidades - @unidades 
	select @Saltotpeso = @Saltotpeso - @peso 
	select @Saltotpallet = @Saltotpallet - @pallet 


	select @num = 1
	select @fecha  =  @fec_Desde
	
	
	
	select @num = 1
	select @fecha  =  @fec_Desde
	
	
		



		 while @fec_Hasta >= @fecha
		 begin

			select @unidades = 0
			select @peso = 0
			select @pallet = 0
			select @totunidades = 0
			select @totpeso = 0
			select @totpallet = 0

			select @fec_string =  CONVERT(VARCHAR, @fecha, 120)
			select @fec_string =  SUBSTRING(@fec_string, 1, 4)   +  '/'  +  SUBSTRING(@fec_string, 6, 2)  + '/' + SUBSTRING(@fec_string, 9, 2) 
			
			select @fecha_serv =  SUBSTRING(@fec_string, 1, 4)  +   SUBSTRING(@fec_string, 6, 2)  
			select @fecha_Grupo = cast(@fecha_Serv as float)
			select @unidades  =  isnull(sum(drec_unidades),0) ,
				@peso = isnull(sum( drec_peso) ,0),
				@pallet = isnull(sum(drec_pallet), 0) 
			 from detarece where
				drec_rutcli = @Rut_Clien and
				drec_contcli =  @Contrato and
				drec_fecrec = @fec_string  and
				drec_codvig = 0

		
			select @totunidades = @totunidades + @unidades
			select @totpeso = @totpeso + @peso
			select @totpallet = @totpallet + @pallet
			If  @totunidades >  0
			begin
				select @Saltotunidades = @Saltotunidades + @totunidades
				select @Saltotpeso = @Saltotpeso + @totpeso
				select @Saltotpallet = @Saltotpallet + @totpallet
			end

			select @unidades = 0
			select @peso = 0
			select @pallet = 0
			select @totunidades = 0
			select @totpeso = 0
			select @totpallet = 0

			select  	@unidades  = isnull(sum(ddes_unidades),0),
				@peso = isnull(sum(ddes_peso),0),
				@pallet = isnull(sum(ddes_pallet),0)
			from detadespa where
				ddes_rutcli = @Rut_Clien and
				ddes_contcli =  @Contrato and

				ddes_fecha = @fec_string  and
				ddes_codvig = 0
			 select @totunidades = @totunidades + @unidades
			select @totpeso = @totpeso + @peso
			select @totpallet = @totpallet + @pallet

			If  @totunidades  > 0
			begin
				select @Saltotunidades =  @Saltotunidades - @totunidades
				select @Saltotpeso = @Saltotpeso - @totpeso
				select @Saltotpallet = @Saltotpallet - @totpallet
			
			--select @totunidadesGer = @totunidadesGer + @totunidades
			end

			if @Saltotunidades > 0
			begin
				select @totunidadesGer = @totunidadesGer + @Saltotunidades
				select @totpesoGer = @totpesoGer + @Saltotpeso
				select @totpalletGer = @totpalletGer + @Saltotpallet
			
				
				insert into ServWeb (
					Sweb_codi,
					Sweb_Serv,
					Sweb_Cliente,
					Sweb_Fecha,
					Sweb_Cam1,
	
					Sweb_Cam2,
					Sweb_Cam3,
					Sweb_GrupFec,
					Sweb_Cam4
			--	Sweb_Cam5,
			--	Sweb_Cam6,
			---	Sweb_Cam7,
			--	Sweb_Cam8
	
					) 
				values (	
					@ID_Fact,
					@Servicio,
					@Rut_Clien,
					@Fecha,			
					 @saltotunidades,
			 		 @saltotpeso,
				 	@saltotpallet,
					@Fecha_Grupo,
					@fec_Hasta
--					CONVERT(VARCHAR,  @fec_Hasta, 120)
					
				--@fec_desde,
				--@Fec_String2,
				--@totpalletGer,
				--@totunidadesGer
				)
			end 
			
			select   @fecha = DateAdd(day, 1, @fecha)  
			--select @Saltotunidades =  0
			--select @Saltotpeso = 0
			--select @Saltotpallet = 0
			
		 end  
	

end
GO
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[sp_TrazaPalletsCodigoIcestar]

    -- Add the parameters for the stored procedure here

    @Codigo nvarchar(9)

       

AS

BEGIN

    -- SET NOCOUNT ON added to prevent extra result sets from

    -- interfering with SELECT statements.

    SET NOCOUNT ON;

 

    -- Insert statements for procedure here

    

    

SELECT dbo.P_Usuario.UsuarioNombre AS PERSONAL, dbo.ClasificacionMovimiento.Cmov_Descrip AS DESCRIPCIN, dbo.movpallet.mov_CA AS CA, 

       dbo.movpallet.mov_BA AS BA, dbo.movpallet.mov_CO AS CO, dbo.movpallet.mov_PI AS PI, dbo.movpallet.mov_NI AS NI, dbo.movpallet.mov_Fecha AS FECHA, 

       dbo.movpallet.mov_Hora AS HORA

FROM   dbo.movpallet INNER JOIN

       dbo.ClasificacionMovimiento ON dbo.movpallet.mov_Tipo = dbo.ClasificacionMovimiento.Cmov_codi INNER JOIN

       dbo.P_Usuario ON dbo.movpallet.mov_codper = dbo.P_Usuario.UsuarioNumero

WHERE  dbo.movpallet.mov_folio = @Codigo AND dbo.movpallet.mov_Tipo <> 'SI'

ORDER BY mov_fecha, mov_hora

 

    END
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[webborradetarecetmp]
@codpal nvarchar(9)
AS
DECLARE @Error int;
DECLARE @HayError int;
BEGIN
    SET NOCOUNT ON;
    SET @Error=@@ERROR ;
    
    SELECT @HayError=0;
    BEGIN TRANSACTION
		
	BEGIN TRY		
			DELETE  FROM  tmpdetarece WHERE frec_codi= LEFT(@codpal,7) AND drec_codi=RIGHT(@codpal,2);
	END TRY
	BEGIN CATCH		
			ROLLBACK TRANSACTION;
			SELECT @HayError=1;
			RETURN 11;
	END CATCH
	
	IF @HayError=0	COMMIT TRANSACTION;
END
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[webgetseriechklst]
@codcorre nvarchar(5)
AS
BEGIN
    SET NOCOUNT ON;
    BEGIN TRANSACTION
    DECLARE @nnId bigint;
    DECLARE @IdCodigo bigint;
    DECLARE @mintmps_codi bigint
    
    SELECT @mintmps_codi= MIN(tmps_codi) FROM correlat_salto WHERE tmps_correl=convert(int,@codcorre)
    IF (@mintmps_codi > 0 )
	BEGIN
		SELECT @nnId=@mintmps_codi
		DELETE FROM correlat_salto WHERE tmps_correl=convert(int,@codcorre) and tmps_codi=@mintmps_codi
	END
	ELSE
	BEGIN
		SELECT @nnId = cor_correact FROM correlat WITH (HOLDLOCK) WHERE cor_codi=@codcorre
		IF NOT (@@ROWCOUNT = 1)
		BEGIN
			INSERT INTO correlat (cor_correact,cor_codi) values (1,@codcorre)
			SELECT @nnId = 1
		END
		UPDATE correlat SET cor_correact = @nnId + 1 WHERE cor_codi=@codcorre
	END
	COMMIT TRANSACTION
	RETURN @nnId
END
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[webingchklst]
@rutclie nvarchar(9),
@rutchof nvarchar(9),
@patente nvarchar(10),
@rampla nvarchar(20),
@turno numeric,
@movi numeric,
@cont numeric,
@temp nvarchar(10),
@guardia numeric,
@etrans nvarchar(40),
@fecha date,
@hora time,
@codcorre nvarchar(5),
@sello nvarchar(20),
@guia nvarchar(20)
AS
DECLARE @return_value int;
DECLARE @Error int;
DECLARE @cadserie nvarchar(7);
DECLARE @largo int;
BEGIN
    SET NOCOUNT ON;
    
    BEGIN TRANSACTION
    
		SET @Error=@@ERROR ;
		
		EXEC	@return_value = webgetseriechklst @codcorre;
		SELECT	'Serie' = @return_value;
		
		SELECT @largo=LEN(@return_value);
		SELECT @cadserie=REPLICATE('0', 7-@largo)+ltrim(str(@return_value));

		SELECT @largo=LEN(@rutchof);
		SELECT @rutchof=REPLICATE('0', 9-@largo)+@rutchof;
		
		IF (@Error<>0) 
		BEGIN
			ROLLBACK;
			SELECT	'Serie' = 0;
		END
		
		
DECLARE @patente_real VARCHAR SET @patente_real= (SELECT cho_patente from Choferes WHERE cho_rut= @rutchof);
DECLARE @rampla_real VARCHAR SET @rampla_real= (SELECT cho_patente2 from Choferes WHERE cho_rut= @rutchof);

IF (@patente!= @patente_real AND @rampla!= @rampla_real) BEGIN
   
   UPDATE Choferes SET cho_patente =@patente, cho_patente2 =@rampla WHERE cho_rut= @rutchof;

INSERT INTO zchecklist
		(CL_fol, Cl_RutCli, Cl_chorut, Cl_pate, Cl_Ram, Cl_Tur,
Cl_Mov,Cl_Cont,Cl_Ting,Cl_Gs,Cl_ChoEmp, CL_tablet,Cl_fec,cl_lleg,
Cl_Estfrigo,Cl_EstPor,Cl_DesSello,Cl_salGuia) 
VALUES (@cadserie,@rutclie,@rutchof,@patente,@rampla,@turno,
		@movi,@cont,@temp,@guardia,@etrans,1,@fecha,GETDATE(),
		0,0,@sello,@guia);

END ELSE IF  (@rampla!= @rampla_real) BEGIN

	  UPDATE Choferes SET cho_patente2 =@rampla WHERE cho_rut= @rutchof;

INSERT INTO zchecklist
		(CL_fol, Cl_RutCli, Cl_chorut, Cl_pate, Cl_Ram, Cl_Tur,
Cl_Mov,Cl_Cont,Cl_Ting,Cl_Gs,Cl_ChoEmp, CL_tablet,Cl_fec,cl_lleg,
Cl_Estfrigo,Cl_EstPor,Cl_DesSello,Cl_salGuia) 
VALUES 
		(@cadserie,@rutclie,@rutchof,@patente,@rampla,@turno,
		@movi,@cont,@temp,@guardia,@etrans,1,@fecha,GETDATE(),
		0,0,@sello,@guia);

END ELSE IF  (@patente!= @patente_real) BEGIN

	  UPDATE Choferes SET cho_patente =@patente WHERE cho_rut= @rutchof;

INSERT INTO zchecklist
		(CL_fol, Cl_RutCli, Cl_chorut, Cl_pate, Cl_Ram, Cl_Tur,
Cl_Mov,Cl_Cont,Cl_Ting,Cl_Gs,Cl_ChoEmp, CL_tablet,Cl_fec,cl_lleg,
Cl_Estfrigo,Cl_EstPor,Cl_DesSello,Cl_salGuia) 
VALUES 
		(@cadserie,@rutclie,@rutchof,@patente,@rampla,@turno,
		@movi,@cont,@temp,@guardia,@etrans,1,@fecha,GETDATE(),
		0,0,@sello,@guia);
      
 END ELSE

   INSERT INTO zchecklist
		(CL_fol, Cl_RutCli, Cl_chorut, Cl_pate, Cl_Ram, Cl_Tur,
Cl_Mov,Cl_Cont,Cl_Ting,Cl_Gs,Cl_ChoEmp, CL_tablet,Cl_fec,cl_lleg,
Cl_Estfrigo,Cl_EstPor,Cl_DesSello,Cl_salGuia) 
VALUES 
		(@cadserie,@rutclie,@rutchof,@patente,@rampla,@turno,
		@movi,@cont,@temp,@guardia,@etrans,1,@fecha,GETDATE(),
		0,0,@sello,@guia);
      
   END ;


            
		IF (@Error<>0) BEGIN
			ROLLBACK;
			SELECT	'Serie' = 0;
		END ELSE 
			COMMIT TRANSACTION
    
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[webingrecepcion]
@NumTmp			int,
@codcorre		nvarchar(5),
@Rerror			int output,
@cadserie nvarchar(7) output,
@codusuweb int
AS
DECLARE @return_value int;
DECLARE @Error int;
DECLARE @HayError int;
DECLARE @largo int;
DECLARE @frec_rutcli nvarchar(19);
DECLARE @frec_clfol nvarchar(7);

DECLARE @drec_codpro nvarchar(7);
DECLARE @drec_codsag nvarchar(15);
DECLARE @drec_codsopo nvarchar(3);
DECLARE @drec_fecprod nvarchar(10);
DECLARE @drec_unidades int;
DECLARE @drec_peso float;
DECLARE @drec_sopocli nvarchar(11);
DECLARE @fechavencimiento char(10);
DECLARE @lotecliente nvarchar(10);
DECLARE @drec_estado nvarchar(50);
DECLARE @codpal nvarchar(9);
DECLARE @temp float;
DECLARE @bloqueado nvarchar(1);
DECLARE @idrece int;
DECLARE @contador int;
DECLARE @NumPal nvarchar(2);
DECLARE @NPallet nvarchar(9);
DECLARE @TieneDetalle int;
DECLARE @TRANS nvarchar(20);
DECLARE @frec_totsopo int;
DECLARE @frec_totunidad int;
DECLARE @frec_totpeso float;
DECLARE @frec_temppro float;
DECLARE @ContTemp int;
DECLARE @frec_rutcond nvarchar(9);
DECLARE @CodAlmac int;
DECLARE @NombAlmac nvarchar(50);
DECLARE @Tunel int;
DECLARE @UsuCodigo nvarchar(3);
DECLARE @Camara nvarchar(2);
DECLARE @contrato nvarchar(7);
BEGIN
	SELECT @HayError=0;
	SELECT @TRANS=CONVERT(nvarchar(20),@NumTmp);
    SET NOCOUNT ON;
    
    SELECT	@TieneDetalle=COUNT(*) FROM webtmpdetarece WHERE codtpmrece=@NumTmp;		
	IF (@TieneDetalle=0)
	BEGIN
		UPDATE webtmpfichrece SET frec_abierto=1 WHERE frec_codigo=@NumTmp;
		SELECT	'error'=0,'Serie' = -1;
		RETURN 0;
	END
		
    BEGIN TRANSACTION @TRANS	
		EXEC @return_value = webgetseriechklst @codcorre;
		
		SELECT @largo=LEN(@return_value);
		SELECT @cadserie=REPLICATE('0', 7-@largo)+ltrim(str(@return_value));
		
		/******************************** OBTENCION DE DATOS ********************************/
		SELECT @contrato=frec_contcli, @Tunel=frec_RecepTunel ,@frec_rutcli=frec_rutcli,@frec_clfol=frec_clfol,@CodAlmac=convert(int,frec_tipoalmacenamiento),
		@Camara=frec_antecamara
		FROM webtmpfichrece WHERE frec_codigo=@NumTmp;
		
		SELECT @frec_rutcond=Cl_chorut FROM zCheckList WHERE  Cl_fol= @frec_clfol
		
		SELECT @frec_totunidad=SUM(drec_unidades),@frec_totpeso=SUM(drec_peso),@frec_totsopo=count(*),
		@frec_temppro=SUM(drec_temp)
		FROM webtmpdetarece WHERE codtpmrece=@NumTmp;
		
		SELECT @ContTemp = COUNT(*) FROM webtmpdetarece WHERE drec_temp is not null AND codtpmrece=@NumTmp;
		SELECT @frec_temppro=@frec_temppro/@ContTemp;
		
		SELECT @NombAlmac=almacenamiento FROM P_TipoAlmacenamiento WHERE id=@CodAlmac;
		
		SELECT @UsuCodigo=usu_codigo FROM webusuarios INNER JOIN Usuarios ON rutusu=usu_rut 
		WHERE codfor=@codusuweb
		/**************************** FIN OBTENCION DE DATOS ********************************/
			
		SELECT TOP 1 @bloqueado = bloqueado  FROM webtmpdetarece WHERE codtpmrece=@NumTmp;
		
		BEGIN TRY		
			INSERT INTO fichrece ( frec_codienca, frec_tipoalmacenamiento, frec_rutcli,frec_contcli,frec_horarec,
			frec_horater,frec_fecrec,frec_tiporecepcion,frec_guiades,frec_clfol,
			frec_tipdesc,frec_origen,frec_numSello,frec_observ,frec_antecamara,frec_olores,frec_contenedor,
			frec_higiene,frec_estiba,frec_daado,frec_RecepTunel,frec_codi,frec_codvig,frec_tablet,
			frec_totpeso,frec_totsopo,frec_totunidad,frec_horalleg,frec_temppro,frec_rutcond)
			SELECT @UsuCodigo,@NombAlmac,frec_rutcli,frec_contcli ,frec_horarec,
			frec_horater,frec_fecrec,frec_tiporecepcion,frec_guiades,frec_clfol,
			frec_tipdesc,frec_origen,frec_numSello,frec_observ,frec_antecamara,frec_olores,frec_contenedor,
			frec_higiene,frec_estiba,frec_daado,@Tunel,@cadserie,0,1,@frec_totpeso,@frec_totsopo,
			@frec_totunidad,cast(datepart(hour,GETDATE()) as char(2))+':'+cast(datepart(minute,GETDATE()) as char(2)),
			@frec_temppro,@frec_rutcond
			FROM webtmpfichrece WHERE frec_codigo=@NumTmp;
		END TRY	
		BEGIN CATCH	
			ROLLBACK TRANSACTION @TRANS;
			SELECT @HayError=1;
			SELECT	'Serie' = 0;
			SELECT	'error'=@HayError,'Serie' = @cadserie;
			RETURN 1;
		END CATCH
		
		BEGIN TRY
			UPDATE zCheckList SET Cl_RutCli=@frec_rutcli WHERE Cl_fol=@frec_clfol
		END TRY
		
		BEGIN CATCH
			ROLLBACK TRANSACTION @TRANS;
			SELECT @HayError=2;
			SELECT	'Serie' = 0;
			SELECT	'error'=@HayError,'Serie' = @cadserie;	
			RETURN 1;
		END CATCH
			
		BEGIN TRY		
					INSERT INTO detarece
					(
					drec_rutcli,drec_fecrec,drec_camara,
					drec_codi,drec_codpro,drec_codsag ,drec_codsopo,
					drec_fecprod,drec_unidades ,drec_peso,drec_sopocli,
					fechavencimiento,lotecliente,drec_estado,drec_temp,
					drec_banda,drec_colum,drec_piso,drec_nivel,drec_almacen,
					drec_codvig,drec_pallet,drec_RecepTunel,drec_codper,drec_hora,
					frec_codi1,drec_etiqueta,drec_contcli) 
					SELECT
					@frec_rutcli,CONVERT(nvarchar(10),GETDATE(),111),@Camara,
					@cadserie+right(drec_codi,2) as  drec_codi,
					drec_codpro,drec_codsag,convert(nvarchar(2),convert(int,drec_codsopo)),
					drec_fecprod,drec_unidades,drec_peso,drec_sopocli,
					fechavencimiento,lotecliente,drec_estado,drec_temp,
					'0','0','0','0',2,'0',1,@Tunel,@UsuCodigo,cast(datepart(hour,GETDATE()) as char(2))+':'+cast(datepart(minute,GETDATE()) as char(2)),
					@cadserie,dbo.CREAETIQUETA('1780000000'+@cadserie+right(drec_codi,2)),@contrato
					FROM webtmpdetarece WHERE codtpmrece=@NumTmp;				
		END TRY
		BEGIN CATCH		
				ROLLBACK TRANSACTION @TRANS;
				SELECT @HayError=3;
				SELECT	'error'=@HayError,'Serie' = @cadserie;
				RETURN 11;
		END CATCH	
		
		BEGIN TRY	
				INSERT INTO rackdeta (racd_codi,racd_codpro,racd_unidades,racd_peso
				,racd_ca,racd_ba,racd_co,racd_pi,racd_ni,racd_estado
				,racd_fecpro,FechaVencimiento)
				SELECT drec_codi,drec_codpro,drec_unidades,drec_peso,drec_camara,'00','00','00','0',
				@bloqueado,drec_fecprod,FechaVencimiento
				FROM detarece WHERE @cadserie=left(drec_codi,len(drec_codi)-2)
		END TRY
		BEGIN CATCH
				ROLLBACK TRANSACTION @TRANS;
				SELECT @HayError=4;
				SELECT	'error'=@HayError,'Serie' = @cadserie;
				RETURN 12;
		END CATCH	
		BEGIN TRY	
				INSERT INTO movpallet (mov_folio,mov_ca,mov_ba,mov_co,mov_pi,mov_ni,
				mov_fecha,mov_tipo,mov_hora,mov_codper,mov_TS,Mov_Saldo,mov_anden,mov_Doc)
				SELECT drec_codi,drec_camara,'00','00','00','0',CONVERT(nvarchar(10),GETDATE(),111),
				'EN',CONVERT(nvarchar(10),GETDATE(),108),
				drec_codper,drec_temp, drec_unidades,@Camara,@cadserie
				FROM detarece WHERE @cadserie=left(drec_codi,len(drec_codi)-2)
		END TRY
		BEGIN CATCH
				ROLLBACK TRANSACTION @TRANS;
				SELECT @HayError=5;
				SELECT	'error'=@HayError,'Serie' = @cadserie;
				RETURN 13;
		END CATCH
		/*INGRESO FOTOS*/
		BEGIN TRY	
				INSERT INTO chk_imagesopo
				(id_pallets,cl_imgpat,cl_imgsel,cl_imgtem) 
				SELECT
				@cadserie+right(id_pallets,2) as id_pallets ,cl_imgpat,cl_imgsel,cl_imgtem
				FROM chk_imagestmp
				WHERE codtpmrece=@NumTmp;			
		END TRY
		BEGIN CATCH
				ROLLBACK TRANSACTION @TRANS;
				SELECT @HayError=6;
				SELECT	'error'=@HayError,'Serie' = @cadserie;
				RETURN 14;
		END CATCH
		
		BEGIN TRY	
				UPDATE webtmpfichrece SET frec_abierto=1 WHERE frec_codigo=@NumTmp;
		END TRY
		BEGIN CATCH
				ROLLBACK TRANSACTION @TRANS;
				SELECT @HayError=7;
				SELECT	'error'=@HayError,'Serie' = @cadserie;
				RETURN 14;
		END CATCH
	SELECT @Rerror=@HayError;
	IF (@HayError=0) 
	BEGIN
		COMMIT TRANSACTION @TRANS;
		SELECT	'error'=@HayError,'Serie' = @cadserie;
	END
END


GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[webingrecepcion2]
@CodRece		nvarchar(7) output,
@codcorre		nvarchar(5),
@Rerror			int output,
@codusuweb      int
AS
DECLARE @return_value int;
DECLARE @Error int;
DECLARE @HayError int;
DECLARE @largo int;
DECLARE @frec_rutcli nvarchar(19);
DECLARE @frec_clfol nvarchar(7);

DECLARE @drec_codpro nvarchar(7);
DECLARE @drec_codsag nvarchar(15);
DECLARE @drec_codsopo nvarchar(3);
DECLARE @drec_fecprod nvarchar(10);
DECLARE @drec_unidades int;
DECLARE @drec_peso float;
DECLARE @drec_sopocli nvarchar(11);
DECLARE @fechavencimiento char(10);
DECLARE @lotecliente nvarchar(10);
DECLARE @drec_estado nvarchar(50);
DECLARE @codpal nvarchar(9);
DECLARE @temp float;
DECLARE @bloqueado nvarchar(1);
DECLARE @idrece int;
DECLARE @contador int;
DECLARE @NumPal nvarchar(2);
DECLARE @NPallet nvarchar(9);
DECLARE @TieneDetalle int;
DECLARE @TRANS nvarchar(20);
DECLARE @frec_totsopo int;
DECLARE @frec_totunidad int;
DECLARE @frec_totpeso float;
DECLARE @frec_temppro float;
DECLARE @ContTemp int;
DECLARE @frec_rutcond nvarchar(9);
DECLARE @CodAlmac int;
DECLARE @NombAlmac nvarchar(50);
DECLARE @Tunel int;
DECLARE @UsuCodigo nvarchar(3);
DECLARE @Camara nvarchar(2);
DECLARE @contrato nvarchar(7);
DECLARE @turno int;
DECLARE @bloqueaped int;
DECLARE @estacontenedor int;
DECLARE @contenedor nvarchar(20);
DECLARE @minutos as int;
DECLARE @hora as int;
DECLARE @minutoschr as nvarchar(2);
DECLARE @horachr as nvarchar(2);


BEGIN
	SELECT @HayError=0;
	SELECT @TRANS=CONVERT(nvarchar(20),@CodRece);
    SET NOCOUNT ON;
    
	SELECT @contenedor='';
    SELECT @estacontenedor=0;
    
	IF (CONVERT(time, GETDATE()) > CONVERT(time, '08:00:00')) AND (CONVERT(time, GETDATE()) <= CONVERT(time, '19:59:59'))
	SELECT @turno=1
	ELSE
	SELECT @turno=2

    SELECT	@TieneDetalle=COUNT(*) FROM TMPDETARECE WHERE frec_codi=@CodRece;		
	IF (@TieneDetalle=0)
	BEGIN
		/******** La recepcion no tiene detalle se cierra *******/
		UPDATE TMPFICHRECE SET frec_abierto=1 WHERE frec_codi=@CodRece;
		/******** Se devuelve el codigo a correlat_salto *******/
		DELETE FROM TMPFICHRECE  WHERE frec_codi=@CodRece;
		DELETE FROM detarececajas  WHERE LEFT(Caj_Pcod,7)=@CodRece;
		DELETE FROM chk_imagestmp WHERE codtpmrece =@CodRece;
		INSERT INTO correlat_salto (tmps_codi,tmps_correl,tmps_personal,tmps_fecha) VALUES (@CodRece,6,@codusuweb,convert(nvarchar(10),GETDATE(),111))
		SELECT	'error'=0,'Serie' = -1;
		RETURN 0;
	END
		
    BEGIN TRANSACTION @TRANS	
		
		/******************************** OBTENCION DE DATOS ********************************/
		SELECT @contrato=frec_contcli, @Tunel=frec_RecepTunel ,@frec_rutcli=frec_rutcli,@frec_clfol=frec_clfol,@CodAlmac=convert(int,frec_tipoalmacenamiento),
		@Camara=frec_antecamara,@contenedor=frec_contenedor
		FROM TMPFICHRECE WHERE frec_codi=@CodRece;
		
/******************************* VALIDACION DE CONTENEDOR  ******************************************/

		SELECT TOP 1 @bloqueado = bloqueado  FROM TMPDETARECE WHERE frec_codi=@CodRece;
		
		SELECT @bloqueaped=cont_BloqImp FROM contrato WHERE cont_codi= @contrato
		

		SELECT @estacontenedor=COUNT(*) FROM Proc_Importaciones WHERE pimp_ncont  LIKE '%'+@contenedor+'%'
		
		IF (@bloqueaped=1) 
		BEGIN
			IF (@estacontenedor=1)
				SELECT @bloqueado = 0;
			ELSE
				SELECT @bloqueado = 5;
		END
	--@bloqueaped=1 bloquea racd_estado=5
	--@estacontenedor=1 solo si @bloqueaped=1     racd_estado=0
/******************************** *******************************************************************/

		SELECT @frec_rutcond=Cl_chorut FROM zCheckList WHERE  Cl_fol= @frec_clfol
		
		SELECT @frec_totunidad=SUM(drec_unidades),@frec_totpeso=SUM(drec_peso),@frec_totsopo=count(*),
		@frec_temppro=SUM(drec_temp)
		FROM TMPDETARECE WHERE frec_codi=@CodRece;
		
		SELECT @ContTemp = COUNT(*) FROM TMPDETARECE WHERE drec_temp is not null AND frec_codi=@CodRece;
		SELECT @frec_temppro=@frec_temppro/@ContTemp;
		
		SELECT @NombAlmac=almacenamiento FROM P_TipoAlmacenamiento WHERE id=@CodAlmac;
		
		SELECT @UsuCodigo=usu_codigo FROM webusuarios INNER JOIN Usuarios ON rutusu=usu_rut 
		WHERE codfor=@codusuweb
		
		/**************************** FIN OBTENCION DE DATOS ********************************/
			
		SELECT @minutos=datepart(MI,GETDATE())
		IF (@minutos<10) SELECT @minutoschr='0'+CAST(@minutos as char(1))
		ELSE SELECT @minutoschr=CAST(@minutos as char(2))
		
		SELECT @hora=datepart(HH,GETDATE())
		IF (@hora<10) SELECT @horachr='0'+CAST(@hora as char(1))
		ELSE SELECT @horachr=CAST(@hora as char(2))
		
		
		BEGIN TRY	
			INSERT INTO fichrece ( frec_codienca, frec_tipoalmacenamiento, frec_rutcli,frec_contcli,frec_horarec,
			frec_horater,frec_fecrec,frec_tiporecepcion,frec_guiades,frec_clfol,
			frec_tipdesc,frec_origen,frec_numSello,frec_observ,frec_antecamara,frec_olores,frec_contenedor,
			frec_higiene,frec_estiba,frec_daado,frec_RecepTunel,frec_codi,frec_codvig,frec_tablet,
			frec_totpeso,frec_totsopo,frec_totunidad,frec_horalleg,frec_temppro,frec_rutcond,frec_turnrec)
			SELECT @UsuCodigo,@NombAlmac,frec_rutcli,frec_contcli ,frec_horarec,
			CONVERT(nvarchar(5),getdate(),108),frec_fecrec,frec_tipo,frec_guiades,frec_clfol,
			frec_tipdesc,frec_origen,frec_numSello,frec_observ,frec_antecamara,frec_olores,frec_contenedor,
			frec_higiene,frec_estiba,frec_daado,@Tunel,@CodRece,0,1,@frec_totpeso,@frec_totsopo,
			@frec_totunidad,frec_horalleg,@frec_temppro,@frec_rutcond,@turno
			FROM TMPFICHRECE WHERE frec_codi=@CodRece;
		END TRY	
		BEGIN CATCH	
			ROLLBACK TRANSACTION @TRANS;
			SELECT @HayError=1;
			SELECT	'Serie' = 0;
			SELECT	'error'=@HayError,'Serie' = @CodRece;
			RETURN 1;
		END CATCH
		
		BEGIN TRY
			UPDATE zCheckList SET Cl_RutCli=@frec_rutcli WHERE Cl_fol=@frec_clfol
		END TRY
		
		BEGIN CATCH
			ROLLBACK TRANSACTION @TRANS;
			SELECT @HayError=2;
			SELECT	'Serie' = 0;
			SELECT	'error'=@HayError,'Serie' = @CodRece;	
			RETURN 1;
		END CATCH
			
		BEGIN TRY		
					INSERT INTO detarece
					(
					drec_rutcli,drec_fecrec,drec_camara,
					drec_codi,drec_codpro,drec_codsag ,drec_codsopo,
					drec_fecprod,drec_unidades ,drec_peso,drec_sopocli,
					fechavencimiento,lotecliente,drec_estado,drec_temp,
					drec_banda,drec_colum,drec_piso,drec_nivel,drec_almacen,
					drec_codvig,drec_pallet,drec_RecepTunel,drec_codper,drec_hora,
					frec_codi1,drec_etiqueta,drec_contcli,drec_arriendo,drec_codcaja) 
					SELECT
					@frec_rutcli,CONVERT(nvarchar(10),GETDATE(),111),@Camara,
					@CodRece+right(drec_codi,2) as  drec_codi,
					drec_codpro,drec_codsag,convert(nvarchar(2),convert(int,drec_codsopo)),
					drec_fecprod,drec_unidades,drec_peso,drec_sopocli,
					fechavencimiento,lotecliente,drec_estado,drec_temp,
					'0','0','0','0',2,'0',1,@Tunel,@UsuCodigo,cast(datepart(hour,GETDATE()) as char(2))+':'+cast(datepart(minute,GETDATE()) as char(2)),
					@CodRece,dbo.CREAETIQUETA('1780000000'+@CodRece+right(drec_codi,2)),@contrato,drec_arriendo,drec_codcaja
					FROM TMPDETARECE WHERE frec_codi=@CodRece;				
		END TRY
		BEGIN CATCH		
				ROLLBACK TRANSACTION @TRANS;
				SELECT @HayError=3;
				SELECT	'error'=@HayError,'Serie' = @CodRece;
				RETURN 11;
		END CATCH	

		BEGIN TRY	
				INSERT INTO rackdeta (racd_codi,racd_codpro,racd_unidades,racd_peso
				,racd_ca,racd_ba,racd_co,racd_pi,racd_ni,racd_estado
				,racd_fecpro,FechaVencimiento,LoteCliente)
				SELECT drec_codi,drec_codpro,drec_unidades,drec_peso,drec_camara,'00','00','00','0',
				@bloqueado,drec_fecprod,FechaVencimiento,lotecliente
				FROM detarece WHERE LEFT(drec_codi,7)=@CodRece
		END TRY
		BEGIN CATCH
				ROLLBACK TRANSACTION @TRANS;
				SELECT @HayError=4;
				SELECT	'error'=@HayError,'Serie' = @CodRece;
				RETURN 12;
		END CATCH	
		BEGIN TRY	
				INSERT INTO movpallet (mov_folio,mov_ca,mov_ba,mov_co,mov_pi,mov_ni,
				mov_fecha,mov_tipo,mov_hora,mov_codper,mov_TS,Mov_Saldo,mov_anden,mov_Doc)
				SELECT drec_codi,drec_camara,'00','00','00','0',CONVERT(nvarchar(10),GETDATE(),111),
				'EN',CONVERT(nvarchar(10),GETDATE(),108),
				drec_codper,drec_temp, drec_unidades,@Camara,@CodRece
				FROM detarece WHERE @CodRece=left(drec_codi,len(drec_codi)-2)
		END TRY
		BEGIN CATCH
				ROLLBACK TRANSACTION @TRANS;
				SELECT @HayError=5;
				SELECT	'error'=@HayError,'Serie' = @CodRece;
				RETURN 13;
		END CATCH
		/*INGRESO FOTOS*/
		BEGIN TRY	
				INSERT INTO chk_imagesopo
				(id_pallets,cl_imgpat,cl_imgsel,cl_imgtem) 
				SELECT
				id_pallets ,cl_imgpat,cl_imgsel,cl_imgtem
				FROM chk_imagestmp
				WHERE codtpmrece=@CodRece;			
		END TRY
		BEGIN CATCH
				ROLLBACK TRANSACTION @TRANS;
				SELECT @HayError=6;
				SELECT	'error'=@HayError,'Serie' = @CodRece;
				RETURN 14;
		END CATCH
		
		BEGIN TRY	
				UPDATE TMPFICHRECE SET frec_abierto=1 WHERE frec_codi=@CodRece;
		END TRY
		BEGIN CATCH
				ROLLBACK TRANSACTION @TRANS;
				SELECT @HayError=7;
				SELECT	'error'=@HayError,'Serie' = @CodRece;
				RETURN 14;
		END CATCH
		
		BEGIN TRY	
			UPDATE receimagen SET rimg_temp=1, rimg_rececodi=@CodRece WHERE rimg_rececodi= @CodRece and rimg_temp=0;
		END TRY
		BEGIN CATCH
				ROLLBACK TRANSACTION @TRANS;
				SELECT @HayError=8;
				SELECT	'error'=@HayError,'Serie' = @CodRece;
				RETURN 14;
		END CATCH
		
	/*SELECT @Rerror=@HayError;*/
	
	IF (@HayError=0) 
	BEGIN
		COMMIT TRANSACTION @TRANS;
		DELETE FROM TMPFICHRECE  WHERE frec_codi=@CodRece;
		DELETE FROM TMPDETARECE  WHERE frec_codi=@CodRece;
		DELETE FROM chk_imagestmp WHERE codtpmrece =@CodRece;
		SELECT	'error'=@HayError,'Serie' = @CodRece;
	END
	
END

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[webingredetarecetmp]
@drec_codi nvarchar(9),
@drec_codpro nvarchar(7),
@drec_codsag nvarchar(15),
@drec_codsopo nvarchar(3),
@drec_fecprod nvarchar(10),
@drec_unidades int,
@drec_peso float,
@drec_sopocli nvarchar(11),
@fechavencimiento char(10),
@lotecliente nvarchar(10),
@drec_estado nvarchar(50),
@codpal nvarchar(9),
@temp float,
@bloqueado nvarchar(1),
@idrece int
AS
DECLARE @Error int;
DECLARE @Cant int;
DECLARE @NumPal nvarchar(2);
DECLARE @Salida int;
DECLARE @HayError int;
BEGIN
    SET NOCOUNT ON;
    SET @Error=@@ERROR ;
    
    SELECT @Cant=0;
    SELECT @HayError=0;
    BEGIN TRANSACTION
		IF (@codpal='0')
		BEGIN
			
			SELECT @Cant=ISNULL(right(MAX(drec_codi),2),0)
			FROM webtmpdetarece WHERE codtpmrece =@drec_codi;

			SELECT @Cant=@Cant + 1 ;
			
			IF @Cant<10
				SELECT @NumPal='0'+CONVERT(nvarchar(1),@Cant);
			ELSE
				SELECT @NumPal=CONVERT(nvarchar(2),@Cant);
			
			SELECT @drec_codi=@drec_codi+@NumPal
		
			BEGIN TRY		
					INSERT INTO webtmpdetarece
					(drec_codi,drec_codpro,drec_codsag ,drec_codsopo,
					drec_fecprod,drec_unidades ,drec_peso,drec_sopocli ,
					fechavencimiento,lotecliente,drec_estado,drec_temp,codtpmrece,bloqueado) 
					VALUES 
					(@drec_codi,@drec_codpro,@drec_codsag ,convert(int,@drec_codsopo),
					convert(nvarchar(10),CONVERT(date,@drec_fecprod),111),@drec_unidades ,@drec_peso,@drec_sopocli,
					@fechavencimiento,@lotecliente,@drec_estado,round(@temp,2),@idrece,@bloqueado);
			END TRY
			BEGIN CATCH		
					ROLLBACK TRANSACTION;
					SELECT @HayError=1;
					RETURN 11;
			END CATCH	
		END
		ELSE
		BEGIN
			BEGIN TRY		
					UPDATE webtmpdetarece
					SET
					drec_codpro=@drec_codpro,
					drec_codsag=@drec_codsag,
					drec_codsopo=convert(int,@drec_codsopo),
					drec_fecprod=convert(nvarchar(10),CONVERT(date,@drec_fecprod),111),
					drec_unidades=@drec_unidades,
					drec_peso=@drec_peso,
					drec_sopocli=@drec_sopocli,
					fechavencimiento=@fechavencimiento,
					lotecliente=@lotecliente,
					drec_estado=@drec_estado,
					drec_temp=round(@temp,2),
					codtpmrece=@idrece
					WHERE drec_codi=@codpal;
			END TRY
			BEGIN CATCH		
					ROLLBACK TRANSACTION;
					SELECT @HayError=1;
					RETURN 11;
			END CATCH	
		END
		if @HayError=0	COMMIT TRANSACTION;
END
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
                       
CREATE PROCEDURE [dbo].[webingredetarecetmp2]
@drec_codi nvarchar(9),
@drec_codpro nvarchar(7),
@drec_codsag nvarchar(15),
@drec_codsopo nvarchar(3),
@drec_fecprod nvarchar(10),
@drec_unidades int,
@drec_peso float,
@drec_sopocli nvarchar(11),
@fechavencimiento char(10),
@lotecliente nvarchar(10),
@drec_estado nvarchar(50),
@codpal nvarchar(9),
@temp float,
@bloqueado nvarchar(1),
@idrece int
AS
DECLARE @Error int;
DECLARE @Cant int;
DECLARE @NumPal nvarchar(2);
DECLARE @Salida int;
DECLARE @HayError int;
DECLARE @frec_rutcli nvarchar(19);
DECLARE @frec_fecrec nvarchar(10);

BEGIN
    SET NOCOUNT ON;
    SET @Error=@@ERROR ;
    
    SELECT @Cant=0;
    SELECT @HayError=0;
    BEGIN TRANSACTION
		IF (@codpal='0')
		BEGIN
			
			SELECT @Cant=ISNULL(right(MAX(drec_codi),2),0)
			FROM tmpdetarece WHERE frec_codi =@drec_codi;

			SELECT @frec_fecrec=frec_fecrec,@frec_rutcli=frec_rutcli FROM TMPFICHRECE WHERE frec_codi=@drec_codi;

			SELECT @Cant=@Cant + 1 ;
			
			IF @Cant<10
				SELECT @NumPal='0'+CONVERT(nvarchar(1),@Cant);
			ELSE
				SELECT @NumPal=CONVERT(nvarchar(2),@Cant);
			
			
			/*SELECT @drec_codi=@drec_codi+@NumPal
			SELECT  'INSERT INTO TMPDETARECE
			(frec_codi,drec_codpro,drec_codsag ,drec_codsopo,
			drec_fecprod,drec_unidades ,drec_peso,drec_sopocli ,
			fechavencimiento,lotecliente,drec_estado,drec_temp,codtmprece,bloqueado,drec_etiqueta,drec_codi)
			VALUES ('+@drec_codi+','+@drec_codpro+','+@drec_codsag+','+@drec_codsopo+','+
			convert(nvarchar(10),CONVERT(date,@drec_fecprod),111)+','+convert(nchar,@drec_unidades) +','+convert(nchar,@drec_peso)+','+@drec_sopocli+','+
			@fechavencimiento+','+@lotecliente+','+@drec_estado+','+convert(nchar,round(@temp,2))+','+convert(nchar,@idrece)
			+','+convert(nchar,@bloqueado)+','+dbo.CREAETIQUETA('1780000000'+@drec_codi+@NumPal)+','+@NumPal*/
					
			BEGIN TRY		
					INSERT INTO TMPDETARECE
					(frec_codi,drec_codpro,drec_codsag ,drec_codsopo,
					drec_fecprod,drec_unidades ,drec_peso,drec_sopocli ,
					fechavencimiento,lotecliente,drec_estado,drec_temp,codtmprece,bloqueado,drec_etiqueta,drec_codi,drec_fecrec,drec_rutcli)
					VALUES 
					(@drec_codi,@drec_codpro,@drec_codsag ,convert(int,@drec_codsopo),
					convert(nvarchar(10),CONVERT(date,@drec_fecprod),111),@drec_unidades ,@drec_peso,@drec_sopocli,
					convert(nvarchar(10),CONVERT(date,@fechavencimiento),111),@lotecliente,@drec_estado,round(@temp,2),@idrece,@bloqueado,dbo.CREAETIQUETA('1780000000'+@drec_codi+@NumPal),
					@NumPal,@frec_fecrec,@frec_rutcli);
			END TRY
			BEGIN CATCH		
					ROLLBACK TRANSACTION;
					SELECT @HayError=1;
					RETURN 11;
			END CATCH	
		END
		ELSE
		BEGIN
			BEGIN TRY		
					UPDATE TMPDETARECE
					SET
					drec_codpro=@drec_codpro,
					drec_codsag=@drec_codsag,
					drec_codsopo=convert(int,@drec_codsopo),
					drec_fecprod=convert(nvarchar(10),CONVERT(date,@drec_fecprod),111),
					drec_unidades=@drec_unidades,
					drec_peso=@drec_peso,
					drec_sopocli=@drec_sopocli,
					fechavencimiento=@fechavencimiento,
					lotecliente=@lotecliente,
					drec_estado=@drec_estado,
					drec_temp=round(@temp,2)
					/*,drec_etiqueta=dbo.CREAETIQUETA('1780000000'+@drec_codi),
					codtmprece=@idrece*/
					WHERE frec_codi= LEFT(@codpal,7) AND drec_codi=RIGHT(@codpal,2);
			END TRY
			BEGIN CATCH		
					ROLLBACK TRANSACTION;
					SELECT @HayError=1;
					RETURN 12;
			END CATCH	
		END
		if @HayError=0	COMMIT TRANSACTION;
END
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

CREATE PROCEDURE [dbo].[webregistraped] 
@filexls		nvarchar(30),
@rutclie		nvarchar(10),
@transporte		nvarchar(100),
@pefecha		nvarchar(10),
@pehora		    nvarchar(5),
@destino		nvarchar(50),
@observacion	nvarchar(1000),
@listamail		nvarchar(300),
@Terror			int output

AS
DECLARE  @return_value int;
DECLARE  @numorden int;
DECLARE  @PALLET nvarchar(9);
DECLARE  @CANTCAJAS int;
DECLARE  @SALDO int;
DECLARE  @TOTKILOS float;
DECLARE  @CA nvarchar(2);
DECLARE  @BA nvarchar(2);
DECLARE  @CO nvarchar(2);
DECLARE  @PI nvarchar(2);
DECLARE  @NI nvarchar(2);
DECLARE  @pick int;
DECLARE  @LINEA int;
DECLARE  @HayError int;
DECLARE  @numped nvarchar(25);
DECLARE  @FF nvarchar(8);
DECLARE  @HH nvarchar(2);
DECLARE  @MM nvarchar(2);
DECLARE  @SS nvarchar(2);
DECLARE  @HORAP nvarchar(8);
DECLARE  @TRANS	nvarchar(10);
DECLARE  @POS	int;
DECLARE  @SW	int;
DECLARE  @FECHA nvarchar(10);
DECLARE  @HORA  nvarchar(5);

 SELECT @FECHA = convert(nvarchar (10),GETDATE(),111)
 SELECT @HORA  = convert(nvarchar (5),GETDATE(),108)
    
	SELECT   @HORAP=CONVERT(nvarchar(8), GETDATE(), 108) 
	SELECT   @FF=CONVERT(nvarchar(8),GETDATE(),112);
	SELECT   @HH=SUBSTRING (@HORAP, 1,2);
	SELECT   @MM=SUBSTRING (@HORAP, 4,2);
	SELECT   @SS=SUBSTRING (@HORAP, 7,2);

	SELECT   @numped=@FF+@HH+@MM+@SS+@rutclie;

	SELECT @TRANS=@rutclie;
	SELECT @HayError=0;
	
    SET NOCOUNT ON;
  
    BEGIN TRANSACTION @TRANS	
		BEGIN TRY
			SELECT @POS=1;
			INSERT INTO PEDIDOS_FICHA (PEDIDO, CLIENTE, TRANSPORTE, FECHA, HORA, DESTINO, OBSERVACION, MAIL, CODVIG, TERMINADO,fechapedido,packinglist)
			VALUES (@numped,@rutclie,@transporte,@pefecha,@pehora,@destino,@observacion,@listamail,'0','0',convert(datetime,getdate(),111),@filexls);
			
			SELECT @numorden=orden FROM PEDIDOS_FICHA WHERE PEDIDO=@numped;
		END TRY
		BEGIN CATCH
			ROLLBACK TRANSACTION @TRANS;
			SELECT @HayError=@POS;
			SELECT	'error'=@HayError,'nped'=0,'nord'=0;
			RETURN @POS;
		END CATCH
		
		/*BEGIN TRY
			SELECT @POS=2;
			INSERT INTO PEDIDOS_PRG (PRG_ORDEN, PRG_HORA, PRG_FECHA, PRG_RUTCLIE,prg_modo)VALUES(@numorden,@pehora,@pefecha,@rutclie,'PACKING LIST');
		END TRY
		
		BEGIN CATCH
			ROLLBACK TRANSACTION @TRANS;
			SELECT @HayError=@POS;
			SELECT	'error'=@HayError,'nped'=@numorden,'nord'=@pehora;
			RETURN @POS;
		END CATCH*/
		
		BEGIN TRY
			SELECT @POS=3;
			UPDATE rackdeta SET racd_estado=1  WHERE racd_codi in (	SELECT caj_pcod FROM PedWebTmp
			INNER JOIN detarececajas ON upper(caj_cod)=upper(pwt_codcaja)
			WHERE pwt_coding=@filexls
			GROUP BY caj_pcod);
		END TRY
		BEGIN CATCH
			ROLLBACK TRANSACTION @TRANS;
			SELECT @HayError=@POS;
			SELECT	'error'=@HayError,'nped'=@numorden,'nord'=@pehora;
			RETURN @POS;
		END CATCH
		BEGIN TRY
			SELECT @POS=4;
			INSERT  pedcaja (pc_fecha,pc_codped,pc_hora,pc_ncaja,pc_numpal,pc_estado,pc_tpoped,pc_saldo,pc_rutclie,pc_kilos)
			SELECT @fecha,@numorden,@hora,COUNT(pwt_codcaja),caj_pcod ,1,3,racd_unidades,@rutclie,SUM(pwt_kilos)
			FROM PedWebTmp
			INNER JOIN (detarececajas INNER JOIN rackdeta ON racd_codi=caj_pcod) ON upper(caj_cod)=upper(pwt_codcaja)
			WHERE pwt_coding=@filexls
			AND caj_Pcod in
			(
			SELECT MAX(caj_pcod) FROM PedWebTmp INNER JOIN DetaReceCajas ON Caj_cod=pwt_codcaja AND Caj_ped=0 
			WHERE pwt_coding=@filexls 
			GROUP BY pwt_codcaja 
			
			)
			GROUP BY caj_pcod,racd_unidades,racd_ca,racd_ba,racd_co ,racd_pi,racd_ni
		END TRY
		BEGIN CATCH
			ROLLBACK TRANSACTION @TRANS;
			SELECT @HayError=@POS;
			SELECT	'error'=@HayError,'nped'=@numorden,'nord'=@pehora;
			RETURN @POS;
		END CATCH
		BEGIN TRY	
			SELECT @POS=5;
			SELECT @LINEA=0;
			DECLARE RSGUIAS CURSOR FOR
			
			
			SELECT caj_pcod as pwt_pallet,COUNT(pwt_codcaja) as CANTCAJAS,racd_unidades as SALDO,SUM(pwt_kilos) as TOTKILOS,racd_ca as CA,racd_ba as BA,racd_co as CO,
			racd_pi AS PI,racd_ni as NI
			FROM PedWebTmp
			INNER JOIN (detarececajas INNER JOIN rackdeta ON racd_codi=caj_pcod) ON upper(caj_cod)=upper(pwt_codcaja)
			WHERE pwt_coding=@filexls AND caj_Pcod in
			(
			SELECT MAX(caj_pcod) FROM PedWebTmp INNER JOIN DetaReceCajas ON Caj_cod=pwt_codcaja AND Caj_ped=0 
			WHERE pwt_coding=@filexls 
			GROUP BY pwt_codcaja 
			
			)
			GROUP BY caj_pcod,racd_unidades,racd_ca,racd_ba,racd_co ,racd_pi,racd_ni
			
			
			/*FOR UPDATE OF caj_pcod*/
			OPEN RSGUIAS
			FETCH NEXT FROM RSGUIAS
			INTO @PALLET,@CANTCAJAS,@SALDO,@TOTKILOS,@CA,@BA,@CO,@PI,@NI;
			
			SELECT @POS=6;
			WHILE @@FETCH_STATUS = 0
			BEGIN	
			
				SELECT @pick=0;
				IF @CANTCAJAS<>@SALDO 
				BEGIN
					SELECT @pick=1;
				END
				SELECT @LINEA=@LINEA+1;
				INSERT INTO Pedidos_Detalle(PEDIDO, LINEA, PALLET, CAJAS, KILOS, POSICION, est,parcial) 
				VALUES(@numped,@LINEA, @PALLET, @CANTCAJAS, @TOTKILOS,@CA+'-'+@BA+'-'+@CO+'-'+@PI+'-'+@NI,'0',@pick);
				
				FETCH NEXT FROM RSGUIAS
				INTO @PALLET,@CANTCAJAS,@SALDO,@TOTKILOS,@CA,@BA,@CO,@PI,@NI;
			END
			CLOSE RSGUIAS
			DEALLOCATE RSGUIAS
		END TRY	
		BEGIN CATCH		
			CLOSE RSGUIAS
			DEALLOCATE RSGUIAS	
			ROLLBACK TRANSACTION @TRANS;
			SELECT @HayError=@POS;
			SELECT 'error'=@HayError,'nped'=0,'nord'=0;
			RETURN @POS;
		END CATCH
		BEGIN TRY
			SELECT @POS=7;
			INSERT INTO detapedcaja (dpc_numpal,dpc_estado,dpc_codcaja,dpc_codped) 
			SELECT MAX(caj_pcod), 1, pwt_codcaja, @numorden FROM PedWebTmp INNER JOIN DetaReceCajas ON Caj_cod=pwt_codcaja AND Caj_ped=0 
			WHERE pwt_coding=@filexls
			GROUP BY pwt_codcaja ORDER BY MAX(caj_pcod);
		END TRY
		BEGIN CATCH
			ROLLBACK TRANSACTION @TRANS;
			SELECT @HayError=@POS;
			SELECT	'error'=@HayError,'nped'=0,'nord'=0;
			RETURN @POS;
		END CATCH
		BEGIN TRY
			SELECT @POS=8;
			UPDATE DetaReceCajas SET caj_ped=1 WHERE Caj_Est=0 AND caj_cod in  (SELECT pwt_codcaja FROM PedWebTmp WHERE pwt_coding=@filexls);
		END TRY
		BEGIN CATCH
			ROLLBACK TRANSACTION @TRANS;
			SELECT @HayError=@POS;
			SELECT	'error'=@HayError,'nped'=0,'nord'=0;
			RETURN @POS;
		END CATCH
		BEGIN TRY
			SELECT @POS=9;
			UPDATE PedWebTmp SET pwt_estado =3,pwt_codped=@numorden WHERE pwt_coding=@filexls;
		END TRY
		BEGIN CATCH
			ROLLBACK TRANSACTION @TRANS;
			SELECT @HayError=@POS;
			SELECT 'error'=@HayError,'nped'=0,'nord'=0;
			RETURN @POS;
		END CATCH
		IF (@HayError=0) 
		BEGIN
			COMMIT TRANSACTION @TRANS;
			SELECT	'error'=@HayError,'nped'=@numped,'nord'=@numorden;
		END
		ELSE
		BEGIN
			SELECT	'error'=@HayError,'nped'=0,'nord'=0;
		END

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

CREATE PROCEDURE [dbo].[webseleccioncajapallet]
@rutclie nvarchar(9),
@pedido  nvarchar(25),
@observacion  nvarchar(1000),
@transporte nvarchar(100),
@destino nvarchar(50),
@listamail nvarchar(300),
@pfecha nvarchar(10),
@phora nvarchar(5)
AS
DECLARE @Error int;
DECLARE @return_value int;

DECLARE @HayError int;
DECLARE @TRANS nvarchar(9);
DECLARE @pguia_nguia nvarchar(9);
DECLARE @pguia_fecha nvarchar(10);
DECLARE @pguia_ncajas int;
DECLARE @pguia_nsopo int;
DECLARE @pguia_hora nvarchar(10);
DECLARE @pguia_estado int;

DECLARE @racd_codi nvarchar(9);
DECLARE @racd_unidades int;
DECLARE @racd_peso float;
DECLARE @racd_ca nvarchar(2);
DECLARE @racd_ba nvarchar(2);
DECLARE @racd_co nvarchar(2);
DECLARE @racd_pi nvarchar(2);
DECLARE @racd_ni nvarchar(1)

DECLARE @caj_pcod nvarchar(9);
DECLARE @caj_cod nvarchar(200);
DECLARE @POS int;
DECLARE @SW int;
DECLARE @linea int;
DECLARE @xnumorden int;
DECLARE @TOT_UNIDADESBLOQ int;
DECLARE @TOT_KILOSBLOQ int;
 
	SELECT @TOT_UNIDADESBLOQ=0;
	SELECT @TOT_KILOSBLOQ=0;
	SELECT @HayError=0;
	SELECT @TRANS=@rutclie;
    SET NOCOUNT ON;
    SELECT @SW=0
    SELECT @POS=0;
    SELECT @linea=0;
    BEGIN TRANSACTION @TRANS	 
        
		BEGIN TRY	
		
			DECLARE RSGUIAS CURSOR FOR
			SELECT pguia_nguia,convert(nvarchar(10),pguia_fecha,103),pguia_ncajas,pguia_nsopo,convert(nvarchar(5),left(pguia_hora,5),1),pguia_estado FROM pedidoguias WHERE pguia_estado=0 AND pguia_rutclie=@rutclie
			FOR UPDATE OF pguia_estado;
			OPEN RSGUIAS
			FETCH NEXT FROM RSGUIAS
			INTO @pguia_nguia,@pguia_fecha,@pguia_ncajas,@pguia_nsopo,@pguia_hora,@pguia_estado
			SELECT @POS=1;
			WHILE @@FETCH_STATUS = 0
			BEGIN
				/*SELECT @pguia_nguia AS GUIA;*/
				IF (@SW=0)
				BEGIN
				
					INSERT INTO PEDIDOS_FICHA (PEDIDO, CLIENTE, TRANSPORTE, FECHA, HORA, DESTINO, OBSERVACION, MAIL, CODVIG, TERMINADO,fechapedido) VALUES (@pedido,@rutclie,@transporte,@pfecha,@phora,@destino,@observacion,@listamail,'0','0',@pguia_fecha+ + ' ' + @pguia_hora)  
					SELECT @SW=1
					
					SELECT @xnumorden = isnull(orden,0) FROM PEDIDOS_FICHA WHERE PEDIDO=@pedido
					/*INSERT INTO PEDIDOS_PRG (PRG_ORDEN, PRG_HORA, PRG_FECHA, PRG_RUTCLIE,prg_modo)VALUES(@xnumorden,@phora,@pfecha,@rutclie,'GUIAS')  */		    	
				END
				DECLARE RSSOPO CURSOR FOR
				SELECT racd_codi,racd_ca,racd_unidades,racd_peso,racd_ca,racd_ba,racd_co,racd_pi,racd_ni FROM rackdeta WHERE LEFT(racd_codi,7)=@pguia_nguia AND racd_estado=0
				OPEN RSSOPO
				FETCH NEXT FROM RSSOPO
				INTO @racd_codi,@racd_ca,@racd_unidades,@racd_peso,@racd_ca,@racd_ba,@racd_co,@racd_pi,@racd_ni
				SELECT @POS=2;
				WHILE @@FETCH_STATUS = 0
				BEGIN
					/*SELECT '                     '+@racd_codi+' - '+@pguia_fecha+' -  '+@pguia_hora*/			
					SELECT @linea=@linea + 1;
					SELECT @TOT_UNIDADESBLOQ=COUNT(*) ,@TOT_KILOSBLOQ=SUM(Caj_Kg)
					FROM DetaReceCajas INNER JOIN (rackdeta INNER JOIN detarece ON racd_codi=drec_codi) ON caj_pcod=racd_codi
					WHERE racd_estadopallet=0 AND caj_est=-1 AND Caj_Pcod=@racd_codi AND caj_ped=0
					GROUP BY Caj_Pcod		
					
					UPDATE rackdeta set RACD_ESTADO='2', racd_pedido_fec=@pguia_fecha, racd_pedido_hor=@pguia_hora WHERE racd_codi=@racd_codi
					INSERT pedcaja (pc_fecha,pc_codped,pc_hora,pc_ncaja,pc_numpal,pc_estado,pc_tpoped,pc_saldo,pc_rutclie,pc_kilos) 
					VALUES (@pguia_fecha,@xnumorden,@pguia_hora,@racd_unidades - @TOT_UNIDADESBLOQ,@racd_codi,0,4,@racd_unidades,@rutclie,@racd_peso - @TOT_KILOSBLOQ);
					
					/*SELECT @pedido +' - '+@linea+' - '+@racd_codi+' - '+@racd_unidades+' - ' +@racd_peso+' - '+@racd_ca+' - '+@racd_ba+' - '+@racd_co+' - '+@racd_pi+' - '+@racd_ni+' - '+'0'+' - '+0*/
					
					INSERT INTO Pedidos_Detalle(PEDIDO, LINEA, PALLET, CAJAS, KILOS, POSICION, est,parcial) 
					VALUES (@pedido,@linea,@racd_codi,@racd_unidades,@racd_peso,@racd_ca+'-'+@racd_ba+'-'+@racd_co+'-'+@racd_pi+'-'+@racd_ni,'0',0)
					
					DECLARE RSCAJA CURSOR FOR
					SELECT caj_pcod,caj_cod FROM DetaReceCajas WHERE caj_pcod=@racd_codi AND caj_est=0 
					OPEN RSCAJA
					FETCH NEXT FROM RSCAJA
					INTO @caj_pcod,@caj_cod
					SELECT @POS=3;
					WHILE @@FETCH_STATUS = 0
					BEGIN
						/*SELECT '                                     '+@caj_cod as CODCAJA;*/
						INSERT  detapedcaja (dpc_numpal,dpc_estado,dpc_codcaja,dpc_codped) VALUES (@caj_pcod,1,@caj_cod,@xnumorden);	
						
						FETCH NEXT FROM RSCAJA
						INTO @caj_pcod,@caj_cod
					END
					CLOSE RSCAJA
					DEALLOCATE RSCAJA
					UPDATE DetaReceCajas SET caj_ped=1 WHERE Caj_Pcod=@racd_codi;
					FETCH NEXT FROM RSSOPO
					INTO @racd_codi,@racd_ca,@racd_unidades,@racd_peso,@racd_ca,@racd_ba,@racd_co,@racd_pi,@racd_ni
				END
				CLOSE RSSOPO
				DEALLOCATE RSSOPO
				
				UPDATE pedidoguias SET pguia_estado=3,pguia_codped=@xnumorden WHERE pguia_estado=0 AND pguia_rutclie=@rutclie AND pguia_nguia=@pguia_nguia
				
				FETCH NEXT FROM RSGUIAS
				INTO @pguia_nguia,@pguia_fecha,@pguia_ncajas,@pguia_nsopo,@pguia_hora,@pguia_estado
			END
			CLOSE RSGUIAS
			DEALLOCATE RSGUIAS
			SELECT @POS=4;
			/*OPEN RSGUIAS*/
		END TRY	
		BEGIN CATCH	
			IF (@POS=1)
			BEGIN
				CLOSE RSGUIAS
				DEALLOCATE RSGUIAS	
			END
			IF (@POS=2)
			BEGIN
				CLOSE RSGUIAS
				DEALLOCATE RSGUIAS	
				CLOSE RSSOPO
				DEALLOCATE RSSOPO
			END
			IF (@POS=3)
			BEGIN
				CLOSE RSGUIAS
				DEALLOCATE RSGUIAS	
				CLOSE RSSOPO
				DEALLOCATE RSSOPO
				CLOSE RSCAJA
				DEALLOCATE RSCAJA
			END
			
			ROLLBACK TRANSACTION @TRANS;
			
			SELECT @HayError=@POS;
			SELECT 'error'=@HayError;
			RETURN @POS;
		END CATCH
		
		IF (@HayError=0) 
		BEGIN
			COMMIT TRANSACTION @TRANS;
			SELECT	'error'=@HayError,'numorden'=@xnumorden;
		END
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[webtmpingrecprod]
@frec_tipoalmacenamiento	varchar(50),
@frec_rutcli				nvarchar(19),
@frec_contcli				nvarchar(7),
@frec_horarec				nvarchar(5),
@frec_horater				nvarchar(5),
@frec_fecrec				nvarchar(10),
@frec_tiporecepcion			nvarchar(1),
@frec_guiades				nvarchar(8),
@frec_clfol					nvarchar(50),
@frec_tipdesc				nvarchar(1),
@frec_origen				nvarchar(2),
@frec_numSello				nvarchar(25),
@frec_observ				nvarchar(50),
@frec_antecamara			nvarchar(2),
@frec_olores				nvarchar(2),
@frec_higiene				varchar(2),
@frec_estiba				nvarchar(2),
@frec_danado				nvarchar(2),
@frec_RecepTunel			int,
@frec_contenedor			nvarchar(20),
@serie int output,
@HayError int output
AS
DECLARE @idrece int;
BEGIN
	SELECT @HayError=0;
    SET NOCOUNT ON;
    BEGIN TRANSACTION
		BEGIN TRY		
			INSERT INTO webtmpfichrece
			(frec_tipoalmacenamiento, frec_rutcli,frec_contcli,frec_horarec,
			frec_horater,frec_fecrec,frec_tiporecepcion,frec_guiades,frec_clfol ,
			frec_tipdesc,frec_origen,frec_numSello,frec_observ,frec_antecamara,frec_olores,frec_higiene,frec_estiba,frec_daado,frec_RecepTunel,frec_contenedor) 
			VALUES 
			(@frec_tipoalmacenamiento,@frec_rutcli,@frec_contcli,@frec_horarec,
			@frec_horater,@frec_fecrec,@frec_tiporecepcion,@frec_guiades,@frec_clfol,
			@frec_tipdesc,@frec_origen,@frec_numSello,@frec_observ,@frec_antecamara,@frec_olores,@frec_higiene,@frec_estiba,@frec_danado,@frec_RecepTunel,@frec_contenedor);
		END TRY	
		BEGIN CATCH	
			ROLLBACK TRANSACTION;
			SELECT @HayError=1;
		END CATCH
	
	IF (@HayError=0) 
	BEGIN
		COMMIT TRANSACTION;
		SELECT @serie = max(frec_codigo) FROM webtmpfichrece
	END
	
END
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[webtmpingrecprod2]
@frec_tipoalmacenamiento	varchar(50),
@frec_rutcli				nvarchar(19),
@frec_contcli				nvarchar(7),
@frec_horarec				nvarchar(5),
@frec_horater				nvarchar(5),
@frec_fecrec				nvarchar(10),
@frec_tiporecepcion			nvarchar(1),
@frec_guiades				nvarchar(8),
@frec_clfol					nvarchar(50),
@frec_tipdesc				nvarchar(1),
@frec_origen				nvarchar(2),
@frec_numSello				nvarchar(25),
@frec_observ				nvarchar(50),
@frec_antecamara			nvarchar(2),
@frec_olores				nvarchar(2),
@frec_higiene				varchar(2),
@frec_estiba				nvarchar(2),
@frec_danado				nvarchar(2),
@frec_RecepTunel			int,
@frec_contenedor			nvarchar(20),
@serie nvarchar(7) output,
@HayError int output

AS
DECLARE @idrece int;
DECLARE @return_value int;
DECLARE @largo int;
DECLARE @codcorre nvarchar(5);
DECLARE @fechhoralleg nvarchar(10);
BEGIN
	SELECT @HayError=0;
	SELECT @codcorre='006';
    SET NOCOUNT ON;
    BEGIN TRANSACTION
    
		
		SELECT @fechhoralleg = convert(nvarchar(5),cl_lleg,108) FROM zCheckList WHERE Cl_fol=@frec_clfol
		
		EXEC @return_value = webgetseriechklst @codcorre;
		SELECT @largo=LEN(@return_value);
		SELECT @serie=REPLICATE('0', 7-@largo)+ltrim(str(@return_value));
		
		BEGIN TRY	
		
		
			INSERT INTO TMPFICHRECE
			(frec_tipoalmacenamiento, frec_rutcli,frec_contcli,frec_horarec,
			frec_fecrec,frec_tipo,frec_guiades,frec_clfol ,frec_horalleg,
			frec_tipdesc,frec_origen,frec_numSello,frec_observ,frec_antecamara,
			frec_olores,frec_higiene,frec_estiba,frec_daado,frec_RecepTunel,
			frec_contenedor,frec_codigo,frec_codi) 
			VALUES
			(@frec_tipoalmacenamiento,@frec_rutcli,@frec_contcli,@frec_horarec,
			@frec_fecrec,@frec_tiporecepcion,@frec_guiades,@frec_clfol,@fechhoralleg,
			@frec_tipdesc,@frec_origen,@frec_numSello,@frec_observ,@frec_antecamara,
			@frec_olores,@frec_higiene,@frec_estiba,@frec_danado,@frec_RecepTunel,
			@frec_contenedor,@serie,@serie);
		END TRY	
		BEGIN CATCH	
			ROLLBACK TRANSACTION;
			SELECT @HayError=1;
		END CATCH
	
	IF (@HayError=0) 
	BEGIN
		COMMIT TRANSACTION;
		SELECT @serie;
	END

END
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE FUNCTION [dbo].[B64aBin](@Base64 VARCHAR(MAX))
RETURNS VARBINARY(MAX)
AS
BEGIN
    DECLARE @Bin VARBINARY(MAX)
    
    /*
        SELECT CONVERT(VARCHAR(MAX), dbo.f_Base64ToBinary('Q29udmVydGluZyB0aGlzIHRleHQgdG8gQmFzZTY0Li4u'))
    */
    
    SET @Bin = CAST(N'' AS XML).value('xs:base64Binary(sql:variable("@Base64"))', 'VARBINARY(MAX)')
 
    RETURN @Bin
END
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE FUNCTION [dbo].[CAJASACUMULADAS](@FECHA1 As varchar(10),@FECHA2 As Varchar(10),@RUT As Varchar(20),@CONTRATO As Varchar(20))  
RETURNS int   
AS   
 
BEGIN  
    DECLARE @diferencia_dias int;
	DECLARE @total int
	DECLARE @i int
	DECLARE @consulta int
	DECLARE @FECHA varchar(20)
	SET @FECHA = @FECHA1
	SET @i = 0
	SET @total = 0
	SET @diferencia_dias = (SELECT DATEDIFF(day, CAST(REPLACE(CONVERT(varchar(10), CAST(@FECHA1 AS DATE), 120),'-','/') AS DATE), CAST(REPLACE(CONVERT(varchar(10), CAST(@FECHA2 AS DATE), 120),'-','/') AS DATE)) )
    
	WHILE (@i <= @diferencia_dias)
      BEGIN  

	SET @consulta = (SELECT isnull(SUM(drec_unidades),0) As RECEPCIONES FROM detarece WHERE drec_fecrec<=REPLACE(CONVERT(varchar(10), CAST(@FECHA AS DATE), 120),'-','/') AND drec_codvig='0' AND drec_rutcli=@RUT AND drec_contcli=@CONTRATO)
      -(SELECT  isnull(SUM(ddes_unidades),0) As DESPACHOS FROM detadespa WHERE ddes_fecha<=REPLACE(CONVERT(varchar(10), CAST(@FECHA AS DATE), 120),'-','/') AND ddes_codvig='0' AND ddes_rutcli=@RUT AND ddes_contcli=@CONTRATO) 
	
	SET @total = @total + @consulta

	  SET @i=@i+1
      SET @FECHA = REPLACE(CONVERT(varchar(10), DATEADD(day,1, CAST(@FECHA AS DATE)), 120),'-','/')
      CONTINUE  
    END  
     
    RETURN @total;  
END; 
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE FUNCTION [dbo].[CodeBase64](@bin VARBINARY(MAX))
RETURNS VARCHAR(MAX)
AS
BEGIN
    DECLARE @Base64 VARCHAR(MAX)
    
    /*
        SELECT dbo.f_BinaryToBase64(CONVERT(VARBINARY(MAX), 'Converting this text to Base64...'))
    */
    
    SET @Base64 = CAST(N'' AS XML).value('xs:base64Binary(xs:hexBinary(sql:variable("@bin")))','VARCHAR(MAX)')
    
    RETURN @Base64
END
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE FUNCTION [dbo].[CREAETIQUETA]
(
	@NE nvarchar(20)
)
 RETURNS nvarchar(20)
 AS
 BEGIN
	DECLARE @DV int;
	DECLARE @Suma int;
	DECLARE @Multiplo int;
	DECLARE @Codigo as nvarchar(20);
	DECLARE @Largo as int;
	DECLARE @Pos int;
	DECLARE @Valor int;
	SET @Largo=len(@NE);
	SET @Suma=0;
	SET @Pos=1;
	WHILE @Pos<=@Largo
	BEGIN
		IF (@Pos % 2)=0	BEGIN SET @Multiplo=1; END
		ELSE			BEGIN SET @Multiplo=3; END
		SET @Valor=convert(int,SUBSTRING(@NE, @Pos, 1)) * @Multiplo
		SELECT @Suma=@Suma+@Valor;
		SET @Pos=@Pos+1;
	END
	
	SET @Suma =(@Suma-(FLOOR(@Suma/10)*10))
	if @Suma>0
	BEGIN
		SET @Suma=10-@Suma;
	END
	SET @Codigo=@NE+convert(nchar(1),@Suma);
	RETURN @Codigo;
 END
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE FUNCTION [dbo].[DIFERENCIA_HORAS]( @FECHA1 varchar(23), @FECHA2 varchar(23))  
RETURNS varchar(8)   
AS   
 
BEGIN  

   DECLARE @FECHA  DATETIME;
   DECLARE @MES1 varchar(2);
   DECLARE @DIA1 varchar(2);
   DECLARE @YEAR1 varchar(4);
   DECLARE @RESTO1 varchar(12);
   DECLARE @MES2 varchar(2);
   DECLARE @DIA2 varchar(2);
   DECLARE @YEAR2 varchar(4);
   DECLARE @RESTO2 varchar(12);
   DECLARE @HORA   varchar(20);

   SET @FECHA1 = (LTRIM(RTRIM(@FECHA1)));
   SET @FECHA2 = (LTRIM(RTRIM(@FECHA2)));

   SET @MES1 = SUBSTRING(@FECHA1,6,2);
   SET @DIA1 = SUBSTRING(@FECHA1,9,2);
   SET @YEAR1 = SUBSTRING(@FECHA1,0,5);
   SET @RESTO1 = SUBSTRING(@FECHA1,12,12);

   SET @FECHA1 = @YEAR1+'-'+@DIA1+'-'+@MES1+' '+@RESTO1;

   SET @MES2 = SUBSTRING(@FECHA2,6,2);
   SET @DIA2 = SUBSTRING(@FECHA2,9,2);
   SET @YEAR2 = SUBSTRING(@FECHA2,0,5);
   SET @RESTO2 = SUBSTRING(@FECHA2,12,12);

   SET @FECHA2 = @YEAR2+'-'+@DIA2+'-'+@MES2+' '+@RESTO2;


   SET @FECHA  = (SELECT CAST(@FECHA2 AS DATETIME)-CAST(@FECHA1 AS DATETIME))
   SET @HORA   = (SELECT CONVERT(varchar(8),@FECHA,108))
       
    RETURN @HORA;  
END; 
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE FUNCTION [dbo].[DIFERENCIA_HORAS_ANDENES](@CODIGO As varchar(10))  
RETURNS varchar(8)   
AS   
 
BEGIN  
   DECLARE @FECHA1 varchar(30);
   DECLARE @FECHA2 varchar(30);
   DECLARE @FECHA  datetime;
   DECLARE @HORA   varchar(8);
   SET @CODIGO = (LTRIM(RTRIM(@CODIGO)));

   SET @FECHA1 = (SELECT TOP(1) FECHA FROM VW_ANDENES WHERE ORDEN =@CODIGO AND MOVIMIENTO='APERTURA' ORDER BY ORDEN DESC);
   SET @FECHA2 = (SELECT TOP(1) FECHA FROM VW_ANDENES WHERE ORDEN =@CODIGO AND MOVIMIENTO='CIERRE' ORDER BY ORDEN DESC);


   SET @FECHA  = (SELECT CAST(@FECHA2 AS DATETIME)-CAST(@FECHA1 AS DATETIME))
   SET @HORA   = (SELECT CONVERT(varchar(8),@FECHA,108))
       
    RETURN @HORA;  
END; 
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE FUNCTION [dbo].[DIFERENCIA_HORAS_ANDENES_RECE](@CODIGO As varchar(10))  

RETURNS varchar(8)   
AS   
 
BEGIN  
   DECLARE @FECHA1 varchar(30);
   DECLARE @FECHA2 varchar(30);
   DECLARE @FECHA  datetime;
   DECLARE @HORA   varchar(8);
   SET @CODIGO = (LTRIM(RTRIM(@CODIGO)));

   SET @FECHA1 = (SELECT TOP(1) FECHA FROM VW_ANDENES_RECE WHERE FOLIO =@CODIGO AND MOVIMIENTO='APERTURA' ORDER BY FOLIO DESC);
   SET @FECHA2 = (SELECT TOP(1) FECHA FROM VW_ANDENES_RECE WHERE FOLIO =@CODIGO AND MOVIMIENTO='CIERRE' ORDER BY FOLIO DESC);


   SET @FECHA  = (SELECT CAST(@FECHA2 AS DATETIME)-CAST(@FECHA1 AS DATETIME))
   SET @HORA   = (SELECT CONVERT(varchar(8),@FECHA,108))
       
    RETURN @HORA;  
END; 
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE FUNCTION [dbo].[f_BinaryToBase64](@bin VARBINARY(MAX))
RETURNS VARCHAR(MAX)
AS
BEGIN
    DECLARE @Base64 VARCHAR(MAX)
    
    /*
        SELECT dbo.f_BinaryToBase64(CONVERT(VARBINARY(MAX), 'Converting this text to Base64...'))
    */
    
    SET @Base64 = CAST(N'' AS XML).value('xs:base64Binary(xs:hexBinary(sql:variable("@bin")))','VARCHAR(MAX)')
    
    RETURN @Base64
END
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO



CREATE FUNCTION [dbo].[FN_EXISTE_ESCSERV] (@CONT_RUTCLIE VARCHAR(9))
RETURNS INT AS
BEGIN


    DECLARE @EXISTE AS BIT
    SET @EXISTE = 0

    IF EXISTS(SELECT ESCALASERV.ESCCONTR FROM ESCALASERV INNER JOIN CONTRATO ON ESCALASERV.ESCCONTR =
CONTRATO.CONT_CODI WHERE CONTRATO.CONT_RUTCLIE = @CONT_RUTCLIE)
        SET @EXISTE = 1
    ELSE
        SET @EXISTE = 0

    RETURN @EXISTE

END



GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO


CREATE FUNCTION [dbo].[FN_RET_ULTDIAMES] (@AO INT, @MES AS INT )
RETURNS INT  AS
BEGIN

    DECLARE @DIA AS INT
    SET @DIA = 0

    IF @MES = 1
        SET @DIA = 31
    ELSE
        IF @MES = 2
            IF @AO % 4  = 0
                SET @DIA = 29
            ELSE
                SET @DIA = 28
        ELSE
            IF @MES = 3
                SET @DIA = 31
            ELSE
                IF @MES = 4
                    SET @DIA = 30
                ELSE
                    IF @MES = 5
                        SET @DIA = 31
                    ELSE
                        IF @MES = 6
                            SET @DIA = 30
                        ELSE
                            IF @MES = 7
                                SET @DIA = 31
                            ELSE
                                IF @MES = 8
                                    SET @DIA = 31
                                ELSE
                                    IF @MES = 9
                                        SET @DIA = 30
                                    ELSE
                                        IF @MES = 10
                                            SET @DIA = 31
                                        ELSE
                                            IF @MES = 11
                                                SET @DIA = 30
                                            ELSE
                                                IF @MES = 12
                                                    SET @DIA = 31

    RETURN @DIA

END






GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE FUNCTION [dbo].[FOTOSPIC](@CAMARA AS VARCHAR(4),@CORD AS VARCHAR (5),@PISO AS VARCHAR(3))  
RETURNS @DATOS TABLE 
(
TIPOP VARCHAR(50),
PISO INT,
CANTIDAD INT
)
AS   
BEGIN

DECLARE @I INT 
	DECLARE @CONSULTA varchar(50);
	DECLARE @CONSULTA2 varchar(20);
	DECLARE @TIPOP VARCHAR(40);
	DECLARE @COUN INT
		 
		 SET @I =1
		

		  
		  SET @CONSULTA = (SELECT  tipopallet from VG_PARAFOTO  where racd_ca=@CAMARA and  cordenada=@cord AND racd_pi=@PISO GROUP BY tipopallet );
		  
	      SET @CONSULTA2 =(SELECT COUNT(tipopallet)AS CO  from VG_PARAFOTO  where racd_ca=@CAMARA and  cordenada=@cord AND racd_pi=@PISO );

		   SET @COUN =ROUND(@CONSULTA2,0)

	  INSERT INTO @DATOS VALUES (@CONSULTA,@piso,@COUN)



	
    RETURN;  
END; 
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE FUNCTION [dbo].[FOTOSPISOS](@CAMARA AS VARCHAR(4),@CORD AS VARCHAR (5))  
RETURNS @DATOS TABLE 
(

TIPOP VARCHAR(50),
PISO INT,
CANTIDAD INT

)
AS   
BEGIN
   DECLARE @I INT 
	DECLARE @CONSULTA varchar(50);
	DECLARE @CONSULTA2 varchar(20);
	DECLARE @TIPOP VARCHAR(40);
	DECLARE @COUN INT
		 
		 SET @I =1
		
WHILE(@I <8)
		  BEGIN
		  
		  SET @CONSULTA = (SELECT  tipopallet from VG_PARAFOTO  where racd_ca=@CAMARA and  cordenada=@cord AND racd_pi=@I GROUP BY tipopallet );
		  
	      SET @CONSULTA2 =(SELECT COUNT(tipopallet)AS CO  from VG_PARAFOTO  where racd_ca=@CAMARA and  cordenada=@cord AND racd_pi=@I );

		   SET @COUN =ROUND(@CONSULTA2,0)

	  INSERT INTO @DATOS VALUES (@CONSULTA,@I,@COUN)
	  SET @I = @I+1;
	CONTINUE;
	END
RETURN;
END;
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

CREATE FUNCTION [dbo].[PESAJE_PRODUCTOS] (@GUIA AS VARCHAR(10))  
RETURNS @DATOS TABLE 
(
DESCRIPCION VARCHAR(40),
KILOS VARCHAR(10),
CAJAS VARCHAR (10),
GUIA VARCHAR(10)
)
AS   
BEGIN



	DECLARE @PESO_GUIA_1 VARCHAR(10)
	DECLARE @PESO_GUIA_2 VARCHAR(10)
	DECLARE @PESO_GUIA_3 VARCHAR(10)
	DECLARE @CAJA_GUIA_1 VARCHAR(10)
	DECLARE @CAJA_GUIA_2 VARCHAR(10)
	DECLARE @CAJA_GUIA_3 VARCHAR(10)
	DECLARE @DESCRIPCION_1 VARCHAR(100)
	DECLARE @DESCRIPCION_2 VARCHAR(100)
	DECLARE @DESCRIPCION_3 VARCHAR(100)
	DECLARE @GUIA_2 VARCHAR(7)
	DECLARE @CONTENEDOR VARCHAR(50)
	DECLARE @RUTGUIA VARCHAR(15)
	DECLARE @DIFERENCIA1_PESO VARCHAR(10)
	DECLARE @DIFERENCIA2_PESO VARCHAR(10)
	DECLARE @DIFERENCIA1_CAJA VARCHAR(10)
	DECLARE @DIFERENCIA2_CAJA VARCHAR(10)

	/*OBTENGO EL CONTENEDOR Y RUT DE LA GUIA DE INGRESO NUMERO 1 PARA PODER OBTENER LOS DATOS DE LA SEGUNDA GUIA*/
	SET @CONTENEDOR = CAST((SELECT frec_contenedor FROM fichrece WHERE frec_codi=@GUIA) AS VARCHAR);
	SET @RUTGUIA    = CAST((SELECT frec_rutcli FROM fichrece WHERE frec_codi=@GUIA) AS VARCHAR);
	SET @GUIA_2     = CAST((SELECT frec_codi FROM fichrece WHERE frec_codi!=@GUIA AND frec_contenedor=@CONTENEDOR AND frec_rutcli=@RUTGUIA) AS VARCHAR);
	
	SET @PESO_GUIA_1 = CAST((SELECT SUM(drec_peso) FROM detarece WHERE frec_codi1=@GUIA) AS VARCHAR);
	SET @PESO_GUIA_2 = CAST((SELECT SUM(drec_peso) FROM detarece WHERE frec_codi1=@GUIA_2) AS VARCHAR);
	SET @PESO_GUIA_3 = CAST((SELECT kilos_guia FROM fichrece WHERE frec_codi=@GUIA) AS VARCHAR);

	SET @CAJA_GUIA_1 = CAST((SELECT SUM(drec_unidades) FROM detarece WHERE frec_codi1=@GUIA) AS VARCHAR);
	SET @CAJA_GUIA_2 = CAST((SELECT SUM(drec_unidades) FROM detarece WHERE frec_codi1=@GUIA_2) AS VARCHAR);
	SET @CAJA_GUIA_3 = CAST((SELECT uni_guia FROM fichrece WHERE frec_codi=@GUIA) AS VARCHAR);

	SET @DESCRIPCION_1 = 'GUIA ANTES DE PROCESO: '+@GUIA;
	SET @DESCRIPCION_2 = 'GUIA DESPUES DE PROCESO: '+@GUIA_2;
	SET @DESCRIPCION_3 = 'GUIA DE CLIENTE';


   SET @DIFERENCIA1_PESO = (ISNULL(CAST(@PESO_GUIA_3 AS INT),0)-ISNULL(CAST(@PESO_GUIA_1 AS INT),0))
   SET @DIFERENCIA2_PESO = (ISNULL(CAST(@PESO_GUIA_3 AS INT),0)-ISNULL(CAST(@PESO_GUIA_2 AS INT),0))

   SET @DIFERENCIA1_CAJA = (ISNULL(CAST(@CAJA_GUIA_3 AS INT),0)-ISNULL(CAST(@CAJA_GUIA_1 AS INT),0))
   SET @DIFERENCIA2_CAJA = (ISNULL(CAST(@CAJA_GUIA_3 AS INT),0)-ISNULL(CAST(@CAJA_GUIA_2 AS INT),0))

	INSERT INTO @DATOS VALUES (@DESCRIPCION_3,@PESO_GUIA_3,@CAJA_GUIA_3,'')
	INSERT INTO @DATOS VALUES (@DESCRIPCION_1,@PESO_GUIA_1,@CAJA_GUIA_1,@GUIA)
	/*INSERT INTO @DATOS VALUES ('DIFERENCIA CON GUIA DE CLIENTE',@DIFERENCIA1_PESO,@DIFERENCIA1_CAJA)*/
	INSERT INTO @DATOS VALUES (@DESCRIPCION_2,@PESO_GUIA_2,@CAJA_GUIA_2,@GUIA_2)
	/*INSERT INTO @DATOS VALUES ('DIFERENCIA CON GUIA DE CLIENTE',@DIFERENCIA2_PESO,@DIFERENCIA2_CAJA)*/
     
    RETURN;  
END; 
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE FUNCTION [dbo].[PROMEDIO_SOPORTANTES](@DIAS AS INT,@MES AS VARCHAR (2),@YEAR AS VARCHAR(4),@CONTRATO AS VARCHAR (20),@CLIENTE AS VARCHAR (9))  
RETURNS @DATOS TABLE 
(
PROMEDIO  INT,
NUMERO INT
)
AS   
BEGIN

    DECLARE @I int;
	DECLARE @SOPORTANTES int;
	DECLARE @FECHA_ACTUAL DATE;
    DECLARE @FECHA_INICIAL varchar(10);
	DECLARE @FECHA_FINAL DATE;
	DECLARE @NUMERO int;
	DECLARE @D int;
	DECLARE @DI varchar(10);
	DECLARE @FECHA varchar(10);
	DECLARE @CONSULTA varchar(10);
	DECLARE @RESULTADO int;
	DECLARE @PROMEDIO int;

	SET @I            = 1;
	SET @SOPORTANTES  = 0;
	SET @FECHA_ACTUAL = CAST((SELECT CAST(YEAR(GETDATE()) AS VARCHAR)+'/'+CAST(MONTH(GETDATE()) AS VARCHAR)+'/'+CAST(DAY(GETDATE()) AS VARCHAR)) AS DATE);
	SET @NUMERO       = 0;
	SET @PROMEDIO        = 0;

    
	WHILE (@I <= @DIAS)
      BEGIN  
	  SET @D = @I;

	  IF (@D<10) 
	  SET @DI = '0'+CAST(@D AS VARCHAR); 
	  ELSE 
	  SET @DI = CAST(@D AS VARCHAR); 
	  /*END IF*/
	  
	  SET @FECHA = @YEAR+'/'+@MES+'/'+@DI
	  SET @FECHA_FINAL = CAST(@FECHA AS DATE)


	  IF (@CONTRATO = 'TODOS')
	  SET @CONSULTA = (SELECT (SELECT isnull(SUM(drec_pallet),0) As RECEPCIONES FROM detarece WHERE drec_fecrec<=@FECHA AND drec_codvig='0' AND drec_rutcli=@CLIENTE)
                    -(SELECT  isnull(SUM(ddes_pallet),0) As DESPACHOS FROM detadespa WHERE ddes_fecha<=@FECHA
                     AND ddes_codvig='0' AND ddes_rutcli=@CLIENTE) AS SOPORTANTES);
      ELSE
      SET @CONSULTA = (SELECT (SELECT isnull(SUM(drec_pallet),0) As RECEPCIONES FROM detarece WHERE drec_fecrec<=@FECHA AND drec_codvig='0' 
                        AND drec_rutcli=@CLIENTE AND drec_contcli=@CONTRATO)-(SELECT  isnull(SUM(ddes_pallet),0) As DESPACHOS FROM detadespa WHERE ddes_fecha<=@FECHA 
                     AND ddes_codvig='0' AND ddes_rutcli=@CLIENTE AND ddes_contcli=@CONTRATO) AS SOPORTANTES);
      /*END IF*/

	    
		IF (@FECHA_ACTUAL<@FECHA_FINAL)
	       SET @SOPORTANTES = @SOPORTANTES+0;
        ELSE
	      IF (@CONSULTA < > '' AND @CONSULTA < > '0')
			BEGIN
              SET @SOPORTANTES = @SOPORTANTES+CAST(@CONSULTA AS INT);
              SET @NUMERO = @NUMERO+1;
		     END
          /*END IF*/
		/*END IF*/
	

	  SET @I = @I+1;

	  IF(@NUMERO>0) 
	  BEGIN
        SET @PROMEDIO = ROUND((@SOPORTANTES / @NUMERO),0);
	  END
	  /*END IF*/



      CONTINUE  
    END  

	

	INSERT INTO @DATOS VALUES (@PROMEDIO,@NUMERO)
     
    RETURN;  
END; 
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

CREATE FUNCTION [dbo].[QRY_KARDEX](@FECINI AS DATETIME, @FECTER AS DATETIME, @CONT AS VARCHAR(9), @CLIENTE AS VARCHAR(9))

RETURNS @TABLA TABLE( 
FECHA VARCHAR(10) NOT NULL,  ENTRADA NUMERIC(18,0) NOT NULL, SALIDA NUMERIC(18,0) NOT NULL, 
SALDO NUMERIC(18,0) NOT NULL, EKIL FLOAT NOT NULL, SKIL FLOAT NOT NULL, S2KIL FLOAT NOT NULL)
AS 

BEGIN		

		DECLARE @ENT AS NUMERIC(18,0)
		DECLARE @SAL AS NUMERIC(18,0)
		DECLARE @SAL2 AS NUMERIC(18,0)
		
		DECLARE @KENT AS float
		DECLARE @KSAL AS float
		DECLARE @KSAL2 AS float
		
IF @CONT=''
	BEGIN
	
		SELECT @KENT = SUM(drec_peso) FROM detarece WHERE drec_rutcli=@CLIENTE AND convert(date,drec_fecrec,111)<convert(varchar(10),@FECINI,111) AND drec_pallet='1'
		SELECT @KSAL = SUM(ddes_peso) FROM detadespa WHERE ddes_rutcli=@CLIENTE AND  convert(date,ddes_fecha,111)<convert(varchar(10),@FECINI,111)  
		
		SELECT @ENT = SUM(drec_pallet) FROM detarece WHERE drec_rutcli=@CLIENTE AND convert(date,drec_fecrec,111)<convert(date,@FECINI,111) AND drec_pallet='1'
		SELECT @SAL = SUM(ddes_pallet) FROM detadespa WHERE ddes_rutcli=@CLIENTE AND  convert(date,ddes_fecha,111)<convert(date,@FECINI,111) 
		
		SET @SAL2=@ENT-@SAL
		SET @KSAL2=@KENT-@KSAL
		
		WHILE(@FECINI<=@FECTER)
			BEGIN 
			
				SELECT @ENT = SUM(drec_pallet) FROM detarece WHERE drec_rutcli=@CLIENTE AND drec_fecrec=convert(varchar(10),@FECINI,111) AND drec_pallet='1'
				SELECT @SAL = SUM(ddes_pallet) FROM detadespa WHERE ddes_rutcli=@CLIENTE AND  ddes_FECHA=convert(varchar(10),@FECINI,111)  
				SET @SAL2=(ISNULL(@SAL2,0)+ISNULL(@ENT,0))-ISNULL(@SAL,0)
			
				SELECT @KENT = SUM(drec_peso) FROM detarece WHERE drec_rutcli=@CLIENTE AND drec_fecrec=convert(varchar(10),@FECINI,111) AND drec_pallet='1'
				SELECT @KSAL = SUM(ddes_peso) FROM detadespa WHERE ddes_rutcli=@CLIENTE AND  ddes_FECHA=convert(varchar(10),@FECINI,111)  
				SET @KSAL2=(ISNULL(@KSAL2,0)+ISNULL(@KENT,0))-ISNULL(@KSAL,0)
		
				INSERT INTO @TABLA VALUES(convert(varchar(10),@FECINI,111),ISNULL(@ENT,0),ISNULL(@SAL,0),isnull(@SAL2,0), isnull(ROUND(@KENT,2),0), isnull(ROUND(@KSAL,2),0),isnull(ROUND(@KSAL2,2),0))
				SET @ENT=0
				SET @SAL=0
				SET @FECINI=DATEADD(DAY,1,@FECINI)
			END 

	END
ELSE
	BEGIN 
		SELECT @KENT = SUM(drec_peso) FROM detarece WHERE drec_contcli=@CONT AND drec_fecrec<convert(varchar(10),@FECINI,111) AND drec_pallet='1'
		SELECT @KSAL = SUM(ddes_peso) FROM detadespa WHERE ddes_contcli=@CONT AND  ddes_fecha<convert(varchar(10),@FECINI,111)  
		
		SELECT @ENT = SUM(drec_pallet) FROM detarece WHERE drec_contcli=@CONT AND drec_fecrec<convert(varchar(10),DATEADD(DAY,-1,@FECINI),111) AND drec_pallet='1'
		SELECT @SAL = SUM(ddes_pallet) FROM detadespa WHERE ddes_contcli=@CONT AND  ddes_FECHA<convert(varchar(10),DATEADD(DAY,-1,@FECINI),111)  
		
		SET @SAL2=@ENT-@SAL
		SET @KSAL2=@KENT-@KSAL
		
		WHILE(@FECINI<=@FECTER)
			BEGIN 
			
				SELECT @ENT = SUM(drec_pallet) FROM detarece WHERE drec_contcli=@CONT AND drec_fecrec=convert(varchar(10),@FECINI,111) AND drec_pallet='1'
				SELECT @SAL = SUM(ddes_pallet) FROM detadespa WHERE ddes_contcli=@CONT AND  ddes_FECHA=convert(varchar(10),@FECINI,111)  
				SET @SAL2=(ISNULL(@SAL2,0)+ISNULL(@ENT,0))-ISNULL(@SAL,0)
			
				SELECT @KENT = SUM(drec_peso) FROM detarece WHERE drec_contcli=@CONT AND drec_fecrec=convert(varchar(10),@FECINI,111) AND drec_pallet='1'
				SELECT @KSAL = SUM(ddes_peso) FROM detadespa WHERE ddes_contcli=@CONT AND  ddes_FECHA=convert(varchar(10),@FECINI,111)  
				SET @KSAL2=(ISNULL(@KSAL2,0)+ISNULL(@KENT,0))-ISNULL(@KSAL,0)
		
				INSERT INTO @TABLA VALUES(convert(varchar(10),@FECINI,111),ISNULL(@ENT,0),ISNULL(@SAL,0),isnull(@SAL2,0), isnull(ROUND(@KENT,2),0), isnull(ROUND(@KSAL,2),0),isnull(ROUND(@KSAL2,2),0))
				SET @ENT=0
				SET @SAL=0
				SET @FECINI=DATEADD(DAY,1,@FECINI)
			END 
	END
	RETURN 
END

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

CREATE FUNCTION [dbo].[QRY_KARDEXCONGRACIA](@FECINI AS DATETIME, @FECTER AS DATETIME, @CONT AS VARCHAR(9), @CLIENTE AS VARCHAR(9), @GRACIA AS INTEGER)
-- ENVIAR DIA DE GRACIA COMO NEGATIVO
RETURNS @TABLA TABLE( 
FECHA VARCHAR(10) NOT NULL,  ENTRADA NUMERIC(18,0) NOT NULL, SALIDA NUMERIC(18,0) NOT NULL, 
SALDO NUMERIC(18,0) NOT NULL, EKIL FLOAT NOT NULL, SKIL FLOAT NOT NULL, S2KIL FLOAT NOT NULL)
AS 

BEGIN		

		DECLARE @ENT AS NUMERIC(18,0)
		DECLARE @SAL AS NUMERIC(18,0)
		DECLARE @SAL2 AS NUMERIC(18,0)
		
		DECLARE @KENT AS float
		DECLARE @KSAL AS float
		DECLARE @KSAL2 AS float
		
IF @CONT=''
	BEGIN
	
		--SELECT @KENT = SUM(drec_peso) FROM detarece WHERE drec_rutcli=@CLIENTE AND drec_fecrec<convert(varchar(10),@FECINI,111) AND drec_pallet='1'
			-- TOTAL DE ENTRADAS A LA FECHA , Y LO CON TUNEL A (FECHA-GRACIA)
			SELECT @ENT = isnull(SUM(drec_pallet),0) FROM detarece WHERE drec_rutcli=@CLIENTE AND drec_fecrec<convert(varchar(10),@FECINI,111) AND drec_pallet='1' AND drec_RecepTunel<>'2'
			SELECT @ENT = @ENT+isnull(SUM(drec_pallet),0) FROM detarece WHERE drec_rutcli=@CLIENTE AND drec_fecrec<convert(varchar(10),DATEADD(DAY,@GRACIA,@FECINI),111) AND drec_pallet='1' AND drec_RecepTunel='2'
			
			SELECT @SAL = isnull(SUM(ddes_pallet),0) FROM detadespa WHERE ddes_rutcli=@CLIENTE AND  ddes_FECHA<convert(varchar(10),@FECINI,111)  
			
			SELECT @KENT = SUM(drec_peso) FROM detarece WHERE drec_rutcli=@CLIENTE AND drec_fecrec<convert(varchar(10),DATEADD(DAY, @GRACIA,@FECINI),111) AND drec_pallet='1' AND drec_RecepTunel<>'2'
			SELECT @KENT = @KENT+isnull(SUM(drec_peso),0) FROM detarece WHERE drec_rutcli=@CLIENTE AND drec_fecrec<convert(varchar(10),DATEADD(DAY,@GRACIA,@FECINI),111) AND drec_pallet='1' AND drec_RecepTunel='2'
			
			SELECT @KSAL = isnull(SUM(ddes_peso),0) FROM detadespa WHERE ddes_rutcli=@CLIENTE AND  ddes_fecha<convert(varchar(10),@FECINI,111)  
			
			
			SET @SAL2=@ENT-@SAL
			SET @KSAL2=@KENT-@KSAL
		
		WHILE(@FECINI<=@FECTER)
			BEGIN 
				SELECT @ENT = isnull(SUM(drec_pallet),0) FROM detarece WHERE drec_rutcli=@CLIENTE AND drec_fecrec=convert(varchar(10),@FECINI,111) AND drec_pallet='1' AND drec_RecepTunel<>'2'
				SELECT @ENT = @ENT+isnull(SUM(drec_pallet),0) FROM detarece WHERE drec_rutcli=@CLIENTE AND drec_fecrec=convert(varchar(10),DATEADD(DAY,@GRACIA,@FECINI),111) AND drec_pallet='1' AND drec_RecepTunel='2'
				
				SELECT @SAL = SUM(ddes_pallet) FROM detadespa WHERE ddes_rutcli=@CLIENTE AND ddes_fecha=convert(varchar(10),@FECINI,111)  
				SET @SAL2=(ISNULL(@SAL2,0)+ISNULL(@ENT,0))-ISNULL(@SAL,0)
			
				SELECT @KENT = SUM(drec_peso) FROM detarece WHERE drec_rutcli=@CLIENTE AND drec_fecrec=convert(varchar(10),@FECINI,111) AND drec_pallet='1' AND drec_RecepTunel<>'2'
				SELECT @KENT = @KENT+isnull(SUM(drec_peso),0) FROM detarece WHERE drec_rutcli=@CLIENTE AND drec_fecrec=convert(varchar(10),DATEADD(DAY,@GRACIA,@FECINI),111) AND drec_pallet='1' AND drec_RecepTunel='2'
			
				SELECT @KSAL = SUM(ddes_peso) FROM detadespa WHERE ddes_rutcli=@CLIENTE AND  ddes_fecha=convert(varchar(10),@FECINI,111)  
				SET @KSAL2=(ISNULL(@KSAL2,0)+ISNULL(@KENT,0))-ISNULL(@KSAL,0)
		
				INSERT INTO @TABLA VALUES(convert(varchar(10),@FECINI,111),ISNULL(@ENT,0),ISNULL(@SAL,0),isnull(@SAL2,0), isnull(ROUND(@KENT,2),0), isnull(ROUND(@KSAL,2),0),isnull(ROUND(@KSAL2,2),0))
				SET @ENT=0
				SET @SAL=0
				SET @FECINI=DATEADD(DAY,1,@FECINI)
			END 

	END
ELSE
	BEGIN 
	
			-- TOTAL DE ENTRADAS A LA FECHA , Y LO CON TUNEL A (FECHA-GRACIA)
			SELECT @ENT = isnull(SUM(drec_pallet),0) FROM detarece WHERE drec_contcli=@CONT AND drec_fecrec<convert(varchar(10),@FECINI,111) AND drec_pallet='1' AND drec_RecepTunel<>'2'
			SELECT @ENT = @ENT+isnull(SUM(drec_pallet),0) FROM detarece WHERE drec_contcli=@CONT AND drec_fecrec<convert(varchar(10),DATEADD(DAY,@GRACIA,@FECINI),111) AND drec_pallet='1' AND drec_RecepTunel='2'
			
			SELECT @SAL = isnull(SUM(ddes_pallet),0) FROM detadespa WHERE ddes_contcli=@CONT AND  ddes_FECHA<convert(varchar(10),@FECINI,111)  
			
			SELECT @KENT = SUM(drec_peso) FROM detarece WHERE drec_contcli=@CONT AND drec_fecrec<convert(varchar(10),DATEADD(DAY, @GRACIA,@FECINI),111) AND drec_pallet='1' AND drec_RecepTunel<>'2'
			SELECT @KENT = @KENT+isnull(SUM(drec_peso),0) FROM detarece WHERE drec_contcli=@CONT AND drec_fecrec<convert(varchar(10),DATEADD(DAY,@GRACIA,@FECINI),111) AND drec_pallet='1' AND drec_RecepTunel='2'
			
			SELECT @KSAL = isnull(SUM(ddes_peso),0) FROM detadespa WHERE ddes_contcli=@CONT AND  ddes_fecha<convert(varchar(10),@FECINI,111)  
			
			
			SET @SAL2=@ENT-@SAL
			SET @KSAL2=@KENT-@KSAL
		
		WHILE(@FECINI<=@FECTER)
			BEGIN 
				SELECT @ENT = isnull(SUM(drec_pallet),0) FROM detarece WHERE drec_contcli=@CONT AND drec_fecrec=convert(varchar(10),@FECINI,111) AND drec_pallet='1' AND drec_RecepTunel<>'2'
				SELECT @ENT = @ENT+isnull(SUM(drec_pallet),0) FROM detarece WHERE drec_contcli=@CONT AND drec_fecrec=convert(varchar(10),DATEADD(DAY,@GRACIA,@FECINI),111) AND drec_pallet='1' AND drec_RecepTunel='2'
				
				SELECT @SAL = SUM(ddes_pallet) FROM detadespa WHERE ddes_contcli=@CONT AND ddes_fecha=convert(varchar(10),@FECINI,111)  
				SET @SAL2=(ISNULL(@SAL2,0)+ISNULL(@ENT,0))-ISNULL(@SAL,0)
			
				SELECT @KENT = SUM(drec_peso) FROM detarece WHERE drec_contcli=@CONT AND drec_fecrec=convert(varchar(10),@FECINI,111) AND drec_pallet='1' AND drec_RecepTunel<>'2'
				SELECT @KENT = @KENT+isnull(SUM(drec_peso),0) FROM detarece WHERE drec_contcli=@CONT AND drec_fecrec=convert(varchar(10),DATEADD(DAY,@GRACIA,@FECINI),111) AND drec_pallet='1' AND drec_RecepTunel='2'
			
				SELECT @KSAL = ISNULL(SUM(ddes_peso),0)  FROM detadespa WHERE ddes_contcli=@CONT AND  ddes_fecha=convert(varchar(10),@FECINI,111)  
				SET @KSAL2=(ISNULL(@KSAL2,0)+ISNULL(@KENT,0))-ISNULL(@KSAL,0)
		
				INSERT INTO @TABLA VALUES(convert(varchar(10),@FECINI,111),ISNULL(@ENT,0),ISNULL(@SAL,0),isnull(@SAL2,0), isnull(ROUND(@KENT,2),0), isnull(ROUND(@KSAL,2),0),isnull(ROUND(@KSAL2,2),0))
				SET @ENT=0
				SET @SAL=0
				SET @FECINI=DATEADD(DAY,1,@FECINI)
			END 
	END
	RETURN 
END



--DECLARE @KENT AS FLOAT
--DECLARE @KSAL AS FLOAT
--DECLARE @FECINI AS DATETIME 
--DECLARE @FECTER AS DATETIME
--DECLARE @CONT AS VARCHAR(9)
--DECLARE @GRACIA AS INTEGER
--set @FECINI='01-07-2014 16:53:11'
--SET @CONT='0002730'
--SET @GRACIA=0

--SELECT @KENT = SUM(drec_peso) FROM detarece WHERE drec_contcli=@CONT AND drec_fecrec<convert(varchar(10),DATEADD(DAY, @GRACIA,@FECINI),111) AND drec_pallet='1' AND drec_RecepTunel<>'2'
--SELECT @KENT = @KENT+isnull(SUM(drec_peso),0) FROM detarece WHERE drec_contcli=@CONT AND drec_fecrec<convert(varchar(10),DATEADD(DAY,@GRACIA,@FECINI),111) AND drec_pallet='1' AND drec_RecepTunel='2'
--SELECT @KSAL= ISNULL(SUM(ddes_peso),0) FROM detadespa WHERE ddes_contcli=@CONT AND  ddes_fecha<convert(varchar(10),@FECINI,111)  
			
--SELECT @KENT
--SELECT @KSAL

--SELECT * FROM dbo.QRY_KARDEXCONGRACIA(, '31-07-2014 16:53:11', '0002730','',0)
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE FUNCTION [dbo].[QRY_SOPORTANTES_DESPACHO](@PEDIDO AS numeric(18,0), @PALLETS AS VARCHAR(MAX), @SOPORTANTES AS INTEGER, @INICIAL AS INTEGER, @val AS VARCHAR(MAX))

RETURNS @TABLA TABLE( 
SOPORTANTE VARCHAR(9) NOT NULL, 
CAJASCONCAT TEXT NOT NULL

)  
AS 
 BEGIN

  SELECT @PALLETS=@PALLETS+''+dpc_numpal FROM DetaReceCajasped WHERE dpc_codped=@PEDIDO GROUP BY dpc_numpal
  		WHILE (@SOPORTANTES>0)
			BEGIN
			--PRINT SUBSTRING(@PALLETS,@INICIAL,7)
			IF (SELECT COUNT(*) FROM DetaReceCajasped WHERE dpc_numpal=SUBSTRING(@PALLETS,@INICIAL,9) AND dpc_codped=@PEDIDO) > 0 
					BEGIN
						SELECT @val=@val +'  -  '+dpc_codcaja 
						FROM DetaReceCajasped INNER JOIN detarece ON drec_codi=dpc_numpal INNER JOIN maeprod ON drec_codpro=mae_codi WHERE dpc_numpal=SUBSTRING(@PALLETS,@INICIAL,9) AND dpc_codped=@PEDIDO
					
						SET @val = SUBSTRING(@val,6,LEN(@val))
					
						INSERT INTO @TABLA VALUES(SUBSTRING(@PALLETS,@INICIAL,9),@val)
						SET @val=''
					END
			--ELSE
			--		BEGIN 
			--			INSERT INTO @TABLA VALUES('CAGE','LOL')
			--		END			
					
				SET @SOPORTANTES=@SOPORTANTES-1
				SET @INICIAL=@INICIAL+9
			END
			RETURN 
		END	
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE FUNCTION [dbo].[QRY_SOPORTANTES_TRAQUEO](@RECEPCION AS VARCHAR(15),@PALLETS AS VARCHAR(MAX), @SOPORTANTES AS INTEGER, @INICIAL AS INTEGER, @val AS VARCHAR(MAX))

RETURNS @TABLA TABLE( 
SOPORTANTE VARCHAR(9) NOT NULL, 
CAJASCONCAT VARCHAR(MAX) NOT NULL
)  
AS
 BEGIN
 
 IF (SELECT COUNT(*) from DetaReceCajas WHERE  LEFT(Caj_Pcod,7)=@recepcion)>0 
 BEGIN
  SELECT @PALLETS=@PALLETS+''+drec_codi FROM detarece WHERE frec_codi1=@RECEPCION
  		WHILE (@SOPORTANTES>0)
			BEGIN
			--PRINT SUBSTRING(@PALLETS,@INICIAL,7)
			--IF (SELECT COUNT(*) FROM DetaReceCajas WHERE Caj_Pcod=SUBSTRING(@PALLETS,@INICIAL,9)) > 0 
			--		BEGIN
						SELECT @val=@val +'  -  '+Caj_cod   --, Caj_Pcod, drec_codpro, mae_descr, drec_unidades, drec_peso 
						FROM DetaReceCajas INNER JOIN detarece ON drec_codi=Caj_Pcod INNER JOIN maeprod ON drec_codpro=mae_codi WHERE Caj_Pcod=SUBSTRING(@PALLETS,@INICIAL,9) --AND Caj_Pcod=@RECEPCION		
					
						SET @val = SUBSTRING(@val,6,LEN(@val))
					
						INSERT INTO @TABLA VALUES(SUBSTRING(@PALLETS,@INICIAL,9),@val)
						SET @val=''
					--END			
				SET @SOPORTANTES=@SOPORTANTES-1
				SET @INICIAL=@INICIAL+9
			END
		END	
		RETURN 
END
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE FUNCTION [dbo].[QRY_SOPORTANTES_TRAQUEO_nvo](@RECEPCION AS VARCHAR(15),@PALLETS AS VARCHAR(MAX), @SOPORTANTES AS INTEGER, @INICIAL AS INTEGER, @val AS VARCHAR(MAX))

RETURNS @TABLA TABLE( 
SOPORTANTE VARCHAR(9) NOT NULL, 
CAJASCONCAT VARCHAR(MAX) NOT NULL
)  
AS
 BEGIN
 
 IF (SELECT COUNT(*) from DetaReceCajas WHERE  LEFT(Caj_Pcod,7)=@recepcion)>0 
 BEGIN
  SELECT @PALLETS=@PALLETS+''+drec_codi FROM detarece WHERE frec_codi1=@RECEPCION
  		WHILE (@SOPORTANTES>0)
			BEGIN
			--PRINT SUBSTRING(@PALLETS,@INICIAL,7)
			--iF (SELECT COUNT(*) FROM DetaReceCajas WHERE Caj_Pcod=SUBSTRING(@PALLETS,@INICIAL,9)) > 0 
			--		BEGIN
						SELECT @val=@val +'  -  '+Caj_cod   --, Caj_Pcod, drec_codpro, mae_descr, drec_unidades, drec_peso 
						FROM DetaReceCajas INNER JOIN detarece ON drec_codi=Caj_Pcod INNER JOIN maeprod ON drec_codpro=mae_codi WHERE Caj_Pcod=SUBSTRING(@PALLETS,@INICIAL,9) --AND Caj_Pcod=@RECEPCION		
					
						SET @val = SUBSTRING(@val,6,LEN(@val))
					
						INSERT INTO @TABLA VALUES(SUBSTRING(@PALLETS,@INICIAL,9),@val)
						SET @val=''
					--END			
				SET @SOPORTANTES=@SOPORTANTES-1
				SET @INICIAL=@INICIAL+9
			END
			END	
		RETURN 
END
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE FUNCTION [dbo].[SOPORTANTESACUMULADOS](@FECHA1 As varchar(10),@FECHA2 As Varchar(10),@RUT As Varchar(20),@CONTRATO As Varchar(20))  
RETURNS int   
AS   
 
BEGIN  
    DECLARE @diferencia_dias int;
	DECLARE @total int
	DECLARE @i int
	DECLARE @consulta int
	DECLARE @FECHA varchar(20)
	SET @FECHA = @FECHA1
	SET @i = 0
	SET @total = 0
	SET @diferencia_dias = (SELECT DATEDIFF(day, CAST(REPLACE(CONVERT(varchar(10), CAST(@FECHA1 AS DATE), 120),'-','/') AS DATE), CAST(REPLACE(CONVERT(varchar(10), CAST(@FECHA2 AS DATE), 120),'-','/') AS DATE)) )
    
	WHILE (@i <= @diferencia_dias)
      BEGIN  

	SET @consulta = (SELECT isnull(SUM(drec_pallet),0) As RECEPCIONES FROM detarece WHERE drec_fecrec<=REPLACE(CONVERT(varchar(10), CAST(@FECHA AS DATE), 120),'-','/') AND drec_codvig='0' AND drec_rutcli=@RUT AND drec_contcli=@CONTRATO)
      -(SELECT  isnull(SUM(ddes_pallet),0) As DESPACHOS FROM detadespa WHERE ddes_fecha<=REPLACE(CONVERT(varchar(10), CAST(@FECHA AS DATE), 120),'-','/') AND ddes_codvig='0' AND ddes_rutcli=@RUT AND ddes_contcli=@CONTRATO) 
	
	SET @total = @total + @consulta

	  SET @i=@i+1
      SET @FECHA = REPLACE(CONVERT(varchar(10), DATEADD(day,1, CAST(@FECHA AS DATE)), 120),'-','/')
      CONTINUE  
    END  
     
    RETURN @total;  
END; 
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE FUNCTION [dbo].[Split] (@String nvarchar (4000), @Delimitador nvarchar (10)) 
                returns @ValueTable table ([Value] nvarchar(4000))
begin
 declare @NextString nvarchar(4000)
 declare @Pos int
 declare @NextPos int
 declare @CommaCheck nvarchar(1)
  
 --Inicializa
 set @NextString = ''
 set @CommaCheck = right(@String,1) 
  
 set @String = @String + @Delimitador
  
 --Busca la posicin del primer delimitador
 set @Pos = charindex(@Delimitador,@String)
 set @NextPos = 1
  
 --Itera mientras exista un delimitador en el string
 while (@pos <>  0)  
 begin
  set @NextString = substring(@String,1,@Pos - 1)
  
  insert into @ValueTable ( [Value]) Values (@NextString)
  
  set @String = substring(@String,@pos +1,len(@String))
   
  set @NextPos = @Pos
  set @pos  = charindex(@Delimitador,@String)
 end
  
 return
end
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE FUNCTION [dbo].[SUMA_HORAS]( @HORA1 varchar(8), @HORA2 varchar(8))  
RETURNS varchar(8)   
AS   
 
BEGIN  

DECLARE @HORA1_FLOAT float;
DECLARE @HORA2_FLOAT float;
DECLARE @HORA_TOTAL float;
DECLARE @HORA int;
DECLARE @MINUTOS int;
DECLARE @HORA_FINAL varchar(8);
   
SET @HORA1_FLOAT = (SELECT SUM(CAST(CONVERT(DATETIME, CAST(@HORA1 AS time)) AS FLOAT)) AS HORA);
SET @HORA2_FLOAT = (SELECT SUM(CAST(CONVERT(DATETIME, CAST(@HORA2 AS time)) AS FLOAT)) AS HORA);

SET @HORA_TOTAL = @HORA1_FLOAT + @HORA2_FLOAT;

SET @HORA     = FLOOR(@HORA_TOTAL);
SET @MINUTOS  = (SELECT (@HORA_TOTAL - FLOOR(@HORA_TOTAL)) * 60);

SET @HORA_FINAL = (SELECT RIGHT('00' + CONVERT(varchar(2), @HORA), 2) + ':' + RIGHT('00' + CONVERT(varchar(2), @MINUTOS), 2));

       
    RETURN @HORA_FINAL;  
END; 






GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE FUNCTION [dbo].[TEMPERATURA_RECEPCION](@CODIGO As varchar(7))  
RETURNS @informacion TABLE 
(
    Cl_Ting varchar(50) NULL, 
    frec_rutcli varchar(50) NULL, 
    asociar varchar(50) NULL
)
AS
BEGIN

   DECLARE @val INT;
   SET @val = (SELECT  COUNT(Cl_Ting)
   FROM fichrece, clientes, contrato , choferes, P_TipoEstiba, P_TipoHigiene, P_TipoOlores , origen, P_TipoRecepcion, usuarios, P_TipoDao, P_TipoCargaDescarga, P_TipoTunel,p_EstadoDocumento,zChecklist
   WHERE cont_codi=frec_contcli AND cli_rut=frec_rutcli and cho_rut= frec_rutcond AND IdEstiba=frec_estiba AND frec_clfol = Cl_fol
   AND frec_higiene=IdHigiene AND frec_olores=idOlor AND ori_codi=frec_origen AND idRecepcion=frec_tiporecepcion  AND iddao=frec_daado AND tcar_codi=frec_tipdesc
   AND personal=frec_codienca AND frec_RecepTunel=IdTunel AND ed_codi=frec_codvig AND frec_codi=@CODIGO);


IF (@val>0)
INSERT @INFORMACION  
SELECT Cl_Ting,frec_rutcli, '1' As asociar
 FROM fichrece, clientes, contrato , choferes, P_TipoEstiba, P_TipoHigiene, P_TipoOlores , origen, P_TipoRecepcion, usuarios, P_TipoDao, P_TipoCargaDescarga, P_TipoTunel,p_EstadoDocumento,zChecklist
 WHERE cont_codi=frec_contcli AND cli_rut=frec_rutcli and cho_rut= frec_rutcond AND IdEstiba=frec_estiba AND frec_clfol = Cl_fol
 AND frec_higiene=IdHigiene AND frec_olores=idOlor AND ori_codi=frec_origen AND idRecepcion=frec_tiporecepcion  AND iddao=frec_daado AND tcar_codi=frec_tipdesc
 AND personal=frec_codienca AND frec_RecepTunel=IdTunel AND ed_codi=frec_codvig AND frec_codi=@CODIGO
ELSE
BEGIN
IF (@val<=0)
  INSERT @INFORMACION 
    SELECT  '0' As Cl_Ting, '0' As frec_rutcli, '1' As asociar
END;


RETURN
END
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE FUNCTION [dbo].[TONELADAS_CONGELADAS](@DIAS AS INT,@MES AS VARCHAR (2),@YEAR AS VARCHAR(4),@CONTRATO AS VARCHAR (20),@CLIENTE AS VARCHAR (9))  
RETURNS @DATOS TABLE 
(
TONELADAS  INT
)
AS   
BEGIN



	DECLARE @FECHA_ACTUAL DATE;
    DECLARE @FECHA_INICIAL varchar(10);
	DECLARE @FECHA_FINAL DATE;
	DECLARE @DI varchar(10);
	DECLARE @FECHA varchar(10);
	DECLARE @CONSULTA varchar(10);
	DECLARE @TONELADAS int;


	SET @FECHA_ACTUAL = CAST((SELECT CAST(YEAR(GETDATE()) AS VARCHAR)+'/'+CAST(MONTH(GETDATE()) AS VARCHAR)+'/'+CAST(DAY(GETDATE()) AS VARCHAR)) AS DATE);
	SET @TONELADAS    = 0;
	   
    SET @FECHA_INICIAL = @YEAR+'/'+@MES+'/01'
	SET @FECHA_FINAL   = @YEAR+'/'+@MES+'/'+CAST(@DIAS AS VARCHAR)

	IF (@FECHA_ACTUAL<@FECHA_FINAL)
	BEGIN
	       SET @FECHA_FINAL = @FECHA_ACTUAL;
	END

	
	  IF (@CONTRATO = 'TODOS')
	  SET @CONSULTA = (SELECT (SUM(drec_peso)/1000) AS TONELADAS FROM detarece, clientes 
                      WHERE drec_RecepTunel='2' AND drec_rutcli = cli_rut AND
                      drec_rutcli = @CLIENTE AND 
                      drec_fecrec BETWEEN @FECHA_INICIAL AND @FECHA_FINAL);
      ELSE
      SET @CONSULTA = (SELECT (SUM(drec_peso)/1000) AS TONELADAS FROM detarece, clientes 
                      WHERE drec_RecepTunel='2' AND drec_rutcli = cli_rut AND
                      drec_rutcli = @CLIENTE AND 
                      drec_fecrec BETWEEN @FECHA_INICIAL AND @FECHA_FINAL AND drec_contcli=@CONTRATO);
      /*END IF*/

	  IF (@CONSULTA = '')
	  BEGIN 
	  SET @CONSULTA = 0
	  END

	    
	 SET @TONELADAS = ROUND(@CONSULTA,0)
	

	INSERT INTO @DATOS VALUES (@TONELADAS)
     
    RETURN;  
END; 
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE FUNCTION [dbo].[TONELADASACUMULADAS](@FECHA1 As varchar(10),@FECHA2 As Varchar(10),@RUT As Varchar(20),@CONTRATO As Varchar(20))  
RETURNS int   
AS   
 
BEGIN  
    DECLARE @diferencia_dias int;
	DECLARE @total int
	DECLARE @i int
	DECLARE @consulta int
	DECLARE @FECHA varchar(20)
	SET @FECHA = @FECHA1
	SET @i = 0
	SET @total = 0
	SET @diferencia_dias = (SELECT DATEDIFF(day, CAST(REPLACE(CONVERT(varchar(10), CAST(@FECHA1 AS DATE), 120),'-','/') AS DATE), CAST(REPLACE(CONVERT(varchar(10), CAST(@FECHA2 AS DATE), 120),'-','/') AS DATE)) )
    
	WHILE (@i <= @diferencia_dias)
      BEGIN  

	SET @consulta = (SELECT isnull(SUM(drec_peso),0) As RECEPCIONES FROM detarece WHERE drec_fecrec<=REPLACE(CONVERT(varchar(10), CAST(@FECHA AS DATE), 120),'-','/') AND drec_codvig='0' AND drec_rutcli=@RUT AND drec_contcli=@CONTRATO)
      -(SELECT  isnull(SUM(ddes_peso),0) As DESPACHOS FROM detadespa WHERE ddes_fecha<=REPLACE(CONVERT(varchar(10), CAST(@FECHA AS DATE), 120),'-','/') AND ddes_codvig='0' AND ddes_rutcli=@RUT AND ddes_contcli=@CONTRATO) 
	
	SET @total = @total + @consulta

	  SET @i=@i+1
      SET @FECHA = REPLACE(CONVERT(varchar(10), DATEADD(day,1, CAST(@FECHA AS DATE)), 120),'-','/')
      CONTINUE  
    END  
     
    RETURN @total;  
END; 
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE FUNCTION [dbo].[ULTIMOS_7_DIAS](@RUT VARCHAR(12))  
RETURNS @DATOS TABLE 
(
FECHA  varchar(10),
SOPORTANTES VARCHAR(12)
)
AS   
BEGIN


   DECLARE @I int;
   DECLARE @K int;
   DECLARE @FECHA1 varchar(10);
   DECLARE @FECHA_A varchar(10);
   DECLARE @SOPORTANTES varchar(10);

   SET @I = 1;

   SET @FECHA1      = (SELECT CONVERT(varchar(10),CONVERT(date,CAST(GETDATE() AS DATE),106),103));
   SET @FECHA_A     = (SELECT REPLACE(CONVERT(date,CAST(GETDATE() AS DATE),106),'-','/'));
   SET @SOPORTANTES =(SELECT (SELECT isnull(SUM(drec_pallet),0) As RECEPCIONES FROM detarece WHERE drec_fecrec<=@FECHA_A AND drec_codvig='0' AND drec_rutcli=@RUT)
                    -(SELECT  isnull(SUM(ddes_pallet),0) As DESPACHOS FROM detadespa WHERE ddes_fecha<=@FECHA_A AND ddes_codvig='0' AND ddes_rutcli=@RUT) AS SOPORTANTES);
   
   INSERT INTO @DATOS VALUES (@FECHA1,@SOPORTANTES)

  WHILE(@I<7)
   BEGIN
   SET @K = @I*-1;
   SET @FECHA1      = (SELECT CONVERT(varchar(10),CONVERT(date,DATEADD(DAY,@K,CAST(GETDATE() AS DATE)),106),103));
   SET @FECHA_A     = (SELECT REPLACE(CONVERT(date,DATEADD(DAY,@K,CAST(GETDATE() AS DATE)),106),'-','/'));
   SET @SOPORTANTES =(SELECT (SELECT isnull(SUM(drec_pallet),0) As RECEPCIONES FROM detarece WHERE drec_fecrec<=@FECHA_A AND drec_codvig='0' AND drec_rutcli=@RUT)
                    -(SELECT  isnull(SUM(ddes_pallet),0) As DESPACHOS FROM detadespa WHERE ddes_fecha<=@FECHA_A AND ddes_codvig='0' AND ddes_rutcli=@RUT) AS SOPORTANTES);
   
   INSERT INTO @DATOS VALUES (@FECHA1,@SOPORTANTES)

   SET @I = @I+1;
   CONTINUE
  END

     
    RETURN;  
END; 
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE FUNCTION [dbo].[ULTIMOS_7_DIAS_DESPACHOS](@RUT VARCHAR(12))  
RETURNS @DATOS TABLE 
(
FECHA  varchar(10),
DESPACHOS VARCHAR(12)
)
AS   
BEGIN


   DECLARE @I int;
   DECLARE @K int;
   DECLARE @FECHA1 varchar(10);
   DECLARE @FECHA_A varchar(10);
   DECLARE @DESPACHOS varchar(10);

   SET @I = 1;

   SET @FECHA1      = (SELECT CONVERT(varchar(10),CONVERT(date,CAST(GETDATE() AS DATE),106),103));
   SET @FECHA_A     = (SELECT REPLACE(CONVERT(date,CAST(GETDATE() AS DATE),106),'-','/'));
   SET @DESPACHOS   =(SELECT ISNULL((SELECT COUNT(fdes_codi) AS DESPACHOS FROM fichdespa WHERE fdes_fecha BETWEEN @FECHA_A AND @FECHA_A AND fdes_rutcli = @RUT),0));
   
   SET @DESPACHOS = (FLOOR(ROUND(@DESPACHOS,0,1)));
   INSERT INTO @DATOS VALUES (@FECHA1,@DESPACHOS)

  WHILE(@I<7)
   BEGIN
   SET @K = @I*-1;
   SET @FECHA1      = (SELECT CONVERT(varchar(10),CONVERT(date,DATEADD(DAY,@K,CAST(GETDATE() AS DATE)),106),103));
   SET @FECHA_A     = (SELECT REPLACE(CONVERT(date,DATEADD(DAY,@K,CAST(GETDATE() AS DATE)),106),'-','/'));
   SET @DESPACHOS   =(SELECT ISNULL((SELECT COUNT(fdes_codi) AS DESPACHOS FROM fichdespa WHERE fdes_fecha BETWEEN @FECHA_A AND @FECHA_A AND fdes_rutcli = @RUT),0));
   
   SET @DESPACHOS = (FLOOR(ROUND(@DESPACHOS,0,1)));   
   INSERT INTO @DATOS VALUES (@FECHA1,@DESPACHOS)

   SET @I = @I+1;
   CONTINUE
  END

     
    RETURN;  
END; 
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE FUNCTION [dbo].[ULTIMOS_7_DIAS_RECEPCIONES](@RUT VARCHAR(12))  
RETURNS @DATOS TABLE 
(
FECHA  varchar(10),
RECEPCIONES VARCHAR(12)
)
AS   
BEGIN


   DECLARE @I int;
   DECLARE @K int;
   DECLARE @FECHA1 varchar(10);
   DECLARE @FECHA_A varchar(10);
   DECLARE @RECEPCIONES varchar(10);

   SET @I = 1;

   SET @FECHA1      = (SELECT CONVERT(varchar(10),CONVERT(date,CAST(GETDATE() AS DATE),106),103));
   SET @FECHA_A     = (SELECT REPLACE(CONVERT(date,CAST(GETDATE() AS DATE),106),'-','/'));
   SET @RECEPCIONES   =(SELECT ISNULL((SELECT COUNT(frec_codi) AS RECEPCIONES FROM fichrece WHERE frec_fecrec BETWEEN @FECHA_A AND @FECHA_A AND frec_rutcli = @RUT),0));
   
   SET @RECEPCIONES = (FLOOR(ROUND(@RECEPCIONES,0,1)));
   INSERT INTO @DATOS VALUES (@FECHA1,@RECEPCIONES)

  WHILE(@I<7)
   BEGIN
   SET @K = @I*-1;
   SET @FECHA1      = (SELECT CONVERT(varchar(10),CONVERT(date,DATEADD(DAY,@K,CAST(GETDATE() AS DATE)),106),103));
   SET @FECHA_A     = (SELECT REPLACE(CONVERT(date,DATEADD(DAY,@K,CAST(GETDATE() AS DATE)),106),'-','/'));
   SET @RECEPCIONES   =(SELECT ISNULL((SELECT COUNT(frec_codi) AS RECEPCIONES FROM fichrece WHERE frec_fecrec BETWEEN @FECHA_A AND @FECHA_A AND frec_rutcli = @RUT),0));
   
   SET @RECEPCIONES = (FLOOR(ROUND(@RECEPCIONES,0,1)));   
   INSERT INTO @DATOS VALUES (@FECHA1,@RECEPCIONES)

   SET @I = @I+1;
   CONTINUE
  END

     
    RETURN;  
END; 
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE FUNCTION [dbo].[ULTIMOS_7_DIAS_TUNEL](@RUT VARCHAR(12))  
RETURNS @DATOS TABLE 
(
FECHA  varchar(10),
TONELADAS VARCHAR(12)
)
AS   
BEGIN


   DECLARE @I int;
   DECLARE @K int;
   DECLARE @FECHA1 varchar(10);
   DECLARE @FECHA_A varchar(10);
   DECLARE @TONELADAS varchar(10);

   SET @I = 1;

   SET @FECHA1      = (SELECT CONVERT(varchar(10),CONVERT(date,CAST(GETDATE() AS DATE),106),103));
   SET @FECHA_A     = (SELECT REPLACE(CONVERT(date,CAST(GETDATE() AS DATE),106),'-','/'));
   SET @TONELADAS   =(SELECT ISNULL((SELECT (SUM(drec_peso)/1000) AS TONELADAS FROM detarece, clientes WHERE drec_RecepTunel='2' AND drec_rutcli = cli_rut 
                      AND drec_fecrec BETWEEN @FECHA_A AND @FECHA_A 
					  AND drec_rutcli = @RUT),0));

   SET @TONELADAS = (FLOOR(ROUND(@TONELADAS,0,1)));
   INSERT INTO @DATOS VALUES (@FECHA1,@TONELADAS)

  WHILE(@I<7)
   BEGIN
   SET @K = @I*-1;
   SET @FECHA1      = (SELECT CONVERT(varchar(10),CONVERT(date,DATEADD(DAY,@K,CAST(GETDATE() AS DATE)),106),103));
   SET @FECHA_A     = (SELECT REPLACE(CONVERT(date,DATEADD(DAY,@K,CAST(GETDATE() AS DATE)),106),'-','/'));
   SET @TONELADAS   =(SELECT ISNULL((SELECT (SUM(drec_peso)/1000) AS TONELADAS FROM detarece, clientes WHERE drec_RecepTunel='2' AND drec_rutcli = cli_rut 
                      AND drec_fecrec BETWEEN @FECHA_A AND @FECHA_A 
					  AND drec_rutcli = @RUT),0));

   SET @TONELADAS = (FLOOR(ROUND(@TONELADAS,0,1)));
   INSERT INTO @DATOS VALUES (@FECHA1,@TONELADAS)

   SET @I = @I+1;
   CONTINUE
  END

     
    RETURN;  
END; 
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
